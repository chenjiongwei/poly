USE [ERP25]
GO
/****** Object:  StoredProcedure [dbo].[usp_s_Calc_DsFee]    Script Date: 2025/4/28 18:46:26 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


-- 528CA87C-F7AF-4FDD-BD05-79641D9F67FB	东北公司
-- A8E2ACA1-508E-46F3-B764-8E2114255B4B	长春公司
-- CEBF9C18-CF48-49FD-B490-A86E3D9F10D4	大连公司
-- 8A08A706-0273-48BA-A1D4-6AB783024D42	江苏公司
-- 289A694A-E5D1-4F02-BFEF-8510E4B6C6A0	齐鲁公司
-- 2FF7167B-4398-4F0B-AFD8-AEA73DDAD8F5	浙江公司
-- 31120F08-22C4-4220-8ED2-DCAD398C823C	浙南公司
-- 4674A41A-81C3-4A20-8B5C-E52319022195	淮海公司
-- BC0235CB-1137-4488-8192-E55DC27ACCD7	山东公司


--***供用户使用，不加密***                                                  
--功能：计算代收费用定义时指定计算方法为“高级扩展”的代收费用                                                  
--参数：@chvSource    调用来源：指调用入口，模拟付款、定单、合同                                                  
--      @chvItemName  代收费用款项名称                                                   
--      @chvSaleGUID  销售单GUID：临时定单GUID（模拟付款）、定单GUID、合同GUID                                                  
--      @intPayFormNo 付款方式序号，用于模拟付款支持多付款方式时区分当前的付款方式                                                  
--返回：（返回参数）代收费用金额                                                  
--EXEC [usp_s_Calc_DsFee] '合同','公共维修基金','fe87097c-10af-ec11-b39c-f40270d39969','',''

--说明：                                                  
--     代收费用的计算有如下情况：                                                  
--     1、固定费用：按次收取，如：变更登记费、产权证贴花、邮寄费、代办费；                                                  
--     2、与交易金额有关：按总房款、贷款额比例收取，如：契税、印花税、保险(担保)费；                                                  
--     3、与房间有关：按建筑性质、面积收取，如：公共维修基金、物业费；                                                  
--     4、与业主有关：按个人、单位或国籍收取，如：契税、公证费                                                  
--    对于第1、2种情况，目前售楼系统中的代收费用定义基本能满足，而对于第3、4种情况的代收费用，以及第1、2种情况中有比较复杂计算关系的代收费用,                                                  
--在系统内定义就比较难以实现，因此提供此存储过程，根据传入的参数，从房间、客户、定单、合同等表取数，作为公式的变量，                                                  
--计算生成此类代收费用的金额；这样一来对于不同客户的不同需求，二次开发（或实施顾问）只要修改此存储过程就可以了，不用修改程序。                                                  
--                                                  
--注：采取按款项名称走分支的方式处理各个代收费用，必须强调的是这些款项名称必须是在系统中定义的，否则没法对接                                                  
alter  PROC [dbo].[usp_s_Calc_DsFee]
(
    @chvSource NVARCHAR(10),   --[来源]：指调用入口，模拟付款、usp_s_Calc_DsFee、合同。                                                  
    @chvItemName NVARCHAR(50), --[款项名称]：代收费用款项名称                                                    
    @chvSaleGUID NVARCHAR(50), --[销售单GUID]： 临时定单GUID（模拟付款）、定单GUID、合同GUID                                                  
    @intPayFormNo INT,         --[付款方式序号]：用于模拟付款支持多付款方式时区分当前的付款方式                                                  
    @decDsFee MONEY OUTPUT     --[代收费用]：返回参数                                                  
)
AS
SET @decDsFee = 0; --默认代收费用为零                                                  
--                                                  
IF (
       @chvSource <> '模拟付款'
       AND @chvSource <> '定单'
       AND @chvSource <> '合同'
   )
   OR @chvSaleGUID = ''
    RETURN 0;


--临时变量                                                  
DECLARE @decTmp MONEY,
        @chvTmp NVARCHAR(100);
DECLARE @chvRoomGUID NVARCHAR(50); --房间GUID                                                  
DECLARE @chvCstGUID NVARCHAR(50); --客户GUID                                                  
DECLARE @chvProjName NVARCHAR(50); --项目名称  
DECLARE @bldname NVARCHAR(50); --项目名称                                                 
DECLARE @mjtmp DECIMAL(19, 4); --面积                                                  
DECLARE @scmj DECIMAL(19, 4); --实测面积                                                  
DECLARE @moneymjtmp MONEY; --money格式面积                                                  
DECLARE @cplx NVARCHAR(50); --产品类型                     
DECLARE @productname NVARCHAR(50); --产品名称                                                  
DECLARE @zynum NVARCHAR(30); --置业次数                                                  
DECLARE @fkfs NVARCHAR(50); --付款方式                                          
DECLARE @ajnx MONEY; --银行按揭年限                                                  
DECLARE @ajdke MONEY; --银行按揭贷款额                                                  
DECLARE @gjjnx MONEY; --公积金年限                          
DECLARE @gjjdke MONEY; --公积金贷款额                                                  
DECLARE @buguid UNIQUEIDENTIFIER; --所属公司                                                  
DECLARE @jgtmp MONEY; --价格                                
DECLARE @BldCjPrice MONEY; --成交单价                                                  
DECLARE @gd MONEY; --过渡变量                                      
DECLARE @ge NVARCHAR(10); --购买的是个人还是公司                                                  
DECLARE @intCstCount INT; --业主个数                                                  
DECLARE @intIsAj INT; --是否有按揭贷款                                                  
DECLARE @intIsGjj INT; --是否有公积金                                          
DECLARE @qsdate NVARCHAR(10); --合同签署日期                                                  
DECLARE @sjbctotal MONEY; --实际补差金额                                      
DECLARE @projGUID UNIQUEIDENTIFIER; --所属项目                                                  
DECLARE @tradeGUID UNIQUEIDENTIFIER; --交易GUID                                      
DECLARE @bldguid UNIQUEIDENTIFIER; --楼栋GUID                                          
DECLARE @floor NVARCHAR(10); --楼层                                          
DECLARE @yszdate NVARCHAR(10); --预售证日期                         
DECLARE @hx NVARCHAR(10); --户型        
DECLARE @VATRate MONEY; --税率       
DECLARE @roomtotal MONEY; --房间总价       
DECLARE @cjtotal MONEY; --总房款     


DECLARE @fsfjscmj DECIMAL(19, 4); --附属房间实测面积    

DECLARE @unit NVARCHAR(50); --单元                                   

DECLARE @fanghao NVARCHAR(50); --fanghao   

DECLARE @PayFormType NVARCHAR(80); --付款方式类型  厦门 和院项目新增产权证工本费待售费用                                      


IF @chvSource = '模拟付款'
    SELECT @chvProjName = ProjName
    FROM p_Project,
         ep_room,
         s_OrderTmp
    WHERE p_Project.ProjGUID = ep_room.ProjGUID
          AND ep_room.RoomGUID = s_OrderTmp.RoomGUID
          AND s_OrderTmp.OrderGUID = @chvSaleGUID;



IF @chvSource = '定单'
    SELECT @chvProjName = ProjName,
           @projGUID = p_Project.ProjGUID
    FROM p_Project,
         ep_room,
         s_Order
    WHERE p_Project.ProjGUID = ep_room.ProjGUID
          AND ep_room.RoomGUID = s_Order.RoomGUID
          AND s_Order.OrderGUID = @chvSaleGUID;

SELECT @buguid = ep_room.BUGUID
FROM p_Project,
     ep_room,
     s_Order
WHERE p_Project.ProjGUID = ep_room.ProjGUID
      AND ep_room.RoomGUID = s_Order.RoomGUID
      AND s_Order.OrderGUID = @chvSaleGUID;

IF @chvSource = '合同'
    SELECT @chvProjName = ProjName,
           @projGUID = p_Project.ProjGUID
    FROM p_Project,
         ep_room,
         s_Contract
    WHERE p_Project.ProjGUID = ep_room.ProjGUID
          AND ep_room.RoomGUID = s_Contract.RoomGUID
          AND s_Contract.ContractGUID = @chvSaleGUID;









SELECT @buguid = ep_room.BUGUID
FROM p_Project,
     ep_room,
     s_Contract
WHERE p_Project.ProjGUID = ep_room.ProjGUID
      AND ep_room.RoomGUID = s_Contract.RoomGUID
      AND s_Contract.ContractGUID = @chvSaleGUID;



--代收SQL开始            
--南海湛江原点广场代收费用开始计算                         
IF (@chvProjName LIKE '%湛江原点广场%')
BEGIN
    --维修基金                                          
    --   计算方式：按预售建筑面积每平米60元收取                       
    IF @chvItemName = '维修基金'
    BEGIN


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  

        BEGIN
            SET @decDsFee = CAST(@mjtmp * 68 AS DECIMAL(18, 2));
        --set @decDsFee=ceiling (@mjtmp*45 )                     
        END;

        RETURN 6;
    END;

--维修基金计算完毕                   


END;
--南海湛江原点广场代收费用计算结束              

--广东公司代收费用开始计算(除红珊瑚、东江首府项目外)                                                  
IF (
       @buguid = '512381FE-A9CB-E511-80B8-E41F13C51836'
       AND
       (
           @projGUID <> '608aecb8-a499-4bc8-bbb5-27610c9e1b94'
           AND @projGUID <> '1A2E2609-3A04-4C5D-997F-A5E8BFC00A07'
       )
   )
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：个人购买的：住宅：建筑面积在144M2以下的，按楼价的1.5%，建筑面积在144m2以上，按楼价的3%，                                                  
    --   单位购买：按楼价的3%                                                  
    IF @chvItemName = '契税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                
        SET @mjtmp = 0;
        SET @scmj = 0;

        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0),
                   @mjtmp = CAST(BldArea AS DECIMAL(19, 4)),
                   @qsdate = CONVERT(CHAR(10), QSDate, 120)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @scmj = ScBldArea
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;




            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0),
                   @mjtmp = CAST(BldArea AS DECIMAL(19, 4)),
                   @qsdate = CONVERT(CHAR(10), QSDate, 120)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @scmj = ScBldArea
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“契税”                                                  


        IF (
               @cplx = '公寓'
               OR @cplx = '高级住宅'
               OR @cplx = '商业'
               OR @cplx = '写字楼'
               OR @cplx = '车位'
           )
        BEGIN
            SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.03);
        END;
        ELSE IF @cplx = '住宅'
                AND @ge = '个人'
        BEGIN
            IF @qsdate < '2011-10-01'
            BEGIN
                IF @scmj = 0
                BEGIN
                    IF @mjtmp >= 144
                    BEGIN
                        SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.03);
                    END;
                    IF @mjtmp < 144
                    BEGIN
                        SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.015);
                    END;
                END;
                IF @scmj <> 0
                BEGIN
                    IF @scmj >= 144
                    BEGIN
                        SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.03);
                    END;
                    IF @scmj < 144
                    BEGIN
                        SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.015);
                    END;
                END;
            END;

            IF @qsdate >= '2011-10-01'
            BEGIN
                SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.03);
            END;
        END;
        IF @ge = '公司'
        BEGIN
            SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.03);
        END;

        RETURN 1;

    END;

    ----契税计算结束；                                      


    --印花税计算开始                                                  

    --2、印花税                                                  
    --   --计算公式：①按业态进行区分，普通住宅不需要收取                                                  
    --               ②如购买高级住宅、商铺、写字楼、车位等，收取万分之五                                                  
    --                                                  
    IF @chvItemName = '印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        --  if charindex('住宅',@cplx) >0                                                   
        --   begin                                                  
        --    set @Cplx='住宅'                                                  
        --   end                                                  
        --  if charindex('高级住宅',@cplx) >0                                                    
        --   begin                                                   
        --    SET @Cplx='高级住宅'                                                    
        --   end                                              
        --  if charindex('商业',@cplx) >0                                                   
        --   begin                                                    
        --    SET @Cplx='商业'                                                    
        --   end                                                  
        --  if charindex('写字楼',@cplx) >0                                                     
        --   begin                                                  
        --    SET @Cplx='写字楼'                                                    
        --   end          

        --                                                  
        --                select @ge=rtrim(P_customer.csttype) from s_Order,s_Trade2Cst,p_Customer where s_Order.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_Order.OrderGUID = @chvSaleGUID;                                    








        --                       if @ge<>'公司'                                                  
        --                 begin                                                  
        --                   set @ge='个人';                 
        --                 end                                                   
        --                                                     
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        --  if charindex('住宅',@cplx) >0                                                   
        --   begin                                                  
        --    set @Cplx='住宅'                                                  
        --   end                                                  
        --  if charindex('高级住宅',@cplx) >0                                                    
        --   begin                                                   
        --    SET @Cplx='高级住宅'                                        
        --   end                                                  
        --  if charindex('商业',@cplx) >0                                                   
        --   begin                                                    
        --    SET @Cplx='商业'                                                    
        --   end                                                  
        --  if charindex('写字楼',@cplx) >0                                                     
        --   begin                                                  
        --    SET @Cplx='写字楼'                                                    
        --   end                                       
        --                                                        
        --                                                  
        --                select @ge=rtrim(P_customer.csttype) from s_contract,s_Trade2Cst,p_Customer where s_contract.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_contract.ContractGUID = @chvSaleGUID;                         














        --                       if @ge<>'公司'                                                  
        --                 begin                                                  
        --                   select @ge='个人';                                                  
        --                 end                                                  
        END;

        ---开始计算“印花税”                                                  


        IF (@cplx <> '住宅')
        BEGIN
            SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.0005);
        END;

        RETURN 1;

    END;
    --印花税计算结束                                                  


    /*                                                  
                                        
----权证综合费；                                                  
                                                 
--3:合同登记费                                                  
--   计算公式：如是商业住宅（商铺、车位、写字楼）550，如不是则个人50，单位80                                                  
   If @chvItemName='合同登记费'                                                  
       Begin                                                  
         --取出是个人购买还是公司购买                                                  
         set @ge=null;                                                  
                                                    
  If @chvSource = '模拟付款'                                                  
   --来源为“模拟付款”从临时定单表中获取                                                  
          begin                                                  
   SELECT @ajdke = 0                                                  
   select @chvRoomGUID =roomguid From s_Ordertmp where OrderGUID = @chvSaleGUID;                                                   
   Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID                                                          
                                                   
  if charindex('住宅',@cplx) >0                                                   
   begin                         
    set @Cplx='住宅'                                                  
   end                                                  
  if charindex('高级住宅',@cplx) >0                                                    
   begin                                                   
    SET @Cplx='高级住宅'                                                    
   end                                                  
  if charindex('商业',@cplx) >0                                           
  begin                                                    
    SET @Cplx='商业'                                                    
   end                                                  
  if charindex('写字楼',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='写字楼'                                             
   end                            
                                                      
                                                  
   select @ge='个人';                                                  
          end                                                  
   --“模拟付款”结束                                                  
                                                  
   If @chvSource = '定单'                                                  
          begin                                                  
  --来源为“定单”通过交易表获取                              
         select @ajdke = IsNull(AjTotal,0) + IsNull(GjjTotal,0) From s_Order Where OrderGUID = @chvSaleGUID;                                     
           select @chvRoomGUID =roomguid From s_Order where OrderGUID = @chvSaleGUID;                                                    
            Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID                                                          
                                                   
  if charindex('住宅',@cplx) >0                                                   
   begin                                                  
    set @Cplx='住宅'                                                  
   end                                                  
  if charindex('高级住宅',@cplx) >0                                                    
   begin                                                   
    SET @Cplx='高级住宅'                                                    
   end                          
  if charindex('商业',@cplx) >0                                                   
   begin                                                    
   SET @Cplx='商业'                                                    
   end                                                  
  if charindex('写字楼',@cplx) >0                                           
begin                                                  
    SET @Cplx='写字楼'                                                    
   end                                                  
                                                    
                                                                 
   select @ge=rtrim(P_customer.csttype) from s_Order,s_Trade2Cst,p_Customer where s_Order.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_Order.OrderGUID = @chvSaleGUID;                                                  
     if @ge<>'公司'                                                  
                 begin                                                  
                   select @ge='个人';                                                  
                 end                                                   
   end                             
                                                  
   If @chvSource = '合同'                                                  
--来源为“合同”通过合同表获取                                                  
    begin                                                  
                Select @ajdke = IsNull(AjTotal,0) + IsNull(GjjTotal,0) From s_Contract Where ContractGUID = @chvSaleGUID;                                                  
    select @chvRoomGUID =roomguid From s_Contract where ContractGUID = @chvSaleGUID;                                                    
               Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID                                                          
                                                   
  if charindex('住宅',@cplx) >0                                                   
   begin                                                  
    set @Cplx='住宅'                                                  
   end                                                  
  if charindex('高级住宅',@cplx) >0                                                    
   begin                                                   
    SET @Cplx='高级住宅'                                                    
   end                                                  
  if charindex('商业',@cplx) >0                                                   
   begin                                      
    SET @Cplx='商业'                                                    
   end                                                  
  if charindex('写字楼',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='写字楼'                                                    
   end                                                   
                             
                                                  
                select @ge=rtrim(P_customer.csttype) from s_contract,s_Trade2Cst,p_Customer where s_contract.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_contract.ContractGUID = @chvSaleGUID;                           
 
    
      
        
          
          
            
              
                 
                  
                    
                      
                       
                       if @ge<>'公司'                                    
      begin                                                  
        select @ge='个人';                                                  
      end                                                  
           end                                                  
                                           
     --开始计算                                                  
          
                                                  
 if ( @cplx = '商业' or @cplx = '写字楼' or @cplx = '车位' )                                                  
     set @decDsFee = 550;                   
 else                                                   
      if @ge='个人'  Set @decDsFee = 50;                                                    
 else                                                    
      if @ge='公司'  Set @decDsFee = 80;                                                  
    return 5                                                  
end                                                  
*/
    --3:产权登记费                                                  
    --   计算公式：如是商业住宅（商铺、车位、写字楼）550，如不是则个人50，单位80,每多1个人名，多收10块工本费。                                                  
    IF @chvItemName = '产权登记费'
    BEGIN
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算                                                  


        IF (@cplx = '商业' OR @cplx = '写字楼' OR @cplx = '车位' OR @cplx = '公寓')
            SET @decDsFee = 550 + (10 * (@intCstCount - 1));
        ELSE IF @ge = '个人'
            SET @decDsFee = 80 + (10 * (@intCstCount - 1));
        ELSE IF @ge = '公司'
            SET @decDsFee = 80 + (10 * (@intCstCount - 1));

        RETURN 5;
    END;

    --4:合同登记费                                          
    --   计算公式：如是商业住宅（商铺、车位、写字楼）550，如不是则个人50，单位80                                                  
    IF @chvItemName = '合同登记费'
    BEGIN
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                             
        BEGIN
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算                                                  


        IF (@cplx = '商业' OR @cplx = '写字楼' OR @cplx = '车位' OR @cplx = '公寓')
            SET @decDsFee = 550;
        ELSE IF @ge = '个人'
            SET @decDsFee = 50;
        ELSE IF @ge = '公司'
            SET @decDsFee = 80;

        RETURN 4;
    END;





    --5:物业维修基金                              
    --   计算公式：建筑面积*105，结果四舍五入；                                                  
    IF @chvItemName = '物业维修基金'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @moneymjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @moneymjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;

        --开始计算                                                  
        IF @cplx LIKE '%高层住宅%'
           OR @cplx LIKE '%商业%'
        BEGIN
            SET @decDsFee = @moneymjtmp * 105;
        END;
        ELSE
            SET @decDsFee = @moneymjtmp * 105;

        RETURN 4;
    END;
    --物业维修基金计算完毕                                                  



    --2、制证费                                                  
    --   --计算公式：交易仅一个权益人时不收取该费用，每增加一个权益人则多收10元                                                  
    --                                                  
    IF @chvItemName = '制证费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                         
            SELECT @decTmp = COUNT(1)
            FROM s_Order
                 LEFT JOIN s_trade2cst ON s_Order.TradeGUID = s_trade2cst.TradeGUID
            WHERE OrderGUID = @chvSaleGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = COUNT(1)
            FROM s_Contract
                 LEFT JOIN s_trade2cst ON s_Contract.TradeGUID = s_trade2cst.TradeGUID
            WHERE ContractGUID = @chvSaleGUID;
        END;
        ---开始计算“制证费”                                                  

        SET @decDsFee = (@decTmp - 1) * 10;


        RETURN 1;
    END;
--制证费计算结束                                                  

END;
---广东公司代收SQL计算结束                                    

--粤东公司红珊瑚项目代收费用开始计算                                                  
IF (@projGUID = '608aecb8-a499-4bc8-bbb5-27610c9e1b94')
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：个人购买的：住宅：建筑面积在144M2以下的，按楼价的1.5%，建筑面积在144m2以上，按楼价的3%，                                                  
    --   单位购买：按楼价的3%                                                  
    IF @chvItemName = '契税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        SET @scmj = 0;

        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0),
                   @mjtmp = CAST(BldArea AS DECIMAL(19, 4)),
                   @qsdate = CONVERT(CHAR(10), QSDate, 120)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0),
                   @mjtmp = CAST(BldArea AS DECIMAL(19, 4)),
                   @qsdate = CONVERT(CHAR(10), QSDate, 120)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
        END;

        --开始计算“契税”                                                  

        SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.03);

        RETURN 1;

    END;

    ----契税计算结束；                                                  


    --印花税计算开始                                                  

    --2、印花税                                                  
    --   --计算公式：①按业态进行区分，普通住宅不需要收取                                                  
    --               ②如购买高级住宅、商铺、写字楼、车位等，收取万分之五                                 
    --                                                  
    IF @chvItemName = '印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
        --                                                     
        END;

        IF @chvSource = '合同' --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


        ---开始计算“印花税”                                                  

        END;

        IF @cplx <> '住宅'
            SET @decDsFee = CAST(@decTmp * 0.0005 AS DECIMAL(10, 2));


        RETURN 1;

    END;
    --印花税计算结束                                                  



    /*                                                  
                                                  
----权证综合费；                                                  
                                                  
--3:合同登记费                                                  
--   计算公式：如是商业住宅（商铺、车位、写字楼）550，如不是则个人50，单位80                                         
    If @chvItemName='合同登记费'                                                  
       Begin                                                  
         --取出是个人购买还是公司购买                                                  
         set @ge=null;                       
                                                    
  If @chvSource = '模拟付款'                                                  
   --来源为“模拟付款”从临时定单表中获取                                                  
          begin                                                  
   SELECT @ajdke = 0                        
   select @chvRoomGUID =roomguid From s_Ordertmp where OrderGUID = @chvSaleGUID;                                                   
   Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID                                                          
                                                   
  if charindex('住宅',@cplx) >0                                                   
   begin                                                  
    set @Cplx='住宅'                                                  
   end                                                  
  if charindex('高级住宅',@cplx) >0                                                    
   begin                            
    SET @Cplx='高级住宅'                                                    
   end                                        
  if charindex('商业',@cplx) >0                                                   
   begin                                           
    SET @Cplx='商业'                                                    
   end                                                  
  if charindex('写字楼',@cplx) >0                   
   begin                                                  
    SET @Cplx='写字楼'                                                    
   end                                    
                      
                                                  
   select @ge='个人';                                                  
          end                                                  
   --“模拟付款”结束                       
                                                  
   If @chvSource = '定单'                                                  
          begin                                                  
  --来源为“定单”通过交易表获取                                                  
         select @ajdke = IsNull(AjTotal,0) + IsNull(GjjTotal,0) From s_Order Where OrderGUID = @chvSaleGUID;                                                  
           select @chvRoomGUID =roomguid From s_Order where OrderGUID = @chvSaleGUID;                                                    
            Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID                                                          
                                                   
  if charindex('住宅',@cplx) >0                                                   
   begin                                                  
    set @Cplx='住宅'                                                  
   end                                                  
  if charindex('高级住宅',@cplx) >0                                                    
   begin                                                   
    SET @Cplx='高级住宅'                               
   end                                                  
  if charindex('商业',@cplx) >0                                                   
   begin                                                    
    SET @Cplx='商业'                   
   end                                                  
  if charindex('写字楼',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='写字楼'                                                    
   end                                                  
                                                    
                  
   select @ge=rtrim(P_customer.csttype) from s_Order,s_Trade2Cst,p_Customer where s_Order.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_Order.OrderGUID = @chvSaleGUID;                                                  
     if @ge<>'公司'                                                  
                 begin                                                  
                   select @ge='个人';                                                  
                 end                                                   
   end                                                  
                                  
   If @chvSource = '合同'                                                  
    --来源为“合同”通过合同表获取                                                  
    begin                                                  
                Select @ajdke = IsNull(AjTotal,0) + IsNull(GjjTotal,0) From s_Contract Where ContractGUID = @chvSaleGUID;                                                  
    select @chvRoomGUID =roomguid From s_Contract where ContractGUID = @chvSaleGUID;                                                    
               Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID                                                          
                                                   
  if charindex('住宅',@cplx) >0                                                  
   begin                                                  
    set @Cplx='住宅'                                                  
   end                                      
  if charindex('高级住宅',@cplx) >0                                                    
   begin            
    SET @Cplx='高级住宅'                                      
   end                                                  
  if charindex('商业',@cplx) >0                    
   begin                                                    
    SET @Cplx='商业'                                                    
   end                                                  
  if charindex('写字楼',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='写字楼'                                                    
   end                                                   
                                                    
                                                  
  select @ge=rtrim(P_customer.csttype) from s_contract,s_Trade2Cst,p_Customer where s_contract.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_contract.ContractGUID = @chvSaleGUID;                                        
  
    
      
        
          
          
                       if @ge<>'公司'                                                  
      begin                                          
        select @ge='个人';                                                  
      end                                         
           end                                                  
                                                  
     --开始计算                                                  
                                                  
                                                  
 if ( @cplx = '商业' or @cplx = '写字楼' or @cplx = '车位' )                                                  
     set @decDsFee = 550;                               
 else                                                   
      if @ge='个人'  Set @decDsFee = 50;                                                    
 else                           
      if @ge='公司'  Set @decDsFee = 80;                                                  
    return 5                                                  
end             
*/
    --3:转移登记费                                                  
    --   计算公式：如是非住宅（商铺、车位、写字楼）550，住宅80,每多1个人名，多收10块工本费。                                                  
    IF @chvItemName = '转移登记费'
    BEGIN
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;

        END;

        --开始计算                                                  


        IF (@cplx <> '住宅')
            SET @decDsFee = 550 + (10 * (@intCstCount - 1));
        ELSE
            SET @decDsFee = 50 + (10 * (@intCstCount - 1));


        RETURN 5;
    END;
    --4:合同登记费                                                  
    --   计算公式：如是商业住宅（商铺、车位、写字楼）550，如不是则个人50，单位80                                                  
    IF @chvItemName = '合同登记费'
    BEGIN
        --取出是个人购买还是公司购买                              
        SET @ge = NULL;

        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN
            SELECT @ajdke = 0;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = '个人';
        END;
        --“模拟付款”结束                            

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算                                                  


        IF (@cplx = '商业' OR @cplx = '写字楼' OR @cplx = '车位')
            SET @decDsFee = 550;
        ELSE IF @ge = '个人'
            SET @decDsFee = 50;
        ELSE IF @ge = '公司'
            SET @decDsFee = 80;

        RETURN 4;
    END;

    --5:物业维修基金                                                  
    --   计算公式：住宅：建筑面积*40，非住宅：建筑面积*50，结果保留到分；                                                  
    IF @chvItemName = '物业维修基金'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @moneymjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @moneymjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
        END;

        --开始计算                                                  
        IF @cplx <> '住宅'
            SET @decDsFee = ROUND(@moneymjtmp * 50, 2);
        ELSE
            SET @decDsFee = ROUND(@moneymjtmp * 40, 2);

        RETURN 4;
    END;
    --物业维修基金计算完毕                                                  


    --5:借款合同印花税                                                  
    --   计算公式：贷款金额×0.05‰，结果四舍五入；                                                  
    IF @chvItemName = '借款合同印花税'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @tradeGUID = TradeGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @decTmp = ISNULL(SUM(RmbAmount), 0)
            FROM s_Fee
            WHERE TradeGUID = @tradeGUID
                  AND ItemType = '贷款类房款'
            GROUP BY TradeGUID;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @tradeGUID = TradeGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @decTmp = ISNULL(SUM(RmbAmount), 0)
            FROM s_Fee
            WHERE TradeGUID = @tradeGUID
                  AND ItemType = '贷款类房款'
            GROUP BY TradeGUID;
        END;

        --开始计算                                                  
        IF @decTmp <> 0
            SET @decDsFee = ROUND(@decTmp * 0.00005, 2);


        RETURN 4;
    END;
    --借款合同印花税计算完毕                                                  

    --5:交易手续费                
    --   计算公式：3元/ m2（限商铺客户），结果保留到分；                                                  
    IF @chvItemName = '交易手续费'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @moneymjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @moneymjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
        END;

        --开始计算                                                  
        IF @cplx = '商业'
            SET @decDsFee = @moneymjtmp * 3;


        RETURN 4;
    END;
    --交易手续费计算完毕                                                  


    --2、制证费    --   --计算公式：交易仅一个权益人时不收取该费用，每增加一个权益人则多收10元                                                  
    --                                                  
    IF @chvItemName = '制证费'
    BEGIN
        --取价格                                        
        SET @decTmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = COUNT(1)
            FROM s_Order
                 LEFT JOIN s_trade2cst ON s_Order.TradeGUID = s_trade2cst.TradeGUID
            WHERE OrderGUID = @chvSaleGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = COUNT(1)
            FROM s_Contract
                 LEFT JOIN s_trade2cst ON s_Contract.TradeGUID = s_trade2cst.TradeGUID
            WHERE ContractGUID = @chvSaleGUID;
        END;
        ---开始计算“制证费”                                                  

        SET @decDsFee = (@decTmp - 1) * 10;


        RETURN 1;

    END;
--制证费计算结束                                                  
END;

---粤东公司红珊瑚代收SQL计算结束                                 

--阳江罗兰香谷代收SQL开始                                                  

IF (
       @chvProjName LIKE '%罗兰香谷%'
       AND @buguid = '4F3B4F6A-0ED9-468A-8158-3F1559C5F2E4'
   )
BEGIN

    --根据不同的代收费用分别进行计算                                                  


    --------------------------------------------12：档案费                                           
    --计算公式:档案费 <= 0～150平米50元/宗，150.01～800平米300元/宗，800平米以上800元宗，建筑面积划分                                                  

    IF @chvItemName = '档案费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN

            IF @intPayFormNo = 1
            BEGIN
                SELECT @decTmp = Cjtotal1
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            IF @intPayFormNo = 2
            BEGIN
                SELECT @decTmp = Cjtotal2
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;

            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = '个人';
        END;
        --“模拟付款”结束                                                  

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                            
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“档案费”                                                  

        IF (@mjtmp <= 150)
        BEGIN
            SET @decDsFee = 50;
        END;
        IF (@mjtmp > 150 AND @mjtmp <= 800)
        BEGIN
            SET @decDsFee = 300;
        END;
        IF (@mjtmp > 800)
        BEGIN
            SET @decDsFee = 800;
        END;
        RETURN 12;
    END;
    --“档案费”计算完毕                                                  



    --------------------------------------------11：房地产他项权证档案费                                                  
    --计算公式：建筑面积150平方米以下：50元（不包含150平方米）建筑面积150平方米以上：300元（含150平方米）（银行按揭、公积金客户都交）                                                  

    IF @chvItemName = '房地产他项权证档案费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN

            IF @intPayFormNo = 1
            BEGIN
                SELECT @decTmp = Cjtotal1
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            IF @intPayFormNo = 2
            BEGIN
                SELECT @decTmp = Cjtotal2
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;

            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = '个人';
        END;
        --“模拟付款”结束                                                  

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;

            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“房地产他项权证档案费”                                                  

        IF (@mjtmp < 150)
        BEGIN
            SET @decDsFee = 50;
        END;
        IF (@mjtmp >= 150)
        BEGIN
            SET @decDsFee = 300;
        END;
        RETURN 11;
    END;
    --“房地产他项权证档案费”计算完毕                                                  




    --------------------------------------------10：预告登记费                                                 
    --计算公式：套内面积120平方米以下：80元/宗 套内面积120平方米以上：550元/宗                 

    IF @chvItemName = '预告登记费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN

            IF @intPayFormNo = 1
            BEGIN
                SELECT @decTmp = Cjtotal1
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            IF @intPayFormNo = 2
            BEGIN
                SELECT @decTmp = Cjtotal2
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;

            SELECT @mjtmp = CAST(TnArea AS DECIMAL(19, 4))
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = '个人';
        END;
        --“模拟付款”结束                                                  

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(TnArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(TnArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“预告登记费”                               

        IF (@mjtmp < 120)
        BEGIN
            SET @decDsFee = 80;
        END;
        IF (@mjtmp >= 120)
        BEGIN
            SET @decDsFee = 550;
        END;
        RETURN 10;
    END;
    --“预告登记费”计算完毕                                                  


    --------------------------------------------9：产权登记费                                       
    --计算公式：【套内面积120平米以下80元/宗，120平米以上按550元/宗，每增加一人加收10元】                                                  
    IF @chvItemName = '产权登记'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                
        SET @ge = NULL;

        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN

            IF @intPayFormNo = 1
            BEGIN
                SELECT @decTmp = Cjtotal1
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            IF @intPayFormNo = 2
            BEGIN
                SELECT @decTmp = Cjtotal2
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            SELECT @intCstCount = 1;
            SELECT @mjtmp = CAST(TnArea AS DECIMAL(19, 4))
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = '个人';
        END;
        --“模拟付款”结束                                                  

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取    select @decTmp=isnull(RmbCjTotal,0) from s_Order where OrderGUID = @chvSaleGUID;                                  
            SELECT @mjtmp = CAST(TnArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(TnArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;








            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“产权登记费”                                                  

        IF (@mjtmp < 120)
        BEGIN
            SET @decDsFee = 80 + ((@intCstCount - 1) * 10);
        END;
        IF (@mjtmp >= 120)
        BEGIN
            SET @decDsFee = 550 + ((@intCstCount - 1) * 10);
        END;
        RETURN 9;
    END;
    --“产权登记费”计算完毕                                                  


    --------------------------------------------8：交易手续费                                                  
    --计算公式：建筑面积*3元/平方米                                                  
    IF @chvItemName = '交易手续费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN

            IF @intPayFormNo = 1
            BEGIN
                SELECT @decTmp = Cjtotal1
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            IF @intPayFormNo = 2
            BEGIN
                SELECT @decTmp = Cjtotal2
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = '个人';
        END;
        --“模拟付款”结束                                                  

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“交易手续费”                                                  


        SET @decDsFee = ROUND((@mjtmp * 3), 0);

        RETURN 8;
    END;
    --“交易手续费”计算完毕                                                  



    --------------------------------------------7：维修基金                                                  
    --计算公式：建筑面积每平方米×990×5%    （洋房）  建筑面积每平方米×1050×5%   (高级住宅)                                                  
    IF @chvItemName LIKE '%维修基金%'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN

            IF @intPayFormNo = 1
            BEGIN
                SELECT @decTmp = Cjtotal1
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            IF @intPayFormNo = 2
            BEGIN
                SELECT @decTmp = Cjtotal2
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;

            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = '个人';
        END;
        --“模拟付款”结束                                  

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“维修基金”                                                  


        IF (@cplx = '住宅')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 990 * 0.05), 0);
        END;

        IF (@cplx = '高级住宅')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 1050 * 0.05), 0);
        END;
        RETURN 7;

    END;
    --“物业维修基金”计算完毕                                   

    --------------------------------------------6：保险费                                                  
    --计算公式：贷款额×（贷款年期+1）×0.0006（公积金贷款）                                                  
    IF @chvItemName = '保险费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN

            IF @intPayFormNo = 1
            BEGIN
                SELECT @decTmp = Cjtotal1
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            IF @intPayFormNo = 2
            BEGIN
                SELECT @decTmp = Cjtotal2
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;

            SELECT @gjjdke = CAST(Ajtotal1 AS INT)
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @gjjnx = CAST(Ajyear1 AS INT)
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = '个人';
        END;
        --“模拟付款”结束                                           

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @gjjdke = CAST(AjTotal AS INT)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @gjjnx = CAST(AjYear AS INT)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @gjjdke = CAST(AjTotal AS INT)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @gjjnx = CAST(AjYear AS INT)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“保险费”                              


        SET @decDsFee = ROUND((@gjjdke * (@gjjnx + 1) * 0.0006), 0);

        RETURN 6;
    END;
    --“保险费”计算完毕                                                  

    --------------------------------------------5：测绘费                                        
    --计算公式：[0-50㎡按80元每宗，50.01-100㎡按120元每宗，100.01-200㎡按160元每宗，每递增100㎡多40元每宗，建筑面积划分]                                                  
    IF @chvItemName = '测绘费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN

            IF @intPayFormNo = 1
            BEGIN
                SELECT @decTmp = Cjtotal1
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            IF @intPayFormNo = 2
            BEGIN
                SELECT @decTmp = Cjtotal2
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;

            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = '个人';
        END;
        --“模拟付款”结束                                                  

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“测绘费”                                                  

        IF (@mjtmp <= 50)
        BEGIN
            SET @decDsFee = 80;
        END;
        IF (@mjtmp > 50 AND @mjtmp <= 100)
        BEGIN
            SET @decDsFee = 120;
        END;
        IF (@mjtmp > 100 AND @mjtmp <= 200)
        BEGIN
            SET @decDsFee = 160;
        END;
        IF (@mjtmp > 200 AND @mjtmp <= 300)
        BEGIN
            SET @decDsFee = 200;
        END;
        IF (@mjtmp > 300 AND @mjtmp <= 400)
        BEGIN
            SET @decDsFee = 240;
        END;
        IF (@mjtmp > 400 AND @mjtmp <= 500)
        BEGIN
            SET @decDsFee = 280;
        END;
        IF (@mjtmp > 500 AND @mjtmp <= 600)
        BEGIN
            SET @decDsFee = 320;
        END;
        IF (@mjtmp > 600 AND @mjtmp <= 700)
        BEGIN
            SET @decDsFee = 360;
        END;
        IF (@mjtmp > 700 AND @mjtmp <= 800)
        BEGIN
            SET @decDsFee = 400;
        END;
        IF (@mjtmp > 800 AND @mjtmp <= 900)
        BEGIN
            SET @decDsFee = 440;
        END;
        IF (@mjtmp > 900 AND @mjtmp <= 1000)
        BEGIN
            SET @decDsFee = 480;
        END;
        RETURN 5;
    END;
    --“测绘费”计算完毕                                                  



    --------------------------------------------4：抵押评估费                             
    --计算公式：房价总额100万以内为0.005，101万至1000万为0.0025（银行按揭才交）                                                  

    IF @chvItemName = '抵押评估费'
    BEGIN
        --取价格                                   
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN

            IF @intPayFormNo = 1
            BEGIN
                SELECT @decTmp = Cjtotal1
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            IF @intPayFormNo = 2
            BEGIN
                SELECT @decTmp = Cjtotal2
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = '个人';
        END;
        --“模拟付款”结束                                                  

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(TnArea AS INT)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;





            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“抵押评估费”                                                  

        IF (@decTmp <= 1000000)
        BEGIN
            SET @decDsFee = ROUND((@decTmp * 0.005), 0);
        END;
        IF (@decTmp > 1000000)
        BEGIN
            SET @decDsFee = ROUND((((@decTmp - 1000000) * 0.0025) + 5000), 0);
        END;
        RETURN 4;
    END;
    --“抵押评估费”计算完毕                                                  

    --------------------------------------------3：房产证印花                                                
    --计算公式：【5块每宗，每增加一人加收5元】                                                  
    IF @chvItemName = '房产证印花'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN

            IF @intPayFormNo = 1
            BEGIN
                SELECT @decTmp = Cjtotal1
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            IF @intPayFormNo = 2
            BEGIN
                SELECT @decTmp = Cjtotal2
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            SELECT @intCstCount = 1;
        END;
        --“模拟付款”结束                                                  

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“房产证印花”                       


        SET @decDsFee = 5 * @intCstCount;

        RETURN 3;
    END;
END;

--“房产证印花”计算完毕                                                  

----阳江公司银滩项目代收费用计算                                                  

IF (
       @chvProjName LIKE '%银滩%'
       AND @buguid = '4F3B4F6A-0ED9-468A-8158-3F1559C5F2E4'
   )
BEGIN

    --------------------------------------------12：档案费                      
    --计算公式:档案费 <= 0～150平米50元/宗，150.01～800平米300元/宗，800平米以上400元宗，建筑面积划分                                                  

    IF @chvItemName = '利用档案费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“利用档案费”                                                  

        IF (@mjtmp <= 150)
        BEGIN
            SET @decDsFee = 50;
        END;
        IF (@mjtmp > 150 AND @mjtmp <= 800)
        BEGIN
            SET @decDsFee = 300;
        END;
        IF (@mjtmp > 800)
        BEGIN
            SET @decDsFee = 400;
        END;
        RETURN 12;
    END;
    --“档案费”计算完毕                                                  

    --------------------------------------------4：抵押评估费        --计算公式：房价总额100万以内为0.005，101万至1000万为0.0025                       

    IF @chvItemName = '抵押评估费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(TnArea AS INT)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;









            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“抵押评估费”                                                  

        IF (@decTmp <= 1000000)
        BEGIN
            SET @decDsFee = ROUND((@decTmp * 0.005), 0);
        END;
        IF (@decTmp > 1000000)
        BEGIN
            SET @decDsFee = ROUND((1000000 * 0.005), 0) + ROUND(((@decTmp - 1000000) * 0.0025), 0);
        END;
        RETURN 4;
    END;
    --“抵押评估费”计算完毕                                        

    --------------------------------------------7：维修基金                                                  
    --计算公式：建筑面积*890*5%（多层）  建筑面积*1312*5%（含地下室）(高层住宅)  建筑面积*1207*5% (高级住宅)                                                  
    IF @chvItemName = '物业维修基金'
    BEGIN
        --取价格                            
        SET @decTmp = 0;
        --取面积                                           
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;





            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“物业维修基金”                                                  


        IF (@cplx = '多层住宅')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 890 * 0.05), 0);
        END;

        IF (@cplx = '高层住宅')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 1312 * 0.05), 0);
        END;

        IF (@cplx = '高级住宅')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 1207 * 0.05), 0);
        END;
        RETURN 7;

    END;
    --“维修基金”计算完毕                                                  

    --------------------------------------------6：保险费                                                  
    --计算公式：贷款额×（贷款年期+1）×0.0006（公积金贷款）                                                  
    IF @chvItemName = '公积金保险费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                      
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买               
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @gjjdke = CAST(AjTotal AS INT)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @gjjnx = CAST(AjYear AS INT)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @gjjdke = CAST(AjTotal AS INT)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @gjjnx = CAST(AjYear AS INT)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM ep_room
            WHERE ep_room.RoomGUID = @chvRoomGUID;
            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;











            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“公积金保险费”                                                  


        SET @decDsFee = ROUND((@gjjdke * (@gjjnx + 1) * 0.0006), 0);

        RETURN 6;
    END;

    --------------------------------------------房屋所有权转移登记费                                                  
    --计算公式：住宅80元/套；商铺550元/套 (H区、J区、Q区 )                                                
    IF @chvItemName = '房屋所有权转移登记费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            SELECT @cplx = p_room.ProductName
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;









            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_room.ProductName
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“房屋所有权转移登记费”                                                  

        IF (@bldguid IN ( 'DA133055-670D-4A54-A47B-0024814A680E', 'AA40CACD-8673-44DE-93B4-038D78BF0B97',
                          '62D51EC5-C5E8-47DE-9D5E-0679E9ED6CBC', '1C034705-F63A-4540-A797-0B88BF1188D0',
                          '9183A408-DAA0-48E6-818B-0BD955FCD1FA', '0330BE54-0ABD-4265-B55C-0D3F4A5B6EB7',
                          '25C94D40-614F-451C-AEE8-119077220D67', '4FAA99C5-506B-463C-8860-12A3E4CFC093',
                          '7E42B41B-8033-438C-8A0A-12AA8DE34990', 'A54A15CA-CCDC-4404-817B-138B5FD5E551',
                          '1B035CBE-C0AD-493C-B229-16CC21A7C25D', 'AE78974E-8025-4AF8-A9AD-17826BAF9BEB',
                          'D5783D12-BB48-4AF5-8E07-196A6B2E66AC', '62E109C4-34D7-4FAB-B9DF-1E44F656C081',
                          '58581AC5-EDAF-47E3-8548-1EFB9B35D659', 'C3678197-9359-422A-96FA-2211E1774FF5',
                          '8BD5C385-7DC1-432F-8915-250B1E276F1E', '7D4A840A-D48B-4491-9BFC-2A337D4A9E75',
                          '108A3A81-0A2D-49A4-8127-2F8372EB0DAB', '1A781D6C-1F08-41A8-B70F-3102821BBC54',
                          '92A883C3-9006-4437-81E8-3281D16654EC', 'FC495931-8C2D-4742-A55A-409C31364965',
                          '6BE4CF15-C163-453F-B080-4149C23E95F5', '55460201-70D7-4BD2-BC70-45AAB8396D59',
                          'CD62361C-EB8D-48A9-B063-471C371BF07C', 'F2184B91-DC07-466A-A9D0-4C07962852CD',
                          'C7B53561-B8EC-42CA-9BBE-50E42D6A79C9', 'B19DC94F-9D16-4671-B232-53F91C99F821',
                          '06A0EE94-3B88-4F3E-B238-56CE79286DE8', '9C31FE7D-30A3-4BB2-A223-57ADFFF2AC8B',
                          'F3C4056D-2D2B-4A6D-AE95-5A409DDBF65F', '2E2470A7-FABD-47BA-9470-7A6D439AD318',
                          'A27AD069-6324-43DD-96D5-7DF943A0A6EF', 'A9E25699-7EC6-4D53-BB81-7EBE8F7218DE',
                          '212CA5FE-CA0A-4F97-AAE0-8701EAE6AD28', '656CF982-AAAD-4D1D-AE4F-8A4F4BDEF570',
                          '74744E46-6555-4A5C-9139-8B866E62AC3C', '3A0E23CA-0FC9-4F41-BF9E-9274E7E33E05',
                          '5EE5DC71-575B-4B5C-8DAF-92BDA04CA6E4', '706BF77E-8E59-4F68-B7D7-9AA30E5915F8',
                          'AC07FD35-AFAE-4718-B3C3-A15205C17F23', 'BB839DA2-8A1B-41EC-98FB-A3D77A89A5CC',
                          '2CF55876-985D-4F7D-8275-B54B86371A30', 'A921FE49-419C-432C-BDEE-C007F137CB23',
                          '0E1886FD-A618-4C45-8E25-C11BDC06C955', '8430DC71-6072-4B01-A495-C54892F2317B',
                          'DAC65721-5060-45DA-B3A8-C6101C157563', '0163B81F-4F39-4DA2-9AC9-C9FF02ABFCD6',
                          'E540AA96-8213-4100-B897-CBA0BE8EBB3B', '74A50645-E5F3-4D26-9D11-D13AD2BACB0D',
                          'C8B12508-A2C2-43D2-893B-D17CBF24BE92', '295120B4-25E3-4578-86B7-D59AC1CD7B4A',
                          '699199C2-E3D8-4386-9C54-D59E6ACEE8EB', '8F2129AF-6855-409D-B04E-DAD4C1AC448F',
                          'F948C6C8-3C0D-4D25-9C8D-DE4EA0CF8801', 'DBDBC9B1-91DE-4523-806C-E228F3091ED4',
                          '3DCACE88-5E8D-E311-9927-E41F13C5183A', 'ABAB6E61-E0F1-46E8-94FA-EBADF5EDE84B',
                          '19A795DE-A30C-468A-84F6-EBB60DD2A58B', 'A1FACF59-878A-4D14-863F-F10660C5997C',
                          'C327A596-28B6-4884-B50E-F4E3D2B940D0', '6A9D81BF-EE14-412E-8851-F65C1A62FEBB',
                          '77B9F08A-FA25-42A1-A01B-FEAB7BA699EA', 'C2B46688-81BB-4126-9B56-082B0EE75373',
                          'C09E5D24-56F6-4A06-9040-3DEFCD053D38', 'A1238F00-CD18-475F-90E9-540723F5E3BD',
                          '70468402-F36D-41FE-9726-5E389A52A2EA', '58B87918-EF10-45C8-9647-6765F6662C8D',
                          '8DB40F38-F139-447C-8071-6CE1597404CB', '88E4E26E-EB03-4B69-A642-6F50A46A15A6',
                          '8810DD15-97A9-4467-9FFB-889279D9F989', '2F6E5A9A-8853-481F-8C5E-9C10EBD055D4',
                          'CE4FE92A-5494-4F6F-B74F-A451B06B113B'
                        )
           ) --H区、Q区        
        BEGIN
            SET @decDsFee = 550;
        END;
        ELSE
        BEGIN
            SET @decDsFee = 80;
        END;
        RETURN 8;

    END;

END;
--“公积金保险费”计算完毕                                                  
----阳江公司银滩项目代收费用计算结束                             

--阳江共青湖项目代收SQL开始                                                  

IF (
       @chvProjName LIKE '%阳江共青湖%'
       AND @buguid = '4F3B4F6A-0ED9-468A-8158-3F1559C5F2E4'
   )
BEGIN

    --根据不同的代收费用分别进行计算                

    --------------------------------------------1：物业维修基金                                                  
    --计算公式：商铺、高层住宅：预售建筑建面*1550*5%；  高级住宅：预售建筑建面* 1480 * 5% ；车位不收取物业维修基金；四舍五入保留到分                            
    -- 1栋 2栋 130栋 131栋    工程造价是：1540元，物业维修基金 ＝工程造价*面积*5%                                                 
    IF @chvItemName LIKE '%维修基金%'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN

            IF @intPayFormNo = 1
            BEGIN
                SELECT @decTmp = Cjtotal1
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            IF @intPayFormNo = 2
            BEGIN
                SELECT @decTmp = Cjtotal2
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;

            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = '个人';
        END;
        --“模拟付款”结束                                                  

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“物业维修基金”                                                  
        IF (@bldguid IN ( '7FD2C3EE-41F9-4A3A-9865-7DCE6CAA2510', '013144BB-29B1-4AA2-82EA-12B292CAE841',
                          '000A9518-0F59-427D-BB52-961FF9ACDFD2', 'DD996377-C5DB-4B5F-A3C1-8EA3502C36BA'
                        )
           )
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 1540 * 0.05), 2);
        END;

        IF (
               @cplx IN ( '商业', '住宅' )
               AND @bldguid != '7FD2C3EE-41F9-4A3A-9865-7DCE6CAA2510'
               AND @bldguid != '013144BB-29B1-4AA2-82EA-12B292CAE841'
               AND @bldguid != '000A9518-0F59-427D-BB52-961FF9ACDFD2'
               AND @bldguid != 'DD996377-C5DB-4B5F-A3C1-8EA3502C36BA'
           )
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 1550 * 0.05), 2);
        END;

        IF (
               @cplx = '高级住宅'
               AND @bldguid != '7FD2C3EE-41F9-4A3A-9865-7DCE6CAA2510'
               AND @bldguid != '013144BB-29B1-4AA2-82EA-12B292CAE841'
               AND @bldguid != '000A9518-0F59-427D-BB52-961FF9ACDFD2'
               AND @bldguid != 'DD996377-C5DB-4B5F-A3C1-8EA3502C36BA'
           )
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 1480 * 0.05), 2);
        END;
        RETURN 7;

    END;
--“物业维修基金”计算完毕                   

END;
--阳江共青湖项目代收SQL结束                                                                    


----阳江公司代收费用计算结束                                                  


--长春代收费用开始                                                  
IF (@buguid = 'A8E2ACA1-508E-46F3-B764-8E2114255B4B' or @buguid = '528CA87C-F7AF-4FDD-BD05-79641D9F67FB')
BEGIN

    --1契税                                               
    /*                                          
  --1、契税                                                  
----   契税收费标准如下                                          
--商铺 总房款5%                                           
住宅；2套及以上 总房款3%                                          
首套房间：                                     
建筑面积小于90平  总房款1%                                          
90平小于等于建筑面积小于等于144平  总房款1.5%                                          
建筑面积大于144平 总房款3%                                          
                                           
   */

    IF @chvItemName = '新契税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;

        SET @BldCjPrice = 0;

        IF @chvSource = '定单'
        BEGIN


            --来源为“定单”通过交易表获取      
            SELECT @qsdate = QSDate
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = ISNULL(BldCjPrice, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;



            SELECT @cplx = ProductType
            FROM vp_RoomLIst
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;





            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;


        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @qsdate = CASE WHEN ISNULL(BaDate, '') = '' THEN QSDate ELSE BaDate END,
                   @decTmp = ISNULL(RmbHtTotal, 0),
                   @zynum = LEFT(ZyNumber, 1)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM vp_RoomLIst
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

        END;

        ---  开始计算“契税”                                                  



        -- if (  @cplx = '商业'  or @cplx = '地下室/车库'or @cplx = '写字楼' )                                                  

        --   begin                                                  
        --        Set @decDsFee = @decTmp*0.05;                                                  

        --   end                                                  
        -- else                                                  
        --if ( @cplx = '住宅' or @Cplx='高级住宅'  )                                            
        -- begin                                                  
        --        Set @decDsFee = @decTmp*0.03;                                                  

        --   end                       

        BEGIN
            IF @bldguid IN ( 'aec992ce-7356-e711-80ba-e61f13c57837', '40c16d00-488a-e811-80bf-e61f13c57837',
                             '5504d1ec-7456-e711-80ba-e61f13c57837', '31f5a655-bda1-e711-80ba-e61f13c57837',
                             'c33141d4-04a4-e711-80ba-e61f13c57837', '830d4c66-7556-e711-80ba-e61f13c57837',
                             'b200f293-ff3a-e811-80ba-e61f13c57837', 'f8e779ad-8e47-e811-80ba-e61f13c57837',
                             '264abdb2-fca3-e711-80ba-e61f13c57837', 'a683a488-fca3-e711-80ba-e61f13c57837',
                             'B200F293-FF3A-E811-80BA-E61F13C57837', 'C90D28C4-5CD4-4752-99E1-0D5DD3D6AF2F',
                             '13031C57-9561-49F8-9D8B-050B4C1F94A5', '199DB106-99A8-4BEA-9298-831423FA8821',
                             'E6CBC7E3-5410-40CA-ADFF-5E95CF46999B'
                           )
               OR @projGUID IN ( 'aec992ce-7356-e711-80ba-e61f13c57837', 'B200F293-FF3A-E811-80BA-E61F13C57837',
                                 'a683a488-fca3-e711-80ba-e61f13c57837', '264abdb2-fca3-e711-80ba-e61f13c57837',
                                 'A111D548-7356-E711-80BA-E61F13C57837', 'F8E779AD-8E47-E811-80BA-E61F13C57837',
                                 'c33141d4-04a4-e711-80ba-e61f13c57837', 'F8E779AD-8E47-E811-80BA-E61F13C57837',
                                 '4ee5d544-51f0-e711-80ba-e61f13c57837', '4ee5d544-51f0-e711-80ba-e61f13c57837',
                                 '830D4C66-7556-E711-80BA-E61F13C57837', 'A683A488-FCA3-E711-80BA-E61F13C57837',
                                 'bc33f140-3d1d-e911-80bf-e61f13c57837', '53df9467-d67f-eb11-b398-f40270d39969',
                                 '05830903-c740-eb11-b398-f40270d39969', 'da8e7641-8828-eb11-b398-f40270d39969',
                                 'e0b5731b-65dc-ea11-80b8-0a94ef7517dd', '0e84fe4f-2e9b-ea11-80b8-0a94ef7517dd',
                                 '5b0e03f6-174c-ea11-80b8-0a94ef7517dd', 'b8c87089-ca18-47b9-88d4-20a2ba064195',
                                 'a4e34c9b-b1dd-e911-80b7-0a94ef7517dd', '9fa3f045-a3ba-eb11-b398-f40270d39969'
                               )
            BEGIN

                IF (@cplx = '住宅' OR @cplx = '高级住宅')
                BEGIN
                    -- if datediff(day,@qsdate,'2016-02-22')<0                                
                    BEGIN
                        IF (@zynum > 1 AND @zynum < 3)
                        BEGIN


                            IF (@mjtmp < 90)
                            BEGIN
                                SET @decDsFee = ROUND((@decTmp / 1.09), 2) * 0.01;
                            END;

                            IF (@mjtmp >= 90)
                            BEGIN
                                SET @decDsFee = ROUND((@decTmp / 1.09), 2) * 0.02;
                            END;
                        END;


                        IF @zynum = 1
                        BEGIN

                            IF (@mjtmp < 90)
                            BEGIN

                                SET @decDsFee = ROUND((@decTmp / 1.09), 2) * 0.01;
                            END;

                            IF (@mjtmp >= 90)
                            BEGIN
                                SET @decDsFee = ROUND((@decTmp / 1.09), 2) * 0.015;
                            END;
                        END;


                        IF @zynum = 3
                        BEGIN

                            SET @decDsFee = ROUND((@decTmp / 1.09), 2) * 0.03;
                        END;

                    END;
                END;

                IF (@cplx = '公寓' OR @cplx = '商业' OR @cplx = '写字楼')
                BEGIN
                    SET @decDsFee = ROUND((@decTmp / 1.05), 2) * 0.05;
                END;

                IF (
                       @cplx = '公寓'
                       OR @cplx = '商业'
                       OR @cplx = '写字楼'
                   )
                   AND @projGUID IN (   'c9a5fdf9-90b2-e911-80b7-0a94ef7517dd',
                                        'F8E779AD-8E47-E811-80BA-E61F13C57837', --'264ABDB2-FCA3-E711-80BA-E61F13C57837',
                                        '40C16D00-488A-E811-80BF-E61F13C57837', '30F14114-2A8A-E811-80BF-E61F13C57837',
                                        '79F69349-F93A-E811-80BA-E61F13C57837', '95CD7B7B-993B-E811-80BA-E61F13C57837',
                                        '53df9467-d67f-eb11-b398-f40270d39969', '05830903-c740-eb11-b398-f40270d39969',
                                        'da8e7641-8828-eb11-b398-f40270d39969', 'e0b5731b-65dc-ea11-80b8-0a94ef7517dd',
                                        '0e84fe4f-2e9b-ea11-80b8-0a94ef7517dd', '5b0e03f6-174c-ea11-80b8-0a94ef7517dd',
                                        'b8c87089-ca18-47b9-88d4-20a2ba064195', 'a4e34c9b-b1dd-e911-80b7-0a94ef7517dd',
                                        '9fa3f045-a3ba-eb11-b398-f40270d39969'
                                    )
                BEGIN
                    SET @decDsFee = ROUND((@decTmp / 1.09), 2) * 0.05;
                END;
                PRINT @decDsFee;
            END;

            ELSE
            BEGIN
                IF (@cplx = '住宅' OR @cplx = '高级住宅')
                BEGIN
                    -- if datediff(day,@qsdate,'2016-02-22')<0                                
                    BEGIN
                        IF (@zynum > 1 AND @zynum < 3)
                        BEGIN


                            IF (@mjtmp < 90)
                            BEGIN
                                SET @decDsFee = ROUND((@decTmp / 1.05), 2) * 0.01;
                            END;

                            IF (@mjtmp >= 90)
                            BEGIN
                                SET @decDsFee = ROUND((@decTmp / 1.05), 2) * 0.02;
                            END;
                        END;


                        IF @zynum = 1
                        BEGIN

                            IF (@mjtmp < 90)
                            BEGIN

                                SET @decDsFee = ROUND((@decTmp / 1.05), 2) * 0.01;
                            END;

                            IF (@mjtmp >= 90)
                            BEGIN
                                SET @decDsFee = ROUND((@decTmp / 1.05), 2) * 0.015;
                            END;
                        END;


                        IF @zynum = 3
                        BEGIN

                            SET @decDsFee = ROUND((@decTmp / 1.05), 2) * 0.03;
                        END;

                    END;

                END;

                IF (@cplx = '商业' OR @cplx = '写字楼' OR @cplx = '公寓')
                BEGIN
                    SET @decDsFee = ROUND((@decTmp / 1.05), 2) * 0.05;
                END;

            END;
            PRINT @decDsFee;
        END;


    -- begin                                 
    -- if ( @cplx = '住宅' or @Cplx='高级住宅'  )                                 
    -- begin                                            
    --  if datediff(day,@qsdate,'2016-02-22')<0                                
    -- begin                                           
    --  if ( @zynum>1 and   @zynum<3 )                                         
    --  begin                                 


    --  if (@mjtmp<90)                                          
    -- begin                                          
    -- Set @decDsFee = @decTmp*0.01;                                           
    -- end                                          

    --  if (@mjtmp>=90)                                          
    -- begin                                          
    -- Set @decDsFee = @decTmp*0.02                                           
    -- end                                                
    --  end                                             


    --  if @zynum=1                                          
    --  begin                                          

    -- if (@mjtmp<90)                                          
    -- begin                                  

    -- Set @decDsFee = @decTmp*0.01;                                           
    -- end              

    --  if (@mjtmp>=90)                                          
    -- begin                                          
    -- Set @decDsFee = @decTmp*0.015;                                           
    -- end                                          
    -- end                                 


    -- if @zynum= 3                                

    --begin                                 

    --Set @decDsFee = @decTmp*0.03;                                
    --end                                

    --        END                                
    --        END                                

    --     if (  @cplx = '商业'OR @Cplx='写字楼' )                                
    --     BEGIN                                
    --      Set @decDsFee = @decTmp*0.05;                                    
    --     end                                

    -- end                                      
    END;

    ------契税计算结束；                                          



    ---契税三                                          

    IF @chvItemName = '契税三'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;

        SET @BldCjPrice = 0;


        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0),
                   @zynum = ZyNumber,
                   @qsdate = CONVERT(CHAR(10), YwblDate, 120),
                   @BldCjPrice = BldCjPrice
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM vp_RoomLIst
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


        END;

        ---  开始计算“契税”                                                  



        IF (@cplx = '商业' OR @cplx = '地下室/车库' OR @cplx = '写字楼')
        BEGIN
            SET @decDsFee = @decTmp * 0.05;

        END;
        ELSE IF (@cplx = '住宅' OR @cplx = '高级住宅')
        BEGIN

            IF @zynum > 1
            BEGIN
                SET @decDsFee = @decTmp * 0.03;
            END;


            IF @zynum = 1
            BEGIN
                IF (@qsdate >= '2010-01-01' AND @qsdate <= '2010-06-30')
                BEGIN


                    IF @BldCjPrice >= 6095
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 6095
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;




                IF (@qsdate > '2010-06-30' AND @qsdate <= '2010-12-31')
                BEGIN


                    IF @BldCjPrice >= 6914
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 6914
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;



                IF (@qsdate > '2010-12-31' AND @qsdate <= '2011-06-30')
                BEGIN


                    IF @BldCjPrice >= 8031
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;
                    ELSE IF @BldCjPrice < 8031
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;



                IF (@qsdate > '2011-06-30' AND @qsdate <= '2011-12-31')
                BEGIN


                    IF @BldCjPrice >= 9878
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9878
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;


                IF (@qsdate > '2011-12-31' AND @qsdate <= '2012-06-30')
                BEGIN


                    IF @BldCjPrice >= 9384
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9384
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;


                IF (@qsdate > '2012-06-30' AND @qsdate <= '2012-12-30')
                BEGIN


                    IF @BldCjPrice >= 9420
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9420
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                IF (@qsdate > '2012-12-30' AND @qsdate <= '2013-06-30')
                BEGIN


                    IF @BldCjPrice >= 10502
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 10502
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                IF (@qsdate > '2013-06-30' AND @qsdate <= '2013-12-31')
                BEGIN


                    IF @BldCjPrice >= 10984
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 10984
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                IF (@qsdate > '2013-12-30' AND @qsdate <= '2014-06-30')
                BEGIN


                    IF @BldCjPrice >= 10692
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 10692
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;
                END;



                IF (@qsdate > '2014-06-30' AND @qsdate <= '2014-12-31')
                BEGIN


                    IF @BldCjPrice >= 10049
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 10049
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;



                --2015上半年开始                                    

                IF (@qsdate >= '2015-01-01' AND @qsdate <= '2015-06-30')
                BEGIN


                    IF @BldCjPrice >= 9814
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9814
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                --2015上半年结束                                    




                --2015下半年开始                                    

                IF (@qsdate > '2015-06-30')
                BEGIN


                    IF @BldCjPrice >= 9819
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9819
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

            --2015下半年结束                                    





            END;
        END;


        RETURN 1;

    END;



    ------契税三计算结束；                                          



    ---契税五                                          

    IF @chvItemName = '契税五'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;

        SET @BldCjPrice = 0;


        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0),
                   @zynum = ZyNumber,
                   @qsdate = CONVERT(CHAR(10), YwblDate, 120),
                   @BldCjPrice = BldCjPrice
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM vp_RoomLIst
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


        END;

        ---  开始计算“契税”                                           



        IF (@cplx = '商业' OR @cplx = '地下室/车库' OR @cplx = '写字楼')
        BEGIN
            SET @decDsFee = @decTmp * 0.05;

        END;
        ELSE IF (@cplx = '住宅' OR @cplx = '高级住宅')
        BEGIN

            IF @zynum > 1
            BEGIN
                SET @decDsFee = @decTmp * 0.03;
            END;


            IF @zynum = 1
            BEGIN
                IF (@qsdate >= '2010-01-01' AND @qsdate <= '2010-06-30')
                BEGIN


                    IF @BldCjPrice >= 5604
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 5604
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;




                IF (@qsdate > '2010-06-30' AND @qsdate <= '2010-12-31')
                BEGIN


                    IF @BldCjPrice >= 5971
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 5971
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;


                IF (@qsdate > '2010-12-31' AND @qsdate <= '2011-06-30')
                BEGIN


                    IF @BldCjPrice >= 6747
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 6747
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;



                IF (@qsdate > '2011-06-30' AND @qsdate <= '2011-12-31')
                BEGIN


                    IF @BldCjPrice >= 8299
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 8299
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;


                IF (@qsdate > '2011-12-31' AND @qsdate <= '2012-06-30')
                BEGIN


                    IF @BldCjPrice >= 7884
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 7884
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;


                IF (@qsdate > '2012-06-30' AND @qsdate <= '2012-12-30')
                BEGIN


                    IF @BldCjPrice >= 7914
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 7914
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                IF (@qsdate > '2012-12-30' AND @qsdate <= '2013-06-30')
                BEGIN


                    IF @BldCjPrice >= 8891
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 8891
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                IF (@qsdate > '2013-06-30' AND @qsdate <= '2013-12-31')
                BEGIN


                    IF @BldCjPrice >= 9277
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9277
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                IF (@qsdate > '2013-12-30' AND @qsdate <= '2014-06-30')
                BEGIN


                    IF @BldCjPrice >= 9296
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9296
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;
                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;



                IF (@qsdate > '2014-06-30' AND @qsdate <= '2015-12-31')
                BEGIN


                    IF @BldCjPrice >= 9305
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9305
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                --2015上半年开始                                    

                IF (@qsdate >= '2015-01-01' AND @qsdate <= '2015-06-30')
                BEGIN


                    IF @BldCjPrice >= 9175
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9175
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                --2015上半年结束                                    




                --2015下半年开始                                    

                IF (@qsdate > '2015-06-30')
                BEGIN


                    IF @BldCjPrice >= 9230
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9230
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

            --2015下半年结束                                    


            END;
        END;


        RETURN 1;

    END;



    ------契税五计算结束；                                          







    ---契税六                                          

    IF @chvItemName = '契税六'
    BEGIN
        --取价格                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;

        SET @BldCjPrice = 0;


        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0),
                   @zynum = ZyNumber,
                   @qsdate = CONVERT(CHAR(10), YwblDate, 120),
                   @BldCjPrice = BldCjPrice
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM vp_RoomLIst
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


        END;

        ---  开始计算“契税”                                                  



        IF (@cplx = '商业' OR @cplx = '地下室/车库' OR @cplx = '写字楼')
        BEGIN
            SET @decDsFee = @decTmp * 0.05;

        END;
        ELSE IF (@cplx = '住宅' OR @cplx = '高级住宅')
        BEGIN

            IF @zynum > 1
            BEGIN
                SET @decDsFee = @decTmp * 0.03;
            END;


            IF @zynum = 1
            BEGIN
                IF (@qsdate >= '2010-01-01' AND @qsdate <= '2010-06-30')
                BEGIN


                    IF @BldCjPrice >= 5578
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 5578
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;




                IF (@qsdate > '2010-06-30' AND @qsdate <= '2010-12-31')
                BEGIN


                    IF @BldCjPrice >= 5744
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 5744
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;



                IF (@qsdate > '2010-12-31' AND @qsdate <= '2011-06-30')
                BEGIN


                    IF @BldCjPrice >= 6490
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 6490
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;



                IF (@qsdate > '2011-06-30' AND @qsdate <= '2011-12-31')
                BEGIN


                    IF @BldCjPrice >= 7982
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 7982
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;


                IF (@qsdate > '2011-12-31' AND @qsdate <= '2012-06-30')
                BEGIN


                    IF @BldCjPrice >= 7583
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 7583
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;


                IF (@qsdate > '2012-06-30' AND @qsdate <= '2012-12-30')
                BEGIN


                    IF @BldCjPrice >= 7612
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 7612
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                IF (@qsdate > '2012-12-30' AND @qsdate <= '2013-06-30')
                BEGIN


                    IF @BldCjPrice >= 8353
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 8353
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                IF (@qsdate > '2013-06-30' AND @qsdate <= '2013-12-31')
                BEGIN


                    IF @BldCjPrice >= 8517
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 8517
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                IF (@qsdate > '2013-12-30' AND @qsdate <= '2014-06-30')
                BEGIN


                    IF @BldCjPrice >= 8441
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 8441
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;


                IF (@qsdate > '2014-06-30' AND @qsdate <= '2014-12-31')
                BEGIN


                    IF @BldCjPrice >= 9144
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9144
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                --2015上半年开始                                    

                IF (@qsdate >= '2015-01-01' AND @qsdate <= '2015-06-30')
                BEGIN


                    IF @BldCjPrice >= 8955
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 8955
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                --2015上半年结束                                    




                --2015下半年开始                                    

                IF (@qsdate > '2015-06-30')
                BEGIN


                    IF @BldCjPrice >= 9144
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9144
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

            --2015下半年结束                                        




            END;
        END;


        RETURN 1;

    END;



    ------契税六计算结束；                                          



    ---契税七                                          

    IF @chvItemName = '契税七'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;

        SET @BldCjPrice = 0;


        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                               
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0),
                   @zynum = LEFT(ZyNumber, 1),
                   @qsdate = CONVERT(CHAR(10), YwblDate, 120),
                   @BldCjPrice = BldCjPrice
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM vp_RoomLIst
            WHERE RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


        END;

        ---  开始计算“契税”                                                  



        IF (@cplx = '商业' OR @cplx = '地下室/车库' OR @cplx = '写字楼')
        BEGIN
            SET @decDsFee = @decTmp * 0.05;

        END;
        ELSE IF (@cplx = '住宅' OR @cplx = '高级住宅')
        BEGIN



            IF @zynum <> 1
            BEGIN
                SET @decDsFee = @decTmp * 0.03;
            END;


            IF @zynum = 1
            BEGIN
                IF (@qsdate >= '2010-01-01' AND @qsdate <= '2010-06-30')
                BEGIN


                    IF @BldCjPrice >= 5055
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 5055
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;




                IF (@qsdate > '2010-06-30' AND @qsdate <= '2010-12-31')
                BEGIN


                    IF @BldCjPrice >= 6342
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 6342
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;



                IF (@qsdate > '2010-12-31' AND @qsdate <= '2011-06-30')
                BEGIN


                    IF @BldCjPrice >= 7169
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 7169
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;



                IF (@qsdate > '2011-06-30' AND @qsdate <= '2011-12-31')
                BEGIN


                    IF @BldCjPrice >= 8818
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 8818
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;


                IF (@qsdate > '2011-12-31' AND @qsdate <= '2012-06-30')
                BEGIN


                    IF @BldCjPrice >= 8377
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 8377
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;


                IF (@qsdate > '2012-06-30' AND @qsdate <= '2012-12-30')
                BEGIN


                    IF @BldCjPrice >= 8409
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 8409
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                IF (@qsdate > '2012-12-30' AND @qsdate <= '2013-06-30')
                BEGIN


                    IF @BldCjPrice >= 7844
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 7844
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                IF (@qsdate > '2013-06-30' AND @qsdate <= '2013-12-31')
                BEGIN


                    IF @BldCjPrice >= 8048
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 8048
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                IF (@qsdate > '2013-12-30' AND @qsdate <= '2014-06-30')
                BEGIN


                    IF @BldCjPrice >= 9514
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9514
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;


                IF (@qsdate > '2014-06-30' AND @qsdate <= '2014-12-31')
                BEGIN


                    IF @BldCjPrice >= 8861
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 8861
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                --2015上半年开始                                    

                IF (@qsdate >= '2015-01-01' AND @qsdate <= '2015-06-30')
                BEGIN


                    IF @BldCjPrice >= 8666
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 8666
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

                --2015上半年结束                                    




                --2015下半年开始                                    

                IF (@qsdate > '2015-06-30')
                BEGIN


                    IF @BldCjPrice >= 9129
                    BEGIN
                        SET @decDsFee = @decTmp * 0.03;
                    END;

                    ELSE IF @BldCjPrice < 9129
                    BEGIN
                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90 AND @mjtmp <= 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;

                        IF (@mjtmp > 144)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.03;
                        END;

                    END;

                END;

            --2015下半年结束                                        




            END;
        END;


        RETURN 1;

    END;



    ------契税七计算结束；                           

    -----契税                  
    IF @chvItemName = '契税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;

        SET @BldCjPrice = 0;

        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                 
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = ISNULL(BldCjPrice, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = ProductType
            FROM vp_RoomLIst
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;





            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;

        END;


        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @qsdate = CASE WHEN ISNULL(BaDate, '') = '' THEN QSDate ELSE BaDate END,
                   @decTmp = ISNULL(RmbHtTotal, 0),
                   @zynum = LEFT(ZyNumber, 1)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = ProductType
            FROM vp_RoomLIst
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


        END;

        --   ---  开始计算“契税”                                                  


        BEGIN
            IF (@cplx = '住宅' OR @cplx = '高级住宅')
            BEGIN
                --if datediff(day,@qsdate,'2016-02-22')<0                                
                BEGIN
                    IF (@zynum > 1 AND @zynum < 3)
                    BEGIN


                        IF (@mjtmp < 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.02;
                        END;
                    END;


                    IF @zynum = 1
                    BEGIN

                        IF (@mjtmp < 90)
                        BEGIN

                            SET @decDsFee = @decTmp * 0.01;
                        END;

                        IF (@mjtmp >= 90)
                        BEGIN
                            SET @decDsFee = @decTmp * 0.015;
                        END;
                    END;

                    IF @zynum = 3
                    BEGIN

                        SET @decDsFee = @decTmp * 0.03;
                    END;

                END;
            END;

            IF (@cplx = '商业' OR @cplx = '写字楼')
            BEGIN
                SET @decDsFee = @decTmp * 0.05;
            END;

        END;
    END;
    --   --契税                                       










    /*                                                 
--1、契税                                                  
----  契税收费标准如下－－                                                  
--住宅：①建筑面积＞144平或成交单价＞5971元，为成交价的3%；                                                  
--②90平＜建筑面积＜144平且成交单价＜5971元，为成交价的1.5%；                                                  
--③建筑面积＜90平且成交单价＜5971元，为成交价的1%；                                                  
--非住宅：成交价的5%                                                 
                                                  
    If @chvItemName='契税'                                                  
       Begin                                        
  --取价格                                                  
  Set @decTmp = 0;                                                  
         --取面积                                                  
   set @mjtmp=0;                                                  
                                                  
        set @BldCjPrice=0;                                                  
                                                       
      
--  If @chvSource = '模拟付款'                                                  
--   --来源为“模拟付款”从临时定单表中获取                                                  
--          begin                                                  
--                                                  
--           if @intPayFormNo=1                                                   
--              begin                                                  
--     select @decTmp=cjtotal1 from s_ordertmp where s_Ordertmp.OrderGUID = @chvSaleGUID;                                                  
--              end                                                   
--           if @intPayFormNo=2                                                   
--     begin                                                  
--                 select @decTmp=cjtotal2 from s_ordertmp where s_Ordertmp.OrderGUID = @chvSaleGUID;                                                  
--              end                                                   
--                                                                
--           select @mjtmp=cast(bldarea as decimal(19,4))  From s_Ordertmp where OrderGUID = @chvSaleGUID;                                                  
--    select @chvRoomGUID =roomguid From s_Ordertmp where OrderGUID = @chvSaleGUID;                                                  
--           Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID                                   
--                     --  if charindex('住宅',@cplx) >0                                                   
--   begin                                                  
--    set @Cplx='住宅'                                                  
--   end                                                  
--  if charindex('高级住宅',@cplx) >0                                               
--   begin                                                   
--    SET @Cplx='高级住宅'                                                    
--   end                                                  
--  if charindex('商业',@cplx) >0                                                   
--   begin                                                    
--    SET @Cplx='商业'                                                    
--   end                                                  
--  if charindex('写字楼',@cplx) >0                                                     
--   begin                                                  
--    SET @Cplx='写字楼'                                                    
--   end                                                  
--                                                    
--                                                  
--          end                                                  
   --“模拟付款”结束                                             
                                                  
   If @chvSource = '定单'                                                  
          begin                                                  
                                                  
  --来源为“定单”通过交易表获取                                                  
  select @decTmp=isnull(RmbCjTotal,0) from s_Order where OrderGUID = @chvSaleGUID;                                                  
  Select @mjtmp=cast(bldarea as decimal(19,4))  From s_Order where OrderGUID = @chvSaleGUID;                                                  
        select @BldCjPrice= isnull(BldCjPrice,0) from s_Order where OrderGUID = @chvSaleGUID;                       
     select @chvRoomGUID =roomguid From s_Order where OrderGUID = @chvSaleGUID;                                                  
                                                                  
  Select @Cplx=ProductType from vp_RoomList where roomguid=@chvRoomGUID                                                          
                                                 
  if charindex('住宅',@cplx) >0                                                   
   begin                                                  
    set @Cplx='住宅'                                                  
   end                                                  
  if charindex('高级住宅',@cplx) >0                                                  
   begin                                                   
    SET @Cplx='高级住宅'                                                    
 end                                                  
  if charindex('商业',@cplx) >0                                                   
   begin                                                    
    SET @Cplx='商业'                                                    
   end                                            
    if charindex('地下室/车库',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='地下室/车库'                                                    
   end                                                  
  if charindex('写字楼',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='写字楼'                                                    
   end                                                  
                                                   
   end                                                  
                                                  
   If @chvSource = '合同'                                                 
    --来源为“合同”通过交易表获取                                                  
    begin                                                  
  select @decTmp=isnull(RmbHtTotal,0) from s_Contract where ContractGUID = @chvSaleGUID;                                                  
  Select @mjtmp=cast(bldarea as decimal(19,4))  From s_Contract where ContractGUID = @chvSaleGUID;                                   
        select @BldCjPrice= isnull(BldCjPrice,0) from s_Contract where ContractGUID = @chvSaleGUID;                                                  
  select @chvRoomGUID =roomguid From s_Contract where ContractGUID = @chvSaleGUID;                                                    
  Select @Cplx=ProductType from vp_RoomList where roomguid=@chvRoomGUID                                                          
                                                   
  if charindex('住宅',@cplx) >0                                                   
   begin                                                  
    set @Cplx='住宅'                                                  
   end                    
  if charindex('高级住宅',@cplx) >0                 
   begin                                                   
    SET @Cplx='高级住宅'                                                
   end                                                  
  if charindex('商业',@cplx) >0                                                   
   begin                                                    
    SET @Cplx='商业'                                                    
   end                                            
    if charindex('地下室/车库',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='地下室/车库'                            
   end                                                  
  if charindex('写字楼',@cplx) >0                                           
   begin                                                  
    SET @Cplx='写字楼'                                                    
   end                                                   
                                                        
                                                  
       end                                                  
                                                  
   ---  开始计算“契税”                                                  
                     
                                                  
                                                
   if (  @cplx = '商业'  or @cplx = '车位'or @cplx = '写字楼' )                                                  
                                                  
     begin                                                  
 Set @decDsFee = @decTmp*0.05;                                                  
                                                  
     end                                                  
   else                                                  
  if ( @cplx = '住宅'  or @cplx = '高级住宅'  )                                                  
 begin                                                  
                                                  
  Set @decDsFee = @decTmp*0.03;                                                  
        end                                                         
                                                        
                                                  
    return 1                                                  
                                                  
 End                                                  
                                                  
------契税计算结束；                                          
*/


    --                                                  
    ----2、印花税                                                  
    --   --计算公式：①建筑面积＞90平，为5元/套                                                  
    ---            ②建筑面积＜90平，为5+成交价的0.05%；                                                  
    ---                                                  
    --   单位购买：按楼价的3%        
    IF @chvItemName = '印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                     
        SET @mjtmp = 0;


        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN

            IF @intPayFormNo = 1
            BEGIN
                SELECT @decTmp = Cjtotal1
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            IF @intPayFormNo = 2
            BEGIN
                SELECT @decTmp = Cjtotal2
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;

            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;
        --“模拟付款”结束                                                  

        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @qsdate = QSDate,
                   @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;

            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;

        --                                                  
        --                select @ge=rtrim(P_customer.csttype) from s_Order,s_Trade2Cst,p_Customer where s_Order.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_Order.OrderGUID = @chvSaleGUID;                                    
        --                       if @ge<>'公司'                                                  
        --                begin                                                  
        --                   set @ge='个人';                                                  
        --                 end                                                   
        --                                                     
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @qsdate = CASE WHEN ISNULL(BaDate, '') = '' THEN QSDate ELSE BaDate END,
                   @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;

        --                             
        --                select @ge=rtrim(P_customer.csttype) from s_contract,s_Trade2Cst,p_Customer where s_contract.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_contract.ContractGUID = @chvSaleGUID;                        














        --                       if @ge<>'公司'                                                  
        --                 begin                                                  
        --                   select @ge='个人';                                                  
        --                 end                                                  
        END;

        ---开始计算“印花税”                                                  

        IF DATEDIFF(DAY, @qsdate, '2016-02-22') > 0
        BEGIN

            IF (@cplx = '住宅' OR @cplx = '高级住宅')
            BEGIN
                SET @decDsFee = 5;
            END;
            IF (@cplx = '商业' OR @cplx = '车位' OR @cplx = '写字楼' OR @cplx = '公寓')
            BEGIN
                SET @decDsFee = 5 + ROUND(CAST(@decTmp AS INT) * 0.0005, 2);
            END;

        END;

        IF DATEDIFF(DAY, @qsdate, '2016-02-22') < 0
        BEGIN
            IF (@cplx = '住宅' OR @cplx = '高级住宅')
            BEGIN
                SET @decDsFee = 0;
            END;
            IF (@cplx = '商业' OR @cplx = '车位' OR @cplx = '写字楼' OR @cplx = '公寓')
            BEGIN
                SET @decDsFee = ROUND(CAST(@decTmp AS INT) * 0.0005, 2);
            END;
        END;


        RETURN 1;

    END;

    --3:维修基金                                                  
    --   计算公式：多层：面积*95，小高层住宅、高层住宅、商业：面积*125;                
    --中央公园如下                                          
    --整栋楼最高层住宅为7层以下：面积*95，                                          
    --整栋楼最高层住宅为7层及7层以上：面积*125                                          





    IF @chvItemName = '维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                            


            SELECT @decTmp = ISNULL(RmbCjTotal, 0),
                   @mjtmp = BldArea,
                   @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @productname = ProductName,
                   @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @yszdate = YEAR(YszGetDate)
            FROM p_Building
            WHERE BldGUID = @bldguid;
            SELECT @floor = MAX(FloorNo)
            FROM p_FloorPlan
            WHERE BldGUID = @bldguid;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取               
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0),
                   @mjtmp = BldArea,
                   @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @productname = ProductName,
                   @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            SELECT @yszdate = YEAR(YszGetDate)
            FROM p_Building
            WHERE BldGUID = @bldguid;
            SELECT @floor = MAX(FloorNo)
            FROM p_FloorPlan
            WHERE BldGUID = @bldguid;
        END;





        --开始计算                                          


        IF (@projGUID IN ( 'aec992ce-7356-e711-80ba-e61f13c57837', '40c16d00-488a-e811-80bf-e61f13c57837',
                           'B200F293-FF3A-E811-80BA-E61F13C57837',-- 'B200F293-FF3A-E811-80BA-E61F13C57837',
                           'F8E779AD-8E47-E811-80BA-E61F13C57837', '4ee5d544-51f0-e711-80ba-e61f13c57837',
                           '831fcbcb-716f-41b2-8e2b-0705b208af0b', '630eae3e-f073-46e2-99f0-469c82e862f1',
                           'ba6f7d5a-db6f-4a29-9022-e0c2fb1e03a8', '830D4C66-7556-E711-80BA-E61F13C57837',
						   '05830903-C740-EB11-B398-F40270D39969'
                         )--C9A5FDF9-90B2-E911-80B7-0A94EF7517DD
           )
        BEGIN
		         

            IF (@yszdate >= '2011')
            BEGIN

                IF @productname IN ( '多层住宅', '独栋高级住宅', '双拼高级住宅', '联排高级住宅', '叠拼高级住宅' )
                BEGIN
                    SET @decDsFee = CAST(@mjtmp * 95 AS DECIMAL(10, 2));

                END;
				IF @bldguid IN ( '6B895060-C238-4C8B-9439-81218AAB305D','910DFB4E-1B42-4730-87E8-7C138CFCBB5A','135975E0-D0E1-4FC4-A494-129042683DBB','76E50A47-E0EC-41CD-9F55-619DC9882EA7',
						 '79A5A844-8DF5-47BC-917D-1F7D51130A67','0871D901-F752-4ECE-89D4-5062AEA03951',
						 '4EC5875B-DB03-482D-979A-EA464E6F45EA','6EB53280-F6DC-486A-8AAB-053EC0D31C46',
						 '7EED2D61-7670-47A0-B1B5-89FBCE44DD33','F11305EE-20F7-4E4B-A7DE-692255023C49',
						 'D5AB5869-E4BA-449A-B871-3A69ABD2CE2E')
            BEGIN
                SET @decDsFee = @mjtmp * 95;       
            END;


                IF @productname IN ( '小高层住宅', '高层住宅', '商铺', '写字楼', '中高层住宅', '地上车位', '普通地下车位', '普通公寓' )
				and @bldguid not IN ( '6B895060-C238-4C8B-9439-81218AAB305D','910DFB4E-1B42-4730-87E8-7C138CFCBB5A','135975E0-D0E1-4FC4-A494-129042683DBB','76E50A47-E0EC-41CD-9F55-619DC9882EA7',
						 '79A5A844-8DF5-47BC-917D-1F7D51130A67',
						'F11305EE-20F7-4E4B-A7DE-692255023C49',
						 'D5AB5869-E4BA-449A-B871-3A69ABD2CE2E')
                BEGIN
                    SET @decDsFee = CAST(@mjtmp * 125 AS DECIMAL(10, 2));
					
                END;
            END;

            IF (@yszdate < '2011')
            BEGIN

                SET @decDsFee = CAST(@decTmp * 0.025 AS DECIMAL(10, 2));
            END;

        END;

        IF (@projGUID IN ( 'e68ab523-f59f-43b4-8b47-3cfa0566ffa0', 'afc21c11-e5d8-4fd8-979b-0531afaecb57',
                           '0cba6a68-23f0-4d76-8064-6c64cab98dfb', '3264965a-42d7-e411-9927-e41f13c5183a'
                         )
           )
        BEGIN



            IF @productname IN ( '多层住宅', '独栋高级住宅', '双拼高级住宅', '联排高级住宅', '叠拼高级住宅' )
            BEGIN
                SET @decDsFee = CAST(@mjtmp * 95 AS DECIMAL(10, 2));

            END;

            IF @productname IN ( '小高层住宅', '高层住宅', '商铺', '写字楼', '中高层住宅', '地上车位', '普通地下车位', '普通公寓' )
            BEGIN


                SET @decDsFee = CAST(@mjtmp * 125 AS DECIMAL(10, 2));

            END;

        END;

		IF @projGUID in('C9A5FDF9-90B2-E911-80B7-0A94EF7517DD')
			and @bldguid in('E24818B1-AC71-47B4-B35D-5A2903B423E6')
			 SET @decDsFee = CAST(@mjtmp * 95 AS DECIMAL(10, 2));

        IF (@projGUID IN ( 'c9a5fdf9-90b2-e911-80b7-0a94ef7517dd', 'f1731f1b-2ba4-e711-80ba-e61f13c57837',
                           '7AA4B32F-7556-E711-80BA-E61F13C57837', '830D4C66-7556-E711-80BA-E61F13C57837',
                           'C33141D4-04A4-E711-80BA-E61F13C57837', 'ba6f7d5a-db6f-4a29-9022-e0c2fb1e03a8',
                           'A683A488-FCA3-E711-80BA-E61F13C57837', 'aec992ce-7356-e711-80ba-e61f13c57837',
                           'a111d548-7356-e711-80ba-e61f13c57837', '264ABDB2-FCA3-E711-80BA-E61F13C57837',
                           '03BF0367-7356-E711-80BA-E61F13C57837', '7BE659DF-7256-E711-80BA-E61F13C57837',
                           'db61db4b-abff-4762-a249-446975a6a3cf', '40C16D00-488A-E811-80BF-E61F13C57837',
                           '30F14114-2A8A-E811-80BF-E61F13C57837', '79F69349-F93A-E811-80BA-E61F13C57837',
                           'a683a488-fca3-e711-80ba-e61f13c57837', '95CD7B7B-993B-E811-80BA-E61F13C57837',
                           'bc33f140-3d1d-e911-80bf-e61f13c57837', '53df9467-d67f-eb11-b398-f40270d39969',
                           '05830903-c740-eb11-b398-f40270d39969', 'da8e7641-8828-eb11-b398-f40270d39969',
                           'e0b5731b-65dc-ea11-80b8-0a94ef7517dd', '0e84fe4f-2e9b-ea11-80b8-0a94ef7517dd',
                           '5b0e03f6-174c-ea11-80b8-0a94ef7517dd', 'b8c87089-ca18-47b9-88d4-20a2ba064195',
                           'a4e34c9b-b1dd-e911-80b7-0a94ef7517dd', '9fa3f045-a3ba-eb11-b398-f40270d39969',
						   'D7420971-9174-EE11-B3A4-F40270D39969','65B4B48C-8287-EF11-B3A5-F40270D39969'
                         )
						 and @bldguid not in ('E24818B1-AC71-47B4-B35D-5A2903B423E6','910DFB4E-1B42-4730-87E8-7C138CFCBB5A','135975E0-D0E1-4FC4-A494-129042683DBB','76E50A47-E0EC-41CD-9F55-619DC9882EA7',
						 '79A5A844-8DF5-47BC-917D-1F7D51130A67','0871D901-F752-4ECE-89D4-5062AEA03951',
						 '4EC5875B-DB03-482D-979A-EA464E6F45EA','6EB53280-F6DC-486A-8AAB-053EC0D31C46',
						 '7EED2D61-7670-47A0-B1B5-89FBCE44DD33','F11305EE-20F7-4E4B-A7DE-692255023C49',
						 'D5AB5869-E4BA-449A-B871-3A69ABD2CE2E')
           )
        BEGIN

            IF (@floor >= 7)
              
            BEGIN

                SET @decDsFee = CAST(@mjtmp * 125 AS DECIMAL(10, 2));
				
            END;

            IF (@floor < 7)
            BEGIN

                SET @decDsFee = CAST(@mjtmp * 95 AS DECIMAL(10, 2));

            END;

            IF @productname IN ( '商铺', '写字楼''地上车位', '普通地下车位', '商业' )
               AND @projGUID IN ( '7AA4B32F-7556-E711-80BA-E61F13C57837', 'C33141D4-04A4-E711-80BA-E61F13C57837' )
            BEGIN


                SET @decDsFee = CAST(@mjtmp * 125 AS DECIMAL(10, 2));

            END;

			

        END;
        PRINT @decDsFee;

        RETURN 4;

    END;






    --3:维修基金95                                                  
    --   计算公式：商业：面积*95;                                                  
    IF @chvItemName = '维修基金95'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = BldArea,
                   @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @productname = ProductName
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @decTmp = BldArea,
                   @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @productname = ProductName
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
        END;

        --开始计算                                                  

        BEGIN
            SET @decDsFee = CAST(@decTmp * 95 AS DECIMAL(10, 2));
        END;

        RETURN 4;
    END;


    --3:维修基金125                                                 
    --   计算公式：商业：面积*125;                                                  
    IF @chvItemName = '维修基金125'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;

        IF @chvSource = '定单'
        BEGIN --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = BldArea,
                   @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @productname = ProductName
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @decTmp = BldArea,
                   @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @productname = ProductName
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
        END;

        --开始计算                                                  
        IF @productname IN ( '商铺', '写字楼', '普通公寓' )
        BEGIN
            SET @decDsFee = CAST(@decTmp * 125 AS DECIMAL(10, 2));
        END;

        RETURN 4;
    END;


    --4:按揭手续费                                                  
    --   计算公式：住宅370元/件，商铺570元/件                                                  
    IF @chvItemName = '按揭手续费'
    BEGIN
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;















            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“按揭手续费”                                                  


        IF (@cplx = '住宅' OR @cplx = '高级住宅' OR @cplx = '写字楼' OR @cplx = '公寓')
        BEGIN
            SET @decDsFee = 370;
        END;

        IF (@cplx = '商业')
        BEGIN
            SET @decDsFee = 570;
        END;

        RETURN 1;

    END;
    --5:登记费                                                  
    --   计算公式：住宅160元/件（包括住宅产权80、住宅它项80）；商铺1100元/件（包括商铺产权550、商铺它项550）                                                  
    IF @chvItemName = '登记费'
    BEGIN
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                      
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;















            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“登记费”                         


        IF (@cplx = '住宅' OR @cplx = '高级住宅' OR @cplx = '写字楼' OR @cplx = '公寓')
        BEGIN
            SET @decDsFee = 160;
        END;

        IF (@cplx = '商业')
        BEGIN
            SET @decDsFee = 1100;
        END;

        RETURN 1;

    END;
    --6:预告登记费                                                  
    --   计算公式：住宅144元/件（包括预告登记费72、预告抵押登记费72元）；非住宅990元/件（包括预告登记495、预告抵押登记495）                                                  
    IF @chvItemName = '预告登记费'
    BEGIN
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                        
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;


            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取         
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“预告登记费”                                                  


        IF (@cplx = '住宅' OR @cplx = '高级住宅' OR @cplx = '写字楼' OR @cplx = '公寓')
        BEGIN
            SET @decDsFee = 144;
        END;

        IF (@cplx = '商业')
        BEGIN
            SET @decDsFee = 990;
        END;

        RETURN 1;

    END;


END;
--长春代收费用结束                                           

--成都代收费用开始                                                  
IF (@buguid = '4EB64056-C30D-486A-BF5B-FC3BE0A52939')
BEGIN

    ----维修基金                                                  
    --   --计算公式：维修基金=720*建筑面积*2.5%  丁香郡  720*实测建筑面积*2.5% 保利心语一期 1100*房屋建筑面积*2.5% 香槟    1100*实测建筑面积*2.5%                                                  
    --  保利公园198-拉斐庄园    实测建筑面积*720*2%                                          
    --保利贝森公馆     建筑成本价（1100元/㎡）×房屋建筑面积 ×2.5%                               
    --保利公园198-海棠花语,保利公园198-拉斐公馆 维修基金=720*建筑面积*2.5%                                       
    --江语城 实际建筑面积×50元/平米（保留二位小数）
    --大都汇一期 叠拼高级住宅=实测建筑面积*1100*2.5%   
    --中央峰景 实测建筑面积*13.75      
    --保利泊苑项目 一号二号地块  住宅  实测面积*1100*2.5%保留两位小数
	--保利石象湖-茶田小院二期    实测面积*11
	-- 天府和悦住宅和车位 ：实测面积*12.5   联排别墅：实测面积*10

    IF @chvItemName IN ( '维修基金', '维修基金（高级住宅）' )
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;

            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @productname = ProductName
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
            IF CHARINDEX('车位', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                      
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(p_room.BldArea AS DECIMAL(19, 4)),
                   @sjbctotal = a.SjBcTotal,
                   @bldguid = p_room.BldGUID
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @productname = ProductName
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;




            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;


        END;

        ---开始计算“维修基金”         



        IF (@projGUID IN ( 'dd4bbddc-7455-e711-80ba-e61f13c57837', 'd5d8c905-9954-e711-80ba-e61f13c57837',
                           '0c270e64-e6cd-45b7-8607-b8aefb0b36e4', '94f0c07e-d7ab-4f47-ac35-fe4a1bc6a79f',
                           '941A35CC-9754-E711-80BA-E61F13C57837', 'aada9668-9d5f-4426-8080-3195a908298d',
                           '7B5276E1-9854-E711-80BA-E61F13C57837', '655de895-735a-41f2-8291-8f97e6f689ef',
                           '68a74701-cd5a-45b6-bebf-20b36302a380', '80fe764e-7bdb-4a68-b118-dfbc63890fe7',
                           '0d9826c1-e015-4a73-88db-58c169573e01', 'D3E33F74-9654-E711-80BA-E61F13C57837',
                           '67215ACD-86B6-E811-80BF-E61F13C57837', '69925C6F-9854-E711-80BA-E61F13C57837',
                           '02B2F68B-F27B-E711-80BA-E61F13C57837', '18A2E66D-3180-E811-80BF-E61F13C57837',
                           'FD4A89CA-8F82-49AC-A9F8-F16EACC17003', '6d25234a-99bd-e911-80b7-0a94ef7517dd',
                           'BACB3F35-EC78-E811-80BF-E61F13C57837',
						   'ab13aa2b-d753-eb11-b398-f40270d39969','dd2358e5-edea-4dd5-8b1e-d3c2b0585912','9f2d70c7-4125-4b8b-8865-9fe87c3b6d9d',
'6b9653a5-a819-4b9a-9534-84b2dddfd999','b3e771ab-bb41-46b1-bebe-06a5f7235d79','cf9d1b83-8b7c-43d3-9104-9d76f86a23ac','2ca316e2-34b5-4493-94d8-4560daf969ae',
--保利北新时区花园
'e12f2564-2ed6-ea11-80b8-0a94ef7517dd'---,'e26f1a1b-608d-4276-a099-6c260deb88e2'
                         )
           )
        BEGIN
            SET @decDsFee = @mjtmp * 1100 * 0.025;

        END;
		 --四川公司-中粮保利天府时区花园-五期
  IF @projGUID IN ( 'E26F1A1B-608D-4276-A099-6C260DEB88E2' )
          
        BEGIN
            SELECT @mjtmp = ScBldArea
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SET @decDsFee = @mjtmp * 27.5;
        END;
		--20230510添加成都市青白江国投项目,青江悦府（一期）维修基金,28.29栋按照实测面积*22,其余实测米娜及*27.5
		        IF (@projGUID IN ( 'A76FEAE0-02E8-EA11-80B8-0A94EF7517DD' ) 
				and @bldguid in ('E99F4280-E060-43D3-9BB9-061AAC20701C','C8B25FA3-0D61-453B-A630-77408207B602'))
        BEGIN
            SET @decDsFee = round((@mjtmp * 22),2,1);
        END;

		--20250324智慧云城4三号地块维修基金高级拓展设置4号楼 5号楼 6号楼 7号楼  13号楼 14号楼，地下室-普通地下车库：维修基金公式：实测建筑面积*27.5、17号楼  18号楼，维修基金公式：实测建筑面积*22
		IF (@projGUID IN ( 'EAED2C8B-278C-470E-B3F7-9D60BA99850E' ) 
		and @bldguid in ('253A843A-06C2-42DF-A0E0-721F0F69220E','02B255ED-A33D-4985-BE99-031D29692E37','AEB00772-ED80-4D25-89C4-357525F26ED6','DD9A3C20-C326-44C4-A478-4EE8B0B4986A',
		'D83936E0-DB0A-44B9-9466-5E6AD75543CA','1F8C713C-C5E3-4F5B-B754-65C220246C0C','EF41A75C-EE69-4B37-ADB5-40120DE5F9CA'))
        BEGIN
            SET @decDsFee = round((@mjtmp * 27.5),2);
        END;

		--20250324智慧云城4三号地块维修基金高级拓展设置4号楼 5号楼 6号楼 7号楼  13号楼 14号楼，地下室-普通地下车库：维修基金公式：实测建筑面积*27.5、17号楼  18号楼，维修基金公式：实测建筑面积*22
		IF (@projGUID IN ( 'EAED2C8B-278C-470E-B3F7-9D60BA99850E' ) 
		and @bldguid in ('4D44CF40-4660-4963-BA59-279934BC0A50','156D88BB-082C-4B4D-A5BD-FFA757F6C9DD'))
        BEGIN
            SET @decDsFee = round((@mjtmp * 22),2);
        END;

		---2023121 拉斐庄园三期
		 IF (@projGUID IN ( '12f3d983-1484-e911-80b7-0a94ef7517dd','0BDDA90B-5AAD-EA11-80B8-0A94EF7517DD','2FED0E85-D2A0-4CCF-8849-790A2717F873' ) )
        BEGIN
            SET @decDsFee = round((@mjtmp * 22),2,1);
        END;

		  IF (@projGUID IN ( 'A76FEAE0-02E8-EA11-80B8-0A94EF7517DD' ) 
				and @bldguid  not in ('E99F4280-E060-43D3-9BB9-061AAC20701C','C8B25FA3-0D61-453B-A630-77408207B602'))
        BEGIN
            SET @decDsFee =round((@mjtmp * 27.5),2,1);
		   --SET @decDsFee = @mjtmp * 27.5;
        END;
		-----
        IF (@projGUID IN ( 'c66b0262-f556-4d5c-b7f8-cac31a730fbc' ))
        BEGIN
            SET @decDsFee = @mjtmp * 1100 * 0.02;
        END;

		--20230530遂宁保利养生谷三期-一期
		IF (@projGUID IN ( 'EA76B625-C053-EB11-B398-F40270D39969' ))
        BEGIN
            SET @decDsFee = @mjtmp * 50;
        END;

		--20230904四川公司-保利锦外小户-一期
		--20241125成都保利云上-十期
		IF (@projGUID IN ( '65EBD076-ABF6-E711-80BA-E61F13C57837','63AFB337-C053-EB11-B398-F40270D39969','7FAC05A7-20D4-EB11-B398-F40270D39969','DBC75A72-5C3C-4B84-885F-D85343111697','1C1AA412-5946-448B-A614-F9B285E956A9' ,'46D25F55-B8B1-EC11-B39C-F40270D39969','2E2B0DFF-B0FC-413F-A47F-DB3881D8390A'))
        BEGIN
            SET @decDsFee =CAST(@mjtmp * 27.5 AS DECIMAL(10, 2));
        END;

        IF (@projGUID IN ( 'C63C57A8-9954-E711-80BA-E61F13C57837' ))
        BEGIN
            SET @decDsFee = @mjtmp * 80;
        END;
        IF (@projGUID IN ( 'c387a223-5842-4fab-8a9d-8a90ee22fc8c', '041F4330-DC66-4616-8509-93B67D3BC54C',
                           '1F775F9F-9854-E711-80BA-E61F13C57837', '30066FB7-9854-E711-80BA-E61F13C57837',
                           '8AC375C3-9A54-E711-80BA-E61F13C57837', 'FFF4FDEB-AAA9-E811-80BF-E61F13C57837',
                           '8C8EF453-C23B-E711-80BA-E61F13C57837'
                         )
           )
        BEGIN


            SET @decDsFee = @mjtmp * 720 * 0.025;
        END;
        IF @projGUID IN ( '5F2279D2-FC3A-E711-80BA-E61F13C57837' )
        BEGIN


            SET @decDsFee = @mjtmp * 720 * 0.025;
        END;
        --堂悦府维修基金20201016        
        IF @projGUID IN ( 'f66a94f4-ad84-e811-80bf-e61f13c57837' )
        BEGIN
            SET @decDsFee = @mjtmp * 13.75;
        END;
		--保利石象湖-茶田小院二期
		IF @projGUID IN ( 'F5761BF1-A254-E711-80BA-E61F13C57837' )
        BEGIN
            SET @decDsFee = @mjtmp * 11;
        END;
        --保利星荟     --保利和光屿湖-一期
        IF @projGUID IN ( 'E5ADAC6C-1FBE-E711-80BA-E61F13C57837', '5a0c954e-5dfb-e711-80ba-e61f13c57837',
                          '4a7920e3-a354-e711-80ba-e61f13c57837', 'CC0775AB-A4BB-464D-9CBA-018864B3EA73',
                          '46136C84-2583-4303-987C-2FFE674A5D2E', '5EC1B83B-89D5-4F5C-9762-4D47F2C480AB',
                          'F9B85041-5074-4525-A092-60C052C004D0', 'A70508D0-3FD1-46B8-BD75-7217B8F243CF',
                          '8EEAEFB4-F674-4030-9685-7A64359789AD', 'B1820AE9-6FD7-4A0E-BF6E-983A67187F6F',
                          '4080BEA3-3C5C-461E-BFB8-A7B9653BDDB8', 'A83AE8F3-2F04-4DB2-B5E1-C3D72C1DBBCE',
                          '950D8341-1D31-4F0C-9A74-D5B1FD55DDF6', 'C6364C1B-FEBC-4555-90B6-E0FE00A9F524',
                          '15C9167B-DC12-E911-80BF-E61F13C57837', 'A2DFA61B-14EA-E711-80BA-E61F13C57837',
                          '5E20152A-2C9D-E911-80B7-0A94EF7517DD', 'A7423BE5-9D54-E711-80BA-E61F13C57837',
						  'e8dce182-b2a4-e711-80ba-e61f13c57837',
						  '0f892b17-0cc8-42b2-afcb-5e4cadcd1861', '4104c2f5-a354-e711-80ba-e61f13c57837',
						  'c1fd0d85-9d54-e711-80ba-e61f13c57837','433666c9-d822-ea11-80b8-0a94ef7517dd',--四川保利大都汇项目5号地/四期B
						  '5a77c50f-9c1f-4d9d-b9d5-ad429b187e0a','C74D9821-389B-4993-B99D-7894556C216E',
						  '1c1aa412-5946-448b-a614-f9b285e956a9','edb9bfcf-4004-4319-a780-907931ac8fe7',
						  '29a43702-d936-4af0-82d0-23ed15a9549b','7862A489-5364-4F13-8042-4B48986EF6BF',
						  'a2070ee0-53e5-4470-bd4a-4992daa570e3','2b010c80-dc41-4ebc-9555-4ea15b8ee9db', --保利云上六七期---添加保利云上四期，十一期
						  '2fed0e85-d2a0-4ccf-8849-790a2717f873','0bdda90b-5aad-ea11-80b8-0a94ef7517dd',  --增加湖光里院一期，二期
						  'd5f72433-44b2-ec11-b39c-f40270d39969',----增加怡心和颂花园
						  'fc7d9e21-5703-ed11-b39c-f40270d39969',---增加锦城和颂
						 '266b44aa-b13b-e711-80ba-e61f13c57837',----保利国宾首府-一号地块
						 'b4a567fe-a56f-e811-80bf-e61f13c57837',----保利国宾首府-二号地块
						 'a6a782ee-ae3a-e711-80ba-e61f13c57837',---保利西子城-一期
						 '0D61D215-C1FA-40C8-9AB8-D62C04AB89DF',---保利成都中环广场g地块
						 '71d25887-b2f9-4960-894d-a649ccead8ea','e7d2f104-9a39-4cb8-ba4f-a7327e87be8b'--保利云上八，九期
						  
                        )
        BEGIN
            SET @decDsFee = @mjtmp * 27.5;

        END;

		--四川保利大都汇项目5号地10号楼
		     IF @bldguid IN ( '7df77344-cdd6-e811-80bf-e61f13c57837')
            BEGIN
                SET @decDsFee = @mjtmp * 22;;       
            END;


        --空港星汇中心      
        IF @projGUID IN ( '84ACDA8D-1EA5-E811-80BF-E61F13C57837' )
        BEGIN
            IF @cplx = '商业' and @bldguid  not IN ( 'C6F856BC-49A9-49AE-938D-4738CE7C9179')
            BEGIN
                SET @decDsFee = @mjtmp * 1100 * 0.02;

            END;

            IF @cplx = '公寓' or  @bldguid  IN ( 'C6F856BC-49A9-49AE-938D-4738CE7C9179')
            BEGIN
                SET @decDsFee = @mjtmp * 1100 * 0.025;

            END;

        END;

		--成都保利西汇智慧云城-二号地块--一号地
		IF @projGUID IN ( 'd1f0ef12-b894-ea11-80b8-0a94ef7517dd','31C06E58-70B6-4CD7-8969-26B137272074' )
        BEGIN
            IF @cplx = '商业'
            BEGIN
                SET @decDsFee = @mjtmp * 22;

            END;

            IF @cplx = '住宅'
            BEGIN
                SET @decDsFee = @mjtmp * 27.5;

            END;

			IF @cplx = '车位'
            BEGIN
                SET @decDsFee = @mjtmp * 27.5;

            END;

        END;




        --中央峰景
        IF @projGUID IN ( 'EF9FED6C-9D54-E711-80BA-E61F13C57837' )
        BEGIN


            SET @decDsFee = @mjtmp * 13.75;
        END;
        IF (@projGUID = '82C2946D-7455-E711-80BA-E61F13C57837')
           AND @cplx = '高级住宅'
        BEGIN
            SET @decDsFee = @mjtmp * 720 * 0.02;
        END;

        IF @projGUID IN ( 'a928b7e9-b63b-e711-80ba-e61f13c57837' /*,'3d82ace4-ad3b-e711-80ba-e61f13c57837'*/ )
           AND @cplx = '高级住宅'
        BEGIN
            SET @decDsFee = @mjtmp * 1100 * 0.02;
        END;

        IF @projGUID IN ( 'a928b7e9-b63b-e711-80ba-e61f13c57837' /*,'3d82ace4-ad3b-e711-80ba-e61f13c57837'*/ )
           AND @cplx IN ( '住宅', '商业', '车位' )
        BEGIN
            SET @decDsFee = @mjtmp * 1100 * 0.025;
        END;
        ---成都保利大都汇一期 叠拼高级住宅=实测*2.5%
        IF @projGUID IN ( '3d82ace4-ad3b-e711-80ba-e61f13c57837' )
           AND @cplx IN ( '住宅', '商业', '车位' )
        BEGIN
            SET @decDsFee = @mjtmp * 1100 * 0.025;
        END;

        IF @projGUID IN ( '3d82ace4-ad3b-e711-80ba-e61f13c57837' )
           AND @cplx = '高级住宅'
           AND @productname <> '叠拼高级住宅'
        BEGIN
            SET @decDsFee = @mjtmp * 1100 * 0.02;
        END;

        IF @projGUID IN ( '3d82ace4-ad3b-e711-80ba-e61f13c57837' )
           AND @cplx IN ( '住宅', '商业', '车位' )
        BEGIN
            SET @decDsFee = @mjtmp * 1100 * 0.025;
        END;

        IF @projGUID IN ( '3d82ace4-ad3b-e711-80ba-e61f13c57837' )
           AND @cplx = '高级住宅'
           AND @productname = '叠拼高级住宅'
        BEGIN
            SELECT @mjtmp = ScBldArea
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SET @decDsFee = @mjtmp * 1100 * 0.025;
        END;




        PRINT @productname;
        PRINT @decDsFee;

        --保利天府和悦-一期

        --IF @projGUID IN ( '2FBAB980-E336-E811-80BA-E61F13C57837' )
        --   AND @cplx = '高级住宅'
        --   --AND @productname = '联排高级住宅'
        --BEGIN
        --    SET @decDsFee = @mjtmp * 10;
        --END;

        IF @projGUID IN ( '2FBAB980-E336-E811-80BA-E61F13C57837' )
           --AND @cplx = '车位'
        BEGIN
            SET @decDsFee = @mjtmp * 12.5;
        END;

        --IF @projGUID IN ( '2FBAB980-E336-E811-80BA-E61F13C57837' )
        --   AND @cplx = '高级住宅'
        --   --AND @productname = '叠拼高级住宅'
        --BEGIN
        --    SELECT @mjtmp = ScBldArea
        --    FROM p_room
        --    WHERE RoomGUID = @chvRoomGUID;
        --    SET @decDsFee = @mjtmp * 12.5;
        --END;

        PRINT @productname;
        PRINT @decDsFee;

		-- ---四川公司-保利西子城一期 除商业外楼栋维修基金=27.5*实测建筑面积
        IF @projGUID IN ( 'A6A782EE-AE3A-E711-80BA-E61F13C57837' )
           AND @cplx not IN ( '商业' )
        BEGIN
            SET @decDsFee = @mjtmp * 27.5;
        END;

       

        -------成都保利大都汇3号地 叠拼高级住宅=实测*2.5%
        /*
  维修基金：维修基金=实测建筑面积*1100*2%（1、4栋商铺）；维修基金=实测建筑面积*1100*2.5%（2栋商铺，高层住宅，叠拼高级住宅，地下车位）*/
        IF @projGUID IN ( 'dd0d0ad1-a354-e711-80ba-e61f13c57837' )
        BEGIN
            IF @bldguid IN ( '85BAB990-0A09-405E-941D-025F975202F7', '7D57A2B8-AD83-46BF-B288-3EE7F7C4492E' )
            BEGIN
                SET @decDsFee = @mjtmp * 1100 * 0.02;
            --print 'lirui'
            END;
            IF @bldguid IN ( '0215C10B-A2EE-42C2-B661-945EF115B3D7' )
               OR @cplx IN ( '高级住宅', '住宅', '车位', '小学' )
            BEGIN
                PRINT 'XXX';
                SET @decDsFee = @mjtmp * 1100 * 0.025;
            END;
            PRINT @cplx;
            PRINT '成都大都汇';
            PRINT @decDsFee;
            RETURN 0;
        END;

        --保利广悦府维修基金计算
        IF (@projGUID = 'af712ac7-2f7c-e811-80bf-e61f13c57837')
        --and @Cplx<>'高级住宅'          
        BEGIN
            SET @decDsFee = @mjtmp * 13.5;
        END;

        IF (@projGUID = '82C2946D-7455-E711-80BA-E61F13C57837')
           AND @cplx <> '高级住宅'
        BEGIN
            SET @decDsFee = @mjtmp * 720 * 0.025;
        END;

        IF (@projGUID = 'C8488911-9454-E711-80BA-E61F13C57837')
           OR (@projGUID = '10CC6AF3-9354-E711-80BA-E61F13C57837')
           OR (@projGUID = '0D2A4099-9A54-E711-80BA-E61F13C57837')
        BEGIN
            SET @decDsFee = @mjtmp * 720 * 0.025;
        END;

        IF (@projGUID = '2B009405-9454-E711-80BA-E61F13C57837')
           OR (@projGUID = '2a1d63b0-158f-e811-80bf-e61f13c57837')
        BEGIN
            SET @decDsFee = @mjtmp * 720 * 0.025;


        END;
        IF (@projGUID IN ( '4254189d-6079-48bc-8351-486b0e92f00b ', '08e5e230-5e7d-4e90-90dc-ba4cf0ac0417' ))
        BEGIN
            SET @decDsFee = @mjtmp * 550 * 0.02;

        END;

        IF (@projGUID IN ( '8420dfcc-1f60-e511-891a-e41f13c5183a' ))
           AND @cplx IN ( '住宅', '车位' )
        BEGIN

            SET @decDsFee = @mjtmp * 1100 * 0.025;
        END;
        IF (@projGUID IN ( '8420dfcc-1f60-e511-891a-e41f13c5183a' ))
           AND @cplx IN ( '高级住宅', '商业' )
        BEGIN

            SET @decDsFee = @mjtmp * 1100 * 0.02;
        END;

        --悦          
        IF (@projGUID IN ( '6a8dbaf6-adfa-e411-891a-e41f13c5183a' ))
           AND @cplx IN ( '住宅', '商业', '车位' )
        BEGIN
            SET @decDsFee = @mjtmp * 1100 * 0.025;

        END;

        IF (@projGUID IN ( '6a8dbaf6-adfa-e411-891a-e41f13c5183a' ))
           AND @cplx IN ( '高级住宅' )
        BEGIN
            SET @decDsFee = @mjtmp * 1100 * 0.02;

        END;


        IF (@projGUID IN ( '68a74701-cd5a-45b6-bebf-20b36302a380' ))
        BEGIN
            SET @decDsFee = @mjtmp * 1100 * 0.025;
        END;

        IF (@projGUID = '4d7ff7e2-3a9d-4827-839d-ee93d6ccbabc')
        BEGIN
            SET @decDsFee = @mjtmp * 1100 * 0.025;
        END;
        IF (@projGUID = 'd22b7b83-b251-4112-8f61-e9a5534a73c6')
           OR (@projGUID = '4E3D061E-B13B-E711-80BA-E61F13C57837')
        BEGIN
            SET @decDsFee = @mjtmp * 720 * 0.02;
        END;
        IF (@projGUID IN ( 'EC7DAC64-87B6-E811-80BF-E61F13C57837', '32e31338-b9d1-457f-a8d8-f20be37533bd' ))
        BEGIN
            SET @decDsFee = CAST(@mjtmp * 1100 * 0.025 AS DECIMAL(10, 2));
        END;
        IF (@projGUID IN ( 'AAD45BA5-9854-E711-80BA-E61F13C57837', '3FD98C23-9454-E711-80BA-E61F13C57837' )) --保利公园198-拉斐公馆             
        BEGIN
            SET @decDsFee = CAST(@mjtmp * 720 * 0.025 AS DECIMAL(10, 2));
        END;
        IF (@projGUID = '18270F42-9954-E711-80BA-E61F13C57837')
        BEGIN
            SET @decDsFee = CAST(@mjtmp * 54 AS DECIMAL(10, 2));
        END;
        IF (@projGUID = '092a7e55-e416-4e1f-bf4d-1508998b5e43')
        BEGIN
            SET @decDsFee = CAST(@mjtmp * 1100 * 0.025 AS DECIMAL(10, 2));
        END;
        IF (@projGUID IN ( '2781d5ce-a154-e711-80ba-e61f13c57837', '1f8ee7f9-9a54-e711-80ba-e61f13c57837',
                           '13099473-d03a-e711-80ba-e61f13c57837', '5149320c-9b54-e711-80ba-e61f13c57837',
                           '05b115f6-7455-e711-80ba-e61f13c57837', '13099473-d03a-e711-80ba-e61f13c57837',
                           '67413510-a8d9-42b7-91aa-65d5b738aee0'
                         )
           )
        /* begin              
        Set @decDsFee =cast(@mjtmp*50 as decimal(10,2)) ;                                          
      end  */
        BEGIN
            IF @cplx IN ( '高级住宅', '住宅', '车位' )
            BEGIN
                SET @decDsFee = CAST(@mjtmp * 50 AS DECIMAL(10, 2));
            END;

            IF @cplx = '商业'
            BEGIN

                SET @decDsFee = CAST(@mjtmp * 35 AS DECIMAL(10, 2));
            END;


        END;

        IF (@projGUID IN ( '1C2A6DF0-9454-E711-80BA-E61F13C57837', '513268DE-9454-E711-80BA-E61F13C57837' ))
        BEGIN
            IF @cplx = '高级住宅'
            BEGIN
                SET @decDsFee = @mjtmp * 1100 * 0.02;
            END;

            IF @cplx IN ( '住宅', '商业', '车位' )
            BEGIN

                SET @decDsFee = @mjtmp * 1100 * 0.025;
            END;


        END;

        IF (@projGUID = 'BDBA7645-9554-E711-80BA-E61F13C57837')
        BEGIN
            IF @cplx = '高级住宅'
            BEGIN
                SET @decDsFee = CAST(@mjtmp * 11 AS DECIMAL(10, 2));
            END;

            IF @cplx = '住宅'
            BEGIN

                SET @decDsFee = CAST(@mjtmp * 13.75 AS DECIMAL(10, 2));
            END;




        END;

        -----保利天空之城2号地

        -- if ( @projGUID='3a69a228-2271-e711-80ba-e61f13c57837')                                     
        --            BEGIN                                          
        --IF @chvItemName='专项维修资金（电梯）'                                          
        --BEGIN                                          
        --Set @decDsFee =@mjtmp*1100*0.025;                                          
        --END                                          

        --  IF @chvItemName='专项维修资金（无电梯）'                                           
        --  BEGIN                                           

        --   Set @decDsFee =@mjtmp*1100*0.02 ;                    
        --  end                                          


        -- end      


        RETURN 1;

    END;






    -----------------                                            
    IF @chvItemName = '国土证手续费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                       
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“国土证手续费)”                           

        IF (@projGUID IN ( '4254189d-6079-48bc-8351-486b0e92f00b' ))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 0.33, 2);
        END;
        IF (@projGUID IN ( '08e5e230-5e7d-4e90-90dc-ba4cf0ac0417b' ))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 22.49, 2);
        END;
        RETURN 1;
    END;

    --国土证手续费计算结束                                          



    -----------------                                          

    --专项维修资金(电梯)=建筑成本价（720元/㎡）×房屋建筑面积 ×2.5%（保留两位小数）                                     
    --中央峰景：专项维修资金(电梯)=实测建筑面积*13.75元/平方米    （保留两位小数）                                     
    --成都湖心岛 观湖苑商业地块 实测面积*1100*2.5%                                
    IF @chvItemName IN ( '专项维修资金(电梯)' )
    --  print   @projgud 

    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                            
        SET @mjtmp = 0;
        SET @scmj = 0;

        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @scmj = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @scmj = CAST(p_room.BldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“专项维修资金(电梯)”                                                  

        IF (@projGUID IN ( 'BAD6BBAC-643B-E711-80BA-E61F13C57837', '706b1e84-403c-e711-80ba-e61f13c57837',
                           'D1D34A61-7455-E711-80BA-E61F13C57837', '986E2457-9A54-E711-80BA-E61F13C57837',
                           '2a1d63b0-158f-e811-80bf-e61f13c57837'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 720 * 0.025, 2);
        END;



        IF (@projGUID IN ( '72a57a40-9e54-e711-80ba-e61f13c57837', '34d2973a-2271-e711-80ba-e61f13c57837',
                           'e880b53b-a254-e711-80ba-e61f13c57837', '3a69a228-2271-e711-80ba-e61f13c57837',
                           'f419debc-c48e-e711-80ba-e61f13c57837', 'b4a567fe-a56f-e811-80bf-e61f13c57837',
                           'a3fe8f4c-2271-e711-80ba-e61f13c57837', '6FF674A4-D73A-E711-80BA-E61F13C57837',
                           '04228d7c-9e54-e711-80ba-e61f13c57837', '7257ec1c-7455-e711-80ba-e61f13c57837',
                           '0dbdb378-aee4-4efa-9385-fcca8fafb06c', 'ecca4882-7355-e711-80ba-e61f13c57837',
                           'CC51C1FA-763B-E711-80BA-E61F13C57837', '6ce56528-9e54-e711-80ba-e61f13c57837',
                           'fd46efb8-a354-e711-80ba-e61f13c57837', '215ce4ca-f27b-e711-80ba-e61f13c57837',
                           '02b2f68b-f27b-e711-80ba-e61f13c57837'
                         )
           )
        BEGIN
            -- print 'YYY'    
            PRINT @decDsFee;
            SET @decDsFee = ROUND(@scmj * 1100 * 0.025, 2);
            PRINT @decDsFee;
        END;

        IF (@projGUID IN (   '3BDF2999-44E5-4DAC-8B7D-EF5B70E589EC', 'a063ae16-6361-e711-80ba-e61f13c57837', --天府南院
                             'b9ee1443-31af-e711-80ba-e61f13c57837',                                         --保利仁里
                             '7917b771-6761-e711-80ba-e61f13c57837', '56302072-a254-e711-80ba-e61f13c57837'  --天府林语
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@scmj * 50, 2);
        END;

        IF (@projGUID IN ( 'e4298fe7-6d55-e711-80ba-e61f13c57837', 'BDBA7645-9554-E711-80BA-E61F13C57837',
                           'EF9FED6C-9D54-E711-80BA-E61F13C57837'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 13.75, 2);
        END;

        IF (@projGUID IN ( 'fc424e07-0355-e511-891a-e41f13c5183a', 'F30A3486-A230-E711-80BA-E61F13C57837',
                           '8BA26B4E-9B54-E711-80BA-E61F13C57837', 'a24e5342-9b54-e711-80ba-e61f13c57837',
                           'bc7171c0-95b1-e311-9927-e41f13c5183a', 'd1fc51ab-7455-e711-80ba-e61f13c57837',
                           '9abf6670-9e54-e711-80ba-e61f13c57837', 'adf5625e-9e54-e711-80ba-e61f13c57837',
                           '11016e52-9e54-e711-80ba-e61f13c57837', 'c6ffaee5-13ea-e711-80ba-e61f13c57837',
                           '4e95f59e-da06-4122-9eed-ed0300859211', '67677e56-e71a-422c-bf3e-255c38ef4a49'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 1100 * 0.025, 2); --实际上是27.5/㎡
        END;

        IF @projGUID IN ( '05b115f6-7455-e711-80ba-e61f13c57837' )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 35, 2);
        END;

        --加国宾学府
        IF (@projGUID IN ( 'F88E3F19-C33B-E711-80BA-E61F13C57837', '4dbfa09a-783b-e711-80ba-e61f13c57837',
                           '343c79b0-a56f-e811-80bf-e61f13c57837', '266b44aa-b13b-e711-80ba-e61f13c57837'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 1100 * 0.025, 2);
        END;
        -- PRINT @decDsFee+'UUU'                                      
        --RETURN 1;

        IF @projGUID IN ( '7c5a1138-2f5a-e711-80ba-e61f13c57837' )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 27.5, 2);
        END;
		  IF @projGUID IN ( 'b7be22ae-ad96-eb11-b398-f40270d39969','f2f2ce4a-512f-4b0d-8b4a-79c2a3c2bbd0' )
                        BEGIN
                            SET @decDsFee = ROUND(@mjtmp * 90, 2);
                        END;

    END;

    --专项维修资金(电梯)计算结束                                          


    --专项维修资金(电梯)=建筑成本价（720元/㎡）×房屋建筑面积 ×2.5%（保留两位小数）                                     
    --中央峰景：专项维修资金(电梯)=实测建筑面积*13.75元/平方米    （保留两位小数）                                     

    IF @chvItemName = '维修基金(电梯预测)'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        SET @scmj = 0;

        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @scmj = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @scmj = CAST(p_room.BldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“专项维修资金(电梯)”                                                  

        IF (@projGUID IN ( 'F88E3F19-C33B-E711-80BA-E61F13C57837' ))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 720 * 0.025, 2);
        END;

        IF (@projGUID IN ( '3BDF2999-44E5-4DAC-8B7D-EF5B70E589EC' ))
        BEGIN
            SET @decDsFee = ROUND(@scmj * 50, 2);
        END;

        IF (@projGUID IN ( 'BDBA7645-9554-E711-80BA-E61F13C57837', 'EF9FED6C-9D54-E711-80BA-E61F13C57837' ))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 13.75, 2);
        END;
        PRINT ' chenfen';
        IF (@projGUID IN ( 'fc424e07-0355-e511-891a-e41f13c5183a', 'F30A3486-A230-E711-80BA-E61F13C57837',
                           '8BA26B4E-9B54-E711-80BA-E61F13C57837', 'a24e5342-9b54-e711-80ba-e61f13c57837',
                           'bc7171c0-95b1-e311-9927-e41f13c5183a'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 1100 * 0.025, 2);
        END;

        IF (@projGUID IN ( '05b115f6-7455-e711-80ba-e61f13c57837' ))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 50, 2);
        END;


        IF (@projGUID IN ( 'F88E3F19-C33B-E711-80BA-E61F13C57837', '706B1E84-403C-E711-80BA-E61F13C57837' ))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 720 * 0.025, 2);
        END;

        IF (@projGUID IN ( '1349DD08-BA88-E711-80BA-E61F13C57837' ))
        BEGIN
            SET @decDsFee = ROUND(@scmj * 720 * 0.025, 2);
        END;

        RETURN 1;
    END;

    --专项维修资金(电梯)计算结束                                          

	    --维修基金(别墅)=11*建面                                                               

    IF @chvItemName = '维修基金(别墅)'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        SET @scmj = 0;

        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @scmj = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @scmj = CAST(p_room.BldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“维修基金(别墅)”                                                  

        IF (@projGUID IN ( '8CB20ADF-A254-E711-80BA-E61F13C57837' ))
        BEGIN
            SET @decDsFee = @mjtmp * 11;
        END;

        RETURN 1;
    END;

    --维修基金(别墅)计算结束                                          





    --专项维修资金(电梯)=建筑成本价（720元/㎡）×房屋建筑面积 ×2%（保留两位小数）                                    
    --中央峰景：专项维修资金(无电梯)＝实测建筑面积*11元/平方米 （保留两位小数）                                         

    IF @chvItemName = '专项维修资金（无电梯）'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        SET @scmj = 0;

        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @scmj = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @scmj = CAST(p_room.BldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“专项维修资金（无电梯）”                                                  

        IF (@projGUID IN ( 'bad6bbac-643b-e711-80ba-e61f13c57837', 'BAD6BBAC-643B-E711-80BA-E61F13C57837',
                           '706b1e84-403c-e711-80ba-e61f13c57837', '5F2279D2-FC3A-E711-80BA-E61F13C57837',
                           'D1D34A61-7455-E711-80BA-E61F13C57837', '986E2457-9A54-E711-80BA-E61F13C57837'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 720 * 0.02, 2);
        END;

        IF (@projGUID IN ( '72a57a40-9e54-e711-80ba-e61f13c57837', '34d2973a-2271-e711-80ba-e61f13c57837',
                           'e880b53b-a254-e711-80ba-e61f13c57837', '3a69a228-2271-e711-80ba-e61f13c57837',
                           'b4a567fe-a56f-e811-80bf-e61f13c57837', 'a3fe8f4c-2271-e711-80ba-e61f13c57837',
                           '0dbdb378-aee4-4efa-9385-fcca8fafb06c', 'ecca4882-7355-e711-80ba-e61f13c57837',
                           '7257ec1c-7455-e711-80ba-e61f13c57837', '9abf6670-9e54-e711-80ba-e61f13c57837',
                           'adf5625e-9e54-e711-80ba-e61f13c57837', '11016e52-9e54-e711-80ba-e61f13c57837',
                           '6ce56528-9e54-e711-80ba-e61f13c57837', '215ce4ca-f27b-e711-80ba-e61f13c57837',
                           '02b2f68b-f27b-e711-80ba-e61f13c57837'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@scmj * 1100 * 0.02, 2); ---也就是22元/平米                                    
        END;

        IF (@projGUID IN (   '3BDF2999-44E5-4DAC-8B7D-EF5B70E589EC', 'a063ae16-6361-e711-80ba-e61f13c57837', --天府南院
                             'b9ee1443-31af-e711-80ba-e61f13c57837',                                         --保利仁里
                             '7917b771-6761-e711-80ba-e61f13c57837', '56302072-a254-e711-80ba-e61f13c57837'  --天府林语
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@scmj * 35, 2);
        END;
        IF (@projGUID IN ( '05b115f6-7455-e711-80ba-e61f13c57837' ))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 50, 2);
        END;
        IF (@projGUID IN ( 'e4298fe7-6d55-e711-80ba-e61f13c57837', 'BDBA7645-9554-E711-80BA-E61F13C57837' ))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 11, 2);
        END;
        IF (@projGUID IN ( '04228d7c-9e54-e711-80ba-e61f13c57837', 'fc424e07-0355-e511-891a-e41f13c5183a',
                           'F30A3486-A230-E711-80BA-E61F13C57837', '8BA26B4E-9B54-E711-80BA-E61F13C57837',
                           'a24e5342-9b54-e711-80ba-e61f13c57837', 'bc7171c0-95b1-e311-9927-e41f13c5183a',
                           'd1fc51ab-7455-e711-80ba-e61f13c57837'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 1100 * 0.02, 2);
        END;
		IF ( @projGUID IN ( 'f2f2ce4a-512f-4b0d-8b4a-79c2a3c2bbd0' ))
                        BEGIN
                            SET @decDsFee = ROUND(@mjtmp * 75, 2);
                        END;

        --加国宾学府
        IF (@projGUID IN ( 'F88E3F19-C33B-E711-80BA-E61F13C57837', '4dbfa09a-783b-e711-80ba-e61f13c57837',
                           '343c79b0-a56f-e811-80bf-e61f13c57837', '266b44aa-b13b-e711-80ba-e61f13c57837'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 1100 * 0.02, 2);
        END;
        PRINT @decDsFee;
        RETURN 1;

    END;

    --专项维修资金（无电梯）计算结束                                          

	---2025217 湖光里院二期1号地
	---20250307 湖光里院一期2号地
	 IF @chvItemName = '维修基金（电梯）'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“维修基金（电梯）”                                                

        IF (@projGUID IN ( '0bdda90b-5aad-ea11-80b8-0a94ef7517dd','2FED0E85-D2A0-4CCF-8849-790A2717F873'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 22, 2);
        END;

        RETURN 1;
    END;



    --维修基金（海德1）维修基金（海德1）=实测建筑面积*108（保留2位小数）                                          

    IF @chvItemName = '维修基金（海德1）'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“维修基金（海德1）”                                                

        IF (@projGUID IN ( 'C63C57A8-9954-E711-80BA-E61F13C57837', 'FD3EB686-A154-E711-80BA-E61F13C57837',
                           '070AAA7A-A154-E711-80BA-E61F13C57837', '156BC8A4-A154-E711-80BA-E61F13C57837',
                           '103AC15C-A154-E711-80BA-E61F13C57837', '31A6BEB8-9E54-E711-80BA-E61F13C57837',
                           '3160B868-A154-E711-80BA-E61F13C57837', '9CE9A7AC-9E54-E711-80BA-E61F13C57837',
                           '4F39A54A-A154-E711-80BA-E61F13C57837', '18270F42-9954-E711-80BA-E61F13C57837'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 108, 2);
        END;

        RETURN 1;
    END;

    --维修基金（海德1）计算结束                        

    --维修基金（海德2）维修基金（海德2）=实测建筑面积*118（保留2位小数）                                          

    IF @chvItemName = '维修基金（海德2）'
    BEGIN
        --取价格                                            
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                               
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“维修基金（海德2）”                                                  

        IF (@projGUID IN ( 'C63C57A8-9954-E711-80BA-E61F13C57837', 'FD3EB686-A154-E711-80BA-E61F13C57837',
                           '070AAA7A-A154-E711-80BA-E61F13C57837', '156BC8A4-A154-E711-80BA-E61F13C57837',
                           '103AC15C-A154-E711-80BA-E61F13C57837', '31A6BEB8-9E54-E711-80BA-E61F13C57837',
                           '3160B868-A154-E711-80BA-E61F13C57837', '9CE9A7AC-9E54-E711-80BA-E61F13C57837',
                           '4F39A54A-A154-E711-80BA-E61F13C57837', '18270F42-9954-E711-80BA-E61F13C57837'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 118, 2);
        END;

        RETURN 1;
    END;

    --维修基金（海德2）计算结束                          
    --维修基金（海德3）维修基金（海德3）=实测建筑面积*72（保留2位小数）                                          

    IF @chvItemName = '维修基金（海德3）'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“维修基金（海德3）”                                                  

        IF (@projGUID IN ( 'C63C57A8-9954-E711-80BA-E61F13C57837', 'FD3EB686-A154-E711-80BA-E61F13C57837',
                           '070AAA7A-A154-E711-80BA-E61F13C57837', '156BC8A4-A154-E711-80BA-E61F13C57837',
                           '103AC15C-A154-E711-80BA-E61F13C57837', '31A6BEB8-9E54-E711-80BA-E61F13C57837',
                           '3160B868-A154-E711-80BA-E61F13C57837', '9CE9A7AC-9E54-E711-80BA-E61F13C57837',
                           '4F39A54A-A154-E711-80BA-E61F13C57837', '18270F42-9954-E711-80BA-E61F13C57837'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 72, 2);
        END;

        RETURN 1;
    END;

    --维修基金（海德3）计算结束                                          


    --维修基金（纽约1）维修基金（纽约1）=实测建筑面积*120 （保留2位小数）                                          


    IF @chvItemName = '维修基金（纽约1）'
    BEGIN
        --取价格                                     
        SET @decTmp = 0;
        --取面积                            
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“维修基金（纽约1）”                                                  

        IF (@projGUID IN ( '9da9602b-5e82-41e3-b1b8-a5734d290e4f' ))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 120, 2);
        END;

        RETURN 1;
    END;

    --维修基金（纽约1）计算结束                                          


    --维修基金（纽约2）维修基金（纽约2）=实测建筑面积*139 （保留2位小数）                                          


    IF @chvItemName = '维修基金（纽约2）'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“维修基金（纽约2）”                                              

        IF (@projGUID IN ( '9da9602b-5e82-41e3-b1b8-a5734d290e4f' ))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 139, 2);
        END;
        IF (@projGUID IN ( '6e69d4de-3b66-e911-80b7-0a94ef7517dd' ))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 80, 2);
        END;

        RETURN 1;
    END;

    --维修基金（纽约2）计算结束                                          


    --维修基金（车位）维修基金（车位）=实测建筑面积*76 （不保留四舍五入）                                          


    IF @chvItemName = '维修基金（车位）'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                 
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“维修基金（车位）”                                

        IF (@projGUID IN ( '9da9602b-5e82-41e3-b1b8-a5734d290e4f' ))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 76, 0);
        END;
        IF (@projGUID IN ( '6ff674a4-d73a-e711-80ba-e61f13c57837' ))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 27.5, 2);
        END;
        RETURN 1;
    END;

    --维修基金（车位）计算结束                                          





    IF @chvItemName = '维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                 
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“维修基金（车位）”                                
		--保利北新时区花园
        IF (@projGUID IN ( '513268DE-9454-E711-80BA-E61F13C57837', '1C2A6DF0-9454-E711-80BA-E61F13C57837',
                           'e8be3142-7455-e711-80ba-e61f13c57837',
						   'ab13aa2b-d753-eb11-b398-f40270d39969','dd2358e5-edea-4dd5-8b1e-d3c2b0585912','9f2d70c7-4125-4b8b-8865-9fe87c3b6d9d',
'6b9653a5-a819-4b9a-9534-84b2dddfd999','b3e771ab-bb41-46b1-bebe-06a5f7235d79','cf9d1b83-8b7c-43d3-9104-9d76f86a23ac','2ca316e2-34b5-4493-94d8-4560daf969ae'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 1100 * 0.025, 0);
        END;


        RETURN 1;
    END;



    ---   维修基金(高级住宅)                                                  
    IF @chvItemName = '维修基金(高级住宅)'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                              
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM s_Contract a
                 LEFT JOIN p_room ON a.RoomGUID = p_room.RoomGUID
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        ---开始计算“维修基金(高级住宅)”                           

        IF (@projGUID = 'C8488911-9454-E711-80BA-E61F13C57837')
        BEGIN
            SET @decDsFee = @mjtmp * 720 * 0.02;
        END;
        IF (@projGUID IN ( 'C63C57A8-9954-E711-80BA-E61F13C57837', 'FD3EB686-A154-E711-80BA-E61F13C57837',
                           '070AAA7A-A154-E711-80BA-E61F13C57837', '156BC8A4-A154-E711-80BA-E61F13C57837',
                           '103AC15C-A154-E711-80BA-E61F13C57837', '31A6BEB8-9E54-E711-80BA-E61F13C57837',
                           '3160B868-A154-E711-80BA-E61F13C57837', '9CE9A7AC-9E54-E711-80BA-E61F13C57837',
                           '4F39A54A-A154-E711-80BA-E61F13C57837', '18270F42-9954-E711-80BA-E61F13C57837'
                         )
           )
        BEGIN
            SET @decDsFee = @mjtmp * 66;
        END;

        IF (@projGUID IN ( '513268DE-9454-E711-80BA-E61F13C57837', '1C2A6DF0-9454-E711-80BA-E61F13C57837',
                           'fc424e07-0355-e511-891a-e41f13c5183a', 'c66b0262-f556-4d5c-b7f8-cac31a730fbc'
                         )
           )
        BEGIN
            SET @decDsFee = @mjtmp * 1100 * 0.02;
        END;

        IF @projGUID IN (   '7917b771-6761-e711-80ba-e61f13c57837', --天府林语
                            '8cb20adf-a254-e711-80ba-e61f13c57837'  ---石象湖茶田小院
                        )
        BEGIN
            SET @decDsFee = @mjtmp * 11;
            PRINT @mjtmp;
            PRINT @decDsFee;
        END;

        IF @projGUID IN (   'a063ae16-6361-e711-80ba-e61f13c57837', --保利仁里
                            'b9ee1443-31af-e711-80ba-e61f13c57837'  --天府南院
                        )
        BEGIN
            SET @decDsFee = @mjtmp * 55;
        --PRINT @mjtmp;
        --PRINT @decDsFee;
        END;

    --RETURN 1;

    END;

    --2、契税                                                  
    --   计算公式：成交总价（含补差）* 3%                                           
    --   单位购买：按楼价的3%                                             
    --保利国际城美茵庄园及纽约郡,江语城 契税 契税=补差后总房款×4% （保留2位小数）                                           
    --契税=补差后总房款*3%  （保留2位小数）                                             

    IF @chvItemName = '契税'
    BEGIN --取价格                                                  
        SET @decTmp = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0),
                   @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0),
                   @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        --开始计算“契税”                                                  

        IF (@projGUID IN ( 'dd4bbddc-7455-e711-80ba-e61f13c57837', 'd5d8c905-9954-e711-80ba-e61f13c57837',
                           'cc51c1fa-763b-e711-80ba-e61f13c57837', '0dbdb378-aee4-4efa-9385-fcca8fafb06c',
                           'F88E3F19-C33B-E711-80BA-E61F13C57837', 'BAD6BBAC-643B-E711-80BA-E61F13C57837',
                           'fc424e07-0355-e511-891a-e41f13c5183a', '706B1E84-403C-E711-80BA-E61F13C57837',
                           'F30A3486-A230-E711-80BA-E61F13C57837', '8BA26B4E-9B54-E711-80BA-E61F13C57837',
                           'a24e5342-9b54-e711-80ba-e61f13c57837', '4E3D061E-B13B-E711-80BA-E61F13C57837',
                           '0D2A4099-9A54-E711-80BA-E61F13C57837', '986E2457-9A54-E711-80BA-E61F13C57837',
                           '0c270e64-e6cd-45b7-8607-b8aefb0b36e4', '092a7e55-e416-4e1f-bf4d-1508998b5e43',
                           '94f0c07e-d7ab-4f47-ac35-fe4a1bc6a79f', '82C2946D-7455-E711-80BA-E61F13C57837',
                           '7B5276E1-9854-E711-80BA-E61F13C57837', '941A35CC-9754-E711-80BA-E61F13C57837',
                           '2B009405-9454-E711-80BA-E61F13C57837', '4d7ff7e2-3a9d-4827-839d-ee93d6ccbabc',
                           '69925C6F-9854-E711-80BA-E61F13C57837', '67215ACD-86B6-E811-80BF-E61F13C57837',
                           'D3E33F74-9654-E711-80BA-E61F13C57837', 'C8488911-9454-E711-80BA-E61F13C57837',
                           '1F775F9F-9854-E711-80BA-E61F13C57837', '68a74701-cd5a-45b6-bebf-20b36302a380',
                           '30066FB7-9854-E711-80BA-E61F13C57837', '8C8EF453-C23B-E711-80BA-E61F13C57837',
                           'D1D34A61-7455-E711-80BA-E61F13C57837'
                         )
           )
        BEGIN
            SET @decDsFee = CAST(@decTmp / (1 + 0.05) * 0.03 AS DECIMAL(10, 2));
        END;


        IF (@projGUID IN ( '5f2279d2-fc3a-e711-80ba-e61f13c57837', 'ecca4882-7355-e711-80ba-e61f13c57837',
                           '513268DE-9454-E711-80BA-E61F13C57837', 'CC51C1FA-763B-E711-80BA-E61F13C57837',
                           '1C2A6DF0-9454-E711-80BA-E61F13C57837'
                         )
           )
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.03 AS DECIMAL(10, 2));
        END;

        IF (@projGUID IN ( 'C63C57A8-9954-E711-80BA-E61F13C57837', 'FD3EB686-A154-E711-80BA-E61F13C57837',
                           '070AAA7A-A154-E711-80BA-E61F13C57837', '156BC8A4-A154-E711-80BA-E61F13C57837',
                           '103AC15C-A154-E711-80BA-E61F13C57837', '31A6BEB8-9E54-E711-80BA-E61F13C57837',
                           '3160B868-A154-E711-80BA-E61F13C57837', '9CE9A7AC-9E54-E711-80BA-E61F13C57837',
                           '4F39A54A-A154-E711-80BA-E61F13C57837', 'C63C57A8-9954-E711-80BA-E61F13C57837',
                           '18270F42-9954-E711-80BA-E61F13C57837', '9da9602b-5e82-41e3-b1b8-a5734d290e4f',
                           '13099473-d03a-e711-80ba-e61f13c57837', '67413510-a8d9-42b7-91aa-65d5b738aee0'
                         )
           )
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.04 AS DECIMAL(10, 2));
        END;

        IF (@projGUID = '6a8dbaf6-adfa-e411-891a-e41f13c5183a')
        BEGIN


            SET @decDsFee = ROUND((@decTmp / 2) * 0.03, 2) * 2;
        END;

		--加成都保利拉斐庄园三期
        IF (@projGUID IN ( '8420dfcc-1f60-e511-891a-e41f13c5183a','12F3D983-1484-E911-80B7-0A94EF7517DD' ))
        BEGIN


            SET @decDsFee = ROUND((@decTmp / 1.05) * 0.03, 2);


        END;

        --加国宾学府                                   
        IF (@projGUID IN ( '2a1d63b0-158f-e811-80bf-e61f13c57837', 'AAD45BA5-9854-E711-80BA-E61F13C57837',
                           'EC7DAC64-87B6-E811-80BF-E61F13C57837', '32e31338-b9d1-457f-a8d8-f20be37533bd',
                           '10CC6AF3-9354-E711-80BA-E61F13C57837', '8AC375C3-9A54-E711-80BA-E61F13C57837',
                           'FFF4FDEB-AAA9-E811-80BF-E61F13C57837', '3FD98C23-9454-E711-80BA-E61F13C57837',
                           '4dbfa09a-783b-e711-80ba-e61f13c57837', '343c79b0-a56f-e811-80bf-e61f13c57837',
                           '266b44aa-b13b-e711-80ba-e61f13c57837', 'b4a567fe-a56f-e811-80bf-e61f13c57837'
                         )
           ) --保利公园198-拉斐公馆                                

        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.03 AS DECIMAL(10, 2));
        END;

        IF (@projGUID IN ( 'bc7171c0-95b1-e311-9927-e41f13c5183a' )) --保利林语溪                                
        BEGIN
            IF @cplx IN ( '住宅' )
            BEGIN
                SET @decDsFee = CAST(@decTmp * 0.02 AS DECIMAL(10, 2));
            END;
            IF @cplx <> '住宅'
            BEGIN
                SET @decDsFee = CAST(@decTmp * 0.03 AS DECIMAL(10, 2));
            END;
        END;
    END;


    --3、契税2                                                  
    --   计算公式：成交总价（含补差）* 3%                                                  
    --   单位购买：按楼价的3%                            --翡丽湾(纽约郡),莱茵庄园 契税2=补差后总房款×3% （保留2位小数）                                           
    --契税2=补差后总房款*3%  （保留2位小数）                                             

    IF @chvItemName = '契税2'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;

        END;

        --开始计算“契税2”                                                  



        IF (@projGUID IN ( 'C63C57A8-9954-E711-80BA-E61F13C57837', 'FD3EB686-A154-E711-80BA-E61F13C57837',
                           '070AAA7A-A154-E711-80BA-E61F13C57837', '156BC8A4-A154-E711-80BA-E61F13C57837',
                           '103AC15C-A154-E711-80BA-E61F13C57837', '31A6BEB8-9E54-E711-80BA-E61F13C57837',
                           '3160B868-A154-E711-80BA-E61F13C57837', '9CE9A7AC-9E54-E711-80BA-E61F13C57837',
                           '4F39A54A-A154-E711-80BA-E61F13C57837', '18270F42-9954-E711-80BA-E61F13C57837',
                           '9da9602b-5e82-41e3-b1b8-a5734d290e4f', 'C63C57A8-9954-E711-80BA-E61F13C57837'
                         )
           )
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.03 AS DECIMAL(10, 2));
        END;
    END;
    --契税2计算结束；                                         




    --4、印花税                                                  
    --   计算公式：成交总价（含补差）* 0.0005                                                  
    --   单位购买：按楼价的3%                                       
    --   江语城  非住宅补差后总房款×0.05%（保留两位小数）；住宅 总价款×0.05%（保留两位小数），个人购买住宅暂免征收                                                  
    IF @chvItemName = '印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;

        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;

        END;



        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID,
                   @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room
                 LEFT JOIN p_BuildProductType ON p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;






            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“印花税”                                                  

        IF (@projGUID IN ( 'dd4bbddc-7455-e711-80ba-e61f13c57837', 'd5d8c905-9954-e711-80ba-e61f13c57837',
                           'cc51c1fa-763b-e711-80ba-e61f13c57837', '0dbdb378-aee4-4efa-9385-fcca8fafb06c',
                           '8420dfcc-1f60-e511-891a-e41f13c5183a', 'fc424e07-0355-e511-891a-e41f13c5183a',
                           'ecca4882-7355-e711-80ba-e61f13c57837', 'fc424e07-0355-e511-891a-e41f13c5183a',
                           '706B1E84-403C-E711-80BA-E61F13C57837', 'F30A3486-A230-E711-80BA-E61F13C57837',
                           '8BA26B4E-9B54-E711-80BA-E61F13C57837', 'a24e5342-9b54-e711-80ba-e61f13c57837',
                           'BDBA7645-9554-E711-80BA-E61F13C57837', 'bc7171c0-95b1-e311-9927-e41f13c5183a',
                           '69925C6F-9854-E711-80BA-E61F13C57837', '2a1d63b0-158f-e811-80bf-e61f13c57837',
                           '0D2A4099-9A54-E711-80BA-E61F13C57837', '986E2457-9A54-E711-80BA-E61F13C57837',
                           '092a7e55-e416-4e1f-bf4d-1508998b5e43', '94f0c07e-d7ab-4f47-ac35-fe4a1bc6a79f',
                           'AAD45BA5-9854-E711-80BA-E61F13C57837', 'EC7DAC64-87B6-E811-80BF-E61F13C57837',
                           '7B5276E1-9854-E711-80BA-E61F13C57837', '941A35CC-9754-E711-80BA-E61F13C57837',
                           '2B009405-9454-E711-80BA-E61F13C57837', '4d7ff7e2-3a9d-4827-839d-ee93d6ccbabc',
                           '9da9602b-5e82-41e3-b1b8-a5734d290e4f', '1F775F9F-9854-E711-80BA-E61F13C57837',
                           '67215ACD-86B6-E811-80BF-E61F13C57837', 'D3E33F74-9654-E711-80BA-E61F13C57837',
                           '68a74701-cd5a-45b6-bebf-20b36302a380', '8AC375C3-9A54-E711-80BA-E61F13C57837',
                           'FFF4FDEB-AAA9-E811-80BF-E61F13C57837', 'aada9668-9d5f-4426-8080-3195a908298d',
                           'D1D34A61-7455-E711-80BA-E61F13C57837'
                         )
           )
        BEGIN
            SET @decDsFee = @decTmp * 0.0005;
        END;
        IF @projGUID IN ( '32e31338-b9d1-457f-a8d8-f20be37533bd', '10CC6AF3-9354-E711-80BA-E61F13C57837',
                          '3FD98C23-9454-E711-80BA-E61F13C57837', '5F2279D2-FC3A-E711-80BA-E61F13C57837'
                        ) --保利公园198-拉斐公馆                                      
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.0005 AS DECIMAL(18, 2));
        END;


        IF @projGUID IN ( 'BAD6BBAC-643B-E711-80BA-E61F13C57837' ) --保利公园198-拉斐公馆                                      
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.0005 AS DECIMAL(18, 2));
        END;

        IF @projGUID IN ( '3d82ace4-ad3b-e711-80ba-e61f13c57837', 'a928b7e9-b63b-e711-80ba-e61f13c57837' )
           AND @cplx <> '住宅'
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.0005 AS DECIMAL(18, 2));
        END;


        --if @projGUID in('bc7171c0-95b1-e311-9927-e41f13c5183a','69925C6F-9854-E711-80BA-E61F13C57837')                   

        --begin                   
        --set @decDsFee =@intCstCount*5                  
        --end                                        
        IF @projGUID IN ( '82C2946D-7455-E711-80BA-E61F13C57837', '513268DE-9454-E711-80BA-E61F13C57837',
                          '1C2A6DF0-9454-E711-80BA-E61F13C57837', '30066FB7-9854-E711-80BA-E61F13C57837',
                          '0c270e64-e6cd-45b7-8607-b8aefb0b36e4', '13099473-d03a-e711-80ba-e61f13c57837',
                          '67413510-a8d9-42b7-91aa-65d5b738aee0', '4dbfa09a-783b-e711-80ba-e61f13c57837',
                          '343c79b0-a56f-e811-80bf-e61f13c57837', '266b44aa-b13b-e711-80ba-e61f13c57837',
                          'b4a567fe-a56f-e811-80bf-e61f13c57837'
                        )
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.0005 AS DECIMAL(18, 2));
        END;

        IF @projGUID = '6a8dbaf6-adfa-e411-891a-e41f13c5183a'
           AND @cplx <> '住宅'
        BEGIN

            SET @decDsFee = ROUND((@decTmp / 2) * 0.0005, 2) * 2;
        END;

        IF @projGUID IN ( '82C2946D-7455-E711-80BA-E61F13C57837', '13099473-d03a-e711-80ba-e61f13c57837',
                          '67413510-a8d9-42b7-91aa-65d5b738aee0', '82C2946D-7455-E711-80BA-E61F13C57837',
                          '8C8EF453-C23B-E711-80BA-E61F13C57837'
                        )
           AND @cplx = '住宅'
           AND @ge = '公司'
        BEGIN

            SET @decDsFee = CAST(@decTmp * 0.0005 AS DECIMAL(18, 2));
        END;
        IF @projGUID = ('8C8EF453-C23B-E711-80BA-E61F13C57837')
           AND @cplx = '商业'
        BEGIN

            SET @decDsFee = CAST(@decTmp * 0.0005 AS DECIMAL(18, 2));
        END;
        IF @projGUID = ('8C8EF453-C23B-E711-80BA-E61F13C57837')
           AND @cplx = '地下室/车库'
        BEGIN

            SET @decDsFee = CAST(@decTmp * 0.0005 AS DECIMAL(18, 2));
        END;

        IF @projGUID IN ( '13099473-d03a-e711-80ba-e61f13c57837', '67413510-a8d9-42b7-91aa-65d5b738aee0' )
           AND @cplx = '商业'
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.0005 AS DECIMAL(18, 2)) + 1;
        END;



        IF @projGUID IN ( '13099473-d03a-e711-80ba-e61f13c57837', '67413510-a8d9-42b7-91aa-65d5b738aee0' )
           AND @cplx = '住宅'
           AND @ge = '个人'
        BEGIN
            SET @decDsFee = '0.00';
        END;
    END;

    --印花税计算结束；                   



    --4、贴花                                                   
    --   计算公式：成交总价（含补差）* 0.0005                                                  
    --   单位购买：按楼价的3%                                       
    --   江语城  非住宅补差后总房款×0.05%（保留两位小数）；住宅 总价款×0.05%（保留两位小数），个人购买住宅暂免征收                      
    IF @chvItemName = '贴花'
    BEGIN
        --取价格                                         
        SET @decTmp = 0;

        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;

        END;



        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID,
                   @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room
                 LEFT JOIN p_BuildProductType ON p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;






            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“贴花”                                                  




        IF @projGUID IN ( '3d82ace4-ad3b-e711-80ba-e61f13c57837', 'a928b7e9-b63b-e711-80ba-e61f13c57837',
                          'bad6bbac-643b-e711-80ba-e61f13c57837', '8420dfcc-1f60-e511-891a-e41f13c5183a',
                          'BAD6BBAC-643B-E711-80BA-E61F13C57837', 'ecca4882-7355-e711-80ba-e61f13c57837',
                          '5F2279D2-FC3A-E711-80BA-E61F13C57837', 'fc424e07-0355-e511-891a-e41f13c5183a',
                          'BDBA7645-9554-E711-80BA-E61F13C57837', 'F30A3486-A230-E711-80BA-E61F13C57837',
                          'bc7171c0-95b1-e311-9927-e41f13c5183a', '69925C6F-9854-E711-80BA-E61F13C57837',
                          '941A35CC-9754-E711-80BA-E61F13C57837', '4dbfa09a-783b-e711-80ba-e61f13c57837',
                          '343c79b0-a56f-e811-80bf-e61f13c57837', '266b44aa-b13b-e711-80ba-e61f13c57837',
                          'b4a567fe-a56f-e811-80bf-e61f13c57837'
                        ) --国宾学府               


        BEGIN
            SET @decDsFee = @intCstCount * 5;


        END;


    END;
    --印花税计算结束；                   

    --4.1、业主预存IC卡电费                                                   
    --   计算公式：成都大都汇-3号地                                                  
    --                                        
    --                       
    IF @chvItemName = '业主预存IC卡电费'
    BEGIN
        --取价格                                         
        SET @decTmp = 0;

        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID,
                   @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room
                 LEFT JOIN p_BuildProductType ON p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算“业主预存IC卡电费”                                                  
        IF @projGUID IN ( 'dd0d0ad1-a354-e711-80ba-e61f13c57837' ) --成都保利大都汇 3号地
        BEGIN
            IF @cplx = '商业'
                SET @decDsFee = 200;
            IF @cplx = '住宅'
                SET @decDsFee = 51;
        END;


    END;
    --4.2、预存电费                                                   
    --   计算公式：保利天悦-一期                                                 
    --                                        
    --                       
    IF @chvItemName = '预存电费'
    BEGIN
        --取价格                                         
        SET @decTmp = 0;

        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID,
                   @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room
                 LEFT JOIN p_BuildProductType ON p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算“预存电费”                                                  
        IF @projGUID IN ( 'A7423BE5-9D54-E711-80BA-E61F13C57837' ) --保利天悦-一期
        BEGIN
            SET @decDsFee = 51;
        END;


    END;

    --业主预存IC卡电费；               

    --3:产权登记费                                                  
    --   计算公式：如是商业住宅（商铺、车位、写字楼）550，如不是则个人50，单位80,每多1个人名，多收10块工本费。                                                  
    IF @chvItemName = '产权登记'
    BEGIN
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;


            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算                                                  

        IF @projGUID NOT IN ( 'e8be3142-7455-e711-80ba-e61f13c57837', 'adf5625e-9e54-e711-80ba-e61f13c57837',
                              '11016e52-9e54-e711-80ba-e61f13c57837', 'dd0d0ad1-a354-e711-80ba-e61f13c57837'
                            ) --湖心岛美湖苑丽湖苑                               
        BEGIN
            IF (@cplx = '住宅' OR @cplx = '高级住宅')
                SET @decDsFee = 80;
            ELSE
                SET @decDsFee = 550;
        END;


        ----两河院子 商铺、1-12联排为550，车位 13-22联排 80
        IF @projGUID IN ( 'e8be3142-7455-e711-80ba-e61f13c57837' )
        BEGIN
            IF @cplx = '商业'
               OR @bldguid IN ( '762CF8A8-91E6-404A-B97E-E714DC066548', '0F86CA63-77DC-4F57-B95E-734159F2A72B',
                                '537CE743-6A8F-4E68-84C9-25811F608DA7', '773ACFB5-B1EF-4CD8-BEA6-326E6DE04E3A',
                                'DA3FE91A-D5E0-4769-BAC3-6871F0E8FC17', 'C6A48C2D-2051-4451-BDE1-2EAF27AD3C8A',
                                'FCD2DBDA-F139-4BBB-8164-6F298E5099AB', 'E2C6975E-01BF-41C0-943B-81FAB50F2BD1',
                                '4C828C18-A76C-48AB-B786-232438D1D2F7', 'E2304E56-BE66-4C34-A9D6-C5E3A23E7D41',
                                'E8731305-19A7-4E1E-B9D7-AB0A16392039', '1DF119C9-6467-4D50-AFC4-2949FD49E5FA'
                              )
                SET @decDsFee = 550;
            IF @cplx = '地下室/车库'
               OR @bldguid IN ( '14A26B95-F489-4023-9390-73AA217AE8BB', 'ACA278DF-4AAE-45FE-8A1B-F65162758601',
                                'AC8E2BB5-9D72-46A9-951E-7106E693A844', '3E28745B-41EC-490E-A9DD-93C679BC49D7',
                                '5F410B35-153F-4D25-BC33-6469D6D86D4F', 'D2F89A8F-6EB2-4E6C-ABAD-78324DBAA040',
                                'FE925D01-C67B-4178-AA1D-19C85C484F1D', '7C82B0AD-6129-4FC4-96D7-AB9A2CD870E2',
                                'D19A5939-31F6-4C78-927C-47E9B426DA4A', '490A23A8-B5D2-4E7F-B72C-E3E6562CF6A0'
                              )
                SET @decDsFee = 80;
        END;
        IF @projGUID IN ( 'adf5625e-9e54-e711-80ba-e61f13c57837', '11016e52-9e54-e711-80ba-e61f13c57837',
                          'dd0d0ad1-a354-e711-80ba-e61f13c57837'
                        )
        BEGIN
            IF @cplx IN ( '住宅', '车位' )
            BEGIN
                SET @decDsFee = 80;
            END;
            IF @cplx = '商业'
            BEGIN
                SET @decDsFee = 550;
            END;
        END;

        PRINT @decDsFee;
        RETURN 5;
    END;
    --产权登记费计算结束                                                    





    ---共有产权证工本费                  






    --3:共有产权证工本费                                                    
    --   计算公式：这里有个共有人工本费，计算规则是 ：（人数-1）*10          


    IF @chvItemName = '共有产权证工本费'
    BEGIN
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;






            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算                                                  

        IF @projGUID IN (   'a928b7e9-b63b-e711-80ba-e61f13c57837', '3d82ace4-ad3b-e711-80ba-e61f13c57837',
                            'bad6bbac-643b-e711-80ba-e61f13c57837', '5f2279d2-fc3a-e711-80ba-e61f13c57837',
                            '7257ec1c-7455-e711-80ba-e61f13c57837', 'C63C57A8-9954-E711-80BA-E61F13C57837',
                            'FD3EB686-A154-E711-80BA-E61F13C57837', '070AAA7A-A154-E711-80BA-E61F13C57837',
                            '156BC8A4-A154-E711-80BA-E61F13C57837', '103AC15C-A154-E711-80BA-E61F13C57837',
                            '31A6BEB8-9E54-E711-80BA-E61F13C57837', '3160B868-A154-E711-80BA-E61F13C57837',
                            '9CE9A7AC-9E54-E711-80BA-E61F13C57837', '4F39A54A-A154-E711-80BA-E61F13C57837',
                            '8420dfcc-1f60-e511-891a-e41f13c5183a', 'BAD6BBAC-643B-E711-80BA-E61F13C57837',
                            'ecca4882-7355-e711-80ba-e61f13c57837', '5F2279D2-FC3A-E711-80BA-E61F13C57837',
                            'fc424e07-0355-e511-891a-e41f13c5183a', '706B1E84-403C-E711-80BA-E61F13C57837',
                            'F30A3486-A230-E711-80BA-E61F13C57837', '941A35CC-9754-E711-80BA-E61F13C57837',
                            '18270F42-9954-E711-80BA-E61F13C57837', 'C63C57A8-9954-E711-80BA-E61F13C57837',
                            '9da9602b-5e82-41e3-b1b8-a5734d290e4f', '4dbfa09a-783b-e711-80ba-e61f13c57837',
                            '343c79b0-a56f-e811-80bf-e61f13c57837', '266b44aa-b13b-e711-80ba-e61f13c57837',
                            'b4a567fe-a56f-e811-80bf-e61f13c57837', 'e8be3142-7455-e711-80ba-e61f13c57837', --学府国宾
                            'a063ae16-6361-e711-80ba-e61f13c57837',                                         --天府南院
                            'b9ee1443-31af-e711-80ba-e61f13c57837',                                         --保利仁里
                            '7917b771-6761-e711-80ba-e61f13c57837',                                         --天府林语 
                            'dd0d0ad1-a354-e711-80ba-e61f13c57837', '02B2F68B-F27B-E711-80BA-E61F13C57837', --成都保利天玺-一期
                            'FD4A89CA-8F82-49AC-A9F8-F16EACC17003', '6d25234a-99bd-e911-80b7-0a94ef7517dd',
							'ab13aa2b-d753-eb11-b398-f40270d39969','dd2358e5-edea-4dd5-8b1e-d3c2b0585912','9f2d70c7-4125-4b8b-8865-9fe87c3b6d9d',
'6b9653a5-a819-4b9a-9534-84b2dddfd999','b3e771ab-bb41-46b1-bebe-06a5f7235d79','cf9d1b83-8b7c-43d3-9104-9d76f86a23ac','2ca316e2-34b5-4493-94d8-4560daf969ae',--保利北新时区花园
'd5f72433-44b2-ec11-b39c-f40270d39969'--增加怡心和颂花园

                        )
        BEGIN

            SET @decDsFee = (@intCstCount - 1) * 10;
            PRINT @decDsFee;
        END;

        RETURN 5;
    END;
    --产权登记费计算结束                                                    








    --5、商品房转让手续费                                                  
    --   计算公式：成交总价（含补差）* 0.0035                                            
    --保利公园198-海棠花语 =补差后总房款*0.9%   （保留1位小数）                                       
    --江语城 非住宅补差后总房款×0.4%（保留整数） 变更为：非住宅补差后总房款×0.25%（保留整数）2015-10-23                                              
    --   单位购买：按楼价的3%                                                  
    IF @chvItemName = '商品房转让手续费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID,
                   @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room
                 LEFT JOIN p_BuildProductType ON p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID,
                   @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room
                 LEFT JOIN p_BuildProductType ON p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;

        --开始计算“商品房转让手续费”                                                  

        IF (@projGUID IN ( '0c270e64-e6cd-45b7-8607-b8aefb0b36e4', '94f0c07e-d7ab-4f47-ac35-fe4a1bc6a79f',
                           'EC7DAC64-87B6-E811-80BF-E61F13C57837', '7B5276E1-9854-E711-80BA-E61F13C57837',
                           '941A35CC-9754-E711-80BA-E61F13C57837', '4d7ff7e2-3a9d-4827-839d-ee93d6ccbabc',
                           '69925C6F-9854-E711-80BA-E61F13C57837', '67215ACD-86B6-E811-80BF-E61F13C57837',
                           'D3E33F74-9654-E711-80BA-E61F13C57837', '68a74701-cd5a-45b6-bebf-20b36302a380'
                         )
           )
        BEGIN
            SET @decDsFee = @decTmp * 0.0035;
        END;
        --保利城一商品房转让手续费=补差后总房款*0.9%                                                  
        IF (@projGUID IN ( '1F775F9F-9854-E711-80BA-E61F13C57837' ))
        BEGIN
            SET @decDsFee = @decTmp * 0.009;
        END;
        --保利公园198-海棠花语 =补差后总房款*0.9%   （保留1位小数）                                         
        IF (@projGUID IN ( '2B009405-9454-E711-80BA-E61F13C57837' ))
        BEGIN
            IF @cplx = '住宅'
            BEGIN
                SET @decDsFee = @decTmp * 0.009;
            END;
            IF @cplx <> '住宅'
            BEGIN
                SET @decDsFee = @decTmp * 0.004;
            END;

        END;
        IF (@projGUID IN ( '0D2A4099-9A54-E711-80BA-E61F13C57837', 'AAD45BA5-9854-E711-80BA-E61F13C57837',
                           '10CC6AF3-9354-E711-80BA-E61F13C57837', '8AC375C3-9A54-E711-80BA-E61F13C57837',
                           'FFF4FDEB-AAA9-E811-80BF-E61F13C57837'
                         )
           )
        BEGIN
            SET @decDsFee = @decTmp * 0.004;
        END;

        IF (@projGUID IN ( '0dbdb378-aee4-4efa-9385-fcca8fafb06c', '8C8EF453-C23B-E711-80BA-E61F13C57837',
                           '2a1d63b0-158f-e811-80bf-e61f13c57837', '82C2946D-7455-E711-80BA-E61F13C57837'
                         )
           )
        BEGIN
            SET @decDsFee = @decTmp * 0.0025;
            IF @decDsFee >= 7500
            BEGIN
                SET @decDsFee = 7500;
            END;
            IF @decDsFee < 7500
            BEGIN
                SET @decDsFee = @decTmp * 0.0025;
            END;
        END;

        IF @projGUID IN ( '092a7e55-e416-4e1f-bf4d-1508998b5e43', '32e31338-b9d1-457f-a8d8-f20be37533bd' )
           AND @cplx <> '住宅'
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.0035 AS DECIMAL(18, 1));
        END;

        IF @projGUID = ('6a8dbaf6-adfa-e411-891a-e41f13c5183a')
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.0025 AS DECIMAL(18, 1));
        END;
        IF @projGUID IN ( '986E2457-9A54-E711-80BA-E61F13C57837', '30066FB7-9854-E711-80BA-E61F13C57837' )
           AND @cplx <> '住宅'
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.004 AS DECIMAL(18, 1));
        END;
        IF @projGUID IN ( '8BA26B4E-9B54-E711-80BA-E61F13C57837', 'a24e5342-9b54-e711-80ba-e61f13c57837',
                          '9da9602b-5e82-41e3-b1b8-a5734d290e4f', '13099473-d03a-e711-80ba-e61f13c57837',
                          '67413510-a8d9-42b7-91aa-65d5b738aee0'
                        )
           AND @cplx <> '住宅'
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.0025 AS DECIMAL(18, 2));
        END;
        IF @projGUID IN ( '513268DE-9454-E711-80BA-E61F13C57837', '1C2A6DF0-9454-E711-80BA-E61F13C57837',
                          '3FD98C23-9454-E711-80BA-E61F13C57837', 'aada9668-9d5f-4426-8080-3195a908298d'
                        )
           AND @cplx <> '住宅' --保利公园198-拉斐公馆                                  

        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.0025 AS DECIMAL(18, 2));
        END;
        IF @projGUID IN ( 'bc7171c0-95b1-e311-9927-e41f13c5183a' )
           AND @cplx = '住宅' --保利linyuxi                                
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.002 AS DECIMAL(18, 2));
        END;
        IF (
               @projGUID IN ( 'bc7171c0-95b1-e311-9927-e41f13c5183a' )
               AND @cplx <> '住宅'
           )
           OR (@projGUID IN ( '5F2279D2-FC3A-E711-80BA-E61F13C57837' )) --保利linyuxi                                
        BEGIN
            SET @decDsFee = CAST(@decTmp * 0.0025 AS DECIMAL(18, 2));
            IF @decDsFee >= 7500
            BEGIN
                SET @decDsFee = 7500;
            END;

            IF @decDsFee < 7500
            BEGIN
                SET @decDsFee = CAST(@decTmp * 0.0025 AS DECIMAL(18, 2));
            END; --加学府国宾
            IF @projGUID IN ( '4dbfa09a-783b-e711-80ba-e61f13c57837', '343c79b0-a56f-e811-80bf-e61f13c57837',
                              '266b44aa-b13b-e711-80ba-e61f13c57837', 'b4a567fe-a56f-e811-80bf-e61f13c57837'
                            )
               AND @cplx <> '住宅'
            BEGIN
                SET @decDsFee = CAST(@decTmp * 0.0025 AS DECIMAL(18, 1));
            END;
        END;

    END;
--商品房转让手续费计算结束；                                    



END;



--成都代收费用结束                      

--重庆公司代收费用计算                                                  
--代收SQL开始                                                  

IF (@buguid = 'A7AA464A-9D27-4319-9C74-53EBACDF9F11')
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：个人购买的：住宅：建筑面积在144M2以下的，按楼价的1%，建筑面积在144m2以上，按楼价的1.5%，                                                  
    --   单位购买：按楼价的3%                                                  
    IF @chvItemName = '契税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“契税”                                                  
        IF (@chvProjName = '保利林语溪')
        BEGIN
            IF ((@cplx = '高级住宅' OR @cplx = '住宅') AND @ge = '个人')
            BEGIN
                IF @mjtmp > 144
                BEGIN
                    SET @decDsFee = CEILING(@decTmp / 1.05 * 0.03);
                END;
                IF @mjtmp <= 144
                   AND @mjtmp > 90
                BEGIN
                    SET @decDsFee = CEILING(@decTmp / 1.05 * 0.015);
                END;
                IF @mjtmp <= 90
                BEGIN
                    SET @decDsFee = CEILING(@decTmp / 1.05 * 0.01);
                END;
            END;

            IF (
                   @ge = '公司'
                   OR
                   (
                       @cplx = '公寓'
                       OR @cplx = '商业'
                       OR @cplx = '写字楼'
                       OR @cplx = '车位'
                   )
               )
            BEGIN
                SET @decDsFee = CEILING(@decTmp / 1.05 * 0.03);
            END;

        END;

        IF (@chvProjName <> '保利林语溪')
           AND
           (
               @chvProjName LIKE '%观塘%'
               OR @chvProjName LIKE '%爱尚里-二期A%'
               OR @chvProjName LIKE '%观澜-三期%'
               OR @chvProjName LIKE '%观澜-四期%'
               OR @chvProjName IN ( '保利堂悦（A区）-一期洋楼', '保利堂悦（A区）-一期洋墅' )
           )
        BEGIN
            IF ((@cplx = '高级住宅' OR @cplx = '住宅') AND @ge = '个人')
            BEGIN
                --if  @mjtmp > 144                                                  
                --          begin                                                   
                --     Set @decDsFee = ceiling(@decTmp/1.11 * 0.03);                                                  
                --          end                                          
                IF @mjtmp > 90
                BEGIN
                    SET @decDsFee = CEILING(@decTmp * 0.015);
                END;
                IF @mjtmp <= 90
                BEGIN
                    SET @decDsFee = CEILING(@decTmp * 0.01);
                END;
            END;

            IF (
                   @ge = '公司'
                   OR
                   (
                       @cplx = '公寓'
                       OR @cplx = '商业'
                       OR @cplx = '写字楼'
                       OR @cplx = '车位'
                   )
               )
            BEGIN
                SET @decDsFee = CEILING(@decTmp / 1.09 * 0.03);
            END;

            RETURN 1;
        END;

        IF (@chvProjName <> '保利林语溪')
           AND (@chvProjName NOT IN ( '保利观塘', '保利爱尚里-二期A区''保利观澜-三期', '保利观塘-二期A', '保利观澜-四期', '保利观塘-一期A', '保利观塘-一期B',
                                      '保利观塘-一期C'
                                    )
               )
        BEGIN
            IF ((@cplx = '高级住宅' OR @cplx = '住宅') AND @ge = '个人')
            BEGIN
                IF @mjtmp > 144
                BEGIN
                    SET @decDsFee = CEILING(@decTmp / 1.09 * 0.03);
                END;
                IF @mjtmp > 90
                BEGIN
                    SET @decDsFee = CEILING(@decTmp / 1.05 * 0.015);
                END;
                IF @mjtmp <= 90
                BEGIN
                    SET @decDsFee = CEILING(@decTmp / 1.09 * 0.01);
                END;
            END;

            IF (
                   @ge = '公司'
                   OR
                   (
                       @cplx = '公寓'
                       OR @cplx = '商业'
                       OR @cplx = '写字楼'
                       OR @cplx = '车位'
                   )
               )
            BEGIN
                SET @decDsFee = CEILING(@decTmp / 1.09 * 0.03);
            END;

            RETURN 1;
        END;
    END;
END;
--契税计算结束； 

--2、契税B                                                                                                 
-- 按不含税楼价的3% 

IF @chvItemName = '契税B'
BEGIN
    --取价格                                                  
    SET @decTmp = 0;
    --取面积                                                  
    SET @mjtmp = 0;
    --取出是个人购买还是公司购买                                                  
    SET @ge = NULL;


    IF @chvSource = '定单'
    BEGIN
        --来源为“定单”通过交易表获取                                                  
        SELECT @decTmp = ISNULL(RmbCjTotal, 0)
        FROM s_Order
        WHERE OrderGUID = @chvSaleGUID;
        SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
        FROM s_Order
        WHERE OrderGUID = @chvSaleGUID;
        SELECT @chvRoomGUID = RoomGUID
        FROM s_Order
        WHERE OrderGUID = @chvSaleGUID;

        SELECT @cplx = p_BuildProductType.BProductTypeName
        FROM p_room,
             p_BuildProductType
        WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
              AND p_room.RoomGUID = @chvRoomGUID;

        IF CHARINDEX('住宅', @cplx) > 0
        BEGIN
            SET @cplx = '住宅';
        END;
        IF CHARINDEX('高级住宅', @cplx) > 0
        BEGIN
            SET @cplx = '高级住宅';
        END;
        IF CHARINDEX('商业', @cplx) > 0
        BEGIN
            SET @cplx = '商业';
        END;
        IF CHARINDEX('写字楼', @cplx) > 0
        BEGIN
            SET @cplx = '写字楼';
        END;
        IF CHARINDEX('公寓', @cplx) > 0
        BEGIN
            SET @cplx = '公寓';
        END;


        SELECT @ge = RTRIM(p_Customer.CstType)
        FROM s_Order,
             s_trade2cst,
             p_Customer
        WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
              AND p_Customer.CstGUID = s_trade2cst.CstGUID
              AND s_Order.OrderGUID = @chvSaleGUID;
        IF @ge <> '公司'
        BEGIN
            SET @ge = '个人';
        END;

    END;

    IF @chvSource = '合同'
    --来源为“合同”通过交易表获取                                                  
    BEGIN
        SELECT @decTmp = ISNULL(RmbHtTotal, 0)
        FROM s_Contract
        WHERE ContractGUID = @chvSaleGUID;
        SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
        FROM s_Contract
        WHERE ContractGUID = @chvSaleGUID;
        SELECT @chvRoomGUID = RoomGUID
        FROM s_Contract
        WHERE ContractGUID = @chvSaleGUID;
        SELECT @cplx = p_BuildProductType.BProductTypeName
        FROM p_room,
             p_BuildProductType
        WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
              AND p_room.RoomGUID = @chvRoomGUID;

        IF CHARINDEX('住宅', @cplx) > 0
        BEGIN
            SET @cplx = '住宅';
        END;
        IF CHARINDEX('高级住宅', @cplx) > 0
        BEGIN
            SET @cplx = '高级住宅';
        END;
        IF CHARINDEX('商业', @cplx) > 0
        BEGIN
            SET @cplx = '商业';
        END;
        IF CHARINDEX('写字楼', @cplx) > 0
        BEGIN
            SET @cplx = '写字楼';
        END;
        IF CHARINDEX('公寓', @cplx) > 0
        BEGIN
            SET @cplx = '公寓';
        END;


        SELECT @ge = RTRIM(p_Customer.CstType)
        FROM s_Contract,
             s_trade2cst,
             p_Customer
        WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
              AND p_Customer.CstGUID = s_trade2cst.CstGUID
              AND s_Contract.ContractGUID = @chvSaleGUID;













        IF @ge <> '公司'
        BEGIN
            SELECT @ge = '个人';
        END;
    END;

    --开始计算“契税”                                                  
    IF (
           @chvProjName LIKE '%保利林语溪%'
           OR @chvProjName LIKE '%高尔夫%'
           OR @chvProjName LIKE '%香槟花园%'
           OR @chvProjName LIKE '%康桥%'
           OR @chvProjName LIKE '%椰风半岛%'
           OR @chvProjName LIKE '%港湾%'
           OR @chvProjName LIKE '%心语%'
           OR @chvProjName LIKE '%可爱岛%'
           OR @chvProjName LIKE '%香雪%'
           OR @chvProjName LIKE '%江上明珠%'
           OR @chvProjName LIKE '%花半里%'
           OR @chvProjName LIKE '%观澜-一期%'
           OR @chvProjName LIKE '%茵梦湖-一期%'
           OR @chvProjName LIKE '%壹号公馆%'
           OR @chvProjName LIKE '%国宾上院%'
           OR @chvProjName LIKE '%爱尚里-一期A%'
           OR @chvProjName LIKE '%爱尚里-一期B%'
       )
    --    begin                   
    --       if ((@cplx = '高级住宅' or @cplx = '住宅' ) and @ge='个人' )                                                  
    --    begin                                                  
    --  if  @mjtmp > 144                                                  
    --            begin                                                   
    --        Set @decDsFee = ceiling(@decTmp/1.05 * 0.03);                                            
    --            end                                                   
    --     if @mjtmp <= 144 and @mjtmp > 90                                                   
    --            begin                                                  
    --             Set @decDsFee = ceiling(@decTmp/1.05 * 0.015);                         
    --           end                                                  
    --    if  @mjtmp <= 90                                                   
    --            begin                                                  
    -- Set @decDsFee = ceiling(@decTmp/1.05 * 0.01);                                                  
    --           end                                     end                                                      
    --                                                        
    --   if (@ge='公司' or (@Cplx='公寓' or @cplx = '商业' or @cplx = '写字楼' or @cplx = '车位'))                                                  
    BEGIN
        SET @decDsFee = CEILING(@decTmp / 1.05 * 0.03);
    END;



    IF (
           @chvProjName LIKE '%天汇%'
           OR @chvProjName LIKE '%观塘%'
           OR @chvProjName LIKE '%爱尚里-二期A%'
           OR @chvProjName LIKE '%爱尚里-二期B%'
           OR @chvProjName LIKE '%爱尚里-二期C%'
           OR @chvProjName LIKE '%爱尚里-三期%'
           OR @chvProjName LIKE '%云禧%'
           OR @chvProjName LIKE '%堂悦%'
           OR @chvProjName LIKE '%大国璟%'
           OR @chvProjName LIKE '%雲璟%'
           OR @chvProjName LIKE '%金香槟%'
           OR @chvProjName LIKE '%天悦%'
           OR @chvProjName LIKE '%和光尘樾%'
           OR @chvProjName LIKE '%阅江台%'
           OR @chvProjName LIKE '%拾光年%'
           OR @chvProjName LIKE '%华侨城%'
           OR @chvProjName LIKE '%慈母山%'
           OR @chvProjName LIKE '%茵梦湖%'
           OR @chvProjName LIKE '%江上明珠-D5-2%'
           OR @chvProjName LIKE '%江上明珠-C%'
           OR @chvProjName LIKE '%江上明珠-E%'
           OR @chvProjName LIKE '%观澜-三期%'
           OR @chvProjName LIKE '%天珺%'
           OR @chvProjName LIKE '%观澜-四期%'
           OR @chvProjName LIKE '%观澜-二期%'
       )
       OR @chvProjName LIKE '%保利时光小区%'
    BEGIN
        SET @decDsFee = CEILING(@decTmp / 1.09 * 0.03);
    END;


END;


--契税B进位计算结束                                         


--林语溪项目契税进位计算                                          
--if(@buguid='A7AA464A-9D27-4319-9C74-53EBACDF9F11' and @chvProjName = '保利林语溪')                                          
--begin                                           
--If @chvItemName='契税'                                                  
--     Begin                                                  
--  --取价格                                                  
--  Set @decTmp = 0;                                                  
--         --取面积                                           
--   set @mjtmp=0;                              
--         --取出是个人购买还是公司购买                                                  
--     set @ge=null;                                                  


--   If @chvSource = '定单'                                                  
--          begin                                                  
--  --来源为“定单”通过交易表获取                                                  
--  select @decTmp=isnull(RmbCjTotal,0) from s_Order where OrderGUID = @chvSaleGUID;                                                  
--  Select @mjtmp=cast(bldarea as decimal(19,4))  From s_Order where OrderGUID = @chvSaleGUID;                                                  
--         select @chvRoomGUID =roomguid From s_Order where OrderGUID = @chvSaleGUID;                                                  

--  Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID                                                          

--  if charindex('住宅',@cplx) >0                                                   
--   begin                                                  
--    set @Cplx='住宅'                                                  
--   end                                                 
--  if charindex('高级住宅',@cplx) >0               
--   begin                                                   
--    SET @Cplx='高级住宅'                                                    
--   end                        
--  if charindex('商业',@cplx) >0                                                   
--   begin                                                    
--    SET @Cplx='商业'                                                    
--   end                                                
--  if charindex('写字楼',@cplx) >0                                 
--   begin                                                  
--    SET @Cplx='写字楼'                                                    
--   end                                                  
--  if charindex('公寓',@cplx) >0                                                     
--   begin                                                  
--    SET @Cplx='公寓'                                                    
--   end                        


--                select @ge=rtrim(P_customer.csttype) from s_Order,s_Trade2Cst,p_Customer where s_Order.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_Order.OrderGUID = @chvSaleGUID;                                    








--                       if @ge<>'公司'                                                  
--                 begin                                                  
--                   set @ge='个人';                                                  
--                 end                                                   

--   end                                     

--   If @chvSource = '合同'                                                  
--    --来源为“合同”通过交易表获取                                        
--    begin                                                  
--  select @decTmp=isnull(RmbHtTotal,0) from s_Contract where ContractGUID = @chvSaleGUID;                                                  
--  Select @mjtmp=cast(bldarea as decimal(19,4))  From s_Contract where ContractGUID = @chvSaleGUID;                                                  
--  select @chvRoomGUID =roomguid From s_Contract where ContractGUID = @chvSaleGUID;                                                    
--  Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID                                    

--  if charindex('住宅',@cplx) >0                                            
--   begin                                                  
--    set @Cplx='住宅'                                                  
--   end                                                  
--  if charindex('高级住宅',@cplx) >0           
--   begin                                                   
--    SET @Cplx='高级住宅'                                                    
--   end                                                  
--  if charindex('商业',@cplx) >0               
--   begin                                                    
--    SET @Cplx='商业'                             
--   end                                                  
--  if charindex('写字楼',@cplx) >0                                                     
--   begin                                                  
--    SET @Cplx='写字楼'                                                    
--   end                                                  
--  if charindex('公寓',@cplx) >0                                                     
--   begin                                                  
--    SET @Cplx='公寓'                                                    
--   end                                                   


--            select @ge=rtrim(P_customer.csttype) from s_contract,s_Trade2Cst,p_Customer where s_contract.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_contract.ContractGUID = @chvSaleGUID;                             












--                       if @ge<>'公司'                                                  
--                 begin                                                  
--                   select @ge='个人';                                                  
--                 end                                                  
-- end                                                  

--     --开始计算“契税”                                                  


--    if ((@cplx = '高级住宅' or @cplx = '住宅' ) and @ge='个人' )                                                  
--    begin                                                  
--   if  @mjtmp > 144                                                  
--             begin                                                   
--        Set @decDsFee = CEILING(@decTmp * 0.03);                                                
--             end                                                   
--      if @mjtmp <= 144 and @mjtmp > 90                                                   
--             begin                                                  
--               Set @decDsFee = CEILING(@decTmp * 0.015);                         
--         end                                                  
--      if  @mjtmp <= 90                                                   
--             begin                                                  
--  Set @decDsFee = CEILING(@decTmp * 0.01);                                                  
--             end                                                  
--     end                                                      

--      if (@ge='公司' or (@Cplx='公寓' or @cplx = '商业' or @cplx = '写字楼' or @cplx = '车位'))                                                  
--        begin                                                  
--          Set @decDsFee = CEILING(@decTmp * 0.03);                                                  
--        end                                                  

--    return 1                                                  

-- end         
--end                                                  
--林语溪契税计算结束                                          


IF (@buguid = 'A7AA464A-9D27-4319-9C74-53EBACDF9F11')
BEGIN

    --大修基金计算开始；                                                  

    ----大修基金                                                  
    --   --计算公式：非车位非电梯大修基金=建筑面积*50 车位大修基金=建筑面积*50                                                  


    IF @chvItemName = '非电梯大修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            IF CHARINDEX('车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
            IF CHARINDEX('学校', @cplx) > 0
            BEGIN
                SET @cplx = '学校';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
            IF CHARINDEX('车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
            IF CHARINDEX('学校', @cplx) > 0
            BEGIN
                SET @cplx = '学校';
            END;
        END;

        --开始计算“非电梯大修基金”                                                  
        IF @projGUID NOT IN ( '5D07800C-7DBE-41AE-9DCF-645F7FE7E9F2','F6617612-ED56-E711-80BA-E61F13C57837','070A9D3C-ED56-E711-80BA-E61F13C57837','BF7DA260-ED56-E711-80BA-E61F13C57837','B5F28F7E-ED56-E711-80BA-E61F13C57837','8FAE9681-6F60-E711-80BA-E61F13C57837' )
        BEGIN
            IF (@cplx = '车位')
            BEGIN
                SET @decDsFee = @mjtmp * 80;
            END;

            IF (
                   @cplx = '学校'
                   OR @cplx = '公寓'
                   OR @cplx = '高级住宅'
                   OR @cplx = '商业'
                   OR @cplx = '写字楼'
                   OR @cplx = '住宅'
               )
            BEGIN
                SET @decDsFee = @mjtmp * 50;
            END;
        END;

        ---626chenfen
        IF @projGUID IN ('5D07800C-7DBE-41AE-9DCF-645F7FE7E9F2','F6617612-ED56-E711-80BA-E61F13C57837','070A9D3C-ED56-E711-80BA-E61F13C57837','BF7DA260-ED56-E711-80BA-E61F13C57837','B5F28F7E-ED56-E711-80BA-E61F13C57837','8FAE9681-6F60-E711-80BA-E61F13C57837', '8a944afe-b8b5-4514-9f10-c7eebb7afc8c'
                        )
        BEGIN
            IF (@cplx = '车位')
            BEGIN
                SET @decDsFee = @mjtmp * 50;
            END;

            IF (
                   @cplx = '学校'
                   OR @cplx = '公寓'
                   OR @cplx = '高级住宅'
                   OR @cplx = '商业'
                   OR @cplx = '写字楼'
                   OR @cplx = '住宅'
               )
            BEGIN
                SET @decDsFee = @mjtmp * 50;
            END;

            IF @projGUID IN ('964be853-144f-eb11-b398-f40270d39969', '3b3c4c23-5917-43d6-af4f-a3368e33a0a1'
							  
                            )
            BEGIN
                SET @decDsFee = @mjtmp * 50;
            END;


		---1102 by chenfen	
            IF @projGUID IN ( 
							  '55ce17a8-4284-e911-80b7-0a94ef7517dd','10c31b17-0db3-e711-80ba-e61f13c57837',
							  'f93f5607-f20c-4057-8905-1303f1e892cf','ba9e0f73-fc99-e711-80ba-e61f13c57837',
							  '1960a688-9ddd-e911-80b7-0a94ef7517dd','d8b39e66-144f-eb11-b398-f40270d39969',
							  '0756cf0e-c62f-eb11-b398-f40270d39969','adcb4fd7-1f75-e811-80bf-e61f13c57837',
							  'fb7ba54e-8e9e-4313-97a6-df638dc1b357'
                            )
            BEGIN
                SET @decDsFee = ROUND((@mjtmp * 50), 1);
            END;



        END;
        PRINT '重庆公司非电梯大修基金';
        PRINT @decDsFee;
        RETURN 1;
    END;

    --大修基金计算开始；                                                  

    ----大修基金                                                  
    --   --计算公式：80*建筑面积                                                 


    IF @chvItemName = '大修基金'
    BEGIN
        --取价格                                                Set @decTmp = 0;      
        --取面积                                                  
        SET @mjtmp = 0;
		 


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
			 @scmj = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;



        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
			      @scmj = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
            IF CHARINDEX('车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
        END;

        --开始计算“大修基金”                                                  


        BEGIN
            SET @decDsFee = @mjtmp * 80;
        END;

 IF @projGUID IN ('5d07800c-7dbe-41ae-9dcf-645f7fe7e9f2','b5f28f7e-ed56-e711-80ba-e61f13c57837','bf7da260-ed56-e711-80ba-e61f13c57837')
            BEGIN
                SET @decDsFee = @scmj * 50;
            END;



        RETURN 1;
    END;

--大维修基金  香槟花园（旧）                                              

END;

IF (@buguid = 'A7AA464A-9D27-4319-9C74-53EBACDF9F11'

   -- and @chvProjName <> '香槟花园（旧）'                  

   )
BEGIN

    --大修基金计算开始；                                                  

    ----大修基金                                                  
    --   --计算公式：非车位电梯大修基金=建筑面积*80 车位大修基金=建筑面积*50                                                  


    IF @chvItemName = '电梯大修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            IF CHARINDEX('车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;

            IF CHARINDEX('会所', @cplx) > 0
            BEGIN
                SET @cplx = '会所';
            END;
            IF CHARINDEX('酒店', @cplx) > 0
            BEGIN
                SET @cplx = '酒店';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
            IF CHARINDEX('车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
            IF CHARINDEX('酒店', @cplx) > 0
            BEGIN
                SET @cplx = '酒店';
            END;
        END;

        --开始计算“电梯大修基金”                                                  

        IF (@cplx = '车位')
        BEGIN
            SET @decDsFee = @mjtmp * 80;
        END;

        IF (
               @cplx = '公寓'
               OR @cplx = '高级住宅'
               OR @cplx = '商业'
               OR @cplx = '写字楼'
               OR @cplx = '住宅'
               OR @cplx = '酒店'
               OR @cplx = '酒店'
           )
        BEGIN
            SET @decDsFee = @mjtmp * 80;
            PRINT @decDsFee;
        END;


        RETURN 1;
    END;
END;
--大修基金计算结束   



-- 物业专项维修资金80
--计算公式  建面*80
IF (@buguid = 'A7AA464A-9D27-4319-9C74-53EBACDF9F11')
BEGIN

    --物业专项维修资金80计算开始；                                                  

    IF @chvItemName = '物业专项维修资金80'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            IF CHARINDEX('车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;

            IF CHARINDEX('会所', @cplx) > 0
            BEGIN
                SET @cplx = '会所';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
            IF CHARINDEX('车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
        END;

        --开始计算“物业专项维修资金80”                                                  

        IF (@cplx = '车位')
        BEGIN
            SET @decDsFee = CEILING(@mjtmp * 80);
        END;

        IF (
               @cplx = '公寓'
               OR @cplx = '高级住宅'
               OR @cplx = '商业'
               OR @cplx = '写字楼'
               OR @cplx = '住宅'
               OR @cplx = '会所'
           )
        BEGIN
            SET @decDsFee = CEILING(@mjtmp * 80);
            PRINT @decDsFee;
        END;


        RETURN 1;
    END;
END;
--物业专项维修资金80计算结束   

-- 物业专项维修资金120
--计算公式  建面*120
IF (@buguid = 'A7AA464A-9D27-4319-9C74-53EBACDF9F11')
BEGIN

    --物业专项维修资金120计算开始；                                                  

    IF @chvItemName = '物业专项维修资金120'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            IF CHARINDEX('车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;

            IF CHARINDEX('会所', @cplx) > 0
            BEGIN
                SET @cplx = '会所';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
            IF CHARINDEX('车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
        END;

        --开始计算“物业专项维修资金80”                                                  

        IF (@cplx = '车位')
        BEGIN
            SET @decDsFee = CEILING(@mjtmp * 120);
        END;

        IF (
               @cplx = '公寓'
               OR @cplx = '高级住宅'
               OR @cplx = '商业'
               OR @cplx = '写字楼'
               OR @cplx = '住宅'
               OR @cplx = '会所'
           )
        BEGIN
            SET @decDsFee = CEILING(@mjtmp * 120);
            PRINT @decDsFee;
        END;


        RETURN 1;
    END;
END;
--物业专项维修资金120计算结束  


--重庆公司代收费用计算结束                                        


--广东公司东江首府项目代收费用计算开始                                                                   
IF (
       @chvProjName LIKE '%东江首府%'
       AND @buguid = '512381FE-A9CB-E511-80B8-E41F13C51836'
   )
BEGIN

    --根据不同的代收费用分别进行计算                                 

    --1、契税                                                  
    --   计算公式：个人购买的：住宅：建筑面积在144M2以下的，按楼价的1.5%，建筑面积在144m2以上，按楼价的3%，                                                  
    --   单位购买：按楼价的3%                                                  
    IF @chvItemName = '契税'
    BEGIN --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                   
        SET @ge = NULL;

        IF @chvSource = '模拟付款'
        --来源为“模拟付款”从临时定单表中获取                                                  
        BEGIN

            IF @intPayFormNo = 1
            BEGIN
                SELECT @decTmp = Cjtotal1
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;
            IF @intPayFormNo = 2
            BEGIN
                SELECT @decTmp = Cjtotal2
                FROM s_OrderTmp
                WHERE s_OrderTmp.OrderGUID = @chvSaleGUID;
            END;

            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_OrderTmp
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = '个人';
        END;
        --“模拟付款”结束                                                  

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                      
            SELECT @decTmp = ISNULL(RoomTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RoomTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“契税”                                                  


        IF (
               @cplx = '公寓'
               OR @cplx = '高级住宅'
               OR @cplx = '商业'
               OR @cplx = '写字楼'
               OR @cplx = '车位'
           )
        BEGIN
            SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.03);
        END;
        ELSE IF @cplx = '住宅'
                AND @ge = '个人'
        BEGIN
            IF @mjtmp >= 144
            BEGIN
                SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.03);
            END;
            IF @mjtmp < 144
            BEGIN
                SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.03);
            END;
        END;
        IF @ge = '公司'
        BEGIN
            SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.03);
        END;

        RETURN 1;

    END;
END;
----契税计算结束；                                                  
--广东东江首府代收费用计算完毕                                                  

----北京公司代收费用开始计算  

IF (@buguid = '5054E880-C6D5-488A-92DF-812E52E2712B')
BEGIN
    IF @chvItemName = '公共维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('商铺', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('商铺', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“公共维修基金”  
        --20210323平谷马坊tjb
        IF @projGUID IN ( '6de22326-f4a3-e711-80ba-e61f13c57837', 'd7c4b091-04c6-e711-80ba-e61f13c57837',
                          'fbefd761-3bb5-e711-80ba-e61f13c57837'
                        ) --北京保利东郡、北京大成路项目、平谷马坊
        BEGIN
            SET @decDsFee = @mjtmp * 200;
        END;

        PRINT @decDsFee;
        PRINT 'dongjun';
    END;
END;

--北京保利花园代收SQL开始                                                  
--保利花园                                          
IF (
(
    @chvProjName = '北京保利花园'
    AND @buguid = '5054E880-C6D5-488A-92DF-812E52E2712B'
)
   )
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：2010年10月1日前签订的合同140（含）平方米以下，总房款小于等于120万，按房款的1.5%，总房款大于120万，按房款的3%计算。                                                  
    -- 2010年10月1日后签订的合同全部按房款的3%计算。                                                  
    IF @chvItemName = '契税'
        IF @chvItemName = '契税'
        BEGIN
            --取价格                                                  
            SET @decTmp = 0;
            --取面积                                                  
            SET @mjtmp = 0;
            --取出是个人购买还是公司购买                                       
            SET @ge = NULL;

            IF @chvSource = '定单'
            BEGIN
                --来源为“定单”通过交易表获取                                                  
                SELECT @decTmp = ISNULL(RmbCjTotal, 0)
                FROM s_Order
                WHERE OrderGUID = @chvSaleGUID;
                SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
                FROM s_Order
                WHERE OrderGUID = @chvSaleGUID;
                SELECT @chvRoomGUID = RoomGUID
                FROM s_Order
                WHERE OrderGUID = @chvSaleGUID;
                SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
                FROM p_room
                WHERE RoomGUID = @chvRoomGUID;

            END;
            IF @chvSource = '合同'
            --来源为“合同”通过交易表获取                                                  
            BEGIN
                SELECT @decTmp = ISNULL(RmbHtTotal, 0)
                FROM s_Contract
                WHERE ContractGUID = @chvSaleGUID;
                SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
                FROM s_Contract
                WHERE ContractGUID = @chvSaleGUID;
                SELECT @chvRoomGUID = RoomGUID,
                       @sjbctotal = SjBcTotal
                FROM s_Contract
                WHERE ContractGUID = @chvSaleGUID;
                SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
                FROM p_room
                WHERE RoomGUID = @chvRoomGUID;
            END;

            --开始计算“契税”                                                  


            IF (@qsdate >= '2010-10-01')
            BEGIN
                SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;
            END;
            ELSE
            BEGIN
                IF @decTmp <= 1200000
                BEGIN
                    SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.015;
                END;
                IF @decTmp > 1200000
                BEGIN
                    SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;
                END;
            END;

            RETURN 1;

        END;

    ----契税计算结束；                                                  

    --------------------------------------------公共维修基金开始计算                                                  
    --计算公式：建筑面积*100（多层）  建筑面积*200 (高层住宅)                                                   
    IF @chvItemName = '公共维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('商铺', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('商铺', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“公共维修基金”                                                  


        IF (@cplx = '多层住宅')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 100), 0);
        END;

        IF (@cplx = '高层住宅')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 0);
        END;
        IF (@cplx = '商业')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 0);
        END;
        RETURN 7;

    END;
    --“公共维修基金”计算完毕                                               


    --------------------------------------------物业费开始计算                                                  
    --计算公式：多层 ：1.54元/建筑平米.月*12个月*实测建筑面积；小高层住宅、高层住宅：1.93元/建筑平米.月*12个月*实测建筑面积；                                                  
    IF @chvItemName = '物业费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                         
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“物业费”                                                  


        IF (@cplx = '多层住宅')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 2.16 * 12), 0);
        END;

        IF (@cplx = '高层住宅')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 2.16 * 12), 0);
        END;

        IF (@cplx = '商业')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 2.3 * 12), 0);
        END;

        RETURN 7;

    END;
    --“物业费”计算完毕                                           



    ---商铺的印花税公式，实测总价的万分之五                                          



    IF @chvItemName = '印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                            
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;











            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“印花税”                                                  



        IF (@cplx = '商业')
        BEGIN
            SET @decDsFee = ROUND((@decTmp + @sjbctotal) * 0.0005, 0);
        END;



    END;

END;
--北京保利花园代收费用计算完毕                                                  

--北京保利东郡代收SQL开始                                                  

IF (
(
    @chvProjName = '北京保利东郡'
    AND @buguid = '5054E880-C6D5-488A-92DF-812E52E2712B'
)
   )
BEGIN


    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：办公楼契税收取标准：实测房款总价的3%                                                  
    IF @chvItemName = '契税'
    BEGIN
        --取价格      Set @decTmp = 0;                                                  
        --取面积                                                  
        SET @decTmp = 0;
        SET @sjbctotal = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
        END;

        --开始计算“契税”                     



        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;
        END;

        RETURN 1;

    END;
    ----契税计算结束；                                             

    --公共维修基金开始计算                                                  
    --计算公式：2008年2月1日起签订商品住宅买卖合同的：多层（六层及六层以下）为100元/建筑平方米；高层住宅（六层以上）为200元/建筑平方米；                                                   
    IF @chvItemName = '公共维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                        
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            -- Select p_room.ProductName,cast(scbldarea as decimal(19,4)) from p_room where p_room.roomguid='a2861e42-c97e-476a-ae65-a6d9c56ca19c'                                             
            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('商铺', @cplx) > 0
            BEGIN
                SET @cplx = '商铺';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;


            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;



            IF (@qsdate >= '2008-02-01' AND (@cplx = '多层住宅'))
            BEGIN
                SET @decDsFee = ROUND((@mjtmp * 100), 0);
            END;

            IF (
                   @qsdate >= '2008-02-01'
                   AND
                   (
                       @cplx = '高层住宅'
                       OR @cplx = '写字楼'
                       OR @cplx = '商铺'
                   )
               )
            BEGIN
                SET @decDsFee = ROUND((@mjtmp * 200), 0);
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('商铺', @cplx) > 0
            BEGIN
                SET @cplx = '商铺';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“公共维修基金”                                                  

        BEGIN

            IF (@qsdate >= '2008-02-01' AND (@cplx = '多层住宅'))
            BEGIN
                SET @decDsFee = ROUND((@mjtmp * 100), 0);
            END;

            IF (
                   @qsdate >= '2008-02-01'
                   AND
                   (
                       @cplx = '高层住宅'
                       OR @cplx = '写字楼'
                       OR @cplx = '商铺'
                   )
               )
            BEGIN
                SET @decDsFee = ROUND((@mjtmp * 200), 0);
            END;
        END;
        --if ( @qsdate>='2008-02-01' and (@cplx = '多层住宅' or @Cplx='商业'))                                                  
        --  begin                                                  
        --       Set @decDsFee = ROUND((@mjtmp * 100 ),0)                                                  
        --  end               

        --if ( @qsdate>='2008-02-01' and (@cplx = '高层住宅' or @Cplx='写字楼') )                                                  
        --  begin                                                  
        --       Set @decDsFee = ROUND((@mjtmp * 200 ),0)                                                  
        --  end                             

        RETURN 7;

    END;
    --“公共维修基金”计算完毕                                               



    --物业费开始计算                                                  
    --计算公式：7.9元/建筑平方米.月，收取12个月；                                                  

    IF @chvItemName = '物业费'
    BEGIN --取价格                                      
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                           
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;









            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“物业费”                                                  


        IF (@cplx = '写字楼')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 7.9 * 12), 0);
        END;

        IF (@cplx = '高层住宅')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 6.9 * 12), 0);
        END;

        IF (@cplx = '商业')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 8.72 * 12), 0);
        END;
        RETURN 7;
    END;
--“物业费”计算完毕                                                     

END;
--北京保利东郡代收费用计算完毕                                              









--北京保利融创．枫丹壹號代收SQL开始                                                  

IF (@projGUID IN ( 'd96f5dc9-cc18-4009-9c7c-ced9f939ff97', '5F3FF380-F6A3-E711-80BA-E61F13C57837' ))
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、印花税                                                  
    --   计算公式：办公楼契税收取标准：实测房款总价的3%                                                  
    IF @chvItemName = '印花税'
    BEGIN
        --取价格      Set @decTmp = 0;                                                  
        --取面积                                                  
        SET @decTmp = 0;
        SET @sjbctotal = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
        END;

        --开始计算“印花税”                                                  



        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.0005;
        END;

        RETURN 1;

    END;

    --契税计算结束；                                                  
    IF @chvItemName = '契税'
    BEGIN
        --取价格      Set @decTmp = 0;                                                  
        --取面积                                                  
        SET @decTmp = 0;
        SET @sjbctotal = 0;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal,
                   @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;

            --开始计算“契税”                                                  

            BEGIN
                SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;
            END;


        END;

    END;

    --公共维修基金开始计算                                                  
    --计算公式：公维是住宅面积*200，商业面积*100                                    
    IF @chvItemName = '公共维修基金'
    BEGIN
        -- 取价格                                                  
        SET @decTmp = 0;
        --    取面积                                                  
        SET @mjtmp = 0;
        --   取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            -- 来源为“定单”通过交易表获取                     
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;


            IF (@cplx = '写字楼' OR @cplx = '商业')
            BEGIN
                SET @decDsFee = ROUND((@mjtmp * 100), 0);
            END;

            ELSE
                SET @decDsFee = ROUND((@mjtmp * 200), 0);


        END;

        IF @chvSource = '合同'
        --  来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;

            IF (@cplx = '写字楼' OR @cplx = '商业')
            BEGIN
                SET @decDsFee = ROUND((@mjtmp * 100), 0);
            END;

            ELSE
                SET @decDsFee = ROUND((@mjtmp * 200), 0);

        END;

    END;
---公共维修基金”计算完毕                                               



----物业费开始计算                                                  
----计算公式：7.9元/建筑平方米.月，收取12个月；                                                  

--    If @chvItemName='物业费'                                                  
--       Begin                                      
--  --取价格                                                  
--  Set @decTmp = 0;                                                  
--         --取面积                                          
--   set @mjtmp=0;                                                  
--         --取出是个人购买还是公司购买                                         
--     set @ge=null;                                                  

--   If @chvSource = '定单'                                   
--          begin                                                  
--  --来源为“定单”通过交易表获取                           
--  select @decTmp=isnull(RmbCjTotal,0) from s_Order where OrderGUID = @chvSaleGUID;                                                  
--     select @chvRoomGUID =roomguid From s_Order where OrderGUID = @chvSaleGUID;                                                  

--  Select @Cplx=p_room.ProductName,@mjtmp=cast(scbldarea as decimal(19,4)) from p_room where p_room.roomguid=@chvRoomGUID                                                          

--  if charindex('多层',@cplx) >0                                                   
--   begin                                                  
--    set @Cplx='多层住宅'                                                  
--   end                                                  
--  if charindex('高级住宅',@cplx) >0                                                    
--   begin                                                   
--    SET @Cplx='高级住宅'                                                    
--   end                                                  
--  if charindex('高层住宅',@cplx) >0                                                   
--   begin                                                    
--    SET @Cplx='高层住宅'                                                    
--   end                                                  
--     if charindex('商业',@cplx) >0                                                   
--   begin                                                    
--    SET @Cplx='商业'                                                    
--   end                                                  
--  if charindex('写字楼',@cplx) >0                                                   
--   begin                                                    
--    SET @Cplx='写字楼'                                                    
--   end                                                  


--                select @ge=rtrim(P_customer.csttype) from s_Order,s_Trade2Cst,p_Customer where s_Order.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_Order.OrderGUID = @chvSaleGUID;                                    








--                       if @ge<>'公司'                                                  
--                 begin                                                  
--                   set @ge='个人';                                                  
--                 end                                                      
--   end                                                  
--           If @chvSource = '合同'             
--    --来源为“合同”通过交易表获取                                           
--    begin                                                
--  select @decTmp=isnull(RmbHtTotal,0) from s_Contract where ContractGUID = @chvSaleGUID;                                                  
--  select @chvRoomGUID =roomguid From s_Contract where ContractGUID = @chvSaleGUID;                                                    
--  Select @Cplx=p_room.ProductName,@mjtmp=cast(scbldarea as decimal(19,4)) from p_room where p_room.roomguid=@chvRoomGUID                                                          

--  if charindex('多层',@cplx) >0                                                   
--   begin                                                  
--    set @Cplx='多层住宅'                                                  
--   end                                                  
--  if charindex('高级住宅',@cplx) >0                                                    
--   begin                                                   
--    SET @Cplx='高级住宅'                                                    
--   end                                                  
--  if charindex('高层住宅',@cplx) >0                                                   
--   begin                                                    
--    SET @Cplx='高层住宅'                                                    
--  end                                                  
--     if charindex('商业',@cplx) >0                                                   
--   begin                                                    
--    SET @Cplx='商业'                                                    
--   end                                                  
--  if charindex('写字楼',@cplx) >0                    
--   begin                                                    
--    SET @Cplx='写字楼'                                                    
--   end                                                  


--                select @ge=rtrim(P_customer.csttype) from s_contract,s_Trade2Cst,p_Customer where s_contract.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_contract.ContractGUID = @chvSaleGUID;                         














--                       if @ge<>'公司'                                                  
--    begin                                  
--                   select @ge='个人';                                                  
--                 end                                                 
--          end                                                  

--     --开始计算“物业费”                                                  


--   if ( @Cplx='写字楼' )                                                  
--     begin                                                
--          Set @decDsFee = ROUND((@mjtmp * 7.9 * 12 ),0)                                                  
--     end                                                  

--     if(@Cplx='高层住宅')                                             
--  begin                                          
--    set    @decDsFee = ROUND((@mjtmp * 6.9 * 12 ),0)                                        
-- end                                        

--            if(@Cplx='商业')                                             
--  begin                                          
--    set    @decDsFee = ROUND((@mjtmp * 8.72 * 12 ),0)                                           
-- end                                          
--    return 7                                                  

--    End                                                  
----“物业费”计算完毕                                                     

END;
--北京保利融创．枫丹壹號代收费用计算完毕                                       







--北京保利罗兰香谷二期代收SQL开始                                                  

IF (@projGUID IN ( '34c60fe1-f6a3-e711-80ba-e61f13c57837' ))
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：办公楼契税收取标准：实测房款总价的3%                                                  
    IF @chvItemName = '契税'
    BEGIN
        --取价格      Set @decTmp = 0;                                                  
        --取面积                                                  
        SET @decTmp = 0;
        SET @sjbctotal = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
        END;

        --开始计算“契税”                                                  



        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;

        END;

        RETURN 1;

    END;
    ----契税计算结束；                            


    --------------------------------------------公共维修基金开始计算                                                  
    --计算公式：  建筑面积*200 (高层住宅)                                                   
    IF @chvItemName = '公共维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                            
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;




            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“公共维修基金”                                                  


        --if ( @cplx = '多层住宅' )                                                  
        --  begin                             
        --       Set @decDsFee = ROUND((@mjtmp * 100 ),0)                                                  
        --  end                                                  

        --if ( @cplx = '高层住宅' )                                           
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 0);
        END;

        RETURN 7;

    END;
--“公共维修基金”计算完毕         





END;
--北京保利罗兰香谷二期代收费用计算完毕                                       





--北京保利垄上高级住宅代收SQL开始                                                  

IF (@projGUID IN ( '52f3771c-b8aa-4b68-9a23-fc58e4feda7c' ))
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：办公楼契税收取标准：实测房款总价的3%                                                  
    IF @chvItemName = '契税'
    BEGIN
        --取价格      Set @decTmp = 0;                                                  
        --取面积                                                  
        SET @decTmp = 0;
        SET @sjbctotal = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
        END;

        --开始计算“契税”                                                  



        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;

        END;

        RETURN 1;

    END;
    ----契税计算结束；                            


    --------------------------------------------公共维修基金开始计算                                                  
    --计算公式：  建筑面积*200 (高层住宅)                                                   
    IF @chvItemName = '公共维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                            
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;















            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“公共维修基金”                                                  


        --if ( @cplx = '多层住宅' )                                                  
        --  begin                             
        --       Set @decDsFee = ROUND((@mjtmp * 100 ),0)                                                  
        --  end                                                  

        --if ( @cplx = '高层住宅' )                                           
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 0);
        END;

        RETURN 7;

    END;
--“公共维修基金”计算完毕         





END;
--北京保利垄上高级住宅收费用计算完毕                                           














--北京保利大都汇代收SQL开始                                                  

IF (@projGUID IN ( 'f8db2546-f657-e711-80ba-e61f13c57837', '3854072e-2f57-e711-80ba-e61f13c57837',
                   '6aefd97b-b957-e711-80ba-e61f13c57837', '78983f89-b757-e711-80ba-e61f13c57837',
                   '418f1739-b457-e711-80ba-e61f13c57837'
                 )
   )
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：办公楼契税收取标准：实测房款总价的3%                                                  
    IF @chvItemName = '契税'
    BEGIN
        --取价格      Set @decTmp = 0;                                                  
        --取面积                                                  
        SET @decTmp = 0;
        SET @sjbctotal = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
        END;

        --开始计算“契税”                                                  



        BEGIN
            PRINT '1121 21';
            PRINT @decTmp;
            PRINT @sjbctotal;
            SET @decDsFee = CAST((@decTmp + @sjbctotal) / 1.09 AS MONEY) * 0.03;
            PRINT @decDsFee;
        END;

        RETURN 1;

    END;
    ----契税计算结束；                            


    --------------------------------------------公共维修基金开始计算                                                  
    --计算公式：  建筑面积*200 (高层住宅)                                                   
    IF @chvItemName = '公共维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4)),
                   @bldguid = BldGUID
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @floor = MAX(FloorNo)
            FROM p_FloorPlan
            WHERE BldGUID = @bldguid;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;

            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                            
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4)),
                   @bldguid = BldGUID
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @floor = MAX(FloorNo)
            FROM p_FloorPlan
            WHERE BldGUID = @bldguid;
            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“公共维修基金”                                                  

        IF @floor > 6
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 2);
        END;
        ELSE
            SET @decDsFee = ROUND((@mjtmp * 100), 2);
        PRINT @floor;
        PRINT '北京和光尘樾';
        PRINT @decDsFee;
        RETURN 7;

    END;
--“公共维修基金”计算完毕         





END;
--北京保利大都汇收费用计算完毕                                           
























--北京东坝地块SQL开始                                                  

IF (@projGUID IN ( '1867261D-BF58-E711-80BA-E61F13C57837' ))
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：办公楼契税收取标准：实测房款总价的3%                                                  
    IF @chvItemName = '契税'
    BEGIN
        --取价格      Set @decTmp = 0;                                                  
        --取面积                                                  
        SET @decTmp = 0;
        SET @sjbctotal = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
        END;

        --开始计算“契税”                                                  



        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;

        END;

        RETURN 1;

    END;
    ----契税计算结束；                            


    --------------------------------------------公共维修基金开始计算                                                  
    --计算公式：  建筑面积*200 (高层住宅)                                                   
    IF @chvItemName = '公共维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                        
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                            
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“公共维修基金”                                                  


        --if ( @cplx = '多层住宅' )                                                  
        --  begin                             
        --       Set @decDsFee = ROUND((@mjtmp * 100 ),0)                                                  
        --  end                                                  

        --if ( @cplx = '高层住宅' )                                           
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 0);
        END;

        RETURN 7;

    END;
--“公共维修基金”计算完毕                                                   





END;
--北京东坝地块代收费用计算完毕                                  







--北京西山林语代收费用开始计算                                                  

IF (
(
    @chvProjName = '北京保利西山林语'
    AND @buguid = '5054E880-C6D5-488A-92DF-812E52E2712B'
)
   )
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：2010年10月1日前签订的合同140（含）平方米以下，总房款小于等于120万，按房款的1.5%，总房款大于120万，按房款的3%计算。                                                  
    -- 2010年10月1日后签订的合同全部按房款的3%计算。                                                  
    IF @chvItemName = '契税'
        IF @chvItemName = '契税'
        BEGIN
            --取价格                                                  
            SET @decTmp = 0;
            --取面积                                                  
            SET @mjtmp = 0;
            --取出是个人购买还是公司购买                                                  
            SET @ge = NULL;

            IF @chvSource = '定单'
            BEGIN
                --来源为“定单”通过交易表获取                                                  
                SELECT @decTmp = ISNULL(RmbCjTotal, 0)
                FROM s_Order
                WHERE OrderGUID = @chvSaleGUID;
                SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
                FROM s_Order
                WHERE OrderGUID = @chvSaleGUID;
                SELECT @chvRoomGUID = RoomGUID
                FROM s_Order
                WHERE OrderGUID = @chvSaleGUID;
                SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
                FROM p_room
                WHERE RoomGUID = @chvRoomGUID;

            END;
            IF @chvSource = '合同'
            --来源为“合同”通过交易表获取                                                  
            BEGIN
                SELECT @decTmp = ISNULL(RmbHtTotal, 0)
                FROM s_Contract
                WHERE ContractGUID = @chvSaleGUID;
                SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
                FROM s_Contract
                WHERE ContractGUID = @chvSaleGUID;
                SELECT @chvRoomGUID = RoomGUID,
                       @sjbctotal = SjBcTotal
                FROM s_Contract
                WHERE ContractGUID = @chvSaleGUID;
                SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
                FROM p_room
                WHERE RoomGUID = @chvRoomGUID;
            END;

            --开始计算“契税”                                                  


            IF (@qsdate >= '2010-10-01')
            BEGIN
                SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;
            END;
            ELSE
            BEGIN
                IF @decTmp <= 1200000
                BEGIN
                    SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.015;
                END;
                IF @decTmp > 1200000
                BEGIN
                    SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;
                END;
            END;

            RETURN 1;

        END;

    ----契税计算结束；                                                  


    --------------------------------------------公共维修基金开始计算                                                  
    --计算公式：建筑面积*100（多层）  建筑面积*200 (高层住宅)                                                   
    IF @chvItemName = '公共维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                      
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;


            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;







            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID,
                   @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“公共维修基金”                                                  
        IF (@bldguid NOT IN ( '4A266EAA-E823-4115-A480-B16730BE0F47', '2259F613-6F25-4486-9BE2-62664F296DC5' ))
        BEGIN
            IF (@cplx = '多层住宅')
            BEGIN
                SET @decDsFee = ROUND((@mjtmp * 100), 0);
            END;

            IF (@cplx = '高层住宅')
            BEGIN
                SET @decDsFee = ROUND((@mjtmp * 200), 0);
            END;
        END;
        IF (@bldguid IN ( '4A266EAA-E823-4115-A480-B16730BE0F47', '2259F613-6F25-4486-9BE2-62664F296DC5' ))
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 100), 0);
        END;
        RETURN 7;

    END;
    --“公共维修基金”计算完毕                                                  




    --------------------------------------------印花税开始计算                                                  
    --计算公式：印花税按合同总额千分之一，小数点后直接进一元计算                                  
    IF @chvItemName = '印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;


            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID,
                   @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;















            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“印花税”                                                  
        IF (@bldguid IN ( '4A266EAA-E823-4115-A480-B16730BE0F47', '2259F613-6F25-4486-9BE2-62664F296DC5' ))
        BEGIN
            SET @decDsFee = ROUND((@decTmp * 0.001), 0);
        END;

        RETURN 7;

    END;
    --“印花税”计算完毕                                                  











    --------------------------------------------物业费开始计算                                                  
    --计算公式：住宅 ：2.58元/建筑平米.月*12个月*实测建筑面积；                                                  

    IF @chvItemName = '物业费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @bldguid = BldGUID,
                   @cplx = BProductTypeName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
                 LEFT JOIN p_BuildProductType ON p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
            WHERE p_room.RoomGUID = @chvRoomGUID;


















        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = BProductTypeName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
                 LEFT JOIN p_BuildProductType ON p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        --开始计算“契税”                                                  
        IF (@bldguid IN ( '4A266EAA-E823-4115-A480-B16730BE0F47', '2259F613-6F25-4486-9BE2-62664F296DC5' ))
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 15.6 * 12), 0);
        END;
        ELSE
        BEGIN

            IF (@cplx = '住宅')
            BEGIN
                SET @decDsFee = ROUND((@mjtmp * 2.58 * 12), 0);
            END;
        END;
        RETURN 7;

    END;
END;
--“物业费”计算完毕                                                   
--北京西山林语代收费用计算完毕                                               










--北京保利春天里代收费用开始计算                                                  

IF (
(
    @projGUID IN ( 'aed57fe1-f4a3-e711-80ba-e61f13c57837', '0ebbcd05-f5a3-e711-80ba-e61f13c57837',
                   '46059cf3-f4a3-e711-80ba-e61f13c57837'
                 )
    AND @buguid = '5054E880-C6D5-488A-92DF-812E52E2712B'
)
   )
BEGIN

    --根据不同的代收费用分别进行计算                                 

    --1、契税                                                  
    --   计算公式：2010年10月1日前签订的合同140（含）平方米以下，总房款小于等于120万，按房款的1.5%，总房款大于120万，按房款的3%计算。                                           
    -- 2010年10月1日后签订的合同全部按房款的3%计算。                                                  
    IF @chvItemName = '契税'
        IF @chvItemName = '契税'
        BEGIN
            --取价格                                                  
            SET @decTmp = 0;
            --取面积                                              
            SET @mjtmp = 0;
            --取出是个人购买还是公司购买                                                  
            SET @ge = NULL;

            IF @chvSource = '定单'
            BEGIN
                --来源为“定单”通过交易表获取                                                  
                SELECT @decTmp = ISNULL(RmbCjTotal, 0)
                FROM s_Order
                WHERE OrderGUID = @chvSaleGUID;
                SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
                FROM s_Order
                WHERE OrderGUID = @chvSaleGUID;
                SELECT @chvRoomGUID = RoomGUID
                FROM s_Order
                WHERE OrderGUID = @chvSaleGUID;
                SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
                FROM p_room
                WHERE RoomGUID = @chvRoomGUID;

            END;
            IF @chvSource = '合同'
            --来源为“合同”通过交易表获取                                                  
            BEGIN
                SELECT @decTmp = ISNULL(RmbHtTotal, 0)
                FROM s_Contract
                WHERE ContractGUID = @chvSaleGUID;
                SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
                FROM s_Contract
                WHERE ContractGUID = @chvSaleGUID;
                SELECT @chvRoomGUID = RoomGUID,
                       @sjbctotal = SjBcTotal
                FROM s_Contract
                WHERE ContractGUID = @chvSaleGUID;
                SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
                FROM p_room
                WHERE RoomGUID = @chvRoomGUID;
            END;

            --开始计算“契税”                                                  



            BEGIN
                SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;
            END;



            RETURN 1;

        END;

    --契税计算结束；                                                  


    --------------------------------------------公共维修基金开始计算                                                  
    --计算公式：公维是每平米200                                                  
    IF @chvItemName = '公共维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;









            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;















            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“公共维修基金”                                                  



        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 0);
        END;



        RETURN 7;

    END;
    --“公共维修基金”计算完毕                                                  

    --------------------------------------------物业费开始计算                                                  
    --计算公式：住宅 ：2.98元/建筑平米.月*12个月*实测建筑面积；                                                  

    IF @chvItemName = '物业费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = BProductTypeName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
                 LEFT JOIN p_BuildProductType ON p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
            WHERE p_room.RoomGUID = @chvRoomGUID;











        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = BProductTypeName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
                 LEFT JOIN p_BuildProductType ON p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
            WHERE p_room.RoomGUID = @chvRoomGUID;










        END;

        --开始计算“公共维修基金”                                                  



        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 2.98 * 12), 0);
        END;

        RETURN 7;

    END;
END;
--“物业费”计算完毕                                                   
--北京保利春天里代收费用计算完毕                                               









--北京保利罗兰香谷项目代收费用开始计算                                                  

IF (
(
    @chvProjName = '北京保利罗兰香谷'
    AND @buguid = '5054E880-C6D5-488A-92DF-812E52E2712B'
)
   )
BEGIN

    --根据不同的代收费用分别进行计算                                           
    --1、契税                                                  
    --   计算公式：1、契税 = 补差后总房款*3%，保留2位小数；                                          

    IF @chvItemName = '契税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
        END;

        --开始计算“契税”                                                  

        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;
        END;


        RETURN 1;

    END;

    ----契税计算结束；                                                 

    --1、契税                                                  
    ----   计算公式：2010年10月1日前签订的合同140（含）平方米以下，总房款小于等于120万，按房款的1.5%，总房款大于120万，按房款的3%计算。                                                  
    ---- 2010年10月1日后签订的合同全部按房款的3%计算。                                                  
    --    If @chvItemName='契税'                                                 
    --        If @chvItemName='契税'                                                  
    --      Begin                                                  
    --  --取价格                                                  
    --  Set @decTmp = 0;                                                  
    --         --取面积                                                  
    --   set @mjtmp=0;                                                  
    --         --取出是个人购买还是公司购买                                                  
    --     set @ge=null;                                                  

    --   If @chvSource = '定单'                                                  
    --          begin                                                  
    --  --来源为“定单”通过交易表获取                                                  
    --  select @decTmp=isnull(RmbCjTotal,0) from s_Order where OrderGUID = @chvSaleGUID;                                                  
    --  Select @mjtmp=cast(bldarea as decimal(19,4))  From s_Order where OrderGUID = @chvSaleGUID;                                                  
    --     select @chvRoomGUID =roomguid From s_Order where OrderGUID = @chvSaleGUID;                                                   
    --  select @mjtmp=cast(scbldarea as decimal(19,4)) from p_room where RoomGUID = @chvRoomGUID;                                                  

    --          end                                                   
    --   If @chvSource = '合同'                                                  
    --    --来源为“合同”通过交易表获取                                                  
    --    begin                                                  
    --  select @decTmp=isnull(RmbHtTotal,0) from s_Contract where ContractGUID = @chvSaleGUID;                                                  
    --  Select @qsdate = left(convert(varchar(20),qsdate,120),10) From s_Contract where ContractGUID = @chvSaleGUID;                                      
    --  select @chvRoomGUID =roomguid,@sjbctotal=sjbctotal From s_Contract where ContractGUID = @chvSaleGUID;                                                   
    --  select @mjtmp=cast(scbldarea as decimal(19,4)) from p_room where RoomGUID = @chvRoomGUID;                                                  
    --    end                                                  

    --     --开始计算“契税”                                                  


    --   if (@qsdate >= '2010-10-01')                                                  
    --   begin                                                  
    -- Set @decDsFee = cast((@decTmp + @sjbctotal) as money)*0.03                                                  
    --     end                                                  
    --   else                                                  
    -- begin                                                
    --   if @dectmp <= 1200000                                                   
    --             begin                                                   
    --        Set @decDsFee = cast((@decTmp + @sjbctotal) as money)*0.015;                                                  
    --             end                                                   
    --          if @dectmp > 1200000                                                   
    --             begin                                                  
    --               Set @decDsFee = cast((@decTmp + @sjbctotal) as money)*0.03;                                                  
    --             end                                                  
    --        end                                                         

    --    return 1                                       

    --    End                                                  

    ----契税计算结束；                                                  


    --------------------------------------------公共维修基金开始计算                                                  
    --计算公式：  建筑面积*200 (高层住宅)                                                   
    IF @chvItemName = '公共维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;

            IF CHARINDEX('车位', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“公共维修基金”                                                  


        IF (@cplx = '车位')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 100), 0);
        END;

        ELSE
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 0);
        END;

        RETURN 7;

    END;
    --“公共维修基金”计算完毕                                                  

    --------------------------------------------物业费开始计算                                         
    --计算公式：住宅 ：2.78元/建筑平米.月*12个月*实测建筑面积；                                                  

    IF @chvItemName = '物业费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = BProductTypeName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
                 LEFT JOIN p_BuildProductType ON p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
            WHERE p_room.RoomGUID = @chvRoomGUID;









        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = BProductTypeName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
                 LEFT JOIN p_BuildProductType ON p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
            WHERE p_room.RoomGUID = @chvRoomGUID;





        END;

        --开始计算“公共维修基金”                                                  


        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 2.78 * 12), 0);
        END;

        RETURN 7;

    END;
END;
--“物业费”计算完毕                                            

--北京保利罗兰香谷项目代收费用计算完毕                                          





--北京茉莉公馆代收SQL开始                                       

IF (
(
    @chvProjName = '北京保利茉莉公馆'
    AND @buguid = '5054E880-C6D5-488A-92DF-812E52E2712B'
)
   )
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：2010年10月1日前签订的合同140（含）平方米以下，成交单价小于21600，按房款的1.5%，成交单价大于21600，按房款的3%计算。                                                  
    -- 2010年10月1日后签订的合同全部按房款的3%计算。                                                  
    IF @chvItemName = '契税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                   
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                               
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
        END;

        --开始计算“契税”                                                  


        IF (@qsdate >= '2010-10-01')
        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;
        END;
        ELSE
        BEGIN
            IF @jgtmp <= 21600
            BEGIN
                SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.015;
            END;
            IF @jgtmp > 21600
            BEGIN
                SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;
            END;
        END;

        RETURN 1;

    END;

    ----契税计算结束；                                                  

    --------------------------------------------公共维修基金开始计算                                                  
    --计算公式：建筑面积*100（多层）  建筑面积*200 (高层住宅)                                                   
    IF @chvItemName = '公共维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;









            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;











            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“公共维修基金”                                                  


        IF (@cplx = '多层住宅')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 100), 0);
        END;

        IF (@cplx = '高层住宅')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 0);
        END;
        RETURN 7;

    END;
    --“公共维修基金”计算完毕                                                  

    --------------------------------------------物业费开始计算                                                  
    --计算公式：住宅：2.68元/建筑平米.月*12个月*实测建筑面积；商业：3.40元/建筑平米.月*12个月*实测建筑面积                                                  

    IF @chvItemName = '物业费'
    BEGIN
        --取价格     
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        --开始计算“公共维修基金”                                                  


        IF (@cplx = '0.02')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 2.68 * 12), 0);
        END;

        IF (@cplx = '0.07')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 3.40 * 12), 0);
        END;

        RETURN 7;

    END;
END;
--“物业费”计算完毕                                                     
--北京茉莉公馆计算完毕                                             

---北京保利中央公园代收费用计算开始                                          
IF (
(
    @chvProjName = '北京保利中央公园'
    AND @buguid = '5054E880-C6D5-488A-92DF-812E52E2712B'
)
   )
BEGIN

    --根据不同的代收费用分别进行计算                                          

    --1、契税                                                  
    --   计算公式：1、契税 = 补差后总房款*3%，保留2位小数；                                          

    IF @chvItemName = '契税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                            
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                     
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
        END;

        --开始计算“契税”                                                  

        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;
        END;


        RETURN 1;

    END;

    ----契税计算结束；                                                  

    --------------------------------------------公共维修基金开始计算                               
    --计算公式：2、维修基金 = 200*实测建筑面积，保留2位小数；  住宅按200 商铺按100                                                
    IF @chvItemName = '公共维修基金'
    BEGIN


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @bldguid = BldGUID,
                   @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            SELECT @floor = MAX(FloorNo)
            FROM p_FloorPlan
            WHERE BldGUID = @bldguid;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID,
                   @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;


            SELECT @floor = MAX(FloorNo)
            FROM p_FloorPlan
            WHERE BldGUID = @bldguid;
        END;

        --开始计算“公共维修基金”                                                  
        IF @floor > 6
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 2);
        END;
        ELSE
            SET @decDsFee = ROUND((@mjtmp * 100), 2);



        RETURN 7;

    END;

    --业主印花税 高级扩展公式实测总价的万分之五                                          

    IF @chvItemName = '业主印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                   
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
        END;

        --开始计算“业主印花税”                                                  

        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.0005;
        END;


        RETURN 1;

    END;


    --业主印花税结束                                          

    --“公共维修基金”计算完毕                                                  

    --------------------------------------------物业费开始计算                                                  
    --计算公式：3.42*12*实测建筑面积，保留0位小数；                                                 

    IF @chvItemName = '物业费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                     
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        --开始计算“物业费”                                                 





        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 3.42 * 12), 0);
        END;

        RETURN 7;

    END;
END;
--“物业费”计算完毕                                            



--北京保利中央公园代收费用计算结束                               











---北京芳园代收费用计算开始                                          
IF (
(
    @chvProjName IN ( '北京门头沟项目', '北京保利芳园', '北京首开保利熙悦诚郡' )
    OR @projGUID IN ( 'ea0456c8-0566-4d2c-90f6-7d879f6174a6' )
    OR @projGUID IN ( '2ecf6744-8158-e711-80ba-e61f13c57837', '38b3d5de-8058-e711-80ba-e61f13c57837' )
       AND @buguid = '5054E880-C6D5-488A-92DF-812E52E2712B'
)
   )
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：1、契税 = 补差后总房款*3%，保留2位小数；                                          

    IF @chvItemName = '契税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                          
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
        END;

        --开始计算“契税”                                                  

        PRINT 'lirui';

        PRINT @decTmp;
        PRINT @sjbctotal;
        IF @projGUID = 'e30915bc-31d3-e311-9927-e41f13c5183a'
           AND @chvRoomGUID NOT IN ( '3C15A449-0122-4A00-8248-2A198DD9F48B', 'BDBC71D1-33EC-4AEE-A746-2B51B48114DD',
                                     'A18D96F6-2C9C-4396-90B2-4767EBA358BB', '62721707-F699-4216-91D9-4A8378262B7E',
                                     'AE7A4E06-FDC9-456A-A5C0-6050898861BC', '55F9F74E-0A2B-4EA2-9A0B-61C8DD12B5DB',
                                     'D7F17A9C-6345-4B21-BE70-79D04D1C1B1A', '25A4033E-1933-4913-AE16-815D3330C290',
                                     '945F9DA3-7775-4824-B3A7-D04F8F561D89', '74eb1a03-e2bf-4cbf-a830-b878f1e02785',
                                     '0a50b9f0-a82d-4db4-a728-88b5dd766b82', 'CA7303CB-C436-4405-925D-A03ABF83A7C3',
                                     '96E13E29-F136-4B18-A2EA-07FD112CF593'
                                   )
        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) / 1.05 AS MONEY) * 0.03;

        END;



        IF @projGUID IN ( '2ecf6744-8158-e711-80ba-e61f13c57837', '38b3d5de-8058-e711-80ba-e61f13c57837' )
        BEGIN

            PRINT 'XX';

            SET @decDsFee = CAST((@decTmp + @sjbctotal) / 1.09 AS MONEY) * 0.03;
            PRINT @decDsFee;
        END;
        ELSE
        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;

        END;


        RETURN 1;

    END;

    ----契税计算结束；                                                  

    --------------------------------------------公共维修基金开始计算                                                  
    --计算公式：2、维修基金 = 200*实测建筑面积，保留2位小数；  住宅按200                                                
    IF @chvItemName = '公共维修基金'
    BEGIN


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                     
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID,
                   @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;

        --开始计算“公共维修基金”                                                  
        --if @Cplx = '0.02'       
        IF @bldguid <> '44545ECD-7F0A-4F52-A8A9-A2C7E1300C3B'
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 2);
        END;

        IF @bldguid = '44545ECD-7F0A-4F52-A8A9-A2C7E1300C3B'
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 100), 2);
        END;




        RETURN 7;

    END;

    --  --业主印花税 高级扩展公式实测总价的万分之五                                          

    --      If @chvItemName='业主印花税'                                                  
    --     Begin                                                  
    ----取价格                                                  
    --Set @decTmp = 0;                                                  
    --       --取面积                                                  
    -- set @mjtmp=0;                                                  
    --       --取出是个人购买还是公司购买                                                  
    --   set @ge=null;                                                  

    -- If @chvSource = '定单'                                                  
    --        begin                                               
    ----来源为“定单”通过交易表获取                                
    --select @decTmp=isnull(RmbCjTotal,0) from s_Order where OrderGUID = @chvSaleGUID;                                                  
    --select @jgtmp=isnull(BldCjPrice,0) from s_Order where OrderGUID = @chvSaleGUID;                   
    --Select @mjtmp=cast(bldarea as decimal(19,4))  From s_Order where OrderGUID = @chvSaleGUID;                                                  
    --   select @chvRoomGUID =roomguid From s_Order where OrderGUID = @chvSaleGUID;                                              
    --select @mjtmp=cast(scbldarea as decimal(19,4)) from p_room where RoomGUID = @chvRoomGUID;                                                  

    --        end                                                   
    -- If @chvSource = '合同'                                                  
    --  --来源为“合同”通过交易表获取                              
    --  begin                                                  
    --select @decTmp=isnull(RmbHtTotal,0) from s_Contract where ContractGUID = @chvSaleGUID;                                                  
    --select @jgtmp=isnull(BldCjPrice,0) from s_Contract where ContractGUID = @chvSaleGUID;                                                  
    --Select @qsdate = left(convert(varchar(20),qsdate,120),10)  From s_Contract where ContractGUID = @chvSaleGUID;                                                  
    --select @chvRoomGUID =roomguid,@sjbctotal=sjbctotal From s_Contract where ContractGUID = @chvSaleGUID;                                                   
    --select @mjtmp=cast(scbldarea as decimal(19,4)) from p_room where RoomGUID = @chvRoomGUID;                                                  
    --  end                                                  

    --   --开始计算“业主印花税”                   

    --         begin                                                  
    --            Set @decDsFee = cast((@decTmp + @sjbctotal) as money)*0.0005;                                                  
    --          end                                                  


    -- return 1                                                  

    --  End                                      


    --  --业主印花税结束                                          

    --“业主印花税”计算完毕                                                  

    --------------------------------------------物业费开始计算                                                  
    --计算公式：71*12*实测建筑面积，保留0位小数；                                                 

    IF @chvItemName = '物业费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        --开始计算“物业费”                                                  





        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 1.71 * 12), 0);
        END;

        RETURN 7;

    END;
END;
--“物业费”计算完毕                                            



--北京芳园代收费用计算结束                                            







---北京保利嘉园代收费用计算开始                                          
IF (
(
    @chvProjName = '北京保利嘉园'
    AND @buguid = '5054E880-C6D5-488A-92DF-812E52E2712B'
)
   )
BEGIN

    --根据不同的代收费用分别进行计算                                                

    --1、契税                                                  
    --   计算公式：1、契税 = 补差后总房款*3%，保留2位小数；                                          

    --      If @chvItemName='契税'                                                  
    --     Begin                             
    ----取价格                                                  
    --Set @decTmp = 0;                                                  
    --       --取面积                                                  
    -- set @mjtmp=0;                                                  
    --       --取出是个人购买还是公司购买                                                  
    --   set @ge=null;                                                  

    -- If @chvSource = '定单'                                                  
    --        begin                                                  
    ----来源为“定单”通过交易表获取                                                  
    --select @decTmp=isnull(RmbCjTotal,0) from s_Order where OrderGUID = @chvSaleGUID;                                                  
    --select @jgtmp=isnull(BldCjPrice,0) from s_Order where OrderGUID = @chvSaleGUID;                                                  
    --Select @mjtmp=cast(bldarea as decimal(19,4))  From s_Order where OrderGUID = @chvSaleGUID;                                                  
    --   select @chvRoomGUID =roomguid From s_Order where OrderGUID = @chvSaleGUID;                                            
    --select @mjtmp=cast(scbldarea as decimal(19,4)) from p_room where RoomGUID = @chvRoomGUID;                                                  

    --        end                                                   
    -- If @chvSource = '合同'                                                  
    --  --来源为“合同”通过交易表获取                                                  
    --  begin                                                  
    --select @decTmp=isnull(RmbHtTotal,0) from s_Contract where ContractGUID = @chvSaleGUID;                                                  
    --select @jgtmp=isnull(BldCjPrice,0) from s_Contract where ContractGUID = @chvSaleGUID;                                                  
    --Select @qsdate = left(convert(varchar(20),qsdate,120),10)  From s_Contract where ContractGUID = @chvSaleGUID;                                                  
    --select @chvRoomGUID =roomguid,@sjbctotal=sjbctotal From s_Contract where ContractGUID = @chvSaleGUID;                                                   
    --select @mjtmp=cast(scbldarea as decimal(19,4)) from p_room where RoomGUID = @chvRoomGUID;                                                  
    --  end                                                  

    --   --开始计算“契税”                                                  

    --         begin                      
    --            Set @decDsFee = cast((@decTmp + @sjbctotal) as money)*0.03;                                            

    --          end                                                  


    -- return 1                                                  

    --  End                                                  

    ----契税计算结束；                                                  

    --------------------------------------------公共维修基金开始计算                                                  
    --计算公式：2、维修基金 = 200*实测建筑面积，保留2位小数；                                               
    IF @chvItemName = '公共维修基金'
    BEGIN


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @bldguid = p_room.BldGUID,
                   @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = p_room.BldGUID,
                   @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;

        --开始计算“公共维修基金”                                                  
        --if @Cplx = '0.02'                                           
        IF (@bldguid IN ( 'DE031727-259A-4092-8797-1F029D00DD79', 'C9F5A128-0C74-4FD2-A48D-279FB7D0B3F4',
                          '7F2968D3-17DD-4B72-964F-284FC2E44E4B', '9D24953D-644B-4D06-86D5-CAAE03C396A8'
                        )
           )
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 2);
        END;




        RETURN 7;

    END;

    --  --业主印花税 高级扩展公式实测总价的万分之五                                          

    --      If @chvItemName='业主印花税'                                           
    --     Begin                                                  
    ----取价格                                                  
    --Set @decTmp = 0;                
    --       --取面积                                                  
    -- set @mjtmp=0;                                                  
    --       --取出是个人购买还是公司购买                                                  
    --   set @ge=null;                                         

    -- If @chvSource = '定单'                                                  
    --        begin                  
    ----来源为“定单”通过交易表获取                                                  
    --select @decTmp=isnull(RmbCjTotal,0) from s_Order where OrderGUID = @chvSaleGUID;                                                  
    --select @jgtmp=isnull(BldCjPrice,0) from s_Order where OrderGUID = @chvSaleGUID;                                                  
    --Select @mjtmp=cast(bldarea as decimal(19,4))  From s_Order where OrderGUID = @chvSaleGUID;                                                  
    --   select @chvRoomGUID =roomguid From s_Order where OrderGUID = @chvSaleGUID;                                                   
    --select @mjtmp=cast(scbldarea as decimal(19,4)) from p_room where RoomGUID = @chvRoomGUID;                                                  

    --        end                                                   
    -- If @chvSource = '合同'                     
    --  --来源为“合同”通过交易表获取                                                  
    --  begin                                 
    --select @decTmp=isnull(RmbHtTotal,0) from s_Contract where ContractGUID = @chvSaleGUID;                                            
    --select @jgtmp=isnull(BldCjPrice,0) from s_Contract where ContractGUID = @chvSaleGUID;                                                  
    --Select @qsdate = left(convert(varchar(20),qsdate,120),10)  From s_Contract where ContractGUID = @chvSaleGUID;                                                  
    --select @chvRoomGUID =roomguid,@sjbctotal=sjbctotal From s_Contract where ContractGUID = @chvSaleGUID;                                                   
    --select @mjtmp=cast(scbldarea as decimal(19,4)) from p_room where RoomGUID = @chvRoomGUID;                                                  
    --  end                                                  

    --   --开始计算“业主印花税”                                                  

    --         begin                                                  
    --            Set @decDsFee = cast((@decTmp + @sjbctotal) as money)*0.0005;                         
    --          end                                                  


    -- return 1                                                  

    --  End                  


    --  --业主印花税结束                                          

    --“业主印花税”计算完毕                                                  

    --------------------------------------------物业费开始计算                                                  
    --计算公式：0.9*12*实测建筑面积，保留0位小数；                                                 

    IF @chvItemName = '物业费'
    BEGIN
        --取价格                                            
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @bldguid = p_room.BldGUID,
                   @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = p_room.BldGUID,
                   @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        --开始计算“物业费”                                                  



        IF (@bldguid IN ( 'DE031727-259A-4092-8797-1F029D00DD79', 'C9F5A128-0C74-4FD2-A48D-279FB7D0B3F4',
                          '7F2968D3-17DD-4B72-964F-284FC2E44E4B', '9D24953D-644B-4D06-86D5-CAAE03C396A8'
                        )
           )
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 0.9 * 12), 0);

        END;

        RETURN 7;

    END;
END;
--“物业费”计算完毕                                            



--北京保利嘉园代收费用计算结束                                         


---北京保利首开·熙悦春天代收费用计算开始                                          
IF (
(
    @chvProjName = '北京保利首开·熙悦春天'
    AND @buguid = '5054E880-C6D5-488A-92DF-812E52E2712B'
)
   )
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：1、契税 = 补差后总房款*3%，保留2位小数；                                          

    IF @chvItemName = '契税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
        END;

        --开始计算“契税”                                                  
        IF @sjbctotal > 0
        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;

        END;
        IF @sjbctotal <= 0
        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;

        END;

        RETURN 1;

    END;

    --契税计算结束；                                        

    --------------------------------------------公共维修基金开始计算                                                  
    --计算公式：2、维修基金 = 200*实测建筑面积，保留2位小数；                                               
    IF @chvItemName = '公共维修基金'
    BEGIN


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @bldguid = p_room.BldGUID,
                   @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = p_room.BldGUID,
                   @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;

        --开始计算“公共维修基金”                                                  
        IF (@cplx = '0.10' OR @cplx = '0.07')
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 100), 2);
        END;
        ELSE
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 2);
        END;





        RETURN 7;

    END;

    --  --业主印花税 高级扩展公式实测总价的0.05%                                          

    IF @chvItemName = '业主印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
        END;

        --开始计算“业主印花税”                                                  

        BEGIN
            SET @decDsFee = CEILING((@decTmp) * 0.0005);
        END;


        RETURN 1;

    END;


--  --业主印花税结束                                          

--“业主印花税”计算完毕                                                  

--------------------------------------------物业费开始计算            
--计算公式：0.9*12*实测建筑面积，保留0位小数；                                        

--  If @chvItemName='物业费'     
--     Begin                                                  
----取价格                                                  
--Set @decTmp = 0;                                                  
--       --取面积                                                  
-- set @mjtmp=0;                                                  
--       --取出是个人购买还是公司购买                                                  
--   set @ge=null;                                                  


-- If @chvSource = '定单'                                                  
--        begin                                                  
----来源为“定单”通过交易表获取                                                  
--select @decTmp=isnull(RmbCjTotal,0) from s_Order where OrderGUID = @chvSaleGUID;                                         
--   select   @chvRoomGUID =roomguid From s_Order where OrderGUID = @chvSaleGUID;                                                  

--Select @bldguid=p_room.BldGUID,  @Cplx=p_room.BProductTypeCode,@mjtmp=cast(scbldarea as decimal(19,4)) from p_room where p_room.roomguid=@chvRoomGUID                                                          

-- end                                                  

-- If @chvSource = '合同'                                                  
--  --来源为“合同”通过交易表获取                                                  
--  begin                                                  
--select @decTmp=isnull(RmbHtTotal,0) from s_Contract where ContractGUID = @chvSaleGUID;                                                  
--select   @chvRoomGUID =roomguid From s_Contract where ContractGUID = @chvSaleGUID;                                      
--Select @bldguid=p_room.BldGUID, @Cplx=p_room.BProductTypeCode,@mjtmp=cast(scbldarea as decimal(19,4)) from p_room where p_room.roomguid=@chvRoomGUID                                              

--        end                                   

--   --开始计算“物业费”                                                  



--     if(@bldguid in ('DE031727-259A-4092-8797-1F029D00DD79','C9F5A128-0C74-4FD2-A48D-279FB7D0B3F4','7F2968D3-17DD-4B72-964F-284FC2E44E4B','9D24953D-644B-4D06-86D5-CAAE03C396A8'))                                                



--   begin                                                  
--        Set @decDsFee = ROUND((@mjtmp *0.9 * 12),0)                                    

--   end                                                 

--  return 7                                            

-- end                         
END;
--“物业费”计算完毕                                 



--北京保利首开·熙悦春天代收费用计算结束                                            




---北京保利海德公园代收费用计算开始                                          
IF (
(
    @chvProjName = '北京保利海德公园'
    AND @buguid = '5054E880-C6D5-488A-92DF-812E52E2712B'
)
   )
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1、契税                                                  
    --   计算公式：1、契税 = 补差后总房款*3%，保留2位小数；                                          

    IF @chvItemName = '契税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @jgtmp = ISNULL(BldCjPrice, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
        END;

        --开始计算“契税”                                                  

        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.03;

        END;


        RETURN 1;

    END;

    --契税计算结束；                                        

    --------------------------------------------公共维修基金开始计算                                                  
    --计算公式：2、维修基金 :1、2、3、5、6号楼是实测面积乘200，4号楼是实测面积乘100 保留2位小数                                              
    IF @chvItemName = '公共维修基金'
    BEGIN


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @bldguid = p_room.BldGUID,
                   @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = p_room.BldGUID,
                   @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;

        --开始计算“公共维修基金”                                                  

        IF @bldguid IN ( 'E564FF3A-C2DE-49F7-A766-EAB2924F3AC5', '7BC2FB85-0A8E-4FEA-9FD2-5AC30822E784',
                         '1EDAF7C7-B1CB-4B0E-AF74-9F51D74AA4F2', '81F0E7E2-F955-4347-9BC6-C31D22E0D110',
                         '8A7693E5-6136-4B4E-B387-9186A7595B16'
                       )
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 200), 2);
        END;

        IF @bldguid IN ( '346A3868-5733-4302-B0BC-AA36296C0DEF' )
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 100), 2);
        END;




        RETURN 2;

    END;

    --3、业主印花税                                                  
    --   计算公式：8、9号楼实测总价乘0.0005                                                  
    IF @chvItemName = '业主印花税'
    BEGIN
        --取价格      Set @decTmp = 0;                                                  
        --取面积                                                  
        SET @decTmp = 0;
        SET @sjbctotal = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @bldguid = p_room.BldGUID,
                   @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @qsdate = LEFT(CONVERT(VARCHAR(20), QSDate, 120), 10)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @sjbctotal = SjBcTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = p_room.BldGUID,
                   @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            IF CHARINDEX('多层', @cplx) > 0
            BEGIN
                SET @cplx = '多层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
        END;

        --开始计算“业主印花税”                                                  


        IF @bldguid IN ( 'CBB1B536-1983-406D-8FA8-5765143B7AC76', 'FE6A7C22-EBE0-4724-A350-C89B5FA8EC30' )
        BEGIN
            SET @decDsFee = CAST((@decTmp + @sjbctotal) AS MONEY) * 0.0005;
        END;

        RETURN 3;

    END;
    --“业主印花税” 计算完毕                                             
    ----4.物业费开始计算                                                  
    --计算公式：物业费是1、2、3、4、5、6号楼是实测面积乘6.18乘12，8号楼乘5.5乘12，9号楼乘10乘12                                                 

    IF @chvItemName = '物业费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            ----来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @bldguid = p_room.BldGUID,
                   @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                            
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = p_room.BldGUID,
                   @cplx = p_room.BProductTypeCode,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        --开始计算“物业费”                                                  



        IF @bldguid IN ( 'E564FF3A-C2DE-49F7-A766-EAB2924F3AC5', '7BC2FB85-0A8E-4FEA-9FD2-5AC30822E784',
                         '1EDAF7C7-B1CB-4B0E-AF74-9F51D74AA4F2', '81F0E7E2-F955-4347-9BC6-C31D22E0D110',
                         '346A3868-5733-4302-B0BC-AA36296C0DEF', '8A7693E5-6136-4B4E-B387-9186A7595B16'
                       )
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 6.18 * 12), 2);
        END;

        IF @bldguid IN ( 'CBB1B536-1983-406D-8FA8-5765143B7AC76' )
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 5.5 * 12), 2);
        END;

        IF @bldguid IN ( 'FE6A7C22-EBE0-4724-A350-C89B5FA8EC30' )
        BEGIN
            SET @decDsFee = ROUND((@mjtmp * 10 * 12), 2);
        END;



        RETURN 4;

    END;
END;
--“物业费”计算完毕                                            



--北京保利海德公园代收费用计算结束                                










--北京公司代收费用计算完毕              

--粤东公司代收费用计算（排除红珊瑚项目和东江首府项目）                                                  
IF (
(
    @buguid IN ( '248B1E17-AACB-E511-80B8-E41F13C51836', '527D47F3-7479-44FB-A7B2-3B7B8F526FFD' )
    AND
    (
        @projGUID <> '608aecb8-a499-4bc8-bbb5-27610c9e1b94'
        AND @projGUID <> '1A2E2609-3A04-4C5D-997F-A5E8BFC00A07'
    )
)
   )
BEGIN

    --根据不同的代收费用分别进行计算                                      

    --1:物业维修基金                                                  
    --   计算公式：                                                
    --   物业维修基金 建筑面积*105，结果四舍五入。             
    IF @chvItemName = '物业维修基金'
       OR @chvItemName = '维修基金'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @moneymjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @moneymjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
        END;

        --开始计算                

        BEGIN
            SET @decDsFee = ROUND(@moneymjtmp * 105, 2);
        END;
        RETURN 4;

    END;
    --2:维修基金                                 
    --   计算公式：                                                
    --   洋房维修基金 建筑面积*105，结果四舍五入；                                                
    --   高级住宅维修基金 建筑面积*77，结果四舍五入；                                                
    --   商铺维修基金 建筑面积*105，结果四舍五入。                                                      

    IF (
           @chvItemName = '维修基金'
           AND @projGUID = '1A2E2609-3A04-4C5D-997F-A5E8BFC00A07'
       )
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @moneymjtmp = BldArea,
                   @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = SUBSTRING(BldFullName, CHARINDEX('-', BldFullName) + 1, 4)
            FROM p_Building,
                 p_room
            WHERE p_Building.BldGUID = p_room.BldGUID
                  AND p_room.RoomGUID = @chvRoomGUID;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @moneymjtmp = BldArea,
                   @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = SUBSTRING(BldFullName, CHARINDEX('-', BldFullName) + 1, 4)
            FROM p_Building,
                 p_room
            WHERE p_Building.BldGUID = p_room.BldGUID
                  AND p_room.RoomGUID = @chvRoomGUID;
        END;

        IF CHARINDEX('洋房', @cplx) > 0
        BEGIN
            SET @cplx = '洋房';
        END;
        IF CHARINDEX('高级住宅', @cplx) > 0
        BEGIN
            SET @cplx = '高级住宅';
        END;
        IF CHARINDEX('商铺', @cplx) > 0
        BEGIN
            SET @cplx = '商铺';
        END;
        IF CHARINDEX('写字楼', @cplx) > 0
        BEGIN
            SET @cplx = '写字楼';
        END;

        --开始计算                           
        IF @cplx = '洋房'
        BEGIN
            SET @decDsFee = ROUND(@moneymjtmp * 105, 2);
        END;
        IF @cplx = '高级住宅'
        BEGIN
            SET @decDsFee = ROUND(@moneymjtmp * 77, 2);
        END;
        IF @cplx = '商铺'
        BEGIN
            SET @decDsFee = ROUND(@moneymjtmp * 105, 2);
        END;
        IF @cplx = '写字楼'
        BEGIN
            SET @decDsFee = ROUND(@moneymjtmp * 105, 2);
        END;
    END;


END;
--物业维修基金计算完毕                                                  
--粤东公司代收费用计算完毕                                                  

--琶洲公司代收费用计算                                                  
IF ((@buguid = 'B35CDDA9-43AC-40AE-8E1B-2711B960BF39'))
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1:维修基金                                                  
    --   计算公式：建筑面积*105，结果四舍五入；                                                  
    IF @chvItemName = '物业维修基金'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @moneymjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @moneymjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
        END;

        --开始计算                                                  

        BEGIN
            SET @decDsFee = CAST(@moneymjtmp * 105 AS DECIMAL(10, 2));
        END;

        RETURN 4;
    END;
    --维修基金计算完毕                                                  

    --4:预告登记费                                                  
    --   计算公式：如是商业住宅（商铺、车位、写字楼）550，如不是则个人50，单位80                                                  
    IF @chvItemName = '预告登记费'
    BEGIN
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算                                                  


        IF (@cplx = '商业' OR @cplx = '写字楼' OR @cplx = '车位' OR @cplx = '公寓')
            SET @decDsFee = 550;
        ELSE IF @ge = '个人'
            SET @decDsFee = 50;
        ELSE IF @ge = '公司'
            SET @decDsFee = 80;

        RETURN 4;
    END;
    --预告登记费计算完毕                                                  

    --3:产权登记费                                                  
    --   计算公式：如是商业住宅（商铺、车位、写字楼）550，如不是则个人50，单位80,每多1个人名，多收10块工本费。                                                  
    IF @chvItemName = '产权登记费'
    BEGIN
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算                             


        IF (@cplx = '商业' OR @cplx = '写字楼' OR @cplx = '车位' OR @cplx = '公寓')
            SET @decDsFee = 550 + (10 * (@intCstCount - 1));
        ELSE IF @ge = '个人'
            SET @decDsFee = 80 + (10 * (@intCstCount - 1));
        ELSE IF @ge = '公司'
            SET @decDsFee = 80 + (10 * (@intCstCount - 1));

        RETURN 5;
    END;
    --产权登记费计算结束                                                  

    --印花税计算开始                           

    --2、印花税                                                  
    --   --计算公式：①按业态进行区分，普通住宅不需要收取                                                  
    --       ②如购买高级住宅、商铺、写字楼、车位等，收取万分之五                                                  
    --                                                  
    IF @chvItemName = '印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
        --                                                     
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
        END;

        ---开始计算“印花税”                                                  


        IF (@cplx <> '住宅')
        BEGIN
            SET @decDsFee = CEILING(CAST(@decTmp AS INT) * 0.0005);
        END;

        RETURN 1;

    END;
    --印花税计算结束                                                  

    --权证印花税                                                  
    --计算公式：一次性付款按人头5块钱一本。按揭按人头5块钱一本，外加5块（他项权证）                                                 
    IF @chvItemName = '权证印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @fkfs = PayformName
            FROM s_Order
            WHERE s_Order.OrderGUID = @chvSaleGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @fkfs = PayformName
            FROM s_Contract
            WHERE s_Contract.ContractGUID = @chvSaleGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;
        END;

        --开始计算权证印花税                                                  
        IF @fkfs NOT LIKE '%按揭%'
        BEGIN
            SET @decDsFee = 5 * @intCstCount;
        END;
        IF @fkfs LIKE '%按揭%'
        BEGIN
            SET @decDsFee = 5 * @intCstCount + 5;
        END;
    END;
END;

--琶洲公司代收费用计算完毕                                                  

--合肥公司代收费用计算                                                  
IF ((@buguid = '455FC380-B609-4A5A-9AAC-EE0F84C7F1B8'))
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1:维修基金                                                  
    --   计算公式：多层：1%，小高层住宅、高层住宅：2%;                                                  
    IF @chvItemName = '维修基金'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = RmbCjTotal,
                   @chvRoomGUID = s_Order.RoomGUID,
                   @mjtmp = p_room.YsBldArea,
                   @cplx = p.BProductTypeName
            FROM s_Order
                 LEFT JOIN p_room ON s_Order.RoomGUID = p_room.RoomGUID
                 LEFT JOIN p_BuildProductType p ON p.BProductTypeCode = p_room.BProductTypeCode
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @productname = ProductName
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                        
        BEGIN
            SELECT @decTmp = RmbHtTotal + ISNULL(SjBcTotal, 0),
                   @chvRoomGUID = s_Contract.RoomGUID,
                   @mjtmp = p_room.BldArea,
                   @cplx = p.BProductTypeName
            FROM s_Contract
                 LEFT JOIN p_room ON s_Contract.RoomGUID = p_room.RoomGUID
                 LEFT JOIN p_BuildProductType p ON p.BProductTypeCode = p_room.BProductTypeCode
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @productname = ProductName
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;

        --开始计算                                                  
        IF @productname = '多层住宅'
        BEGIN
            SET @decDsFee = @mjtmp * 80;
        END;
        IF CHARINDEX('住宅', @cplx) > 0
        BEGIN
            SET @cplx = '住宅';
        END;
        IF CHARINDEX('商业', @cplx) > 0
        BEGIN
            SET @cplx = '商业';
        END;
        IF CHARINDEX('地下室/车库', @cplx) > 0
           OR CHARINDEX('其', @cplx) > 0
        BEGIN
            SET @cplx = '地下室/车库';
        END;

        IF @productname IN ( '小高层住宅', '高层住宅', '多层住宅', '写字楼' )
           OR @projGUID IN ( '68A463F4-C412-E711-80BA-E61F13C57837', 'a3a97b38-abce-e311-9927-e41f13c5183a',
                             '59655ce7-f85b-e411-9927-e41f13c5183a', '81669970-8ef4-e511-80b9-e41f13c51836 ',
                             '1edafed8-ba12-e711-80ba-e61f13c57837','5134C08C-29A1-E911-80B7-0A94EF7517DD',
							 '05215E36-758D-4C67-A025-19F5AA16251D','717C640B-E6A2-4187-A868-3544E8C1856D'
                           )
           OR @cplx = '住宅'
		   --and @projGUID not in ( '08A0AEDA-72A5-4AF0-A18D-91758A43BA81','67AFE510-2AA1-E911-80B7-0A94EF7517DD'
		   --                  ,'F430CB8C-EA5B-4013-BBC4-128A6944F25C','4A3D6D53-1D5B-42D2-867B-99ECE831AD61')
        BEGIN
            SET @decDsFee = @mjtmp * 110;
        END;
        IF (@productname IN ( '地上车位', '普通地下车位' )
           OR @cplx = '地下室/车库') 
		   --and @projGUID not in('5134C08C-29A1-E911-80B7-0A94EF7517DD')
        BEGIN
            SET @decDsFee = @mjtmp * 80;
        END;

        IF @cplx = '商业'
           AND @projGUID in( '3FFBBC63-B512-E711-80BA-E61F13C57837','1574CC64-F2B2-EB11-B398-F40270D39969','70B90EA8-DC9D-EC11-B39C-F40270D39969')
        BEGIN
            SET @decDsFee = @mjtmp * 80;
        END;
        IF @projGUID IN ( '2F7165EE-A3A3-E911-80B7-0A94EF7517DD',
		'08A0AEDA-72A5-4AF0-A18D-91758A43BA81','67AFE510-2AA1-E911-80B7-0A94EF7517DD'
		                     ,'F430CB8C-EA5B-4013-BBC4-128A6944F25C','4A3D6D53-1D5B-42D2-867B-99ECE831AD61' )
           AND @cplx IN ( '住宅', '商业' )
        BEGIN
            SET @decDsFee = @scmj * 110;
        END;
		 -- IF @projGUID IN ( '08A0AEDA-72A5-4AF0-A18D-91758A43BA81','67AFE510-2AA1-E911-80B7-0A94EF7517DD'
		 --                    ,'F430CB8C-EA5B-4013-BBC4-128A6944F25C','4A3D6D53-1D5B-42D2-867B-99ECE831AD61')
          
   --     BEGIN
   --         --SET @decDsFee = @scmj * 80;
			--SET @decDsFee = @scmj * 110;
   --     END;

 
        IF @projGUID IN ( '2F7165EE-A3A3-E911-80B7-0A94EF7517DD','c726c2bf-b812-e711-80ba-e61f13c57837' )
           AND @cplx = '地下室/车库'
        BEGIN
            SET @decDsFee = @scmj * 80;
        END;

        PRINT @cplx;
        PRINT @mjtmp;
        PRINT @decDsFee;
        RETURN 4;
    END;

    --维修基金计算完毕                                                  

    --4:契税                                                  
    --   计算公式：首套房，并且建筑面积在90平米以下为房款总额的1%，90平米以上，144平米以下的为房款总额的2%；非首套房或者144平米以上的为房屋总价的4%。                                
    --   2016年新公式：住宅首套房：建筑面积在90平米以下为房款总额的1%，90平米以上为房款总额的1.5%；二套房：建筑面积在90平米以下为房款总额的1%，90平米以上为房款总额的2%；                                
    --                 三套房及以上：房款总额的4%；  非住宅不变                                            
    IF @chvItemName = '契税'
    BEGIN

        --取价格                     
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @projGUID = ProjGUID,
                   @decTmp = RmbHtTotal + ISNULL(SjBcTotal, 0),
                   @mjtmp = BldArea,
                   @zynum = ZyNumber
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @VATRate = VATRate
            FROM s_VATSet
            WHERE ProjGUID = @projGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;

            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @bldguid = BldGUID
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;




            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;

        END;

        --开始计算                                                  
        IF (
               @cplx = '住宅'
               OR @cplx = '高级住宅'
           )
           AND @projGUID <> 'ca63d3b7-bc70-e511-a49f-e41f13c5183a'
        BEGIN

            IF (@zynum = 1)
            BEGIN
                IF @mjtmp <= 90
                BEGIN
                    SET @decDsFee = (@decTmp / (1 + @VATRate / 100)) * 0.01;
                END;
                IF @mjtmp > 90
                BEGIN
                    SET @decDsFee = (@decTmp / (1 + @VATRate / 100)) * 0.015;
                END;
            END;
            ELSE IF (@zynum = 2)
            BEGIN
                IF @mjtmp <= 90
                BEGIN
                    SET @decDsFee = (@decTmp / (1 + @VATRate / 100)) * 0.01;
                END;
                IF @mjtmp > 90
                BEGIN
                    SET @decDsFee = (@decTmp / (1 + @VATRate / 100)) * 0.02;
                END;
            END;
            ELSE
                SET @decDsFee = (@decTmp / (1 + @VATRate / 100)) * 0.04;


            RETURN 4;

        END;
        IF (
               @cplx = '商业'
               OR @cplx = '地下室/车库'
           )
           AND @projGUID not in ('ca63d3b7-bc70-e511-a49f-e41f13c5183a','4A3D6D53-1D5B-42D2-867B-99ECE831AD61','08A0AEDA-72A5-4AF0-A18D-91758A43BA81'
		   ,'67AFE510-2AA1-E911-80B7-0A94EF7517DD','F430CB8C-EA5B-4013-BBC4-128A6944F25C')
        BEGIN
            SET @decDsFee = (@decTmp / (1 + @VATRate / 100)) * 0.04;
        END;

        IF @projGUID IN ( 'd7ddd17e-b412-e711-80ba-e61f13c57837','1574CC64-F2B2-EB11-B398-F40270D39969' )
        BEGIN
            SET @decDsFee = (@decTmp) * 0.03;

        END;
        IF (@cplx = '地下室/车库')
           AND @projGUID IN ( '3ffbbc63-b512-e711-80ba-e61f13c57837', '82d4109f-b712-e711-80ba-e61f13c57837',
                              'bce2400e-b912-e711-80ba-e61f13c57837'
                            )
        BEGIN
            SET @decDsFee = (@decTmp / (1 + @VATRate / 100)) * 0.03;
        END;

        IF (
               @cplx = '商业'
               OR @cplx = '地下室/车库'
           )
           AND @projGUID = '2F7165EE-A3A3-E911-80B7-0A94EF7517DD'
        BEGIN
            SET @decDsFee = @decTmp / 1.09 * 0.03;--不含税合同价的3%
        END;
		IF (
               @cplx = '商业'
               OR @cplx = '地下室/车库'
           )
           AND @projGUID in( '4A3D6D53-1D5B-42D2-867B-99ECE831AD61','08A0AEDA-72A5-4AF0-A18D-91758A43BA81'
		   ,'67AFE510-2AA1-E911-80B7-0A94EF7517DD','F430CB8C-EA5B-4013-BBC4-128A6944F25C')
        BEGIN
            SET @decDsFee = @decTmp/1.09 * 0.03;
        END;
        IF (@cplx = '住宅')
           AND @projGUID = '2F7165EE-A3A3-E911-80B7-0A94EF7517DD'
        BEGIN
            SET @decDsFee = @decTmp * 1.09 * 0.015;
        END;
        IF @projGUID = 'ca63d3b7-bc70-e511-a49f-e41f13c5183a'
        BEGIN

            IF (@cplx = '住宅' OR @cplx = '高级住宅')

            --           and @bldguid in ('507B1F8F-9E6D-47DA-9E1B-060E9CAC6BBC','432A4F08-276C-4D53-B78F-8C77F563A7AD','E7C9AF25-E2B0-47E3-83EC-A0D72173F2ED','CA55F5FB-94F1-4D5C-8B01-264D7605BCE8','DCF5BDA2-11E6-40D9-B95A-CEA2BF248F66',    
            --'5326536E-D86D-4545-9C59-E2EAC54B4EC4','08544A41-B397-474F-AD03-3C0A0E55AF29','5031B89C-1E37-4983-BD52-BFFA2116D69D')      
            BEGIN


                IF (@zynum = 1)
                BEGIN
                    IF @mjtmp <= 90
                    BEGIN
                        SET @decDsFee = (@decTmp / (1 + 11 / 100)) * 0.01;
                    END;
                    IF @mjtmp > 90
                    BEGIN
                        SET @decDsFee = (@decTmp / (1 + 11 / 100)) * 0.015;
                    END;
                /*                                   
       if @mjtmp > 90 and @mjtmp <=144                                                  
          begin                                                  
          set @decDsFee = @decTmp*0.02                                                  
          end                                                  
       if @mjtmp > 144                                                  
           begin                                                 
          set @decDsFee = @decTmp*0.04                                                  
          end  */
                END;
                ELSE IF (@zynum = 2)
                BEGIN
                    IF @mjtmp <= 90
                    BEGIN
                        SET @decDsFee = (@decTmp / (1 + 11 / 100)) * 0.01;
                    END;
                    IF @mjtmp > 90
                    BEGIN
                        SET @decDsFee = (@decTmp / (1 + 11 / 100)) * 0.02;
                    END;
                END;
                ELSE
                    SET @decDsFee = (@decTmp / (1 + 11 / 100)) * 0.04;


                RETURN 4;
            END;
            IF (
                   @cplx = '商业'
                   OR @cplx = '地下室/车库'
               )
               AND @bldguid IN ( '507B1F8F-9E6D-47DA-9E1B-060E9CAC6BBC', '432A4F08-276C-4D53-B78F-8C77F563A7AD',
                                 'E7C9AF25-E2B0-47E3-83EC-A0D72173F2ED', 'CA55F5FB-94F1-4D5C-8B01-264D7605BCE8',
                                 'DCF5BDA2-11E6-40D9-B95A-CEA2BF248
  
F    
66', '5326536E-D86D-4545-9C59-E2EAC54B4EC4', '08544A41-B397-474F-AD03-3C0A0E55AF29',
                                 '5031B89C-1E37-4983-BD52-BFFA2116D69D'
                               )
            BEGIN
                SET @decDsFee = (@decTmp / (1 + 11 / 100)) * 0.04;
            END;







            IF (
                   @cplx = '住宅'
                   OR @cplx = '高级住宅'
               )
               AND @bldguid NOT IN ( '507B1F8F-9E6D-47DA-9E1B-060E9CAC6BBC', '432A4F08-276C-4D53-B78F-8C77F563A7AD',
                                     'E7C9AF25-E2B0-47E3-83EC-A0D72173F2ED', 'CA55F5FB-94F1-4D5C-8B01-264D7605BCE8',
                                     'DCF5BDA2-11E6-40D9-B95A-CEA2BF24
  
    
8F66', '5326536E-D86D-4545-9C59-E2EAC54B4EC4', '08544A41-B397-474F-AD03-3C0A0E55AF29',
                                     '5031B89C-1E37-4983-BD52-BFFA2116D69D'
                                   )
            BEGIN


                IF (@zynum = 1)
                BEGIN
                    IF @mjtmp <= 90
                    BEGIN
                        SET @decDsFee = (@decTmp / (1 + 5 / 100)) * 0.01;
                    END;
                    IF @mjtmp > 90
                    BEGIN
                        SET @decDsFee = (@decTmp / (1 + 5 / 100)) * 0.015;
                    END;
                /*                                   
       if @mjtmp > 90 and @mjtmp <=144                                                  
          begin                                                  
          set @decDsFee = @decTmp*0.02                                                  
          end                                                  
       if @mjtmp > 144                                                  
           begin                                                 
          set @decDsFee = @decTmp*0.04                                                  
          end  */
                END;
                ELSE IF (@zynum = 2)
                BEGIN
                    IF @mjtmp <= 90
                    BEGIN
                        SET @decDsFee = (@decTmp / (1 + 5 / 100)) * 0.01;
                    END;
                    IF @mjtmp > 90
                    BEGIN
                        SET @decDsFee = (@decTmp / (1 + 5 / 100)) * 0.02;
                    END;
                END;
                ELSE
                    SET @decDsFee = (@decTmp / (1 + 5 / 100)) * 0.04;


                RETURN 4;
            END;




        END;



    END;
    --契税计算完毕                                                  

    --3:产权证工本费                                                  
    --   计算公式：每本10元,每多1个人名多收10块工本费。                                                  
    IF @chvItemName = '产权证工本费'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;

        END;



        --开始计算 
       
        IF (@cplx = '商业' OR @cplx = '地下室/车库' OR @cplx = '写字楼')
        BEGIN
            SET @decDsFee = 550 + (10 * (@intCstCount - 1));
        END;
        IF (@cplx = '住宅' OR @cplx = '高级住宅')   or @projGUID IN ( '32bdcecd-8e10-ec11-b398-f40270d39969')
--		拾光花园-一期
--产权证工本费公式：工本费=80，两个人90以此类推
        BEGIN
            SET @decDsFee = 80 + (10 * (@intCstCount - 1));
        END;
        IF (@cplx = '地下室/车库')
           AND @projGUID IN ( 'd7ddd17e-b412-e711-80ba-e61f13c57837', '3ffbbc63-b512-e711-80ba-e61f13c57837',
                              '82d4109f-b712-e711-80ba-e61f13c57837', 'bce2400e-b912-e711-80ba-e61f13c57837','2F7165EE-A3A3-E911-80B7-0A94EF7517DD '
                            )
        BEGIN
            SET @decDsFee = 80 + (10 * (@intCstCount - 1));
        END;
		 IF (
               @cplx = '商业'
               --OR @cplx = '地下室/车库'
               OR @cplx = '写字楼'
               OR @cplx = '住宅'
           )
           AND @projGUID IN ( '2F7165EE-A3A3-E911-80B7-0A94EF7517DD' )
        BEGIN
            SET @decDsFee = 10 + (10 * (@intCstCount - 1));
        END;

        RETURN 5;
    END;
    --产权证工本费计算结束                             



    ----5:产权证工本费                                                  
    ----   计算公式：每本50元,每多1个人名多收10块工本费。                                                  
    --    If @chvItemName='产权证工本费'                                                  
    --       Begin                                                  

    --   If @chvSource = '定单'                                                  
    --          begin                                                  
    --  --来源为“定单”通过交易表获取                                                  
    --           Select @intCstCount = Count(*) From s_Order,s_Trade2Cst Where s_Order.TradeGUID = s_Trade2Cst.TradeGUID And s_Order.OrderGUID=@chvSaleGUID;                                                          
    --       end                                                  

    --   If @chvSource = '合同'                                                  
    --    --来源为“合同”通过合同表获取                                                  
    --    begin                                                         
    --            Select @intCstCount = Count(*) From s_Contract,s_Trade2Cst Where s_Contract.TradeGUID = s_Trade2Cst.TradeGUID And s_Contract.ContractGUID=@chvSaleGUID;                                                   
    --       end                                                  

    --     --开始计算                                           

    --  Set @decDsFee = 50 + (10 * (@intCstCount-1));                                                   

    --    return 5                                 
    --end                                                  
    ----房屋产权证工本费计算结束                                                  

    --产权证印花税计算开始               

    --2、产权证印花税                                                  
    --   --计算公式：住宅：每本5元,每多1个人名多收5块 ；非住宅=（成交价+补差款）*0.0005     保留两位小数点                                        

    --                                                  
    IF @chvItemName = '产权证印花税'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @decTmp = ISNULL(RmbCjTotal, 0),
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;
            SELECT @decTmp = RmbHtTotal + ISNULL(SjBcTotal, 0),
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
        END;

        ---开始计算“产权证印花税”                                                  

        --Set @decDsFee = 5 + (5 * (@intCstCount-1));                                   
        /*      if (@Cplx='住宅'and @mjtmp>144 )                                          
        begin                                           
  Set @decDsFee =5 + (5 * (@intCstCount-1))+cast(@decTmp*0.0005 as decimal(10,2));                                         
      end                               
        if (@Cplx='住宅'and @mjtmp<=144 )                                          
        begin                                           
  Set @decDsFee =5 + (5 * (@intCstCount-1));                                               
      end                                    
  if (@Cplx <>'住宅' )                                          
        begin                                           
  Set @decDsFee =5 + (5 * (@intCstCount-1))+cast(@decTmp*0.0005 as decimal(10,2));                                                   
      end   */
        IF (
               @cplx = '住宅'
               OR @cplx = '高级住宅'
               OR @cplx = '写字楼'
               OR @cplx = '地下室/车库'
           )
           AND @projGUID IN ( '2F7165EE-A3A3-E911-80B7-0A94EF7517DD',
		   '08A0AEDA-72A5-4AF0-A18D-91758A43BA81','67AFE510-2AA1-E911-80B7-0A94EF7517DD'
		                     ,'F430CB8C-EA5B-4013-BBC4-128A6944F25C','4A3D6D53-1D5B-42D2-867B-99ECE831AD61')
        BEGIN
            SET @decDsFee = @decTmp * 0.00025;
        END;
        IF (@cplx <> '住宅' AND @cplx <> '高级住宅')
        BEGIN
            SET @decDsFee = 5 + (5 * (@intCstCount - 1)) + CAST(@decTmp * 0.0005 AS DECIMAL(10, 2));
        END;
        IF (@cplx = '住宅' OR @cplx = '高级住宅')
        BEGIN
            SET @decDsFee = 5 + (5 * (@intCstCount - 1));
        END;

        IF @cplx = '写字楼'
        BEGIN

            SET @decDsFee = @decTmp * 0.0003;
        END;

        IF @cplx = '地下室/车库'
           AND @projGUID IN ( 'd7ddd17e-b412-e711-80ba-e61f13c57837', '3ffbbc63-b512-e711-80ba-e61f13c57837',
                              '82d4109f-b712-e711-80ba-e61f13c57837', 'bce2400e-b912-e711-80ba-e61f13c57837','2F7165EE-A3A3-E911-80B7-0A94EF7517DD'
                            )
        BEGIN

            SET @decDsFee = @decTmp * 0.00025;
        END;
        RETURN 1;

    END;
    --产权证印花税计算结束                                                  

    --借款合同印花税                                      --计算公式：办理按揭贷款时需缴纳。付款方式非按揭的不需要交纳                                                  
    IF @chvItemName = '借款合同印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @fkfs = PayformName,
                   @tradeGUID = TradeGUID
            FROM s_Order
            WHERE s_Order.OrderGUID = @chvSaleGUID;
            SELECT @decTmp = SUM(RmbAmount)
            FROM s_Fee
            WHERE TradeGUID = @tradeGUID
                  AND ItemType = '贷款类房款';
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @fkfs = PayformName,
                   @tradeGUID = TradeGUID
            FROM s_Contract
            WHERE s_Contract.ContractGUID = @chvSaleGUID;
            SELECT @decTmp = SUM(RmbAmount)
            FROM s_Fee
            WHERE TradeGUID = @tradeGUID
                  AND ItemType = '贷款类房款';
        END;

        --开始计算借款合同印花税                                                  
        IF @fkfs LIKE '%按揭%'
        BEGIN
            SET @decDsFee = @decTmp * 0.00005;
        END;

    END;
END;
--借款合同印花税计算结束                                               
--合肥公司代收费用计算完毕                                                  

--河南郑州公司代收费用计算                                                  
IF ((@buguid = 'EE94E591-2916-4400-AD9B-9073B36FCD03'))
BEGIN

    --根据不同的代收费用分别进行计算                                                  

    --1:维修基金                                                  
    --   计算公式：预售建筑面积;                                                  
    IF @chvItemName = '维修基金'
    BEGIN
        --取价格                    Set @decTmp = 0;                                                  

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @decTmp = CASE WHEN p_room.AreaStatus = '预售' THEN YsBldArea ELSE ScBldArea END,
                   @mjtmp = s_order.bldarea,
				   @floor = p_room.Floor
            FROM p_room
                 LEFT JOIN s_order ON p_room.roomguid = s_order.roomguid
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
				 
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @decTmp = RmbHtTotal,
                   @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @decTmp = CASE WHEN p_room.AreaStatus = '预售' THEN YsBldArea ELSE ScBldArea END,
                   @mjtmp = s_contract.bldarea,
				   @floor = p_room.Floor
            FROM p_room
                 LEFT JOIN s_contract ON p_room.roomguid = s_contract.roomguid
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

		





            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;
        --开始计算                             B0B41233-75F2-E511-80B9-E41F13C51836               
        BEGIN
            --IF(@projGUID in ('4f1e49d5-db69-48b6-a433-9805c44d7088','d85b3210-9a63-48c1-a866-37e20efa3104'))         


            IF (
                   @projGUID IN ( '12F64D0E-67FD-E511-80B9-E41F13C51836', 'B0B41233-75F2-E511-80B9-E41F13C51836' )
                   AND @cplx = '高级住宅'
               )
            BEGIN


                SET @decDsFee = CAST(CAST(@decTmp * 35 AS DECIMAL(19, 3)) AS INT);

            END;

			   IF (
                   @projGUID IN ( '5B1DE1D5-F5BB-4025-9E5B-4674DA5A6A8A', '6E6D4B9A-354A-EA11-80B8-0A94EF7517DD' )
                   AND @cplx != '商业'
               )

            BEGIN


                SET @decDsFee = CAST(CAST(@decTmp * 65 AS DECIMAL(19, 3)) AS INT);

            END;

			IF (
                   @projGUID IN ( '5B1DE1D5-F5BB-4025-9E5B-4674DA5A6A8A', '6E6D4B9A-354A-EA11-80B8-0A94EF7517DD' )
                   AND @cplx = '商业'
               )

            BEGIN


                SET @decDsFee = CAST(CAST(@decTmp * 35 AS DECIMAL(19, 3)) AS INT);

            END;

            --IF(@projGUID in ('4f1e49d5-db69-48b6-a433-9805c44d7088','d85b3210-9a63-48c1-a866-37e20efa3104'))                
            IF (
                   @projGUID IN ( --'5f4a536b-d813-e911-80bf-e61f13c57837' ,
                                    'EF568EC1-DB57-E711-80BA-E61F13C57837', '510F1F6E-2686-E711-80BA-E61F13C57837',
                                    '12F64D0E-67FD-E511-80B9-E41F13C51836', 'B0B41233-75F2-E511-80B9-E41F13C51836',
                                    '3afc6227-f9a6-47f0-829b-a8e9ae6c4b2f'
                                )
                   AND @cplx IN ( '住宅', '商业' )
               )
            BEGIN


                SET @decDsFee = CAST(CAST(@decTmp * 65 AS DECIMAL(19, 3)) AS INT);

            END;


            IF (@projGUID IN (   '2fdb9730-bdbd-e911-80b7-0a94ef7517dd',
                                 --'5f4a536b-d813-e911-80bf-e61f13c57837' ,
                                 '510F1F6E-2686-E711-80BA-E61F13C57837', '3afc6227-f9a6-47f0-829b-a8e9ae6c4b2f',
                                 '510f1f6e-2686-e711-80ba-e61f13c57837', 'd3574cf6-eb02-eb11-b398-f40270d39969',
                                 '5bfc8dca-7661-e711-80ba-e61f13c57837', 'b49aed64-7cd5-eb11-b398-f40270d39969',
                                 '554e0a45-c7c8-eb11-b398-f40270d39969', '12be9183-ef33-454e-9f21-cfbbc680fb30',
                                 '247B3425-5BF7-EC11-B39C-F40270D39969'
                             )
               ) --保利心语四期
            BEGIN


                SET @decDsFee = CAST(CAST(@decTmp * 65 AS DECIMAL(19, 3)) AS INT);

            END;

            IF (@projGUID IN (   '002a3504-2c0e-45f4-946e-08cf8d13403e', 'DACAE3D0-FCE5-E711-80BA-E61F13C57837',
                                                                         -- '023fc5d3-7adb-e811-80bf-e61f13c57837' ,
                                 '6f3cb9b0-5b61-e711-80ba-e61f13c57837',
                                 'D0751455-3E62-E711-80BA-E61F13C57837', ---海上五月花
                                 '3e8d76c3-c745-eb11-b398-f40270d39969', --和光屿湖二期-一0810
                                 'BB309743-836F-E811-80BF-E61F13C57837', '93EA7F67-836F-E811-80BF-E61F13C57837',
                                 '47FBAB91-836F-E811-80BF-E61F13C57837',
                                                                         --'74284e4f-7bdb-e811-80bf-e61f13c57837' ,
                                 '7d03f594-b05f-eb11-b398-f40270d39969', --同心路58号地
                                 '2df7f1ee-8e5b-ea11-80b8-0a94ef7517dd'
                             )
               )
            BEGIN


                SET @decDsFee = CAST(CAST(@decTmp * 65 AS DECIMAL(19, 3)) AS INT);
                PRINT @decDsFee;
            END;
			--新增杓袁7号地项目726
            IF (@projGUID IN ( '023fc5d3-7adb-e811-80bf-e61f13c57837', '74284e4f-7bdb-e811-80bf-e61f13c57837',
                               '5f4a536b-d813-e911-80bf-e61f13c57837','0e63e1ad-4703-4a95-b661-9e8e415e041f'
                             )
               )
            BEGIN


                SET @decDsFee = CAST(CAST(@mjtmp * 65 AS DECIMAL(19, 3)) AS INT);
                PRINT @decDsFee;
            END;

            IF @projGUID IN ( '4f1e49d5-db69-48b6-a433-9805c44d7088', '797e99ee-db3f-e411-9927-e41f13c5183a',
                              'd85b3210-9a63-48c1-a866-37e20efa3104', '93EA7F67-836F-E811-80BF-E61F13C57837',
                              '1db6aba6-c4b5-ea11-80b8-0a94ef7517dd','d3574cf6-eb02-eb11-b398-f40270d39969','3e8d76c3-c745-eb11-b398-f40270d39969'
                            )
               AND @cplx = '商业'
            BEGIN

                SET @decDsFee = CAST(CAST(@decTmp * 35 AS DECIMAL(19, 3)) AS INT);

            END;

------增加时光悦商业 117
          IF @projGUID IN ( '2fdb9730-bdbd-e911-80b7-0a94ef7517dd'
                            )
               AND @cplx = '商业'   AND @floor= 1
            BEGIN

                SET @decDsFee = CAST(CAST(@decTmp * 35 AS DECIMAL(19, 3)) AS INT);

            END;

			IF @projGUID IN ( '2fdb9730-bdbd-e911-80b7-0a94ef7517dd'
                            )
               AND @cplx = '商业'  AND @floor = 2
            BEGIN

                SET @decDsFee = CAST(CAST(@decTmp * 65 AS DECIMAL(19, 3)) AS INT);

            END;

            ---新增和光屿湖一期高级扩展330 
            ---新增 郑州市高新区文广二期66亩-二期高级扩展58   

            IF @projGUID IN ( '4f1e49d5-db69-48b6-a433-9805c44d7088', '797e99ee-db3f-e411-9927-e41f13c5183a',
                              'd85b3210-9a63-48c1-a866-37e20efa3104', '93EA7F67-836F-E811-80BF-E61F13C57837',
                              '1db6aba6-c4b5-ea11-80b8-0a94ef7517dd', '7c96aaf9-5913-4d8e-90c2-4b578edc2a2f',
                              '8e8fbbdc-14bc-ea11-80b8-0a94ef7517dd'
                            )
               AND @cplx <> '商业'
            BEGIN
                SET @decDsFee = CAST(CAST(@decTmp * 65 AS DECIMAL(19, 3)) AS INT);
            END;
        END;







    END;



    --维修基金计算完毕                                                  

    --1:产权登记费        
    --   计算公式：住宅60,每多1个人名，多收10块工本费。                                                  
    IF @chvItemName = '产权登记费'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        --开始计算                                              


        IF (@cplx = '住宅')
        BEGIN
            SET @decDsFee = 80;
        END;
        IF (@cplx = '商业')
        BEGIN
            SET @decDsFee = 550 + (10 * (@intCstCount - 1));

        END;

        IF (
               @projGUID IN ( '510F1F6E-2686-E711-80BA-E61F13C57837', '510f1f6e-2686-e711-80ba-e61f13c57837',
                              '7C96AAF9-5913-4D8E-90C2-4B578EDC2A2F'
                            )
               AND @cplx IN ( '公寓' )
           )
        BEGIN
            SET @decDsFee = 550;
        END;

        IF (@projGUID IN ( '023fc5d3-7adb-e811-80bf-e61f13c57837', 'DACAE3D0-FCE5-E711-80BA-E61F13C57837',
                           '74284e4f-7bdb-e811-80bf-e61f13c57837', 'b49aed64-7cd5-eb11-b398-f40270d39969',
                           'd3574cf6-eb02-eb11-b398-f40270d39969', '247B3425-5BF7-EC11-B39C-F40270D39969'
                         )
           )
        BEGIN
            SET @decDsFee = 80;
        END;

        IF (
               @projGUID IN ( 'ef568ec1-db57-e711-80ba-e61f13c57837', '510f1f6e-2686-e711-80ba-e61f13c57837',
                              '6E6D4B9A-354A-EA11-80B8-0A94EF7517DD', '5B1DE1D5-F5BB-4025-9E5B-4674DA5A6A8A','d3574cf6-eb02-eb11-b398-f40270d39969'
                            )
               AND @cplx = '商业'
           ) --保利心语二期、文化广场一期、保利天汇-一期、二期sy:550
        BEGIN
            SET @decDsFee = 550;
        END;

        IF (
               @projGUID IN ( '6E6D4B9A-354A-EA11-80B8-0A94EF7517DD', '5B1DE1D5-F5BB-4025-9E5B-4674DA5A6A8A' )
               AND @cplx = '住宅'
           ) ---保利天汇-一期、二期 zz:80
        BEGIN
            SET @decDsFee = 80;
        END;


    END;

END;

--产权登记费计算完毕                                                  
--郑州公司代收费用计算完毕                                                  


--湖南公司代收费用开始计算          加入上海公司                                        
IF (@buguid IN ( '4A1E877C-A0B2-476D-9F19-B5C426173C38', '4975B69C-9953-4DD0-A65E-9A36DB8C66DF' ))
BEGIN

    --根据不同的代收费用分别进行计算                                                  
    --1:产权登记费                                                  
    --   计算公式：如是非住宅550，住宅、车库、高级住宅80,每多1个人名，多收10块工本费。                                                  
    IF @chvItemName = '产权登记'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        --开始计算                                                  


        IF (@cplx = '住宅' OR @cplx = '地下室/车库' OR @cplx = '高级住宅')
            SET @decDsFee = 80 + (10 * (@intCstCount - 1));
        ELSE
            SET @decDsFee = 550 + (10 * (@intCstCount - 1));


        RETURN 5;
    END;

    --产权登记费计算完毕                                                  

    --1、契税                                                  
    --   计算公式：写字楼、144平米以上按总房款的4%收取，144平米以下按总房款的2%收取                                                  
    IF @chvItemName = '契税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0),
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取    
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0),
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0),
                   @mjtmp = BldArea,
                   @zynum = LEFT(ZyNumber, 1),
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;









            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“契税”                                                  

        IF @ge <> '个人'
        BEGIN
            SET @decDsFee = @decTmp * 0.04;
        END;

        IF @ge = '个人'
        BEGIN
            IF (@cplx = '商业' OR @cplx = '地下室/车库' OR @cplx = '公寓' OR @cplx = '写字楼')
            BEGIN
                SET @decDsFee = @decTmp * 0.04;
            END;
            IF (@cplx = '住宅' OR @cplx = '高级住宅')
            BEGIN
                IF @mjtmp < 144
                BEGIN
                    SET @decDsFee = @decTmp * 0.02;
                END;
                IF @mjtmp >= 144
                BEGIN
                    SET @decDsFee = @decTmp * 0.04;
                END;
            END;

            RETURN 1;
        END;

        IF (@projGUID IN ( '9a224325-c53f-4807-a056-b3629c2478cd', '5336f15d-75f7-e611-80ba-e61f13c57837' ))
        BEGIN
            IF @zynum = 1
            BEGIN
                SET @decDsFee = @decTmp * 0.015;

            END;
            IF @zynum = 2
            BEGIN
                SET @decDsFee = @decTmp * 0.02;

            END;
            IF @zynum = 3
            BEGIN
                SET @decDsFee = @decTmp * 0.04;

            END;

        END;

    END;

    ----契税计算结束；                                          

    --印花税开始计算                                          
    --1.印花税                                          
    --2.计算公式：总房款×0.5‰（以个人名义购房的暂不收取）                                          
    IF @chvItemName = '印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0),
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0),
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;









            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“印花税”                                                  

        IF @ge <> '个人'
        BEGIN
            SET @decDsFee = @decTmp * 0.0005;
        END;

        IF @ge = '个人'
        BEGIN

            SET @decDsFee = 0;
        END;
    END;
    ----印花税计算完毕                                          


    --印花票开始计算                                          
    --计算公式印花票:   5元/套  ,  有共有人的多5元/本.            

    IF @chvItemName = '印花票'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        --开始计算                                                 


        IF (@projGUID IN ( '87648daf-388e-4c39-8e62-edb742e64636' ))
        BEGIN
            SET @decDsFee = 5 + (5 * (@intCstCount - 1));

        END;
        RETURN 5;
    END;
    --印花票计算完毕                                          


    --   他项权利登记费 开始计算                                          
    --计算公式：住宅：80元/户；                                          

    IF @chvItemName = '他项权利登记费'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                     
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        --开始计算                               


        IF (@cplx = '住宅')
            SET @decDsFee = 80;



        RETURN 5;
    END;

    --他项权利登记费计算结束                                          



    --国有土地使用证登记费开始计算                                                  
    --1、国有土地使用证登记费                                                  
    --   计算公式：100平米以下按100元/户收取，100平米以上按120元/户收取，写字楼为140元/户                                                  
    IF @chvItemName = '国有土地使用证登记费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                         
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算“国有土地使用证登记费”                                                  

        IF (@cplx = '商业' OR @cplx = '公寓' OR @cplx = '写字楼')
        BEGIN
            SET @decDsFee = 140;
        END;

        IF (@cplx = '住宅' OR @cplx = '高级住宅')
        BEGIN
            IF @mjtmp < 100
            BEGIN
                SET @decDsFee = 100;
            END;
            IF @mjtmp >= 100
            BEGIN
                SET @decDsFee = 120;
            END;
        END;
        IF (@projGUID IN ( '87648daf-388e-4c39-8e62-edb742e64636' ))
        BEGIN
            IF @mjtmp < 100
            BEGIN
                SET @decDsFee = 38;
            END;
            IF @mjtmp >= 100
            BEGIN
                SET @decDsFee = 68;
            END;

        END;
        RETURN 1;

    END;

    --国有土地使用证登记费计算完毕                                                  

    --1:预告登记手续费                                                  
    --   计算公式：商铺、公寓、写字楼550，住宅、高级住宅80                                                  
    IF @chvItemName = '预告登记手续费'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

        END;

        --开始计算                                                  


        IF (@cplx = '住宅' OR @cplx = '高级住宅')
            SET @decDsFee = 80;
        ELSE
            SET @decDsFee = 550;


        RETURN 5;
    END;
    --预告登记手续费计算完毕     

    --维修基金                                                  
    --   计算公式：实测面积*80，结果四舍五入；                                          
    --保利香槟：实测面积*110                                                  
    IF @chvItemName = '维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                              
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                  
        IF ((@cplx = '住宅' OR @cplx = '公寓' OR @cplx = '写字楼' OR @cplx = '商业')and @projGUID not in('82080584-6A57-EA11-80B8-0A94EF7517DD','3DDFA6B9-F8ED-EB11-B398-F40270D39969','6032285D-E313-ED11-B39C-F40270D39969'))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 120, 2);
        END;
        IF (@cplx = '高级住宅'and @projGUID not in('82080584-6A57-EA11-80B8-0A94EF7517DD','3DDFA6B9-F8ED-EB11-B398-F40270D39969','6032285D-E313-ED11-B39C-F40270D39969'))
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 75, 2);
        END;
        IF (@cplx = '地下室/车库'and @projGUID not in('82080584-6A57-EA11-80B8-0A94EF7517DD','3DDFA6B9-F8ED-EB11-B398-F40270D39969','6032285D-E313-ED11-B39C-F40270D39969'))
        BEGIN
            SET @decDsFee = ROUND(@scmj * 80, 2);
        END;

        IF (@projGUID IN ( '87648daf-388e-4c39-8e62-edb742e64636' ) AND @cplx = '住宅')
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 93, 2);
        END;

		--美罗家园云澜名邸
		IF @projGUID IN ( '3DDFA6B9-F8ED-EB11-B398-F40270D39969' ) 
        BEGIN
            SET @decDsFee = ROUND(@scmj * 1295*0.03, 2);
        END;

		--		----加上保利叶都
		IF (
               @projGUID IN ( '82080584-6A57-EA11-80B8-0A94EF7517DD','A1CC14A0-AE87-4AB1-B987-14CAE829AC30')
           )
        BEGIN
            SET @decDsFee = ROUND(@scmj * 38.85, 2);
        END;

        IF (
               @projGUID IN ( '561fe847-437c-4356-b09b-3e1ae4c0f5ff' )
               AND @cplx = '高级住宅'
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 57, 2);
        END;
        IF (
               @projGUID IN ( '9a224325-c53f-4807-a056-b3629c2478cd', '5336f15d-75f7-e611-80ba-e61f13c57837' )
               AND @cplx = '高级住宅'
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 60, 2);
        END;
        IF (
               @projGUID IN ( '9a224325-c53f-4807-a056-b3629c2478cd', '5336f15d-75f7-e611-80ba-e61f13c57837' )
               AND @cplx = '住宅'
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 110, 2);
        END;
        IF (@projGUID IN ( '561fe847-437c-4356-b09b-3e1ae4c0f5ff' ) AND @cplx = '住宅')
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 110, 2);
        END;

		

		

        --云禧名邸     锦上名苑
		---云上名邸
        IF (@projGUID IN ( 'c363f672-a173-e811-80bf-e61f13c57837', '7ED555FD-9823-E911-80BF-E61F13C57837',
                           '80c30fac-75c4-e911-80b7-0a94ef7517dd'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@scmj * 38.85, 2);
        END;

		---保利海汇璟庭一期
        IF (@projGUID IN ( '6032285D-E313-ED11-B39C-F40270D39969'))
        BEGIN
            SET @decDsFee = ROUND(@scmj * 1295*0.03, 2);
        END;

		





        RETURN 6;
    END;
    --维修基金计算完毕 

    --代收维修基金计算                                                

    --保利国际中心：实测面积*38.85                                                
    IF @chvItemName = '代收维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                              
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @bldguid = p_room.Bldguid
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;


        IF (
               @projGUID IN ( '6d4e08b0-4557-e711-80ba-e61f13c57837')
               AND @bldguid IN ( '3DC7C0D6-E4E6-4B7D-B8E1-62B88598E117', '337E47E8-A6D0-4DC7-9595-49E92CD165A8')
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 38.85, 2);
        END;

		--美罗家园云澜名邸
		IF @projGUID IN ( '3DDFA6B9-F8ED-EB11-B398-F40270D39969') 
        BEGIN
            SET @decDsFee = ROUND(@scmj * 1295*0.03, 2);
        END;

		--都汇名邸 加上静悦名邸、新顾城和颂名邸
		IF @projGUID IN ('97246562-9346-eb11-b398-f40270d39969','a20a9dcb-89d9-eb11-b398-f40270d39969','7d8c415d-9948-ed11-b39d-f40270d39969') 
        BEGIN
            SET @decDsFee = ROUND(@scmj * 1295*0.03, 2);
        END;

		--保利都汇璟庭--一期 加上保利海汇璟庭--元江雅苑-一期,加上元江名邸
		 IF (@projGUID IN ( 'C024E8AB-917B-E911-80B7-0A94EF7517DD','efd4819b-c5ec-ea11-80b8-0a94ef7517dd','6032285d-e313-ed11-b39c-f40270d39969','25789fbe-922a-ed11-b39d-f40270d39969','a8f9d343-dc17-ed11-b39c-f40270d39969'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@scmj * 1295 * 0.03, 2);
        END;

		----加上保利叶都
		IF (
               @projGUID IN ( '82080584-6A57-EA11-80B8-0A94EF7517DD','5a6b9f52-4757-e711-80ba-e61f13c57837','64371d20-338d-eb11-b398-f40270d39969')
           )
        BEGIN
            SET @decDsFee = ROUND(@scmj * 38.85, 2);
        END;





        RETURN 6;
    END;
    --代收维修基金计算完毕 



    --抵押登记费                                                  
    --   计算公式：商铺、公寓：贷款金额*0.2%，写字楼为：贷款金额*0.3%，住宅、高级住宅80                                                  
    IF @chvItemName = '抵押登记费'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                               
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @fkfs = PayformName,
                   @tradeGUID = TradeGUID
            FROM s_Order
            WHERE s_Order.OrderGUID = @chvSaleGUID;
            SELECT @decTmp = SUM(RmbAmount)
            FROM s_Fee
            WHERE TradeGUID = @tradeGUID
                  AND ItemType = '贷款类房款';

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @fkfs = PayformName,
                   @tradeGUID = TradeGUID
            FROM s_Contract
            WHERE s_Contract.ContractGUID = @chvSaleGUID;
            SELECT @decTmp = SUM(RmbAmount)
            FROM s_Fee
            WHERE TradeGUID = @tradeGUID
                  AND ItemType = '贷款类房款';

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

        END;

        --开始计算                                                  
        IF (@projGUID IN ( '2614bcd1-ef08-4221-ac58-3245055a3440', '561fe847-437c-4356-b09b-3e1ae4c0f5ff' ))

        --if @fkfs like '%按揭%'                                                  
        BEGIN
            IF (@cplx = '住宅' OR @cplx = '高级住宅')
                SET @decDsFee = 80;
            IF (@cplx = '商业' OR @cplx = '公寓')
                SET @decDsFee = @decTmp * 0.002;
            IF (@cplx = '写字楼')
                SET @decDsFee = @decTmp * 0.003;
        END;
        ELSE
        BEGIN
            IF (@cplx = '住宅' OR @cplx = '高级住宅')
                SET @decDsFee = 80;
            IF (@cplx = '商业' OR @cplx = '公寓' OR @cplx = '写字楼')
                SET @decDsFee = 550;

        END;
        RETURN 5;
    END;
END;
---湖南代收费用结束                                         

--南昌公司代收费用开始计算                                                  
IF (@buguid = 'A8DF0CF2-6D79-4E44-B169-45784CE13437')
BEGIN

    --根据不同的代收费用分别进行计算                                                  
    --1:产权登记费                                                  
    --   计算公式：南昌半山项目：非住宅（商业、公寓、写字楼）：755+15/新增人，住宅（住宅、高级住宅）：185+15/新增人；其它项目：非住宅（商业、公寓、写字楼）：555+15/新增人，住宅（住宅、高级住宅）：85+15/新增人                                                  
    IF @chvItemName = '产权登记'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        --开始计算                                               
        IF (@projGUID = 'B21F77F6-618B-494C-BCEF-3A45C0B86E14')
        BEGIN
            IF (@cplx = '住宅' OR @cplx = '高级住宅')
            BEGIN
                SET @decDsFee = 185 + (15 * (@intCstCount - 1));
            END;
            IF (@cplx = '商业' OR @cplx = '公寓' OR @cplx = '写字楼')
            BEGIN
                SET @decDsFee = 755 + (15 * (@intCstCount - 1));
            END;
        END;
        ELSE
        BEGIN
            IF (@cplx = '住宅' OR @cplx = '高级住宅')
            BEGIN
                SET @decDsFee = 85 + (15 * (@intCstCount - 1));
            END;
            IF (@cplx = '商业' OR @cplx = '公寓' OR @cplx = '写字楼')
            BEGIN
                SET @decDsFee = 555 + (15 * (@intCstCount - 1));
            END;
        END;
        RETURN 5;
    END;

    --产权登记费计算完毕                                                  

    --产证代办                                                  
    --   计算公式：非住宅（商业、公寓、写字楼）：555+1.6元/平米*实测面积，住宅（住宅、高级住宅）：85+1.2元/平米*实测面积                                                  
    IF @chvItemName = '产证代办'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                             
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @mjtmp = p_room.BldArea
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;






            SELECT @fkfs = PayformName,
                   @tradeGUID = TradeGUID
            FROM s_Order
            WHERE s_Order.OrderGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @mjtmp = p_room.BldArea
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;











            SELECT @fkfs = PayformName,
                   @tradeGUID = TradeGUID
            FROM s_Contract
            WHERE s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

        END;

        --开始计算                                                  

        IF (@fkfs LIKE '%按揭%' OR @fkfs LIKE '%公积金%')
        BEGIN
            IF (@cplx = '住宅' OR @cplx = '高级住宅')
            BEGIN
                SET @decDsFee = 85 + @mjtmp * 1.2;
            END;
            IF (@cplx = '商业' OR @cplx = '公寓' OR @cplx = '写字楼')
            BEGIN
                SET @decDsFee = 555 + @mjtmp * 1.6;
            END;
        END;

        RETURN 5;
    END;
END;

--江苏公司代收费用开始计算                                                  
IF (@buguid = '8A08A706-0273-48BA-A1D4-6AB783024D42')
BEGIN
    --维修基金                                                  
    --   计算公式：实测面积*90，结果四舍五入；                                                  
    IF @chvItemName = '维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @bldguid = p_room.BldGUID
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;
        PRINT '22222';
        PRINT @projGUID;

        --开始计算 

        --南京江宁梅龙湖2016G05-一期实测*120
        IF (@projGUID IN ( 'faf6c8d6-9881-e711-80ba-e61f13c57837'--,'49B55998-1531-EA11-80B8-0A94EF7517DD'
		)
		)
        BEGIN
            SET @decDsFee = @scmj * 120;
            PRINT @scmj;
            PRINT @decDsFee;
        END;
        ----end

        IF (@projGUID IN ( '0f6d421d-2497-4a74-ac63-dbf67d360d52' ,'84316340-87dd-eb11-b398-f40270d39969'))
        BEGIN
            SET @decDsFee = @scmj * 80;
        END;
        IF (@projGUID NOT IN ( '0f6d421d-2497-4a74-ac63-dbf67d360d52', 'BF2CFEB1-8094-E711-80BA-E61F13C57837',
                               'f240ffe8-a459-e711-80ba-e61f13c57837', '0b60dbe7-1fae-e711-80ba-e61f13c57837',
                               '3c908de0-0d5a-e711-80ba-e61f13c57837', 'faf6c8d6-9881-e711-80ba-e61f13c57837',
                               '196ea48b-8059-e711-80ba-e61f13c57837', ---云禧花苑
							   '49B55998-1531-EA11-80B8-0A94EF7517DD','84316340-87dd-eb11-b398-f40270d39969',
							   'EAACF463-C9DC-EC11-B39C-F40270D39969','85C3BDA7-8306-ED11-B39C-F40270D39969'
                             )
           )
        BEGIN
            SET @decDsFee = ROUND(@scmj * 90, 0);
        END;


        IF (@projGUID IN ( 'BF2CFEB1-8094-E711-80BA-E61F13C57837', '0b60dbe7-1fae-e711-80ba-e61f13c57837',
                           '3c908de0-0d5a-e711-80ba-e61f13c57837', '06b9e94f-fd91-e711-80ba-e61f13c57837'
                         )
           )
        BEGIN

            PRINT '0000';

            SET @decDsFee = @scmj * 120;
            PRINT @scmj;
            PRINT @decDsFee;
        END;
        ----天悦花园 非车位
        IF @projGUID IN ( 'f240ffe8-a459-e711-80ba-e61f13c57837' )
           AND @cplx <> '地下室/车库'
        BEGIN

            PRINT '00001';

            SET @decDsFee = @scmj * 120;
            PRINT @scmj;
            PRINT @decDsFee;
        END;
        ----天悦花园 非车位
        IF @projGUID IN ( 'f240ffe8-a459-e711-80ba-e61f13c57837' )
           AND @cplx = '地下室/车库'
        BEGIN

            PRINT '00002';

            SET @decDsFee = @scmj * 75;
            PRINT @scmj;
            PRINT @decDsFee;
        END;

		----南京 琥珀云台  南京 萃云台 住宅
        IF @projGUID IN ( 'EAACF463-C9DC-EC11-B39C-F40270D39969','85C3BDA7-8306-ED11-B39C-F40270D39969' )
           AND @cplx = '住宅'
        BEGIN
            SET @decDsFee = floor(@scmj * 120);
        END;
        ----南京 琥珀云台  南京 萃云台 商业车位
        IF @projGUID IN ( 'EAACF463-C9DC-EC11-B39C-F40270D39969','85C3BDA7-8306-ED11-B39C-F40270D39969' )
           AND @cplx in ('地下室/车库','商业')
        BEGIN
            SET @decDsFee = floor(@scmj * 75);
        END;

		----新增南京保利江汇一期929
		IF @projGUID IN ( '49b55998-1531-ea11-80b8-0a94ef7517dd' ,'1590b64a-1178-eb11-b398-f40270d39969')
        BEGIN
            IF @cplx = '商业'
            BEGIN
                SET @decDsFee = FLOOR(@scmj * 120);

            END;

            IF @cplx = '住宅'
            BEGIN
                SET @decDsFee = FLOOR(@scmj * 120);

            END;

			IF @cplx = '车位'
            BEGIN
                SET @decDsFee = FLOOR(@scmj * 75);

            END;
			
        END;




        --观棠和府 住宅
		--南京.长江时代G16
		--增加阅云台雅居328
		--南京.云锦四季24612
		---云辰原麓苑830
        IF  ( @projGUID IN ( '55F710EF-6A9D-E911-80B7-0A94EF7517DD','c9ea8b41-8c13-eb11-b398-f40270d39969','a46b4386-be27-eb11-b398-f40270d39969','767c3156-da28-ec11-b398-f40270d39969',
		'50667a76-d6d0-eb11-b398-f40270d39969','21907a8e-d6d0-eb11-b398-f40270d39969','44e3bcc6-d7d0-eb11-b398-f40270d39969','4ECEE86F-C9DC-EC11-B39C-F40270D39969')
           AND @cplx LIKE '%住宅%'  )  or (@projGUID IN ( '55F710EF-6A9D-E911-80B7-0A94EF7517DD') and @cplx LIKE '%住宅%' )
        BEGIN
            SET @decDsFee = FLOOR(@scmj * 120);
			END;

			IF  ( @projGUID IN ( '55F710EF-6A9D-E911-80B7-0A94EF7517DD')
           AND @cplx LIKE '%商业%'  )  
        BEGIN
            SET @decDsFee = FLOOR(@scmj * 75);
			 END;

			IF  ( @projGUID IN ( '767c3156-da28-ec11-b398-f40270d39969','4ECEE86F-C9DC-EC11-B39C-F40270D39969')
           AND @cplx LIKE '%商业%'  )  
        BEGIN
            SET @decDsFee = FLOOR(@scmj * 120);



        END;
		--增加阅云台雅居328
		---云辰原麓苑830
		 IF @projGUID IN ( '767c3156-da28-ec11-b398-f40270d39969' ,'50667a76-d6d0-eb11-b398-f40270d39969','21907a8e-d6d0-eb11-b398-f40270d39969','44e3bcc6-d7d0-eb11-b398-f40270d39969','4ECEE86F-C9DC-EC11-B39C-F40270D39969')
           AND  @cplx LIKE '%地下室/车库%' or ( @cplx LIKE '%商业%' and @projGUID not IN ( '55F710EF-6A9D-E911-80B7-0A94EF7517DD','767c3156-da28-ec11-b398-f40270d39969','4ECEE86F-C9DC-EC11-B39C-F40270D39969'))
        BEGIN
            SET @decDsFee = FLOOR(@scmj * 75);
        END;

		--增加南京燕璟和颂
		IF @projGUID IN ( '5E44AEDA-4706-ED11-B39C-F40270D39969')
        BEGIN
            IF @cplx  in('商业','车位')
            BEGIN
                SET @decDsFee = CAST(@scmj * 75 AS INT);
				 
            END;

            IF @cplx = '住宅'
            BEGIN
                SET @decDsFee = CAST(@scmj * 120 AS INT);

            END;
 END;

        IF (@projGUID IN ( '196ea48b-8059-e711-80ba-e61f13c57837','c9ea8b41-8c13-eb11-b398-f40270d39969' )) ---云禧花苑
        BEGIN
            IF @bldguid IN ( ---1-4 8-15 75
                               'A8F5DF94-F3DD-4BE9-872C-D6F328ADF5F9', '7B128500-F6B5-47EF-B19E-109E5F816033',
                               'F8C3ACDA-AD16-479D-9E01-950227E02864', '2B870897-2F92-45D5-9839-6341FBC63C6E',
                               '90DAD367-69C4-49DE-9AD5-368EB46FBDCD', '6CB2AA20-B8BF-4B96-842E-A176C2E1AF33',
                               'FB2A8427-3A5C-44DC-A4FD-6B8E691ED841', '6A1284B2-A00A-42A4-AB04-DC8CA48F7352',
                               'A81F6647-2071-4744-A31E-920CDECC0577', '9597E136-78D1-4885-A64C-CB30C017450F',
                               'F7904D11-2D4B-4E4E-8025-86E466FE5331', '70613B32-8EA6-4C03-8E9E-422B991326BE',
--南京.长江时代G16
							   'D163E7A9-BE64-462C-9D69-2354F377082C','A6651269-F59D-4FEC-9654-37FFE0EC757C','42C345AE-1E83-4319-A4CC-5FEC8FC093A2'
                           )
            BEGIN
                PRINT '0004';
                SET @decDsFee = FLOOR(@scmj * 75);
                PRINT @scmj;
                PRINT @decDsFee;
            END;
            IF @bldguid IN ( ---5、6、7、16、17、18、19、20、21、22、23、24、30维修基金=实测面积*120
                               '741319AC-9AC3-E811-80BF-E61F13C57837', 'D76ADE80-3AA8-4A71-ADEC-AD12D6F320E8',
                               '1028BC56-F1BD-4B91-8A4F-12207B68B70F', '9DB7A97A-FA57-4537-BA8C-0FF334AD0220',
                               '00B67CAF-A270-4032-A381-C17B0D37C32C', '5CB5937D-CC6D-4CF0-ACE0-9E3D6C70B917',
                               '5F71DDB8-C48B-4783-87D3-118ABCFF8539', 'C9B82B6E-C23E-4721-ADDE-E1649F6A3D36',
                               'F11C5B1A-B97C-4DAE-BE9E-5F8FEA6E8FBB', 'ACA7D9F4-54DC-48B5-B585-87544232815D',
                               '8F83CD70-813B-4C4F-8F00-E30500AC3F80', 'DA94B7F0-04DA-4116-8983-18475EA98191',
                               'C7EFB78F-B8B4-4A70-AFE4-E41B413D9B2F'
                           )
            BEGIN
                PRINT '0001';
                SET @decDsFee = FLOOR(@scmj * 120);
                PRINT @scmj;
                PRINT @decDsFee;
            END;
        END;

        --if (@gd>=@scmj*90)                                                  
        --begin                                                   
        --set @decDsFee=@gd                                                  
        --end                                                  
        --if(@gd<@scmj*90)                                                  
        --begin                                                   
        --set @decDsFee=@gd+1                                                  
        --end 
        PRINT '江苏公司结果输出';
        PRINT @decDsFee;
        RETURN 6;

    END;
--维修基金计算完毕                         
END;



--淮海公司代收费用开始计算                                                  
IF (@buguid = '4674A41A-81C3-4A20-8B5C-E52319022195' or @buguid = '8A08A706-0273-48BA-A1D4-6AB783024D42' )
BEGIN
    --维修基金                                                  
    --   计算公式：实测面积*80，结果四舍五入；                                                  
    IF @chvItemName = '维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @bldguid = p_room.BldGUID
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;
        PRINT '淮海';
        PRINT @projGUID;

        --开始计算 

        IF (@projGUID IN ( 'c5fa20ec-063e-e711-80ba-e61f13c57837', 'aace3ba2-063e-e711-80ba-e61f13c57837',
                           '3e1d9325-6a91-e711-80ba-e61f13c57837'
                         )
           )
        BEGIN
            SET @decDsFee = @mjtmp * 80;
        END;

        IF (@projGUID IN ( '7eb0820a-c2ff-eb11-b398-f40270d39969', 'F4CEBE40-C2FF-EB11-B398-F40270D39969',
                           'F4CEBE40-C2FF-EB11-B398-F40270D39969'
                         )
           )
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 90, 2);
        END;
		   IF (@projGUID IN ('e2ea9a15-2926-ea11-80b8-0a94ef7517dd'
                         )
           )
        BEGIN
            SET @decDsFee = @mjtmp * 80;
        END;



        PRINT '淮海公司结果输出';
        PRINT @decDsFee;
        RETURN 7;

    END;
--维修基金计算完毕                         
END;


--天津公司代收费用开始计算                                                  
IF (@buguid = '08087BE4-1C8D-4440-8A12-70C9B24AE211')
BEGIN
    --维修基金                                                  
    --   计算公式：预售面积*100，结果四舍五入；                                                  
    IF @chvItemName = '维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                            
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  
        IF (@chvProjName LIKE '%大都会%')
        BEGIN

            SET @decDsFee = @mjtmp * 100;

        END;
        PRINT '天津公司结果输出';
        PRINT @decDsFee;
        RETURN 6;
    END;
    --维修基金计算完毕                                   





    -----------------契税开始计算                                

    IF @chvItemName = '契税'
    BEGIN

        --取价格                                                                                  
        SET @decTmp = 0;
        --取面积                                                                                  
        SET @mjtmp = 0;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                                        
        BEGIN
            SELECT @projGUID = ProjGUID,
                   @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0),
                   @mjtmp = BldArea,
                   @zynum = LEFT(ZyNumber, 1)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                    




        BEGIN

            IF @projGUID NOT IN ( '34C74147-3857-E711-80BA-E61F13C57837', 'c9673acb-a67e-425b-b5ab-19d3e83f6fea' )
            BEGIN
                IF (@zynum = 1 AND (@cplx = '住宅' OR @cplx = '高级住宅'))
                BEGIN
                    IF @mjtmp <= 90
                    BEGIN

                        SET @decDsFee = ROUND(@decTmp / (1 + 0.05) * 0.01, 2);

                    END;
                    IF @mjtmp > 90
                       AND @mjtmp <= 144
                    BEGIN
                        SET @decDsFee = ROUND(@decTmp / (1 + 0.05) * 0.015, 2);
                    END;
                    IF @mjtmp > 144
                    BEGIN
                        SET @decDsFee = ROUND(@decTmp / (1 + 0.05) * 0.015, 2);
                    END;
                END;
                IF (@zynum = 2 AND (@cplx = '住宅' OR @cplx = '高级住宅'))
                BEGIN
                    IF @mjtmp <= 90
                    BEGIN
                        SET @decDsFee = ROUND(@decTmp / (1 + 0.05) * 0.01, 2);
                    END;
                    IF @mjtmp > 90
                       AND @mjtmp <= 144
                    BEGIN
                        SET @decDsFee = ROUND(@decTmp / (1 + 0.05) * 0.02, 2);
                    END;
                    IF @mjtmp > 144
                    BEGIN
                        SET @decDsFee = ROUND(@decTmp / (1 + 0.05) * 0.02, 2);
                    END;
                END;

                IF (@zynum > 2 OR @cplx = '商业' OR @cplx = '公寓' OR @cplx = '写字楼')
                BEGIN
                    SET @decDsFee = ROUND(@decTmp / (1 + 0.05) * 0.03, 2);

                END;



            END;

            IF @projGUID IN ( '2B046BDD-3957-E711-80BA-E61F13C57837', '34C74147-3857-E711-80BA-E61F13C57837',
                              '3aba19d6-c5aa-4b09-b008-d11dd11dabdf', '1ad94981-bec9-e311-9927-e41f13c5183a',
                              'c9673acb-a67e-425b-b5ab-19d3e83f6fea'
                            )
            BEGIN
                IF (@zynum = 1 AND (@cplx = '住宅' OR @cplx = '高级住宅'))
                BEGIN
                    IF @mjtmp <= 90
                    BEGIN

                        SET @decDsFee = ROUND(@decTmp / (1 + 0.1) * 0.01, 2);

                    END;
                    IF @mjtmp > 90
                       AND @mjtmp <= 144
                    BEGIN
                        SET @decDsFee = ROUND(@decTmp / (1 + 0.1) * 0.015, 2);
                    END;
                    IF @mjtmp > 144
                    BEGIN
                        SET @decDsFee = ROUND(@decTmp / (1 + 0.1) * 0.015, 2);
                    END;
                END;
                IF (@zynum = 2 AND (@cplx = '住宅' OR @cplx = '高级住宅'))
                BEGIN
                    IF @mjtmp <= 90
                    BEGIN
                        SET @decDsFee = ROUND(@decTmp / (1 + 0.1) * 0.01, 2);
                    END;
                    IF @mjtmp > 90
                       AND @mjtmp <= 144
                    BEGIN
                        SET @decDsFee = ROUND(@decTmp / (1 + 0.1) * 0.02, 2);
                    END;
                    IF @mjtmp > 144
                    BEGIN
                        SET @decDsFee = ROUND(@decTmp / (1 + 0.1) * 0.02, 2);
                    END;
                END;

                IF (@zynum > 2 OR @cplx = '商业' OR @cplx = '公寓' OR @cplx = '写字楼')
                BEGIN
                    SET @decDsFee = ROUND(@decTmp / (1 + 0.1) * 0.03, 2);

                END;



            END;

        END;


    END;


--契税计算完毕                                 

END;
--天津公司代收费用计算结束    



--厦门公司代收费用开始计算                                                  
IF (@buguid = '863D7F7C-53B4-4AFA-9A6F-BEA44BFB8598')
BEGIN

    --制证费计算开始:产权证上名字仅1人免征，每增加1人20元                                                  

    IF @chvItemName = '产权证工本费'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            --厦门 和院项目新增产权证工本费待售费用 
            SELECT @PayFormType = s_PayForm.PayFormType
            FROM s_Order,
                 s_PayForm
            WHERE s_Order.PayformName = s_PayForm.PayformName
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;
            --厦门 和院项目新增产权证工本费待售费用                                                  
            SELECT @PayFormType = s_PayForm.PayFormType
            FROM s_Contract,
                 s_PayForm
            WHERE s_Contract.PayformName = s_PayForm.PayformName
                  AND s_Contract.ContractGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        --    --开始计算   原来的                                               

        --begin                                                  
        -- set @decDsFee =10 * (@intCstCount-1);                                                  
        --end                                                  

        --开始计算       修改后                                           

        BEGIN
            IF @projGUID = '9d1effe4-5eae-e711-80ba-e61f13c57837'
            BEGIN
                IF @PayFormType = '一次性付款'
                   OR @PayFormType = '分期付款'
                BEGIN
                    SET @decDsFee = 80;
                --print 55  
                END;
                IF @PayFormType = '组合贷款'
                   OR @PayFormType = '按揭贷款'
                   OR @PayFormType = '公积金贷款'
                    PRINT 20;
                BEGIN
                    SET @decDsFee = 160;
                    PRINT 56;
                END;
            END;
			BEGIN
				IF @projGUID = '0D4054D1-F9E2-EB11-B398-F40270D39969'
				BEGIN
					IF @cplx = '商业'
					BEGIN
						SET @decDsFee = 550;
					END;
					IF @cplx = '住宅'
					OR @cplx = '高级住宅'
					OR @cplx = '地下室/车库'
					BEGIN
						SET @decDsFee = 80;
					END;
				END;
			END;
            ----长泰保利大国璟-一期 产权工本费
            IF @projGUID = '3B1FFC80-0A59-E811-80BB-E61F13C57837'
            BEGIN
                IF @cplx = '住宅'
                   OR @cplx = '高级住宅'
                   OR @cplx = '车位'
                BEGIN
                    IF @PayFormType = '一次性付款'
                       OR @PayFormType = '分期付款'
                    BEGIN
                        SET @decDsFee = 80;
                        PRINT 80;
                    END;
                    IF @PayFormType = '组合贷款'
                       OR @PayFormType = '按揭贷款'
                       OR @PayFormType = '公积金贷款'
                    BEGIN
                        SET @decDsFee = 160;
                        PRINT 160;
                    END;
                END;
                IF @cplx = '商业'
                BEGIN
                    IF @PayFormType = '一次性付款'
                       OR @PayFormType = '分期付款'
                    BEGIN
                        SET @decDsFee = 550;
                        PRINT 550;
                    END;
                    IF @PayFormType = '组合贷款'
                       OR @PayFormType = '按揭贷款'
                       OR @PayFormType = '公积金贷款'
                    BEGIN
                        SET @decDsFee = 1100;
                        PRINT 1100;
                    END;
                END;
            END;
            IF @projGUID <> '9d1effe4-5eae-e711-80ba-e61f13c57837'
               AND @projGUID <> '3B1FFC80-0A59-E811-80BB-E61F13C57837'
			   AND @projGUID <> '0D4054D1-F9E2-EB11-B398-F40270D39969'
            BEGIN
                SET @decDsFee = 10 * (@intCstCount - 1);
            --print  50  
            END;
        END;

        RETURN 5;
    END;
    --制证费计算结束                                                  

    --产权证印花税计算开始：每人一本，每本5元                                                  

    IF @chvItemName = '产权证印花税'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        --开始计算                                                
        BEGIN
            SET @decDsFee = 5 * @intCstCount;
        END;

        RETURN 6;



    END;
    --产权证印花税计算结束                                           

    --3:契税:厦门公司海上五月花-一期代收费用                                          
    --   计算公式：                                                                      
    --   1、家庭唯一住宅且面积<90平，契税=补差后总房款*1%；                                                                       
    --   2、家庭唯一住宅且面积为90-144平，契税=补差后总房款*1.5%；                                                           
    --   3、二套及二套以上或面积＞144平或单套总价＞180万，契税=补差后总房款*3%                                                                         
    IF @chvItemName = '契税'
    BEGIN

        --取价格                                                                                  
        SET @decTmp = 0;
        --取面积                                                                                  
        SET @mjtmp = 0;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                                   
        BEGIN
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0),
                   @mjtmp = BldArea,
                   @zynum = LEFT(ZyNumber, 1)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
        END;

        --开始计算                                                    
        --if ( @zynum=1 and @projGUID in ('9FC0778D-2BBD-471F-9CA3-4E522CFDB3CD') and  (@cplx = '住宅' or @cplx = '高级住宅'))                                    

        --    begin                                                                                  
        --      if @mjtmp <= 90                                                                                   
        --         begin                                                                                   
        --         set @decDsFee = @decTmp*0.01                                                                                  
        --         end                                                                                  
        --      if @mjtmp > 90 and @mjtmp <=144                                                                                  
        --         begin                                                                                  
        --         set @decDsFee = @decTmp*0.015                                                        
        --         end                                                                                  
        --      if @mjtmp > 144                                                                                  
        --          begin                                                                                  
        --         set @decDsFee = @decTmp*0.03                                                                                 
        --        end 

        --    end                                                                                 
        --       else                                                                                   
        --   set @decDsFee = @decTmp*0.03  

        --903保利利城二期


        --开始计算                                                    
        IF (@projGUID IN ( '9FC0778D-2BBD-471F-9CA3-4E522CFDB3CD', '2c515da8-2857-e711-80ba-e61f13c57837','0D4054D1-F9E2-EB11-B398-F40270D39969' )
           --and  (@cplx = '住宅' or @cplx = '高级住宅')
           )
        BEGIN
            IF @mjtmp <= 90
               AND @zynum = 1
               AND @projGUID IN ( '9FC0778D-2BBD-471F-9CA3-4E522CFDB3CD' )
            BEGIN
                SET @decDsFee = @decTmp * 0.01;
            END;
            IF @mjtmp > 90
               AND @mjtmp <= 144
               AND @zynum = 1
               AND @projGUID IN ( '9FC0778D-2BBD-471F-9CA3-4E522CFDB3CD' )
            BEGIN
                SET @decDsFee = @decTmp * 0.015;
            END;
            IF @mjtmp > 144
               AND @zynum = 1
               AND @projGUID IN ( '9FC0778D-2BBD-471F-9CA3-4E522CFDB3CD' )
            BEGIN
                SET @decDsFee = @decTmp * 0.03;
            END;
            IF @mjtmp <= 90
               AND @projGUID IN ( '2c515da8-2857-e711-80ba-e61f13c57837' )
            BEGIN
                SET @decDsFee = @decTmp * 0.01;
            END;
            IF @mjtmp > 90
               AND @zynum = 1
               AND @projGUID IN ( '2c515da8-2857-e711-80ba-e61f13c57837' )
            BEGIN
                SET @decDsFee = @decTmp * 0.015;
            END;
            IF @mjtmp > 90
               AND @zynum = 2
               AND @projGUID IN ( '2c515da8-2857-e711-80ba-e61f13c57837' )
            BEGIN
                SET @decDsFee = @decTmp * 0.02;
            END;   
			IF @projGUID IN ( '0D4054D1-F9E2-EB11-B398-F40270D39969' )
               --AND @cplx = '车位'
			BEGIN
               SET @decDsFee = ceiling(@decTmp / 1.09 * 0.03);
            END;
        END;
		ELSE
            SET @decDsFee = @decTmp * 0.03;



    END;
    --契税计算完毕                                          

    --计算房屋土地登记费                                          
    IF @chvItemName = '房屋和土地登记费'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                         
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        --开始计算                                            
        IF (@cplx = '住宅' OR @cplx = '高级住宅' OR @cplx = '地下室/车库')
        BEGIN

            SET @decDsFee = 180;
        END;
        IF (@cplx = '商业' OR @cplx = '写字楼')
        BEGIN

            SET @decDsFee = 1250;
        END;

        RETURN 7;

    END;


    --房屋土地登记费计算完毕 



    ---产权登记费                                          
    --计算方式：不管任何付款方式都要收，住宅820，非住宅（商业、车位）550..                                          

    IF @chvItemName = '产权登记'
    BEGIN
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;
        --开始计算   
        ---泉州保利城-二期  住宅：80，非住宅：550                                             
        IF (@cplx = '住宅' OR @cplx = '地下室/车库')
        BEGIN
            SET @decDsFee = 80;
        END;
        ELSE
        BEGIN
            SET @decDsFee = 550;
        END;
    END;
    ---计算结束





    --厦门晋江    

    IF @chvItemName = '维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            --Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID                                                          
            SELECT @bldguid = BldGUID,
                   @cplx = p_room.ProductName,
                   @unit = Unit,
                   @fanghao = Room
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF @cplx LIKE '%高层住宅%'
            BEGIN
                SET @decDsFee = @mjtmp * 80;
            END;
            IF @cplx LIKE '%高级住宅%'
            BEGIN
                SET @decDsFee = @mjtmp * 100;
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            --Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID;  
            SELECT @bldguid = BldGUID,
                   @cplx = p_room.ProductName,
                   @mjtmp = BldArea,
                   @unit = Unit,
                   @fanghao = Room
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;



            PRINT '77777';
            PRINT @projGUID;

            --海西保利城一期车位
            IF @bldguid IN ( '23C3BB1E-8E8D-4CC3-BD87-2CF90AF0246A' ,
			'138B6991-26CC-491F-9771-C0D66BE51F35','87DD0A74-DB3F-4CBB-8C5F-5692BE6DAF76')
			--泉州保利天汇-一期车位
            BEGIN
                SET @decDsFee = @mjtmp * 60;

            END;

			--云上
				IF @projGUID IN ( '420E1911-4E4B-EB11-B398-F40270D39969' )
                   AND @bldguid IN ( '959BB6C4-578E-4B2A-80AE-CBFC6E5EE8C0','06124E92-9C90-455B-BE39-D0AC83E2EFFB','238E2BA5-3152-4923-BBF0-2D343996803B','D12690A8-54A3-44A1-B806-184BC7E95395'
				   ,'8732465D-D6AD-4266-AE00-BC0B013FD22D','E1E3BE5E-94E4-40AE-AD21-32C3C67739E0','A2A94B25-8088-486E-BE24-60D411368DC5','9FE4829C-49D7-427F-B155-2629309E2F33')
                BEGIN
				print 12332123
                    SET @decDsFee = @mjtmp * 100;
					print @decDsfee
                END;

				IF @projGUID IN ( '420E1911-4E4B-EB11-B398-F40270D39969' )
                   AND @bldguid IN ( '26DB816C-0ECB-4C1C-8CD8-D5447A9A5E19','76160428-40E4-4180-9B25-AB67BFD22569','B6EFC545-2879-4CD0-845B-15DAD729374F','9DC562F3-8771-4306-A01B-D45189DBEFBA' )
                BEGIN
                    SET @decDsFee = @mjtmp * 80;
                END;

				IF @projGUID IN ( '420E1911-4E4B-EB11-B398-F40270D39969' )
                   AND @bldguid IN ( '98CC3AF9-D382-4EFE-8F56-A6BD892E59D9','58B9E6CF-983E-4E47-A379-D1F1E7FB55A3' )
                BEGIN
                    SET @decDsFee = @mjtmp * 70;
					print @decDsFee
                END;

				IF @projGUID IN ( '420E1911-4E4B-EB11-B398-F40270D39969' )
                   AND @bldguid IN ( '03401248-5C7E-49E4-B9E5-3F240A5AC088','CA9895AC-1EE2-4576-82E1-88EC93F84ED0' )
                BEGIN
                    SET @decDsFee = @mjtmp * 60;
					print @decDsFee
                END;


			--锦上
				IF @projGUID IN ( 'E6BC02BC-4BF7-EC11-B39C-F40270D39969' )
                   AND @bldguid IN ('FD3761EE-0775-48BC-B0C1-B7797F0661EB','E0B94473-E871-4166-B6C4-864830651342','2AF4A39A-CB82-454F-8A89-356094121B2B','BD291F52-36FE-4692-B337-73DEDF02216D')
                BEGIN
                    SET @decDsFee = @mjtmp * 100;
					print @decDsfee
                END;

				IF @projGUID IN ( 'E6BC02BC-4BF7-EC11-B39C-F40270D39969' )
                   AND @bldguid IN ('943BD2C8-55B9-43F4-8E47-6577D7B4EBDB','45B56D24-3684-42C7-95B5-E5AD8D2F51BB','24BFC7DE-D391-46B2-B022-3B2A8CE5CC6F',
				   '20DDD545-F54D-4448-85B3-95EE70FF7AD6','0D5EE66E-24A7-473B-A874-418D9AD05AE6')
                BEGIN
                    SET @decDsFee = @mjtmp * 80;
                END;

				IF @projGUID IN ( 'E6BC02BC-4BF7-EC11-B39C-F40270D39969' )
                   AND @bldguid IN ('5058F8E5-9391-4445-9E42-B75629A46C4E')
                BEGIN
                    SET @decDsFee = @mjtmp * 70;
					print @decDsFee
                END;

				IF @projGUID IN ( 'E6BC02BC-4BF7-EC11-B39C-F40270D39969' )
                   AND @bldguid IN ( '1D6562B6-8C2D-430A-B9FF-31B87DB0B5ED' )
                BEGIN
                    SET @decDsFee = @mjtmp * 60;
					print @decDsFee
                END;


            -----	



            IF @projGUID IN ( 'd174203e-2957-e711-80ba-e61f13c57837', '888b31da-2957-e711-80ba-e61f13c57837',
                              'dc48fc72-4c53-ec11-b398-f40270d39969'
                            )
            BEGIN
                IF @cplx NOT LIKE '%车%'
                   AND @projGUID NOT IN ( 'dc48fc72-4c53-ec11-b398-f40270d39969','420e1911-4e4b-eb11-b398-f40270d39969' )
                    SET @decDsFee = @mjtmp * 80;
                IF @cplx NOT LIKE '%车%'
                   AND @projGUID IN ( 'dc48fc72-4c53-ec11-b398-f40270d39969' )
                    SET @decDsFee = @mjtmp * 60;
                IF @cplx LIKE '%车%'
                    SET @decDsFee = @mjtmp * 40;
                --南安保利香槟公馆一期售楼处商铺
                IF @bldguid IN ( '6441a772-afd6-e811-80bf-e61f13c57837' )
                    SET @decDsFee = @mjtmp * 40;

            END;
            --泉州朗阅公馆一期
            --IF   @projGUID  IN ('dc48fc72-4c53-ec11-b398-f40270d39969') 
            --                                   BEGIN
            --                                    IF @cplx NOT LIKE '%车%' SET @decDsFee = @mjtmp * 60;
            --                                    IF @cplx LIKE '%车%' SET @decDsFee = @mjtmp * 40;

            --                                END;



            --源昌丰盛家园一期
            IF @bldguid IN ( '53A8AAE1-5848-477F-89F2-F89A3037EF10', '16268FBA-3D84-4380-8A0C-479494B528E3',
                             'A8A33115-FFDD-42A7-B83D-1EF5FCC1CC91', 'F6C2813F-2A06-4C2F-B9DD-BA144C8CD005',
                             'FEBBA594-1E92-40CA-A1E7-35C262F74D06', '7DBE207A-15BB-4B41-B185-EB3D6A4ED9D3'
                           )
            BEGIN
                SET @decDsFee = @mjtmp * 80;

            END;

            IF @bldguid IN ( 'E54A35FC-BEC4-419F-8AB4-CD1FA19329DB', '475DEF28-AB02-4A4A-80AB-25F416FD8D77',
                             'CB9C5945-A41A-4E4B-AC11-FD3BAF677026', '1CE5EFAD-251F-4620-978F-BE4AA5DA3B21',
                             'AB7BF678-29DB-46CB-A302-CDA14E011763', 'BD01DE60-7D27-4C08-BB81-F6552AB07453'
                           )
            BEGIN
                SET @decDsFee = @mjtmp * 60;

            END;

            -----	

            IF @projGUID IN ( '4634310b-84d1-ea11-80b8-0a94ef7517dd','b803bd21-f20f-e911-80bf-e61f13c57837' )
               AND @bldguid NOT IN ( '53A8AAE1-5848-477F-89F2-F89A3037EF10', '16268FBA-3D84-4380-8A0C-479494B528E3',
                                     'A8A33115-FFDD-42A7-B83D-1EF5FCC1CC91', 'F6C2813F-2A06-4C2F-B9DD-BA144C8CD005',
                                     'FEBBA594-1E92-40CA-A1E7-35C262F74D06', '7DBE207A-15BB-4B41-B185-EB3D6A4ED9D3',
                                     'E54A35FC-BEC4-419F-8AB4-CD1FA19329DB', '475DEF28-AB02-4A4A-80AB-25F416FD8D77',
                                     'CB9C5945-A41A-4E4B-AC11-FD3BAF677026', '1CE5EFAD-251F-4620-978F-BE4AA5DA3B21',
                                     'AB7BF678-29DB-46CB-A302-CDA14E011763', 'BD01DE60-7D27-4C08-BB81-F6552AB07453'
                                   )
            BEGIN
                IF @cplx NOT LIKE '%车%'
                    SET @decDsFee = @mjtmp * 80;
                IF @cplx LIKE '%车%'
                    SET @decDsFee = @mjtmp * 40;

            END;

            IF @projGUID IN ( 'DAB77776-2757-E711-80BA-E61F13C57837' )
               AND @bldguid IN ( 'B9711EE5-98BA-422D-8499-0E49F671EEB4' )
            BEGIN
                SET @decDsFee = @mjtmp * 80;

            END;

			--【泉州壹号公馆】代收费用新增公共维修基金15、16、17、18四栋住宅实测面积*100
			IF @projGUID IN ( 'E4D05786-682C-EA11-80B8-0A94EF7517DD' )
               AND @bldguid IN ( 'B9498331-B1B5-44EF-8E1A-E6C642251759','15A54ACE-1C1D-4BB7-B55A-DEA676BC827D',
			   'C4B9E4BF-C23D-48C7-A8CF-409D59F0CD68','5DCC4C19-9403-4CF8-AD9F-DE49ED875E98')
            BEGIN
                SET @decDsFee = @mjtmp * 100;
				print @decDsFee
            END;

			IF @projGUID IN ( 'E4D05786-682C-EA11-80B8-0A94EF7517DD' )
               AND @bldguid not IN ( 'B9498331-B1B5-44EF-8E1A-E6C642251759','15A54ACE-1C1D-4BB7-B55A-DEA676BC827D',
			   'C4B9E4BF-C23D-48C7-A8CF-409D59F0CD68','5DCC4C19-9403-4CF8-AD9F-DE49ED875E98')
            BEGIN
                SET @decDsFee = @mjtmp * 60;
				print @decDsFee
            END;




            IF @projGUID IN ( '2c515da8-2857-e711-80ba-e61f13c57837' )
                PRINT '5678';
            PRINT @bldguid;

            BEGIN

                IF @bldguid IN ( '1D138CF8-71F3-421A-AF0D-71E9DFE22078', '7B5084C7-C77F-4D65-B51D-A903907625F0',
                                 'FCE81C6F-3640-43A2-BCE9-85721D541E25', '85442B8D-4F99-4921-B5AB-68F967F169FC',
                                 'FE26F24A-CB3C-4670-A373-CADCE36E6A69', '14A84576-AB19-4335-AD5A-87C4A644B872',
                                 '928A904B-6FA0-4BD0-A985-184196372B7D', 'EF201A99-ECDB-4CF2-9BA2-354AFFEF506E',
                                 '95B1E18B-BA1B-4610-8F69-DEB636DBDF61', '24FD01CC-4090-44F8-A070-6220992C0AF4',
                                 '7EBEA7B3-BF1A-4DAA-AD62-F0D58925E768', '66CABE21-78F3-45B0-B41F-2B368E6BA32A',
                                 '3AAAA2C5-3BA5-42E6-911B-DE298537EF79', '5299255C-C539-49DD-A633-01978E279FAA',
                                 'C0EE8926-A582-47F2-AEDA-7D7366164CC7', '848F6811-3112-4202-80E4-923E29AF70FE',
                                 'A1E735CC-306F-4B25-9A1F-E1859532273B', 'B843B684-0770-4529-AACB-0D40B16BD804',
                                 'C57E619F-A14F-489D-84C5-0B345E6471DE', 'A933CE8C-ED36-4EC0-9029-1A386D1FCDA9',
                                 'D5BFAFFB-22EA-405F-9252-341FBE23B90A', '5BD23F17-4385-4010-A55C-E2A423738C39',
                                 'BEEED6E4-832C-4A49-8B17-CB5811BC8DFC'
                               )
                BEGIN
                    SET @decDsFee = @mjtmp * 80;
                END;



                IF @bldguid IN ( '51A33BC0-BD6D-4547-8E63-8B15A38D6960', '4A17AA3E-8D99-4087-872C-9469D5E66276',
                                 '9884BBCE-B4BE-4683-A6D6-50A07D16BB09', 'C31D6831-901E-423B-A851-F38B1E7E28AF',
                                 'D616077D-7D81-4949-B836-BDECD2ED619A', '035B061C-E033-44B3-8020-CB814DA5B941',
                                 '56FCA0B3-561D-4692-8B91-D044C6B564E0', 'F0BFA24C-8061-424C-B713-A9BDD7DCE16A'
                               )
                BEGIN
                    SET @decDsFee = @mjtmp * 60;
                END;



                IF @bldguid IN ( '8FF906E4-5D9C-4D39-A27A-4039D36B8BC9', 'EEB3545C-3520-4A87-8C3C-4FA344F35B1C' )
                BEGIN
                    SET @decDsFee = @mjtmp * 70;
                END;




                IF @bldguid IN ( 'E189165E-3ECD-E811-80BF-E61F13C57837', 'E289165E-3ECD-E811-80BF-E61F13C57837',
                                 'F0542E56-2E09-4FFA-92FB-C7AF3787EC46', 'EAB9C4AD-A9BC-46E4-AB25-2FD21D72762F',
                                 '50CA155C-3199-4168-A02F-DF4A52A59407', '2ABC9C26-8D8D-4703-8E42-11C7615411F1',
                                 '800AB248-2FCC-4554-B4D1-05C7E7D607F0', 'A0D05650-5C6A-41F6-94FD-4096579F94B7',
                                 '2DDA5931-C0AD-4DD4-B3DF-85CE28F313FF', '7181AC39-A544-4A30-8424-970CBDB1C6F5',
                                 'B78EE9CA-9E79-457B-8722-1A999B2D2375', '99044621-611E-4BD2-A33E-679DAF86F8BD',
                                 'F31EF5AE-58B8-4961-800E-0D1F22FCD92E', '48CFD6F4-4F18-4338-ACF8-A7D861BB59F1',
                                 '15B20333-CF34-4AF3-BA09-679F75B845A4', '8426D7C7-EA03-49CC-8A62-00E10F29E482',
                                 '626F78D6-332C-4561-B1B2-EC5BCC1AE079', 'D60CE58B-8CBA-4C7A-81B4-AB7F9443CA13',
                                 'E27AA1E9-8AC4-4063-B9C3-728B39A3FB09', 'A5939B84-4A7D-4C01-BF94-F98AA05CD3C6',
                                 '338D06E5-2D87-49A0-A492-F14A3AD2B115', 'CB9650D5-DF42-4CEF-8108-D187E59ED8E1',
                                 'D0645C6C-6BB5-404F-A4D2-513311B65D6F'
                               )
                BEGIN

                    SET @decDsFee = @mjtmp * 100;
                END;

            END;
            /*	begin 
		if @cplx  not  like '%车%'
		 Set @decDsFee = @mjtmp*80 
		if  @cplx    like '%车%'
		 set @decDsFee = @mjtmp*60 
		print @decDsFee
		end 
		
		*/

            IF @projGUID IN ( '762541d2-7589-e711-80ba-e61f13c57837' )  and @projGUID not  IN ('e4d05786-682c-ea11-80b8-0a94ef7517dd','420e1911-4e4b-eb11-b398-f40270d39969')
            BEGIN
                IF @bldguid IN ( '4F9E248E-FF9C-47A7-9D45-AED6515E7443' )
                BEGIN
                    SET @decDsFee = @mjtmp * 60;
					print @decDsFee
                END;
                IF @bldguid IN ( 'F5D11853-DD43-4B26-BECC-853C248B8524', '60FE968C-C717-4DEF-AC3D-F1E10E3C5A4D',
                                 '96CF62EC-D161-4C3D-9B04-96479BEF03C1', '14FEAA52-C86D-454F-A39C-94FB10F19FB0',
                                 '6AD7F871-0695-4639-AAAF-00282283572F', '189C511F-5BB1-441F-B5F3-0FD58ED4E608',
                                 '78503D7C-7B2A-40A9-81A9-C973CA1E9F1A', 'C345603D-B1B3-4E78-AD8D-BCBE150BBAF0',
                                 '4CA0AFF5-D0B6-41F2-A7F2-7D804AE22758', 'B1C73317-FDBA-45D8-BAC2-0974690D250E',
                                 'A9CD6BDC-B51F-4F21-996A-C3436E0D8D23', 'F5D11853-DD43-4B26-BECC-853C248B8524',
                                 '60FE968C-C717-4DEF-AC3D-F1E10E3C5A4D', '96CF62EC-D161-4C3D-9B04-96479BEF03C1',
                                 '14FEAA52-C86D-454F-A39C-94FB10F19FB0', '6AD7F871-0695-4639-AAAF-00282283572F',
                                 '189C511F-5BB1-441F-B5F3-0FD58ED4E608', '78503D7C-7B2A-40A9-81A9-C973CA1E9F1A'
                               )
                BEGIN
                    SET @decDsFee = @mjtmp * 80;

                END;
                PRINT @cplx;
                IF @cplx LIKE '%高级住宅%'
                BEGIN
                    SET @decDsFee = @mjtmp * 90;
                END;


                IF @cplx LIKE '%车%'
                BEGIN
                    SET @decDsFee = @mjtmp * 40;
                END;



                IF @bldguid IN ( 'B75D3375-DA03-420C-8653-1257170CFA04' )
                   AND @unit LIKE '%1%'
                BEGIN

                    SET @decDsFee = @mjtmp * 60;

                END;
                IF @bldguid IN ( 'B75D3375-DA03-420C-8653-1257170CFA04' )
                   AND @fanghao LIKE '%商铺%'
                BEGIN
                    SET @decDsFee = @mjtmp * 40;


                END;

                IF @bldguid IN ( 'B75D3375-DA03-420C-8653-1257170CFA04' )
                   AND @unit <> '1#'
                   AND @fanghao NOT LIKE '%商铺%'
                BEGIN
                    SET @decDsFee = @mjtmp * 80;


                END;

            END;




            IF @projGUID NOT IN ( '2c515da8-2857-e711-80ba-e61f13c57837', 'd174203e-2957-e711-80ba-e61f13c57837',
                                  '888b31da-2957-e711-80ba-e61f13c57837', '762541d2-7589-e711-80ba-e61f13c57837',
                                  '4634310b-84d1-ea11-80b8-0a94ef7517dd', 'dc48fc72-4c53-ec11-b398-f40270d39969'
                                ,'e4d05786-682c-ea11-80b8-0a94ef7517dd','420E1911-4E4B-EB11-B398-F40270D39969','B803BD21-F20F-E911-80BF-E61F13C57837','E6BC02BC-4BF7-EC11-B39C-F40270D39969')
            BEGIN
                BEGIN
                    SET @decDsFee = @mjtmp * 100;
                END;
                IF @cplx LIKE '%高级住宅%'
                BEGIN
                    SET @decDsFee = @mjtmp * 100;
                END;
                IF @cplx LIKE '%车%'
                   AND @projGUID NOT IN ( 'dab77776-2757-e711-80ba-e61f13c57837',
				   --泉州保利天汇-一期
				   '78cdcd69-d448-492e-8673-444a738cd178','420e1911-4e4b-eb11-b398-f40270d39969' )
                BEGIN
                    SET @decDsFee = @mjtmp * 40;
                END;
				 IF @cplx LIKE '%车%'
                   AND @projGUID  IN ( 
				   --泉州保利天汇-一期
				   '78cdcd69-d448-492e-8673-444a738cd178' )
                BEGIN
                    SET @decDsFee = @mjtmp * 60;
                END;
                IF @projGUID IN ( 'dab77776-2757-e711-80ba-e61f13c57837' )
                   AND @bldguid IN ( 'B9711EE5-98BA-422D-8499-0E49F671EEB4' )
                BEGIN
                    SET @decDsFee = @mjtmp * 80;
                END;
                --泉州朗阅公馆一期
                --IF   @projGUID  IN ('dc48fc72-4c53-ec11-b398-f40270d39969') AND  @cplx not LIKE '%车%' 
                --                                     BEGIN
                --                                                            SET @decDsFee = @mjtmp * 60;
                --                                        END;
                --	IF   @projGUID  IN ('dc48fc72-4c53-ec11-b398-f40270d39969') AND  @cplx  LIKE '%车%' 
                --                                     BEGIN
                --                                                            SET @decDsFee = @mjtmp * 40;
                --                                        END;





                IF @projGUID IN ( 'dab77776-2757-e711-80ba-e61f13c57837' )
                   AND @bldguid IN ( 'A802C549-4D8D-4DCB-9948-3E515CB39758' )
                   AND @unit = '4#'
                BEGIN
                    SET @decDsFee = @mjtmp * 80;
                END;

                IF @cplx LIKE '%车%'
                   AND @projGUID IN ( 'dab77776-2757-e711-80ba-e61f13c57837' )
                BEGIN
                    SET @decDsFee = @mjtmp * 60;
                END;
--泉州和光尘樾：1、住宅-1、2、3、5、6、7、8、9、10、11、12、15# 代收费用：维修基金=住宅实测面积*100（保留两位小数点，四舍五入）2、车位60元/个

				IF @projGUID IN ( 'd87d0db0-4bf7-ec11-b39c-f40270d39969' )
                   AND @bldguid IN ( '054EF361-2A7C-495D-96A5-E4E8C2EE1132','252566D1-D96B-4091-BBD9-97B6B9730CF7','3FC7724C-9108-4747-8168-D9F4A1B60E92',
'A0365E7C-658D-42F7-9CFE-9D6A0B4556C1','BB53E364-D1ED-4E32-843B-393EFCDEE241','E0C2E61B-90AB-40D0-B6AC-3C6BC027D567','00257EEC-9281-4548-AF0D-8D34913CB644',
'C6E8F0D8-AFE9-46A9-8C15-065DA53633A1','74D383CF-5408-41DF-AF8C-3134621EF245','BF1664B7-49E1-46E5-A76E-1573C8F9F982',
	'2AFCACA1-DA11-4076-82CD-F737FB198DEF','F7F669CB-5B49-4787-8CA7-3300EEBE89EE'			   )
				
                BEGIN
                    SET @decDsFee = @mjtmp * 100;
                END;

				IF @projGUID IN ( 'd87d0db0-4bf7-ec11-b39c-f40270d39969' )
				AND @bldguid IN ('83B434B4-F3DC-4639-B751-D491CF9311D9','8C175487-6D1C-4975-B383-9BEF64357C15')
				BEGIN
                    SET @decDsFee = @mjtmp * 60;
                END;

			--南安悦公馆
--住宅-18#、19#、20#、22#代收费用：维修基金=房间实测面积*60（保留两位小数点，四舍五入）
--住宅-17#、21#、23#代收费用：维修基金=房间实测面积*80（保留两位小数点，四舍五入）
				IF @projGUID IN ( '4A22626D-1F0A-EB11-B398-F40270D39969' )
                   AND @bldguid IN ( '57FDDDD0-9461-4F19-BB7D-10B97DBE55DE','9445F21D-6FCC-4758-AEAA-56C798CE2700','0A2B05E6-2CC2-45EB-8619-2AB6BA8DE9A7','24F3E3CF-6DF9-443A-9060-71980472EA64',
				   'A20B21D9-B204-4F14-A6DE-0A2D51EE6CE6','93EA92F5-9856-4EAB-BD4E-1055A82B1F5F','A4ED9296-45B9-49CC-BA65-FA34061DBDB2',
'D68FB342-8647-4FD9-8E36-A80DFB904E15','55051C70-877E-4171-BE71-EDE95DF9D2ED','A8CA7EE5-EEF5-421D-A337-5E1FD5ED176A',
'F2B40601-A8FE-4546-BF87-18350D681B19','FE21921A-C8D0-4C5A-B1A8-5298E9E3D623'
				   )
				
                BEGIN
                    SET @decDsFee = @mjtmp * 60;
                END;

				IF @projGUID IN ( '4A22626D-1F0A-EB11-B398-F40270D39969' )
                   AND @bldguid IN ( 'D8F206E1-2FD8-4F33-990D-72A97DEF8966','A9DE4E9C-2DB0-4715-A538-57F0D4773367','F0865DA0-99F7-4393-A8D1-C43B08ABE866',
				   'E22E8FE3-F6D0-4E8A-8939-D3F288CE00DE','16E1C68A-FFA3-49D2-BE44-D3B8CF8450F5','2505B7FB-C61B-4948-A96E-006F02F21CD2',
'9439E7D0-B51A-4A86-B96D-42734EBD9883','BEA691D4-81F1-475C-A5C8-3DF8D72E1F8B','C291774D-7D38-49A3-AF25-FCF2DD753CB1')
                BEGIN
                    SET @decDsFee = @mjtmp * 80;
                END;




				--中高层住宅：2、3、5、6、7、8、9、10、11# 代收费用：维修基金=住宅实测面积*70


IF @projGUID IN ('82080C2F-64E8-EB11-B398-F40270D39969' )
                   AND @bldguid IN ( '604DD246-1DAD-409C-A81B-65E98F507130','20A1E1FF-72DA-44B8-93AA-CB0A828FE7C9','B43B7CAA-3C11-4AFE-A8DA-DED2A18E1938','835F9DAC-6F43-43F9-B8C3-9535618A62C8',
				   'B9545D0D-F01E-4F53-8D03-3CA328CD55D2','E3463F45-8FE9-4D95-B418-F732518FFA26','CAC79CF0-691A-4C15-9D01-9B89D16888F8',
'C360E9AF-EEEA-436A-8EB6-E6312ABAC103','4086E4EB-B988-4F6E-BCD2-8DC0EC229E64'
				   )
				
                BEGIN
				 Select @mjtmp=cast(scbldarea as decimal(19,4)) from p_room where p_room.roomguid=@chvRoomGUID 
                    SET @decDsFee = @mjtmp *70 ;
                END;


				--合院住宅：12、13、15、16、17、18、19、20#代收费用：维修基金=住宅实测面积*60


IF @projGUID IN ('82080C2F-64E8-EB11-B398-F40270D39969' )
                   AND @bldguid IN ( '7D276D79-DB3E-499C-819D-6F26CF204730','D23D8EBB-4BDA-4300-B0E5-6B994EC0FA43',
				   'F8E3FB26-C6EF-4BF6-A8F5-4E274D24A032' ,'E86DC7EB-A5C1-4E39-9D60-A2C9B9667B65',
				   '717743D0-8D4C-46FD-AE58-C42C988A60EC', '04EEBD46-DF85-4366-AE1C-E301247200AA',
				   'AC7BCD00-926A-4FE3-921D-12F0694695CE' , '61BBC69F-AB27-4CD6-A694-6DA509FA52D8'
				   )
				
                BEGIN
				 Select @mjtmp=cast(scbldarea as decimal(19,4)) from p_room where p_room.roomguid=@chvRoomGUID 
                    SET @decDsFee = @mjtmp *60 ;
                END;
--车位代收费用：维修基金=车位实测面积*50


IF @projGUID IN ('82080C2F-64E8-EB11-B398-F40270D39969' )
                   AND @bldguid IN ( '24401EBC-00B4-4BFD-A259-620444D0E0F1'
				   )
				
                BEGIN
				 Select @mjtmp=cast(scbldarea as decimal(19,4)) from p_room where p_room.roomguid=@chvRoomGUID 
                    SET @decDsFee = @mjtmp *50 ;
                END;
				--泉州保利时光印象（三期）
				IF (@projGUID IN ('1427443d-a740-400e-8eaf-3013d2663def' )  and   @bldguid IN   
				('BC557B8E-B332-4EFA-981F-7AA758367F10','98BC2652-F501-4E78-A76B-D180B231229B','740B5D8C-C1E8-4A92-BDAB-B2A408EA5322',
'2B38C15A-B520-45C4-8D90-18B77C8A021E','8399918D-B7A2-4199-B967-89137CE19DE3','354D2556-6284-4CE1-A1B6-B4BE73EE3BCA',
'88C86B6E-355B-4F4F-9BD4-2AEE719A509A','2E084ADB-A9AC-42CD-A81A-0086F550C853','8878868C-64EB-4A49-ADD7-D9465C73E723')
          	)
                BEGIN
				 Select @mjtmp=cast(scbldarea as decimal(19,4)) from p_room where p_room.roomguid=@chvRoomGUID 
                    SET @decDsFee =ceiling ( @mjtmp *90 );
                END;


            END;
        END;

    END;



END;
--厦门公司代收费用计算结束                       



--  select * from mybusinessunit where buguid ='8412A5B2-0147-4AA3-813B-CC41D5D3D55B'                            


--漳州公司代收费用开始计算                                                  
IF (@buguid = '8412A5B2-0147-4AA3-813B-CC41D5D3D55B')
BEGIN


    ---维修基金 建筑面积 75元一平                                          
    --保利城 按购房合同上的预售建筑面积，6#、7#、8#、9#楼80元/㎡，其他楼栋90元/㎡。                                        

    IF @chvItemName = '维修基金'
    BEGIN

        IF @chvSource = '定单'
        BEGIN

            SELECT @mjtmp = BldArea,
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;



        END;

        IF @chvSource = '合同'
        BEGIN

            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0),
                   @mjtmp = BldArea,
                   @zynum = LEFT(ZyNumber, 1),
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;

            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;



        END;
        --开始计算     




        BEGIN
            IF @projGUID IN ( '3b1ffc80-0a59-e811-80bb-e61f13c57837', 'ae4b0f3b-c32d-4a40-bea0-3acb3e6af819',
                              '9d1effe4-5eae-e711-80ba-e61f13c57837'
                            )
                IF @bldguid IN ( 'C702475B-CA1A-4A21-A363-7043CA9FE6FF', '312E453F-DD84-E811-80BF-E61F13C57837',
                                 '322E453F-DD84-E811-80BF-E61F13C57837', '332E453F-DD84-E811-80BF-E61F13C57837',
                                 '342E453F-DD84-E811-80BF-E61F13C57837', '352E453F-DD84-E811-80BF-E61F13C57837',
                                 '362E453F-DD84-E811-80BF-E61F13C57837', '382E453F-DD84-E811-80BF-E61F13C57837',
                                 '392E453F-DD84-E811-80BF-E61F13C57837', '3A2E453F-DD84-E811-80BF-E61F13C57837',
                                 '3B2E453F-DD84-E811-80BF-E61F13C57837', '9A0687B8-7DD6-44EE-A67F-BEBEC248C59E',
                                 '0C7138B3-B9CC-429D-9024-360519A4670C', '66C33AAF-79F6-4CC7-BC80-41F7A35F90C3'
                               )
                BEGIN
                    SET @decDsFee = CEILING(@mjtmp * 60);
                END;

            IF @bldguid IN ( '22805686-07C7-4989-85CC-82F8E69A0646', '3109E37A-4E31-4A78-A78D-3E622726D6CC',
                             'EC84B073-B72A-4632-8212-1085D7934542', '37E72C4F-1B27-413B-8C26-CFB6C442C621',
                             'B1E0F09A-025A-43BE-88FE-9C0D444B73C8', '3B7AE396-DDFD-4371-8170-307ED0939811',
                             '81592CBA-0919-4EB0-9F7E-EEDE6F799B9A', '02F8B06F-CA2A-4CFE-86B0-97C82076FEA3',
                             '37E72C4F-1B27-413B-8C26-CFB6C442C621', '22805686-07C7-4989-85CC-82F8E69A0646',
                             '3109E37A-4E31-4A78-A78D-3E622726D6CC', 'EC84B073-B72A-4632-8212-1085D7934542'
                           )
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 37.5);
            END;


            IF @bldguid IN ( '3E2E453F-DD84-E811-80BF-E61F13C57837', '402E453F-DD84-E811-80BF-E61F13C57837',
                             '3D2E453F-DD84-E811-80BF-E61F13C57837', '3F2E453F-DD84-E811-80BF-E61F13C57837',
                             '3C2E453F-DD84-E811-80BF-E61F13C57837', '9D7C1CFA-65BB-4718-8715-7A65F61E27C4',
                             'CCA51A90-6508-4B71-BEF3-1CF3A94D0BFF', '34D2E7F8-3BE7-4438-9360-C1C7BA25C814',
                             '51196532-4C87-4CD7-B44D-4870734E16C0', 'BFF8D97E-711E-4161-8D12-72D8216A97B4',
                             'BF75082E-8916-4BC5-AF17-694D10D8E8DB', 'A461BC9F-377B-45BF-998B-65A544FE40C1',
                             'C90BA6DE-6062-4E7D-9F79-9B3C438F2331', 'B3CD1BA0-2CB7-4C78-B1C7-931D9384966F',
                             'CCA51A90-6508-4B71-BEF3-1CF3A94D0BFF', '34D2E7F8-3BE7-4438-9360-C1C7BA25C814',
                             '51196532-4C87-4CD7-B44D-4870734E16C0', 'BFF8D97E-711E-4161-8D12-72D8216A97B4',
                             'BF75082E-8916-4BC5-AF17-694D10D8E8DB', 'A461BC9F-377B-45BF-998B-65A544FE40C1',
                             'C90BA6DE-6062-4E7D-9F79-9B3C438F2331', 'B3CD1BA0-2CB7-4C78-B1C7-931D9384966F',
                             '05320E25-7745-48FB-9600-6AF17BDF9ABB', '462B276F-DAEE-4C29-86A6-E7F2C3244E52',
                             'A3F53F5C-571D-4CDE-A6E4-837CF92AEACB', '253CBAB9-AAEA-470D-ADB1-526F5618B652',
                             'B291EFF0-C87C-4E72-AE89-FEF462BEC941', '87589AEB-A6F9-4781-B61C-F4D67F311DE5',
                             'ED400228-9A03-4B1A-BC16-5AECACEE1FED', 'F938F741-86C0-4DDA-80B0-5469232DF891'
                           )
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 47.5);
            END;
        END;

    END;
    IF @chvItemName = '契税'
    BEGIN

        --取价格                                                                                  
        SET @decTmp = 0;
        --取面积                                                                                  
        SET @mjtmp = 0;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                                   
        BEGIN
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0) / 1.1,
                   @mjtmp = BldArea,
                   @zynum = LEFT(ZyNumber, 1)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
        END;

        --开始计算                                                    
        IF (@zynum = 1)
        BEGIN
            IF @mjtmp <= 90
            BEGIN
                SET @decDsFee = @decTmp * 0.01;
            END;
            IF @mjtmp > 90
               AND @mjtmp <= 144
            BEGIN
                SET @decDsFee = @decTmp * 0.015;
            END;

        END;
        IF (@zynum = 2)
        BEGIN
            IF @mjtmp <= 90
            BEGIN
                SET @decDsFee = @decTmp * 0.01;
            END;
            IF @mjtmp > 90
            BEGIN
                SET @decDsFee = @decTmp * 0.02;
            END;

        END;
        ELSE IF @zynum NOT IN ( '2', '1' )
        BEGIN
            SET @decDsFee = @decTmp * 0.03;
        END;


    END;
--契税计算完毕                                                                             

END;
--漳州公司代收费用计算结束                                                  





































--福建公司代收费用开始计算                                                  
IF (@buguid = '26AC8E14-EBAF-4557-8953-1293B058518B')
   OR @projGUID IN ( '9d1effe4-5eae-e711-80ba-e61f13c57837' )
BEGIN
    ---维修基金 建筑面积 75元一平                                          
    --保利城 按购房合同上的预售建筑面积，6#、7#、8#、9#楼80元/㎡，其他楼栋90元/㎡。
    ---保利城六期 9号楼设置成80  17号楼80                                      
    --保利城七期
    ---莆田香盛公馆 1#2#3#5#6#7#8#这七栋高层是90块钱每平方 剩余楼栋是65元每平方
    ---莆田保利紫荆公馆 全是80
    --莆田保利天汇全是90
	--莆田绶溪保利瑧悦-期全是90
    IF @chvItemName = '维修基金'
    BEGIN

        IF @chvSource = '定单'
        BEGIN

            SELECT @mjtmp = BldArea,
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;

            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @floor = MAX(FloorNo)
            FROM p_FloorPlan
            WHERE BldGUID = @bldguid;




            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;


        END;

        IF @chvSource = '合同'
        BEGIN

            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0),
                   @mjtmp = BldArea,
                   @zynum = LEFT(ZyNumber, 1),
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;

            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID
            FROM p_room
            WHERE RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @floor = MAX(FloorNo)
            FROM p_FloorPlan
            WHERE BldGUID = @bldguid;






            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;




        END;
        --开始计算
        ---莆田保利云上 26d3357e-2f9e-e911-80b7-0a94ef7517dd
        IF @bldguid IN ( '238CA499-726A-480E-9C19-E07C07DF60E4', '9B61D679-20F1-4B14-864C-6F0F047B57B5',
                         'CEE15B73-CE97-45B9-8640-962BC9F0E091', 'B46B1815-1663-47E1-A118-C8ADA27AEB13',
                         '57F276F3-FFB3-4757-A323-CB373E717AE7'
                       ) ---1 2 3 5 9 
        BEGIN
            SET @decDsFee = CEILING(@mjtmp * 80);
        END;

        IF @bldguid IN ( 'D9902189-60C1-49A6-BF24-DA91D6F796C6', '21B95E47-E487-4AE5-AFE3-EE5EEA7DF5B5',
                         '39FFDFD9-35EE-45F0-B404-D3E4FAF46233', '89CED238-C79B-4A20-B755-157E3454B6A3',
                         '909B7530-EED5-4C86-B587-CDAF906B6F62'
                       ) --678
           OR @projGUID IN ( '281f9fe6-e935-eb11-b398-f40270d39969' ) ---202161
        BEGIN
            SET @decDsFee = CEILING(@mjtmp * 90);
        END;

		--莆田绶溪保利瑧悦-一期 90    
            IF @projGUID IN ( '4B577B21-C065-EE11-B3A4-F40270D39969' )
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 90);
            END;

		--福建公司-2021-29号一期
		IF @projGUID IN('fd303be1-0a88-ee11-b3a4-f40270d39969')
           and @bldguid IN ( '2C9B0A30-7007-4CFA-943F-2D7D10FF3753','C4C4DDB0-8458-41E2-AD7E-CF5FE048157C','577B77DF-FA97-4ACA-96E9-99C68FBD6F46','3B519FBE-2338-4214-882F-E505B0043FF6','F701F334-09E8-4F63-9C5E-633626B1914A','4532BC2E-C4A4-483B-8026-D0D38549CAD6' )
        BEGIN
            SET @decDsFee = @mjtmp * 80;
        END;

		IF @projGUID IN ('fd303be1-0a88-ee11-b3a4-f40270d39969')
           and @bldguid IN ( '028A62A0-E1BF-478C-B8FA-16118A8B0B63','5BA6C812-905E-4C68-A8D9-01A2CCC98B1B','7822A2BC-DCE2-4394-B3EF-6D7356B0C394',
		   '39D43F0D-194E-4E69-A02F-093B1B6653E3','4AE8DDA5-E99A-4F5E-8EDF-CD72ED3E90A7','102CF866-C084-4E66-B349-62CF4E2B2291',
		   '8D6ACB9F-99A0-48D1-B49D-B01A9972C1DB','ECA94B95-3185-4258-93DF-6B3A1CAD7B9E','F5AFE935-0CFF-421C-A37B-B8F9B7E0A312','0475CD94-39C0-4A5D-94E5-56793F66D10E')
        BEGIN
            SET @decDsFee = @mjtmp * 90;
        END;

        IF @projGUID IN ( '77a721de-b988-e711-80ba-e61f13c57837', 'd47583cf-5057-e711-80ba-e61f13c57837' )
        BEGIN

            IF @cplx = '高级住宅'
            BEGIN

                SET @decDsFee = CEILING(@mjtmp * 65);

            END;

            IF @cplx = '地下室/车库'
               OR @cplx = '住宅'
            BEGIN

                SET @decDsFee = CEILING(@mjtmp * 90);
            END;

            IF @bldguid IN ( '6ACE3BA4-E777-43FE-9F5C-D819E30F533F', 'E13EBF2F-0574-4B08-A356-166ED024E8D8',
                             '0AB16275-4101-42E7-BC0C-8C8FDD849C58', '6529A686-BFD2-45D7-9466-DAA9DE485B4C'
                           )
            BEGIN

                SET @decDsFee = CEILING(@mjtmp * 90);
            END;

            IF @bldguid IN ( '461A007E-F887-4824-981B-9833926647CC', 'F0EC4441-5803-4AB7-B4FC-ACF19073F691' )
            BEGIN

                SET @decDsFee = CEILING(@mjtmp * 80);
            END;

            IF @bldguid IN ( '20E64520-A937-49E8-8FD6-F800A8441A2F', '43B9C319-ED05-4D8C-A530-86D1B2DDA253',
                             '474CF2FD-D157-43CC-88AF-8301C4089528', '864339EE-0AE1-E811-80BF-E61F13C57837',
                             '5BD68CD7-0695-4CC6-900E-8FCD28C3B0C6'
                           )
            BEGIN

                SET @decDsFee = CEILING(@mjtmp * 65);
            END;


        END;



        PRINT 'XCXC';
        PRINT @projGUID;
        PRINT @decDsFee;
        PRINT @mjtmp;
        IF @projGUID IN ( '199c7172-4af1-e911-80b8-0a94ef7517dd', '6167a35a-da08-e911-80bf-e61f13c57837',
                          '048E57BE-667B-E711-80BA-E61F13C57837', 'af3f947f-5357-e711-80ba-e61f13c57837',
                          '200DB54E-2DD1-E411-9927-E41F13C5183A', 'bf62f9be-ca2b-43b4-8430-e312af6f2964',
                          '5e7a8071-1fe3-4b09-90fb-eb45e5a93bd4', '970d4a13-6370-4887-8761-327fc0825228',
                          '71161556-881f-e911-80bf-e61f13c57837', '2261545f-7777-e911-80b7-0a94ef7517dd'
                        -- ,'573dbed1-e58a-ec11-b399-f40270d39969'
                        )
        BEGIN
            IF @bldguid IN ( '0A629D57-E440-4F6E-9F4C-7C1B64489529', 'B6798AB9-9F77-4164-961F-3352C8D3D9DE',
                             '5239575C-A74A-49D2-AC20-FE45099C15A9', '9BA83DC5-376D-4A74-87BD-27762FFF7005',
                             '727A12CD-00D5-4731-8373-010BD8304BA4', '7FA67024-9DE3-4B0D-B897-E962FB3B456E',
                             '7FA67024-9DE3-4B0D-B897-E962FB3B456E', '919CB188-F1C8-489E-BE58-649B1BB76997',
                             '441157BF-600F-411B-A1A7-5C1D27EE8DA5', 'E1AE9812-3069-45F3-9EE4-7EC58A2B5F78',
                             '018DF9A5-0897-4D92-B7A9-9581CA22B1A3', '9B304CB6-2159-483D-B412-FBA1019C4592',
                             '29A4C0AF-758C-489D-8463-2060D7CBB37B', '6A8035A6-F44A-4624-BB40-19B008506B55',
                             '5239575C-A74A-49D2-AC20-FE45099C15A9', 'E38C1F9A-C5A8-496F-859F-15C1B5D7FFA5',
                             '6A8035A6-F44A-4624-BB40-19B008506B55', 'B6798AB9-9F77-4164-961F-3352C8D3D9DE',
                             'D197B610-0499-4583-9A23-98B0FBA0AF30', '9B304CB6-2159-483D-B412-FBA1019C4592',
                             'F7E4F738-A5AE-47B9-8436-9BE92B550E74', 'FAAE803F-1814-4E9B-8F8D-406374031D59',
                             '0A629D57-E440-4F6E-9F4C-7C1B64489529', '1ED506D2-213E-4EF3-84C9-7BEE09574742',
                             '29A4C0AF-758C-489D-8463-2060D7CBB37B', '2E95495F-F9B8-4035-8DCA-C698EE72CFC2',
                             '1241DBB9-1919-49FD-903A-030FB009C616', '0A7D14D2-5DCF-4B58-87EB-4E639E9DF374',
                             '297D73A7-D775-4626-A92C-BB40A5514690', 'BA7E3398-7898-4DF4-BC99-2403780F6640',
                             '882BA400-0AC0-4B0A-B17E-4AEEEC05BE5A', 'ACC6BDF7-6D43-40F2-A8EB-3BC8B11BEFDE',
                             '9ACFFAA4-D4B6-4DE8-A926-59DEBE4F4515', '72E8CA67-9E73-4CC4-84DE-9F337A9CCC5D',
                             '1602CE4F-5E06-469E-81C6-A5A30D51390F', '75EDACDF-D352-4ECB-9B96-B8D670A9A52B',
                             '5AD98EA0-9056-4BFD-9070-091C55024B8F', '12FDF65F-55A5-4412-871E-53F2AAF9B1C1',
                             '9A9B46A7-D011-4E06-8AD0-5EE7BF72F4EB', '3B367C8A-6821-4D2D-AE32-83994390C05D',
                             '7FCFB023-74DA-416D-B2B3-6807C0CE54FA', 'E7FEADFC-2FBC-4E2E-A0B5-AB36D0CF9E24',
                             '9CA897E9-6F96-4186-AD41-6403A2F2D4AF'
                           -- ,'CAD1D43B-0F76-4283-BD6D-7FEF494F027A','2A9E9FAF-632A-48EF-BDC7-491AB3829C1D',
                           --'13214C05-E21D-4D19-B155-4C25E480CE98','6E812E21-EB0E-4AF5-88E1-C0737D7D44C8',
                           --'D951C869-233B-4956-B881-8B95D0E82DB1','E3BAA7D4-D1B8-4B62-B936-71596C851BEE',
                           --'3E0667A8-BBA5-4534-8786-6867C5D8B939','FA417DD5-3C0A-4954-8021-454F9A27C65C',
                           --'A9659779-EF6F-46E7-B72B-10750810A4C0','93A6DC72-AED3-45EF-8A89-C688E6A15AEC','ADAD888C-E77F-4B66-B45B-CDE6B3BC7C59'
                           )
            BEGIN
                PRINT @mjtmp;

                SET @decDsFee = CEILING(@mjtmp * 80);


                PRINT @decDsFee;
            END;

            ELSE
            -- PRINT    @bldguid                             
            IF @bldguid IN ( '48C077E9-5B25-42AB-86FA-74FFB3E0D373', 'E829F02C-7099-4FDD-9AB9-25346AF16F8E',
                             'F9918D9D-61BA-E811-80BF-E61F13C57837', '4F967CB0-078E-4FF0-9DED-9AC5F52A896C',
                             '3A0C3F0B-48DF-48FC-9B0A-24EE9DE8D137', '62ECF810-03EA-4D13-9110-1D1310B3F916',
                             '0C9688B9-3DD9-4A9A-86F8-85BD2196F1D1', '46D0C722-B6BC-4ECA-B9BD-C62E1FB7976A',
                             'BB09CE4C-C455-4655-917B-98B6EFF1791A', '3BACF82B-B4C8-4DB1-8E74-850F66FC25AB',
                             '0695EB04-8DD0-4CE0-AADE-A57B75BECE8B', '62ECF810-03EA-4D13-9110-1D1310B3F916',
                             '0C9688B9-3DD9-4A9A-86F8-85BD2196F1D1', '0F51E6A1-CB21-4313-A633-08A221297489',
                             'B07888D6-6745-4DEC-8F49-F4791EB62AB1', '46D0C722-B6BC-4ECA-B9BD-C62E1FB7976A',
                             'D278C960-A14B-40D1-92F0-8DCA2D468B41', '34ACCEFB-78F7-4F6F-BC8E-A0DBA3434924',
                             '0695EB04-8DD0-4CE0-AADE-A57B75BECE8B', '71126104-F8B1-4927-BFDC-B71127C7549B',
                             'A23C774C-228F-4E96-BD8A-E44B27BDE43B', '0F51E6A1-CB21-4313-A633-08A221297489',
                             'BC3F6B46-6E5E-4F5F-8B59-D961B1CFD731', 'B07888D6-6745-4DEC-8F49-F4791EB62AB1',
                             '8B201AD2-4AFE-4590-ABD8-48FEC2946092', 'B2D73DD4-5255-46A3-9735-FD1897D9C53A',
                             '4C865CB9-121A-4BA1-9E40-CEDE9551F18C', '6C4B6C57-C9C8-4D07-8310-CD3358EC1616',
                             'F7F07772-5373-426E-8F97-D5719EEBC8F7', 'C9D92F16-485F-4E28-B370-F3D2303F4B5C',
                             '3FC0A129-A7BC-451F-8093-1F3D643EC645', '0DBEC111-E766-474B-A0B4-72A209210BB2',
                             '3F09F931-66EC-4888-A282-8B9BA7F1CE24', '36547012-8D90-46B7-AA2E-3DBDA528786E',
                             '3704CD4A-A856-4D65-B218-4913A09F062C', 'D08B7B6D-FD02-42B8-B4DB-D1C42BB193A2',
                             'B25C7CAE-EBAA-49B7-9F5A-2835E719AD87', '7C04156B-2A29-424F-954E-120043BE0A02',
                             'DEF55E61-7BCF-4653-9D04-C0C3A4031F23', '924A0262-85A0-4E85-873E-8D6B1EE89530',
                             '2316C5D0-E5B0-4C45-A3AB-68F3EEEB2E5F', 'B3A4632F-5446-427D-BAD4-779A4E00B465',
                             '1817376E-A61B-42B7-9EEA-14F83302BCA2', 'B3A4632F-5446-427D-BAD4-779A4E00B465',
                             '448871CF-0494-473C-860E-A468C0E4B34D', '4C946CBD-CADA-4057-9FD0-17DEF50FA492',
                             '3E7FCE6B-9FD4-4023-85A4-25D4D57DD8A8', 'E829F02C-7099-4FDD-9AB9-25346AF16F8E',
                             '2D7F0C2B-8696-4033-903A-370EC6180F04', '48C077E9-5B25-42AB-86FA-74FFB3E0D373',
                             '5740A563-B937-4EA8-84BB-2D3781C5A415', 'A39F0042-E65B-4514-9367-0873476AAE99',
                             '1817376E-A61B-42B7-9EEA-14F83302BCA2', 'D59FF4B6-01A3-430F-B104-75D55CB76DC4',
                             'B3A4632F-5446-427D-BAD4-779A4E00B465', 'C1174C53-600B-45FD-A129-75D37548EB21',
                             '4CDCC04B-FD66-4291-AAD9-A0B7B49B8899', '0438839D-8936-4B83-A733-54A41D33F8C0',
                             'C4944634-49BB-40F8-98D8-C9E6EB13CF9E', 'C0B17E24-CFCE-4151-8941-2DB2C89A5250',
                             'C00CF221-6A63-4CCD-854F-2A6ACA873CA4', 'A78F8C65-AE33-4003-9E72-80D44025011F',
                             'FD66955C-DB44-4101-B0A9-B6C37D4DFB85', '6A7EBD9F-B940-4D64-889B-D846ED4EED3A',
                             'D8389BDD-07BA-4AA9-AD98-A84E5D7F8536', 'ACEBF662-6755-43BC-B0DA-45FF2D095A14',
                             '90FB5022-E3B4-48C2-A84C-0006EFE93EF0', '8FCF76D6-518F-4E8E-B604-77BEE4E59CF2',
                             'BF78026E-96AD-4BF6-8DFA-DD4119EFF1A7', 'B3045EBB-CFF2-4A1B-9B6A-DE23F93E3D1E',
                             '4264AA84-19AD-43DA-BE17-04DC2AF92C55', '3DC78D2B-8120-44E0-B468-D6CECA6C7E87',
                             '5AF6846D-EC4A-43CC-9804-E29AD0D16FA1', 'E5532623-CF59-4D00-AC5E-62FBAEAA4A01',
                             '05903AB4-2DFF-44B2-AA52-DE7FDEA63922', 'CCBC3AF0-3D30-49BE-9767-6F1E3F9A1F18',
                             '933C0B7D-1EBE-45AE-90CB-EECEB83DC631', '9CA897E9-6F96-4186-AD41-6403A2F2D4AF',
                             'C1B581C0-E126-4AD1-BB3A-5B69EF98BA74', '05F32AAA-7129-4F44-B689-60B5E056A48C',
                             '06352ED7-0F3C-4C02-9EE9-D6D6EF06A7B6'
                           -- , '037E9ACE-1DF9-4932-B9FE-982D64142662'
                           )
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 90);
                PRINT @decDsFee;
            END;


            IF @bldguid IN ( 'DE23174A-1F8F-E811-80BF-E61F13C57837', 'DD23174A-1F8F-E811-80BF-E61F13C57837',
                             '6B5B8BDC-EFD3-4EDE-9EBF-977DCF472B7A', 'A64B8178-2B01-49A3-8C13-7160EB0CD41E',
                             'C90EEC4C-8879-43C0-B3F9-5C2F28813980', 'C05C0FA0-6B36-427B-929F-4FCACC0AD197',
                             '1269AB34-529C-448F-9F97-98044FAFB7E0', '6136ECAE-4565-47C9-83A1-1E9A9357A2FE',
                             '407B17D1-7C34-4246-BB4A-3EA5864DB002', '51342053-F7D8-4909-BF1F-702A6E23C8D4',
                             '6CF0DC25-5572-4C68-A72E-A9906E822DCF', '613A70D2-B1F1-486C-99F1-685593BBA4F5',
                             '6B5B8BDC-EFD3-4EDE-9EBF-977DCF472B7A', 'A64B8178-2B01-49A3-8C13-7160EB0CD41E',
                             'C90EEC4C-8879-43C0-B3F9-5C2F28813980', '97AFA9EB-1945-4831-8B99-DC0F3244CC13',
                             '0FCA4D4E-ECE9-44D0-8127-F237B433DA10', '6366A90E-3035-4732-B8A9-2CD1B9970967',
                             'D37E2839-097B-4478-8BDE-C384DBAA68F8', 'F061D183-1085-402E-B274-9480877F3AAB',
                             '4595EDDC-2313-49AE-8BE9-C596092E7D1C', 'ADE6E0F3-961A-4127-A932-7BBD2E6CEFF0',
                             'E1807FE6-0DA3-4267-A6C6-ED182D5C3532', '6731BA51-79E9-4727-B60A-4771C7640C5D',
                             '7426D6E9-A433-4C8D-B3FF-5884C071377E', '385C4D11-54EC-42D5-A6DA-2A1616CFFC25',
                             '7EEF7CF4-5492-4144-866F-B122F1FFB5EE', '7F25C10D-317E-410C-ADCE-ADA77AF491E2',
                             '6527CEFC-44DB-4A80-8BF1-269174A67AAA', 'BDA77A0F-474C-41B2-A01A-501054F42FF2',
                             '50F559E2-8105-4784-9EA7-FE65E5D8BE13', 'A6BE9D62-70CF-405E-A4C9-88453592B53C',
                             '2B70EFE0-D5EA-4FA7-8FA3-3BCBCBFEB129', '0735089D-B1FE-4CD3-8DEA-8336585D9A08',
							 'EE918D9D-61BA-E811-80BF-E61F13C57837','4C8A12B9-93DD-E811-80BF-E61F13C57837'
                           )
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 65);

            END;

            IF @cplx = '地下室/车库'
               AND @projGUID IN ( '048e57be-667b-e711-80ba-e61f13c57837', '199c7172-4af1-e911-80b8-0a94ef7517dd'
			   ,'af3f947f-5357-e711-80ba-e61f13c57837' )
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 90);
                PRINT 3321;
                PRINT @decDsFee;
            END;


            RETURN 1; --防止进入后续无用条件

        END;


        IF @projGUID IN ( '82e97ecf-7fcf-e311-9927-e41f13c5183a' )
        BEGIN
            IF @bldguid IN ( 'A30BD92E-E62A-4933-8027-45506903EADC', '0469CAF2-F008-4D3B-A5F3-AE0531BC05F6',
                             'EDCB201A-B4FC-49AE-98C1-803AB401241C', '8C94F470-52F5-417E-968E-415290B91FDD',
                             'CB94AF1D-4C00-4141-AF8F-0C2B67827022', 'D96219D1-32F4-48D8-90AA-E359883C0EEE',
                             'C2C754C9-5561-4743-A3B7-174895223A00'
                           )
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 50);
            END;

            ELSE IF @bldguid IN ( 'D8B37047-FB7A-47BB-A696-FA22BF304571', '8F3BF503-572A-40F6-9E41-1AB117B3B43B',
                                  'EDEE86D3-16F7-49DC-93A3-C5C99D6F9F97', '2C8A65BA-6863-4209-AC53-4C9BB24056D1',
                                  '50A20C49-F370-4E06-A7A3-4CD19BC5966C', 'A30BD92E-E62A-4933-8027-45506903EADC',
                                  '101A872C-DCA3-4BDE-8443-5388748DF83C'
                                )
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 75);
            END;

            IF @bldguid IN ( 'E027E0B5-DCDB-4128-8FC7-E32041DFBD79' )
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 90);
            END;


        END;

        IF @projGUID NOT IN ( '6167a35a-da08-e911-80bf-e61f13c57837', '26d3357e-2f9e-e911-80b7-0a94ef7517dd',
                              '77A721DE-B988-E711-80BA-E61F13C57837', '200DB54E-2DD1-E411-9927-E41F13C5183A',
                              'bf62f9be-ca2b-43b4-8430-e312af6f2964', '5e7a8071-1fe3-4b09-90fb-eb45e5a93bd4',
                              '970d4a13-6370-4887-8761-327fc0825228', '82e97ecf-7fcf-e311-9927-e41f13c5183a',
                              '200DB54E-2DD1-E411-9927-E41F13C5183A', 'bf62f9be-ca2b-43b4-8430-e312af6f2964',
                              '985fc74e-6554-e611-80b9-e41f13c51836', 'BE4F5E85-0C48-EC11-B398-F40270D39969',
                              '281f9fe6-e935-eb11-b398-f40270d39969','fd303be1-0a88-ee11-b3a4-f40270d39969','4b577b21-c065-ee11-b3a4-f40270d39969'
                            )
        BEGIN

            SET @decDsFee = CEILING(@mjtmp * 75);
        END;

        IF @projGUID IN ( 'BE4F5E85-0C48-EC11-B398-F40270D39969' )
        BEGIN
            SET @decDsFee = CEILING(@mjtmp * 90);
        END;

        IF @projGUID IN ( '573DBED1-E58A-EC11-B399-F40270D39969' )
        BEGIN
            SET @decDsFee = CAST(@mjtmp * 80 AS DECIMAL(18, 2));
        END;




        IF (
               @projGUID IN ( '6a513327-ba88-e711-80ba-e61f13c57837' )
               AND @cplx IN ( '住宅', '地下室/车库' )
           )
           OR @projGUID IN ( '985fc74e-6554-e611-80b9-e41f13c51836' )
        BEGIN

            SET @decDsFee = CEILING(@mjtmp * 90);
        END;

        IF @projGUID IN ( '6a513327-ba88-e711-80ba-e61f13c57837' )
           AND @cplx IN ( '高级住宅' )
        BEGIN

            SET @decDsFee = CEILING(@mjtmp * 65);


        END;

        IF @projGUID IN ( 'bedf5fef-9ba7-4e02-a7bb-a759d00d993c', '0090B329-8366-E911-80CB-E61F13C5783B' )
        BEGIN
            IF @bldguid IN ( '67910CDA-1A8A-4152-90CB-D3056580136E', '3CFFE1D9-EC5A-4AC0-970D-D349E07D6338',
                             '77FFF566-C211-49A2-9419-35C641517D4A', '130FCE10-3CF4-4327-B520-E08397D7291A',
                             '6F98FFDA-DA4E-4B89-BF03-A664FF11A8F3', '35C355BF-9B7B-4527-BA06-09298643B86C',
                             '41FE2AED-24F6-4549-9456-3967F2C0ABCF', 'FA3F9EC8-A687-4FF0-8695-81B713CF4EF4',
                             '6C222CEB-5841-466E-9014-2B17299DAD5A', '2DD06863-D816-4991-8ED2-2FEFA8D72A86',
                             'D780B33F-FB7F-4602-972C-C5CC63FFC5E0', '3077ba87-f0f8-44ba-b55d-3eb74ae11164'
                           )
            BEGIN

                SET @decDsFee = CEILING(@mjtmp * 90);
            END;


            ELSE
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 65);

            END;
        END;
        IF @projGUID IN ( '0a7a15e4-5261-e711-80ba-e61f13c57837' )
        BEGIN
            SET @decDsFee = CEILING(@mjtmp * 65);

        END;



        IF @projGUID = 'ae7b7f9b-673c-4ddc-a4f4-de4ab71fa716'
        BEGIN
            SET @decDsFee = CEILING(@mjtmp * 90);
        END;
        IF @bldguid IN ( '048e57be-667b-e711-80ba-e61f13c57837', '6BA723C2-8948-42D5-95DB-AE21E6ABC80A',
                         'FE44993F-3033-4F05-85A2-DC26836F38CB', '7DDA589A-E892-4F61-B368-17531FCA941C',
                         'BEDCEE59-4F29-44EE-8239-1D8EBA696F65', 'A16792AC-D9E1-4BC6-B622-3656036E9F76',
                         'F5918D9D-61BA-E811-80BF-E61F13C57837', 'F6918D9D-61BA-E811-80BF-E61F13C57837',
                         'F8918D9D-61BA-E811-80BF-E61F13C57837', 'FA918D9D-61BA-E811-80BF-E61F13C57837',
                         'FB918D9D-61BA-E811-80BF-E61F13C57837', 'FC918D9D-61BA-E811-80BF-E61F13C57837',
                         'F0177DF2-4C89-41D9-A9A7-EC64C6ED6506', 'AE25AA47-2DDA-4E5E-A1D1-FDD8AF8B6CC7',
                         '1C998129-E42F-485F-9F7F-4614D7745043'
                       )
        BEGIN

            SET @decDsFee = CEILING(@mjtmp * 80);
        END;
        IF @bldguid IN ( 'A1EAA519-B384-4C17-9851-173A7D0BA58D', '158DE28D-136A-487B-9069-93131617FA80',
                         'DECBEE7C-27E4-4A5F-8BD9-98E43C3539C7', 
                         'EF918D9D-61BA-E811-80BF-E61F13C57837', 'F0918D9D-61BA-E811-80BF-E61F13C57837'
                       )
        BEGIN

            SET @decDsFee = CEILING(@mjtmp * 60);
        END;
        IF @projGUID = 'd2fab7d3-e08f-e811-80bf-e61f13c57837'
        BEGIN
            SET @decDsFee = CEILING(@mjtmp * 80);
        END;
        --莆田保利堂悦	 695239a3-bf23-eb11-b398-f40270d39969,18层及以上设置维修基金 建筑面积*90
        IF @projGUID = '695239a3-bf23-eb11-b398-f40270d39969'
        BEGIN
            IF (
                   @floor >= 18
                   AND @bldguid NOT IN ( '04A86C1A-4B90-42CA-AA25-AB726862981B',
                                         '716A7D18-038E-4770-8274-201E9993E083',
                                         '7EC26D30-5BB1-4D23-94A9-FFAD6B7015F5',
                                         '12E0DCD2-0669-4435-8AA4-C3C46E6E4A73', '47E8DFF8-5345-4F21-A51D-5A065AE49B58'
                                       )
               )
               OR @bldguid IN ( 'AAE4E543-31FA-4CBC-A43A-3CC4DE76F26E', '4943133E-A1E6-4A25-A178-82A745ED3F0D',
                                'F144BEF3-0D96-4F13-9102-BA29E7B90AC1'
                              )
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 90);
                PRINT @decDsFee;
            END;
            --莆田保利堂悦	 A9# A11# A12# A13#这几栋改成建筑面积*80	B8 B9 B10 B11 B12
            IF @bldguid IN ( '0FAE76D2-F761-43D0-909D-B6E94F0CCFE1', 'C817A433-005A-435F-AF5D-A55B1E032192',
                             '31845371-6306-4EB5-8E6E-D45D03EA2D4A', 'E99586DB-3556-459D-BE7B-8749FD9C8F5A',
                             '69E20B84-9EE7-4EAB-8F60-3D4334DBB346', '706E77EF-6DE7-4569-9753-608F1F0D2441',
                             '04A86C1A-4B90-42CA-AA25-AB726862981B', '716A7D18-038E-4770-8274-201E9993E083',
                             '7EC26D30-5BB1-4D23-94A9-FFAD6B7015F5', '12E0DCD2-0669-4435-8AA4-C3C46E6E4A73',
                             '47E8DFF8-5345-4F21-A51D-5A065AE49B58'
                           )
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 80);
            END;
            --莆田保利堂悦 商铺建筑面积*65
            IF @bldguid IN ( 'DB35FF22-285F-4453-8E94-99524EC55E39' )
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 65);
            END;

            --莆田保利天汇 90    
            IF @projGUID IN ( '281f9fe6-e935-eb11-b398-f40270d39969' )
            BEGIN
                SET @decDsFee = CEILING(@mjtmp * 90);
            END;

        END;
    END;

    --备案登记费计算开始:住宅2元/㎡，非住宅6.5元/㎡                                                  

    IF @chvItemName = '备案登记费'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = YsBldArea,
                   @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;








            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = YsBldArea,
                   @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;









            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        --开始计算                                             


        IF @cplx = '住宅'
        BEGIN


            SET @decDsFee = @mjtmp * 2;
        END;
        ELSE
        BEGIN


            SET @decDsFee = @mjtmp * 6.5;
        END;
        RETURN 5;
    END;

    --备案登记计算结束                                                  

    --土地证工本费计算开始：每人一本，每本5元                                                  

    IF @chvItemName = '土地证工本费'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                               
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
        END;

        --开始计算                                                  
        BEGIN


            SET @decDsFee = 10 * (@intCstCount - 1);
        END;

        RETURN 6;



    END;

    --产权证印花税计算结束       






    IF @chvItemName = '印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取        


        BEGIN

            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;




        END;

        ---开始计算“印花税”                                                  



        BEGIN


            SET @decDsFee = ROUND(CAST(@decTmp AS INT) * 0.0005, 1);


        END;

        RETURN 1;

    END;
    --印花税计算结束                            








    --3:契税:厦门公司海上五月花-一期代收费用                                                                                  
    --   计算公式：                                                     
    --   1、家庭唯一住宅且面积<90平，契税=补差后总房款*1%；                                      
    --   2、家庭唯一住宅且面积为90-144平，契税=补差后总房款*1.5%；                                                         
    --   3、二套及二套以上或面积＞144平或单套总价＞180万，契税=补差后总房款*3%                                                                                  

    IF @chvItemName = '契税'
    BEGIN

        --取价格                                                                                  
        SET @decTmp = 0;
        --  取面积                                                                                  
        SET @mjtmp = 0;

        IF @chvSource = '合同'
        --  来源为“合同”通过合同表获取                                                                        
        BEGIN


            SELECT @chvRoomGUID = RoomGUID,
                   @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0),
                   @mjtmp = BldArea,
                   @zynum = LEFT(ZyNumber, 1)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0),
                   @mjtmp = BldArea,
                   @zynum = LEFT(ZyNumber, 1)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
        END;


        --开始计算                                                                                       
        IF (
               @zynum = 1
               AND @projGUID IN ( '82e97ecf-7fcf-e311-9927-e41f13c5183a' )
               AND
               (
                   @cplx = '住宅'
                   OR @cplx = '高级住宅'
               )
           )
        BEGIN


            IF @mjtmp <= 90
            BEGIN
                SET @decDsFee = CEILING(@decTmp * 0.01);
            END;
            IF @mjtmp > 90
            BEGIN
                SET @decDsFee = CEILING(@decTmp * 0.015);
            END;
        END;






        IF @projGUID IN ( '048e57be-667b-e711-80ba-e61f13c57837', '5cc31057-5057-e711-80ba-e61f13c57837',
                          'd47583cf-5057-e711-80ba-e61f13c57837'
                        )
        BEGIN
            IF @zynum = 1
            BEGIN
                SET @decDsFee = CEILING(@decTmp * 0.015);
            END;

            IF @zynum = 2
            BEGIN
                SET @decDsFee = CEILING(@decTmp * 0.02);
            END;
            IF @zynum > 2
            BEGIN
                SET @decDsFee = CEILING(@decTmp * 0.03);
            END;
        END;









        IF (
               @projGUID IN ( '82e97ecf-7fcf-e311-9927-e41f13c5183a' )
               AND
               (
                   @zynum > 2
                   OR (@cplx = '车位')
               )
           )
        BEGIN
            SET @decDsFee = CEILING(@decTmp * 0.03);

        END;


        IF (@zynum = 2 AND @projGUID IN ( '82e97ecf-7fcf-e311-9927-e41f13c5183a' ))
        BEGIN
            IF @mjtmp <= 90
            BEGIN
                SET @decDsFee = CEILING(@decTmp * 0.01);
            END;

            IF @mjtmp > 90
            BEGIN
                SET @decDsFee = CEILING(@decTmp * 0.02);
            END;




        END;


        IF (
               @zynum = 1
               AND @projGUID IN ( '9d1effe4-5eae-e711-80ba-e61f13c57837' )
               AND
               (
                   @cplx = '住宅'
                   OR @cplx = '高级住宅'
               )
           )
        BEGIN


            IF @mjtmp <= 90
            BEGIN
                SET @decDsFee = CEILING(@decTmp / 1.1 * 0.01);
            END;
            IF @mjtmp > 90
            BEGIN
                SET @decDsFee = CEILING(@decTmp / 1.1 * 0.015);
            END;
            PRINT @decDsFee;
        END;

        IF (
               @projGUID IN ( '048e57be-667b-e711-80ba-e61f13c57837', 'd47583cf-5057-e711-80ba-e61f13c57837',
                              '5cc31057-5057-e711-80ba-e61f13c57837', '82e97ecf-7fcf-e311-9927-e41f13c5183a',
                              '9d1effe4-5eae-e711-80ba-e61f13c57837'
                            )
               AND
               (
                   @zynum > 2
                   OR (@cplx = '地下室/车库')
               )
           )
        BEGIN
            SET @decDsFee = CEILING(@decTmp * 0.03);

        END;
        IF (@zynum = 2 AND @projGUID IN ( '9d1effe4-5eae-e711-80ba-e61f13c57837' ))
        BEGIN
            IF @mjtmp <= 90
            BEGIN
                SET @decDsFee = CEILING(@decTmp / 1.1 * 0.01);
            END;

            IF @mjtmp > 90
            BEGIN
                SET @decDsFee = CEILING(@decTmp / 1.1 * 0.02);
            END;




        END;

    END;
--契税计算完毕                                          

--计算房屋土地登记费                                          
/* If @chvItemName='房屋和土地登记费'                                                  
       Begin                                                  
                                                  
   If @chvSource = '定单'                                                  
          begin                      
  --来源为“定单”通过交易表获取                                                  
           Select @intCstCount = Count(*) From s_Order,s_Trade2Cst Where s_Order.TradeGUID = s_Trade2Cst.TradeGUID And s_Order.OrderGUID=@chvSaleGUID;                              
           select @chvRoomGUID =roomguid,@projGUID =projGUID From s_Order where OrderGUID = @chvSaleGUID;                                                    
            Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID                                                          
                                                   
  if charindex('住宅',@cplx) >0                                                   
   begin                                                  
    set @Cplx='住宅'                                                  
   end                                                  
  if charindex('高级住宅',@cplx) >0                                                    
   begin                                                   
    SET @Cplx='高级住宅'                                                    
   end                                                  
  if charindex('商业',@cplx) >0                                                   
   begin                                    
    SET @Cplx='商业'                                                    
   end                 
  if charindex('写字楼',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='写字楼'                                                    
   end                                                   
  if charindex('地下室/车库',@cplx) >0                                                     
   begin                                               
    SET @Cplx='地下室/车库'                                                    
   end                                                     
   end                                                  
                                                  
   If @chvSource = '合同'                                                  
    --来源为“合同”通过合同表获取                                                  
    begin                         
    select @chvRoomGUID =roomguid,@projGUID =projGUID From s_Contract where ContractGUID = @chvSaleGUID;                                                    
                Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID;                                                          
                Select @intCstCount = Count(*) From s_Contract,s_Trade2Cst Where s_Contract.TradeGUID = s_Trade2Cst.TradeGUID And s_Contract.ContractGUID=@chvSaleGUID;                                                  
                                                   
  if charindex('住宅',@cplx) >0                                                   
   begin                                                  
    set @Cplx='住宅'                                                  
   end                                                  
  if charindex('高级住宅',@cplx) >0                                                    
   begin                                                   
    SET @Cplx='高级住宅'                                                    
   end                                                  
  if charindex('商业',@cplx) >0                                                   
   begin                                                    
    SET @Cplx='商业'                       
   end                                                  
  if charindex('写字楼',@cplx) >0                                                     
   begin                                       
    SET @Cplx='写字楼'                                                    
   end                                  
  if charindex('地下室/车库',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='地下室/车库'                                 
   end                            
           end                           
                                                  
     --开始计算                                            
     if(@Cplx='住宅'or @Cplx='高级住宅'or @Cplx='地下室/车库' )                                                
       begin                                           
                                               
  set @decDsFee =180;                                                  
 end                                            
    if(@Cplx='商业' or @Cplx='写字楼' )                                                
                      
              begin                                           
                                                        
  set @decDsFee =1250;                                                  
 end                                          
                                             
 return 7                                            
                                           
 end                                          
                                           
 --房屋土地登记费计算完毕                                          
  */
END;
--福建公司代收费用计算结束                   





























--杭州公司代收费用开始计算                                                  
IF (@buguid = '2FF7167B-4398-4F0B-AFD8-AEA73DDAD8F5')
BEGIN
    --维修基金                                                  
    --   计算公式：住宅每平米65元,排屋每平米45元；                                                  
    IF @chvItemName = '维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  
        IF (@cplx = '住宅' OR @cplx = '公寓')
        BEGIN

            SET @decDsFee = @mjtmp * 65;

        END;
        IF (@cplx = '高级住宅')
        BEGIN

            SET @decDsFee = @mjtmp * 45;

        END;
        RETURN 6;
    END;
--维修基金计算完毕                                                  
END;
--杭州公司代收费用计算结束                                          




--河北公司代收费用开始计算                                                  
IF (@buguid = '55CF1D71-37F8-416D-ABC7-F56921CF1413')
BEGIN
    --公共维修基金                                   
    --   计算方式：地上部分按实测建筑面积每平米70元收取、地下部分按实测建筑面积每平米20元收取。                             
    IF @chvItemName = '公共维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;
        SET @fsfjscmj = 0;
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
			       @bldguid = BldGUID
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;


            SELECT @fsfjscmj = ISNULL(BldArea, 0)
            FROM p_room
            WHERE MainRoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
			      @bldguid = BldGUID
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @fsfjscmj = ISNULL(BldArea, 0)
            FROM p_room
            WHERE MainRoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;



        --开始计算        

        IF @projGUID NOT IN ( '97A38035-1957-E711-80BA-E61F13C57837', 'e16e8e1f-1a57-e711-80ba-e61f13c57837',
                              '386b9d01-1a57-e711-80ba-e61f13c57837', 'a7b47577-1957-e711-80ba-e61f13c57837','1984523E-851E-EB11-B398-F40270D39969'
                            )
        BEGIN


            IF (
                   @cplx = '住宅'
                   OR @cplx = '公寓'
                   OR @cplx = '写字楼'
                   OR @cplx = '商业'
                   OR @cplx = '高级住宅'
               )
            BEGIN

                SET @decDsFee = ROUND((@scmj + @fsfjscmj) * 32, 0);

            END;
            IF (@cplx = '地下室/车库')
            BEGIN

                SET @decDsFee = ROUND(@scmj * 20, 0);

            END;

        END;
        IF @projGUID IN ( '009d590c-7db5-e711-80ba-e61f13c57837' )
            IF (@cplx = '地下室/车库')
            BEGIN

                SET @decDsFee = ROUND(@scmj * 20, 0);

            END;

        IF (@cplx <> '地下室/车库')
        BEGIN
            SET @decDsFee = ROUND((@scmj * 65), 0);
        END;
        --
	   --衡水市桃城区41号地块
	     IF @projGUID IN ( 'ACC3286E-9B45-EB11-B398-F40270D39969','EF369132-FBA3-E711-80BA-E61F13C57837') 
		
            IF (@cplx = '住宅'or @cplx = '商业' )
            BEGIN

                SET @decDsFee = floor(@scmj * 90);

            END;
			  IF (@cplx = '地下室/车库' )
            BEGIN

                SET @decDsFee = ROUND(@scmj * 60, 0);

            END;
        IF (@cplx = '商业')
        BEGIN
            SET @decDsFee = ROUND((@scmj * 60), 0);
        END;
        -----     
		IF @projGUID IN ( '1984523E-851E-EB11-B398-F40270D39969' )
            IF (@cplx = '住宅')
				BEGIN

					SET @decDsFee = @scmj * 70;

				END;

			IF (@cplx = '商业')
				BEGIN
					SET @decDsFee = @scmj * 90;
				END;

        IF @projGUID IN ( '97A38035-1957-E711-80BA-E61F13C57837' )
        BEGIN


            IF (
                   @cplx = '住宅'
                   OR @cplx = '公寓'
                   OR @cplx = '写字楼'
                   OR @cplx = '商业'
                   OR @cplx = '高级住宅'
               )
            BEGIN

                SET @decDsFee = ROUND((@scmj + @fsfjscmj) * 70, 0);
                PRINT @decDsFee;

            END;
        END;
        IF @projGUID IN ( 'b38cee5f-1857-e711-80ba-e61f13c57837', '386b9d01-1a57-e711-80ba-e61f13c57837' )
        BEGIN

            SET @decDsFee = ROUND((@scmj + @fsfjscmj) * 70, 0);
            PRINT @decDsFee;
        END;

        IF @projGUID IN ( '009d590c-7db5-e711-80ba-e61f13c57837' )
        BEGIN

            SET @decDsFee = ROUND((@scmj + @fsfjscmj) * 40, 0);
            PRINT @decDsFee;
        END;

        IF @projGUID IN ( 'a7b47577-1957-e711-80ba-e61f13c57837' )
        BEGIN

            SET @decDsFee = ROUND((@scmj + @fsfjscmj) * 43, 0);
            PRINT @decDsFee;
        END;
        --- 石家庄藁城区育才街项目 一期
        IF @projGUID IN ( 'e16e8e1f-1a57-e711-80ba-e61f13c57837' )
        BEGIN

            SET @decDsFee = ROUND((@scmj + @fsfjscmj) * 65, 0);
            PRINT @decDsFee;
        END;

		--拉菲公馆一期   
        IF @projGUID IN ( '75BAEDC6-EEA3-E711-80BA-E61F13C57837') 
		begin
            IF (@cplx = '住宅' OR @cplx = '地下室/车库')
            BEGIN

                SET @decDsFee = ROUND(@scmj * 90, 0);

            END;
			IF (@cplx = '商业' )
            BEGIN

                SET @decDsFee = ROUND(@scmj * 60, 0);

            END;
			END;

        RETURN 6;
    END;
    --维修基金计算完毕       

    --2、印花税                                                  
    --   --计算公式：①按业态进行区分，普通住宅不需要收取                                                  
    --               ②如购买高级住宅、商铺、写字楼、车位等，收取万分之五                                                  
    --                                                  
    IF @chvItemName = '印花税'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN

            --来源为“定单”通过交易表获取                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        --  if charindex('住宅',@cplx) >0                                                   
        --   begin                                                  
        --    set @Cplx='住宅'                                                  
        --   end                                                  
        --  if charindex('高级住宅',@cplx) >0                                                    
        --   begin                                                   
        --    SET @Cplx='高级住宅'                                                    
        --   end                                              
        --  if charindex('商业',@cplx) >0                                                   
        --   begin                                                    
        --    SET @Cplx='商业'                                                    
        --   end                                                  
        --  if charindex('写字楼',@cplx) >0                                                     
        --   begin                                                  
        --    SET @Cplx='写字楼'                                                    
        --   end                                                  

        --                                                  
        --                select @ge=rtrim(P_customer.csttype) from s_Order,s_Trade2Cst,p_Customer where s_Order.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_Order.OrderGUID = @chvSaleGUID;                                    






        --                       if @ge<>'公司'                                                  
        --                 begin                                                  
        --                   set @ge='个人';                                                  
        --                 end                                                   
        --                                                     
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @mjtmp = CAST(BldArea AS DECIMAL(19, 4))
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @BldCjPrice = BldCjPrice
            FROM s_Order
            WHERE s_Order.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

        --  if charindex('住宅',@cplx) >0                                                   
        --   begin                                                  
        --    set @Cplx='住宅'                                 
        --   end                                                  
        --  if charindex('高级住宅',@cplx) >0                                                    
        --   begin                                                   
        --    SET @Cplx='高级住宅'                                        
        --   end                                                  
        --  if charindex('商业',@cplx) >0                                                   
        --   begin                                                    
        --    SET @Cplx='商业'                                                    
        --   end                                                  
        --  if charindex('写字楼',@cplx) >0                                                     
        --   begin                                                  
        --    SET @Cplx='写字楼'                                                    
        --   end                                       
        --                                                        
        --                                                  
        --                select @ge=rtrim(P_customer.csttype) from s_contract,s_Trade2Cst,p_Customer where s_contract.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_contract.ContractGUID = @chvSaleGUID;                        














        --                       if @ge<>'公司'                                                  
        --                 begin                                                  
        --                   select @ge='个人';                                                  
        --                 end                                                  
        END;

        ---开始计算“印花税”                                                  



        BEGIN
            SET @decDsFee = ROUND(CAST(@decTmp AS INT) * 0.0005, 1);
        END;
        RETURN 1;

    END;
    --印花税计算结束                                                  



    --契税计算方式：实测建筑面积140平米以上的，按实测总价的4%收取；实测建筑面积140平米以下（含）的，按实测总计的3%收取。                                          



    IF @chvItemName = '契税'
    BEGIN

        --取价格                             
        SET @decTmp = 0;
        --取面积                                                                                  
        SET @mjtmp = 0;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                             
        BEGIN



            SELECT @chvRoomGUID = RoomGUID,
                   @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0),
                   @mjtmp = BldArea,
                   @zynum = LEFT(ISNULL(ZyNumber, 0), 1)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID,
                   @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
        END;

        --开始计算       


        IF @cplx = '住宅'
        BEGIN

            IF @zynum = 1
            BEGIN
                IF @scmj > 90
                BEGIN


                    SET @decDsFee = ROUND(@decTmp * 0.015, 2);

                END;
                IF @scmj <= 90
                BEGIN
                    SET @decDsFee = ROUND(@decTmp * 0.01, 2);
                END;

            END;

            IF @zynum = 2
            BEGIN
                IF @scmj > 90
                BEGIN
                    SET @decDsFee = ROUND(@decTmp * 0.02, 2);
                END;
                IF @scmj <= 90
                BEGIN
                    SET @decDsFee = ROUND(@decTmp * 0.01, 2);
                END;

            END;



            IF @zynum > 2
            BEGIN
                IF @scmj > 140
                BEGIN
                    SET @decDsFee = ROUND(@decTmp / 1.05 * 0.03, 2);
                END;
                IF @scmj <= 140
                BEGIN
                    SET @decDsFee = ROUND(@decTmp * 0.04, 2);
                END;

            END;

        END;

        IF @cplx = '商业'
           OR @cplx = '公寓'
        BEGIN
            SET @decDsFee = ROUND(@decTmp * 0.04, 2);

        END;

    -- BEGIN                    
    -- if @scmj > 90                     
    -- BEGIN                   
    --  set @decDsFee = @decTmp/1.05*0.02                 
    -- END                  
    -- if @scmj <= 90                    
    -- BEGIN                   
    -- set @decDsFee = @decTmp/1.05*0.01                  
    --end                

    -- end                     

    --end       




    --   begin             

    --   if   @Cplx='住宅'            
    --   begin                                                                              
    --     if @scmj > 140                                            

    --        begin                                                                                   
    --        set @decDsFee = @decTmp*0.04                                                                                  
    --end                                  
    --     if  @scmj <=140                                                                                   
    --        begin                                                                                  
    --        set @decDsFee = @decTmp*0.03                                                                   
    --        end                       






    --   if  @Cplx='商业'            
    --   begin            

    --    set @decDsFee = @decTmp/1.05*0.04               

    --   end            


    --     end                                                                         

    END;
    --契税计算完毕                                          

    ------------------------------------------物业费开始计算                                                  
    --计算公式：住宅每月每平米1.2元、商业每月每平米3.2元                                   
    IF @chvItemName = '物业费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0),
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;



            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0),
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;



            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“物业费”                                                  


        IF (
               @cplx = '住宅'
               OR @cplx = '高层住宅'
           )
           AND @projGUID <> '97A38035-1957-E711-80BA-E61F13C57837'
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 1.6 * 12, 2);

        END;
        IF (
               @cplx = '住宅'
               OR @cplx = '高层住宅'
           )
           AND @projGUID = '97A38035-1957-E711-80BA-E61F13C57837'
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 2.2 * 12, 2);

        END;


        IF (@cplx = '商业' OR @cplx = '商铺')
        BEGIN
            SET @decDsFee = ROUND(@mjtmp * 2.5 * 12, 2);
        END;

        RETURN 7;

    END;
    --“物业费”计算完毕       


    ------------------------------------------物业费开始计算                                                  
    --计算公式：住宅每月每平米1.2元、商业每月每平米3.2元                                   
    IF @chvItemName = '出图费'
    BEGIN
        --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0),
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;

            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;



            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal, 0),
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_room.ProductName,
                   @mjtmp = CAST(ScBldArea AS DECIMAL(19, 4))
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;



            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;













            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        --开始计算“出图费”                                                  






        BEGIN
            SET @decDsFee = 20;
        END;

        RETURN 7;

    END;
    --“出图费”计算完毕             
    ---产权登记费                                          
    --计算方式：不管任何付款方式都要收，住宅820，非住宅（商业、车位）550..                                          

    IF @chvItemName = '产权登记'
    BEGIN
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;
        --开始计算                                                
        IF (@cplx = '住宅')
        BEGIN

            SET @decDsFee = 80;

        END;

        IF (@cplx = '商业')
        BEGIN

            SET @decDsFee = 550;

        END;
    END;
---计算结束                                          



END;
--河北公司代收费用计算结束                                          















--西安公司代收费用开始计算                                            
IF (@buguid = '434FEB88-9B18-4575-967F-1D7E8B60C9CB')
BEGIN

    ---产权登记费                                          
    --计算方式：不管任何付款方式都要收，住宅820，非住宅（商业、车位）550..                                          

    IF @chvItemName = '产权登记'
    BEGIN
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;
        --开始计算                                                  
        IF (@cplx = '住宅')
        BEGIN

            SET @decDsFee = 80;

        END;
        ELSE
        BEGIN
            SET @decDsFee = 550;
        END;

    END;
    ---计算结束                                          



    --他项权利证费，这种费用的收款范围是：仅按揭收，住宅80，非住宅（商业、车位）550                                          


    IF @chvItemName = '他项权利证费'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea,
                   @fkfs = PayformName
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea,
                   @fkfs = PayformName
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                
        IF (@fkfs LIKE '%按揭%' OR @fkfs LIKE '%公积金%' OR @fkfs LIKE '%分期%')
        BEGIN

            IF (@cplx = '住宅')
            BEGIN
                SET @decDsFee = 80;
            END;
            ELSE
            BEGIN
                SET @decDsFee = 550;
            END;
        END;
        IF (@fkfs LIKE '%一次性')
        BEGIN
            SET @decDsFee = 0;
        END;

        RETURN 6;
    END;
--维修基金计算完毕                                             

----契税计算方式：实测建筑面积140平米以上的，按实测总价的4%收取；实测建筑面积140平米以下（含）的，按实测总计的3%收取。                                          



--  If @chvItemName='契税'                                                                                  
--       Begin                                                                  

--  --取价格                                                                                  
--  Set @decTmp = 0;                                                                                  
--         --取面积                                                                       
--   set @mjtmp=0;                                                                                  

--  If @chvSource = '合同'                                
--    --来源为“合同”通过合同表获取                                                                        
--      begin                                                                                  
--       Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType                                                                       
--      where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID;                                                 
--      Select @chvRoomGUID =roomguid, @decTmp=isnull(RmbHtTotal+sjbctotal,0),@mjtmp=bldarea From s_Contract Where ContractGUID = @chvSaleGUID;                                                                                       
--  Select @scmj=ScBldArea,@mjtmp=YsBldArea from p_room where  p_room.roomguid=@chvRoomGUID                                           

--  if charindex('住宅',@cplx) >0                                                                                   
--   begin                                                                                  
--   set @Cplx='住宅'                                                                                  
--   end                           
--  if charindex('高级住宅',@cplx) >0                     
--   begin                                                                     
--   SET @Cplx='高级住宅'                                                                                    
--   end                                                                            
-- if charindex('商业',@cplx) >0                                                                                   
--   begin                                                                                    
--   SET @Cplx='商业'                                                                                    
--   end                                                                                              
--  if charindex('地下室/车库',@cplx) >0                                                             
--   begin                                                                                  
--   SET @Cplx='车位'                                                                                    
--   end                                                
--       end                                                                      

-- --开始计算                                     

--     begin                                                                                  
--       if @scmj > 140                    

--          begin                                                                                   
--          set @decDsFee = @decTmp*0.04                                                                              
--          end                      
--       if  @scmj <=140                                                                                 
--          begin                                                                                  
--          set @decDsFee = @decTmp*0.03                                                                                  
--          end                                                                                  

--     end                                                                             



-- end                                                                                  
----契税计算完毕                                          

--------------------------------------------物业费开始计算                                                  
----计算公式：住宅每月每平米1.2元、商业每月每平米3.2元                                          
--    If @chvItemName='物业费'                                           

--       Begin                                                  
--  --取价格                                                  
--  Set @decTmp = 0;                                         
--         --取面积              
--   set @mjtmp=0;                                                  
--         --取出是个人购买还是公司购买                                                  
--     set @ge=null;                                                  

--   If @chvSource = '定单'                                                  
--          begin                                                  
--  --来源为“定单”通过交易表获取                             
--  select @decTmp=isnull(RmbCjTotal,0) from s_Order where OrderGUID = @chvSaleGUID;                                                  
--     select @chvRoomGUID =roomguid From s_Order where OrderGUID = @chvSaleGUID;                                                  

--  Select @Cplx=p_room.ProductName,@mjtmp=cast(scbldarea as decimal(19,4)) from p_room where p_room.roomguid=@chvRoomGUID                                                          

--  if charindex('住宅',@cplx) >0                                                                                   
--   begin                                                                                  
--   set @Cplx='住宅'                                                                                  
--   end                                                                               
--  if charindex('高级住宅',@cplx) >0                                                                                    
--   begin                                                                     
--   SET @Cplx='高级住宅'                                 
--   end                                                                                  
--  if charindex('商业',@cplx) >0                                                                                   
--   begin                                                                                    
--   SET @Cplx='商业'                                                                                    
--   end                                                                                              
--  if charindex('地下室/车库',@cplx) >0                                                                                     
--   begin                                                                                  
--   SET @Cplx='车位'                                                                                    
--   end                                            
--     if charindex('高层住宅',@cplx) >0                                                                           
--   begin                                                       
--   SET @Cplx='高层住宅'                                                                                    
--   end                                                       


--                select @ge=rtrim(P_customer.csttype) from s_Order,s_Trade2Cst,p_Customer where s_Order.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_Order.OrderGUID = @chvSaleGUID;                                    








--                       if @ge<>'公司'                                                  
--                 begin                                            
--                   set @ge='个人';                                                  
--                 end                                                      
--   end                                                  

--   If @chvSource = '合同'                                                  
--    --来源为“合同”通过交易表获取                                                  
--    begin                                                  
--  select @decTmp=isnull(RmbHtTotal,0) from s_Contract where ContractGUID = @chvSaleGUID;                                                  
--  select @chvRoomGUID =roomguid From s_Contract where ContractGUID = @chvSaleGUID;                                                    
--  Select @Cplx=p_room.ProductName,@mjtmp=cast(scbldarea as decimal(19,4)) from p_room where p_room.roomguid=@chvRoomGUID                                                          



--if charindex('住宅',@cplx) >0                                                                                   
--   begin                                                                                  
--   set @Cplx='住宅'                                                                                  
--   end                                         
--  if charindex('高级住宅',@cplx) >0                                                                                    
--   begin                                      
--   SET @Cplx='高级住宅'                                                                                    
--   end                                                       
--  if charindex('商业',@cplx) >0                                                       
--   begin           
--   SET @Cplx='商业'                                                                                    
--   end                                                                                              
--  if charindex('地下室/车库',@cplx) >0                                                                                     
--   begin                                                                                  
--   SET @Cplx='车位'                                                                                    
--   end                                                
--      if charindex('高层住宅',@cplx) >0                                                    
--   begin                                                             
--   SET @Cplx='高层住宅'                                                                                    
--   end                                                   

--                select @ge=rtrim(P_customer.csttype) from s_contract,s_Trade2Cst,p_Customer where s_contract.tradeguid=s_Trade2Cst.tradeguid  and p_Customer.cstguid=s_Trade2Cst.cstguid and s_contract.ContractGUID = @chvSaleGUID;                         














--                      if @ge<>'公司'                                                  
--                 begin                                                  
--                   select @ge='个人';                                            
--                 end                                                  
--          end                                        

--     --开始计算“物业费”                                               


--   if ( @cplx = '住宅' or  @cplx = '高层住宅')                                                  
--     begin                                                  
--          Set @decDsFee = @mjtmp * 1.8 * 12                                           

--     end                                                  


--   if ( @cplx = '商业' )                                                  
--     begin                                                  
--          Set @decDsFee = @mjtmp * 3.2 * 12          
--     end                                                  

--    return 7                                               

--    End                                       
----“物业费”计算完毕                                           



END;
--西安公司代收费用计算结束                                          




--国贸公司代收费用开始计算                                                  
IF (@buguid = 'DFE03264-02F8-41A0-9D06-7B03582F7CF2')
BEGIN

    ---抵押登记费                                          
    --计算方式：不管任何付款方式都要收，住宅820，非住宅（商业、车位）550..                                          
    /*                                          
If @chvItemName='抵押登记费'                                           
begin                                   
If @chvSource = '定单'                                                  
          begin                                                  
  --来源为“定单”通过交易表获取                                                  
        select @chvRoomGUID =roomguid,@mjtmp=BldArea  ,@fkfs= PayformName From s_Order where OrderGUID = @chvSaleGUID;                                                  
        Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID                                                          
          Select @scmj=ScBldArea,@mjtmp=YsBldArea from p_room where  p_room.roomguid=@chvRoomGUID                                            
  if charindex('住宅',@cplx) >0                                                   
   begin                                                  
    set @Cplx='住宅'                                                  
   end            
  if charindex('高级住宅',@cplx) >0                                                    
   begin                                                   
    SET @Cplx='高级住宅'         end                                                  
  if charindex('商业',@cplx) >0                                                   
   begin                                                    
    SET @Cplx='商业'                                                    
   end                                                    
  if charindex('写字楼',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='写字楼'                                                    
   end                                                   
  if charindex('地下室/车库',@cplx) >0       
   begin                                                  
    SET @Cplx='地下室/车库'                                                    
   end                                                   
  if charindex('公寓',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='公寓'                                                    
   end                                                                    
   end                                         
                              
If @chvSource = '合同'                                                  
    --来源为“合同”通过合同表获取                                                  
    begin                                          
        select @chvRoomGUID =roomguid,@mjtmp=BldArea,@fkfs= PayformName  From s_Contract where ContractGUID = @chvSaleGUID;                         
        Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID;                  
        Select @scmj=ScBldArea,@mjtmp=YsBldArea from p_room where  p_room.roomguid=@chvRoomGUID                                           
  if charindex('住宅',@cplx) >0                                                   
   begin                                                  
    set @Cplx='住宅'                                                  
   end                                                  
  if charindex('高级住宅',@cplx) >0                                                    
   begin                                                   
    SET @Cplx='高级住宅'                                                    
   end                                                  
  if charindex('商业',@cplx) >0                                                   
   begin                                                    
    SET @Cplx='商业'                                                    
   end                                                  
  if charindex('写字楼',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='写字楼'                                    
   end                                                   
  if charindex('地下室/车库',@cplx) >0                                                     
   begin                                       
    SET @Cplx='地下室/车库'                                                    
   end                                                  
  if charindex('公寓',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='公寓'                                                    
   end                                                   
       end                                                  
 --开始计算                                            
                                           
                                           
 IF (@fkfs LIKE '%按揭%' or @fkfs LIKE '%贷款%'  or @fkfs LIKE '%公积金%')                                
 BEGIN                                           
    if (@cplx='住宅' )                                                    
 begin                                                  
                                          
    set @decDsFee=80                                                 
                                
    end                                           
    else                                     
    begin                                          
     set @decDsFee=550                                             
    end                                            
 end                                           
                                           
                                                  
                                          
end                                          
--计算结束                                          
                                          
                                   
                                          
---测绘费                                          
--计算方式：不管任何付款方式都要收，住宅820，非住宅（商业、车位）550..                                          
                                 
If @chvItemName='测绘费'                                           
begin                                          
If @chvSource = '定单'                                                  
          begin                                       
  --来源为“定单”通过交易表获取                                                  
        select @chvRoomGUID =roomguid,@mjtmp=BldArea ,@fkfs= PayformName  From s_Order where OrderGUID = @chvSaleGUID;                                                  
        Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID                                                          
          Select @scmj=ScBldArea,@mjtmp=YsBldArea from p_room where  p_room.roomguid=@chvRoomGUID                                            
  if charindex('住宅',@cplx) >0                                            
   begin                               
    set @Cplx='住宅'                                                  
   end                                                  
  if charindex('高级住宅',@cplx) >0                                                    
   begin                                                   
    SET @Cplx='高级住宅'         end                                                  
  if charindex('商业',@cplx) >0                                                   
   begin                                                    
    SET @Cplx='商业'                                                    
   end                                                    
  if charindex('写字楼',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='写字楼'                                                    
   end                                                   
  if charindex('地下室/车库',@cplx) >0                                           
   begin                                                  
    SET @Cplx='地下室/车库'                                                    
   end                                                   
  if charindex('公寓',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='公寓'                                                    
   end                                                                    
   end                                            
                                             
If @chvSource = '合同'                                                  
    --来源为“合同”通过合同表获取                                                  
    begin                                                  
        select @chvRoomGUID =roomguid,@mjtmp=BldArea ,@fkfs= PayformName From s_Contract where ContractGUID = @chvSaleGUID;                                                  
        Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID;                                                  
        Select @scmj=ScBldArea,@mjtmp=YsBldArea from p_room where  p_room.roomguid=@chvRoomGUID                                           
  if charindex('住宅',@cplx) >0                       
   begin                                                  
    set @Cplx='住宅'                                                  
   end                                                  
  if charindex('高级住宅',@cplx) >0                                                    
   begin                                             
    SET @Cplx='高级住宅'                                                    
   end                                                  
  if charindex('商业',@cplx) >0                                           
   begin                                                    
    SET @Cplx='商业'                                                    
   end                                                  
  if charindex('写字楼',@cplx) >0                                       
   begin                                                  
    SET @Cplx='写字楼'                           
   end                                                   
  if charindex('地下室/车库',@cplx) >0                                                     
   begin                                                  
    SET @Cplx='地下室/车库'                                                    
   end                                                  
  if charindex('公寓',@cplx) >0                                                     
   begin                  
    SET @Cplx='公寓'                                                    
   end                                                   
       end                                                  
 --开始计算                                             
                                           
IF (@fkfs LIKE '%按揭%' or @fkfs LIKE '%贷款%'  or @fkfs LIKE '%公积金%')                                           
BEGIN                      
 if (@cplx='住宅' or  @cplx='高级住宅')                                                    
 begin                                                  
                                                      
    set @decDsFee=1*@mjtmp                                                
                                                      
    end                                           
    else                                          
    begin                                          
     set @decDsFee=1.4*@mjtmp                                              
    end                                               
                                          
end                                            
                                         
                                          
end                                          
--计算结束                                          
*/



    --契税计算方式：实测建筑面积144平米以上的，按实测总价的3%收取；90-144按实测总计的1.5%收取。90以下1%                                          


    -- If @chvItemName='契税'                                    
    --      Begin                                                                                  

    -- --取价格                                                                                  
    -- Set @decTmp = 0;                                                                                  
    --        --取面积                                                                                  
    --  set @mjtmp=0;                                                                                  

    -- If @chvSource = '合同'                                                                                  
    --   --来源为“合同”通过合同表获取                                              
    --     begin                                                                                  
    --      Select @Cplx=p_BuildProductType.BProductTypeName from p_room,p_BuildProductType                                                                       
    --     where p_room.BProductTypeCode=p_BuildProductType.BProductTypeCode and p_room.roomguid=@chvRoomGUID;                                                 
    --     Select @chvRoomGUID =roomguid, @decTmp=isnull(RmbHtTotal+sjbctotal,0),@mjtmp=bldarea From s_Contract Where ContractGUID = @chvSaleGUID;                                                                                  
    -- Select @scmj=ScBldArea,@mjtmp=YsBldArea from p_room where  p_room.roomguid=@chvRoomGUID                                           

    -- if charindex('住宅',@cplx) >0                                                                                   
    --  begin                                                                                  
    --  set @Cplx='住宅'                                                                                  
    --  end                                          
    -- if charindex('高级住宅',@cplx) >0                       
    --  begin                                                                     
    --  SET @Cplx='高级住宅'                                                                                    
    --  end                                                       
    -- if charindex('商业',@cplx) >0                      
    --  begin                                                                                    
    --  SET @Cplx='商业'                                                                                    
    --  end                                                                                              
    -- if charindex('地下室/车库',@cplx) >0         
    --  begin                                                 
    --  SET @Cplx='车位'                                                                                    
    --  end                                                
    --      end                                                                      

    ----开始计算                                                                 

    --    begin                                                                                  
    --      if @scmj > 144                                            

    --         begin                                                                                   
    --         set @decDsFee = @decTmp*0.03                                                                                 
    --         end                                               
    --      if   @scmj >=90  AND @scmj <=144                                                                                 
    --         begin                                                                                  
    --         set @decDsFee = @decTmp*0.015                                                                                  
    --         end                    

    --      if   @scmj <90                                                                                
    --         begin                                                                   
    --         set @decDsFee = @decTmp*0.01                                                                                  
    --         end                                                     

    --    end                                                             



    --end                                                                                  
    --契税计算完毕                                          

    --维修基金                                                  
    --   计算方式：按实测建筑面积每平米105元收取                                               
    IF @chvItemName = '维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                          

        BEGIN

            SET @decDsFee = @mjtmp * 105;

        END;

        RETURN 6;
    END;
--维修基金计算完毕                                            




----2、印花税                                                  
----   --计算公式：每本5元,每多1个人名多收5块。                                                  

----                                                  
--    If @chvItemName='印花税'                                                  

--       Begin                                     

--   If @chvSource = '定单'                                                  
--          begin                                                  
--  --来源为“定单”通过交易表获取                                                  
--           Select @intCstCount = Count(*) From s_Order,s_Trade2Cst Where s_Order.TradeGUID = s_Trade2Cst.TradeGUID And s_Order.OrderGUID=@chvSaleGUID;                                                  
--       end            

--   If @chvSource = '合同'                                                  
--    --来源为“合同”通过合同表获取                                                  
--    begin                                                         
--            Select @intCstCount = Count(*) From s_Contract,s_Trade2Cst Where s_Contract.TradeGUID = s_Trade2Cst.TradeGUID And s_Contract.ContractGUID=@chvSaleGUID;                                                   
--       end                                                  

--     ---开始计算“产权证印花税”                                             

--  Set @decDsFee = 5 + (5 * (@intCstCount-1));                                                   

--    return 1                                                  

--     end                                                  
----产权证印花税计算结束                                                  





END;
--国贸公司代收费用计算结束                                          
















--兰州公司代收费用开始计算                                                  
IF (@buguid = '0190CAA8-00B3-E311-9927-E41F13C5183A')
BEGIN

    --产权登记费                                                  
    --   计算方式：一次性收160，公积金 按揭收240                                            
    IF @chvItemName = '产权登记'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea,
                   @bldguid = BldGUID
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @fkfs = PayformName
            FROM s_Order
            WHERE s_Order.OrderGUID = @chvSaleGUID;
            SELECT @bldname = BldName
            FROM p_Building
            WHERE BldGUID = @bldguid;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea,
                   @bldguid = BldGUID
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @bldname = BldName
            FROM p_Building
            WHERE BldGUID = @bldguid;
            SELECT @fkfs = PayformName
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  


        BEGIN
            IF @fkfs LIKE '%一次性%'
               AND @fkfs <> '一次性-公积金转款'
            BEGIN
                SET @decDsFee = 160;
            END;
            IF @fkfs = '一次性-公积金转款'
            BEGIN
                SET @decDsFee = 160;
            END;
            IF (
                   @fkfs LIKE '%按揭%'
                   OR @fkfs LIKE '%公积金%'
               )
               AND @fkfs <> '一次性-公积金转款'
            BEGIN
                SET @decDsFee = 240;

            END;
            IF @bldname LIKE '%地上%'
               AND @projGUID = 'F70E7F0A-7F46-E711-80BA-E61F13C57837'
            BEGIN
                SET @decDsFee = 80;
            END;
            PRINT '1212312';
            IF @bldname LIKE '%地下%'
            BEGIN
                PRINT '909090';
                PRINT @bldname;
                SET @decDsFee = 550;
                PRINT @decDsFee;
            END;
            IF (
                   @cplx = '住宅'
                   OR @cplx = '高级住宅'
               )
               AND @bldname NOT LIKE '%地下%'
            --      and @projguid in ('28ac3f06-c93b-e711-80ba-e61f13c57837','df2f7dec-cc3b-e711-80ba-e61f13c57837',
            --'5984fe77-da03-e811-80ba-e61f13c57837','ad4e043f-cd3b-e711-80ba-e61f13c57837','4edf2b04-dc03-e811-80ba-e61f13c57837','9bc898d5-cc3b-e711-80ba-e61f13c57837',
            --'39126d3a-783b-e711-80ba-e61f13c57837','ed41ba76-8b3b-e711-80ba-e61f13c57837','767be285-823b-e711-80ba-e61f13c57837')
            BEGIN
                SET @decDsFee = 80;
            END;
            IF (@cplx = '商业' OR @cplx = '地下室/车库')
            --     and @projguid in ('28ac3f06-c93b-e711-80ba-e61f13c57837','df2f7dec-cc3b-e711-80ba-e61f13c57837',
            --'5984fe77-da03-e811-80ba-e61f13c57837','ad4e043f-cd3b-e711-80ba-e61f13c57837','4edf2b04-dc03-e811-80ba-e61f13c57837','9bc898d5-cc3b-e711-80ba-e61f13c57837',
            --'39126d3a-783b-e711-80ba-e61f13c57837','ed41ba76-8b3b-e711-80ba-e61f13c57837','767be285-823b-e711-80ba-e61f13c57837')
            BEGIN
                SET @decDsFee = 550;
            END;

        END;

        RETURN 6;
    END;
    --产权登记费计算完毕                       



    ---抵押登记费                                       
    --计算方式：不管任何付款方式都要收，住宅820，非住宅（商业、车位）550..                                        

    IF @chvItemName = '抵押登记费'
    BEGIN
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea,
                   @fkfs = PayformName
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea,
                   @fkfs = PayformName
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;
        --开始计算                                     


        IF (@fkfs LIKE '%按揭%' OR @fkfs LIKE '%贷款%' OR @fkfs LIKE '%公积金%')
        BEGIN
            IF (@cplx = '住宅')
            BEGIN

                SET @decDsFee = 80;

            END;
            ELSE
            BEGIN
                SET @decDsFee = 550;
            END;
        END;



    END;
    --计算结束                                          



    ---测绘费                                          
    --计算方式：不管任何付款方式都要收，住宅820，非住宅（商业、车位）550..                                          

    IF @chvItemName = '测绘费'
    BEGIN
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea,
                   @fkfs = PayformName
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea,
                   @fkfs = PayformName
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;
        --开始计算                                             

        IF (@fkfs LIKE '%按揭%' OR @fkfs LIKE '%贷款%' OR @fkfs LIKE '%公积金%')
        BEGIN
            IF (@cplx = '住宅' OR @cplx = '高级住宅')
            BEGIN

                SET @decDsFee = 0.9 * @mjtmp;

            END;
            ELSE
            BEGIN
                SET @decDsFee = 1.26 * @mjtmp;
            END;

        END;


    END;
    --计算结束                                          



    --契税计算方式：实测建筑面积144平米以上的，按实测总价的3%收取；90-144按实测总计的1.5%收取。90以下1%                                          



    IF @chvItemName = '契税'
    BEGIN
        --取价格                                                                                  
        SET @decTmp = 0;
        --取面积                                                                                  
        SET @mjtmp = 0;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                              
        BEGIN
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0),
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
        END;

        --开始计算                                                                                       

        BEGIN
            IF @scmj > 144
            BEGIN
                SET @decDsFee = @decTmp * 0.03;
            END;
            IF @scmj >= 90
               AND @scmj <= 144
            BEGIN
                SET @decDsFee = @decTmp * 0.015;
            END;

            IF @scmj < 90
            BEGIN
                SET @decDsFee = @decTmp * 0.01;
            END;

        END;



    END;
    --契税计算完毕               

    --维修基金                                                  
    --   计算方式：按实测建筑面积每平米70元收取                                               
    IF @chvItemName = '维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea,
                   @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea,
                   @bldguid = BldGUID
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea,
                   @projGUID = ProjGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea,
                   @bldguid = BldGUID
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  

        BEGIN
            IF @cplx = '高级住宅'
            BEGIN
                SET @decDsFee = @scmj * 50;
            END;
            IF @bldguid = 'F33B106D-2116-4B9D-9CC7-E444A295D420'
            BEGIN
                SET @decDsFee = @scmj * 50;
            END;
            IF @cplx IN ( '住宅', '商业' )
               AND @bldguid <> 'F33B106D-2116-4B9D-9CC7-E444A295D420'
            BEGIN
                SET @decDsFee = @scmj * 70;
            END;

        END;

        RETURN 6;
    END;
    --维修基金计算完毕                                            




    --2、印花税                                                  
    --   --计算公式：每本5元,每多1个人名多收5块。                                                  

    --                                                  
    IF @chvItemName = '印花税'
    BEGIN

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;
        END;

        ---开始计算“产权证印花税”                                                  

        SET @decDsFee = 5 + (5 * (@intCstCount - 1));

        RETURN 1;

    END;
--产权证印花税计算结束                                                  





END;
--兰州公司代收费用计算结束                                          





--------------------                                          
--新疆公司代收费用开始计算                                                  
IF (@buguid = '3CDA8172-4E8A-E411-9927-E41F13C5183A')
BEGIN


    --契税计算方式：预售建筑面积144平米以上的，按预售总价的3%收取；90-144按预售总计的1.5%收取。90以下1%                          
    ---二套及以上总价款*3% 商业 总价款*3%                                          
    --契税进位精确到元，小数点后数字直接进位  modified by  xiaoyi 2015-11-11                                           


    IF @chvItemName = '契税'
    BEGIN

        --取价格                                                                                  
        SET @decTmp = 0;
        --取面积                                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        --来源为“定单”通过定单表获取                                                                        
        BEGIN

            SELECT @chvRoomGUID = RoomGUID,
                   @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;


            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
        END;


        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                                        
        BEGIN

            SELECT @chvRoomGUID = RoomGUID,
                   @decTmp = ISNULL(RmbHtTotal, 0),
                   @zynum = ZyNumber
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '车位';
            END;
        END;

        --开始计算                                         

        BEGIN


            IF (@cplx = '住宅' OR @cplx = '高级住宅')
            BEGIN

                IF @zynum = 1
                BEGIN

                    IF @mjtmp <= 90
                    BEGIN
                        SET @decDsFee = CEILING(@decTmp * 0.01);
                    END;


                    IF @mjtmp > 90
                    BEGIN
                        SET @decDsFee = CEILING(@decTmp * 0.015);
                    END;
                --IF  @mjtmp>=140                                          

                --BEGIN                                           
                -- set @decDsFee = CEILING(@decTmp*0.03)                                 
                --END                                          

                END;

                IF @zynum > 1
                BEGIN

                    IF @mjtmp <= 90
                    BEGIN
                        SET @decDsFee = CEILING(@decTmp * 0.01);
                    END;


                    IF @mjtmp > 90
                    BEGIN
                        SET @decDsFee = CEILING(@decTmp * 0.02);
                    END;
                --IF  @mjtmp>=140                                          

                --BEGIN                                           
                -- set @decDsFee = CEILING(@decTmp*0.03)                                            
                --END                                          

                END;



            END;
            IF (@cplx = '商业')
            BEGIN
                SET @decDsFee = CEILING(@decTmp * 0.03);

            END;



        END;



    END;
    --契税计算完毕                       

    --维修基金                                                  
    --   计算方式：按实测建筑面积每平米70元收取       
    IF @chvItemName IN ( '维修基金', '（新）维修基金' )
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                    
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID,
                   @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;




            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  

        BEGIN

            IF @bldguid IN ( 'CBE1ABBB-7A5D-4599-85A2-B415A2FEFF06', '06E1A32A-24D6-4A85-A892-67E235DD1DC1',
                             '16C11CAE-52D6-4BB0-8A2D-91E2EBA69F38', '791A5860-81FC-4B03-AB63-A68FA0AEA8CF',
                             '3CCDE625-B995-4021-B11E-2FAA4573E740', '5F00FDCB-9DD5-419F-B8AB-CE9DF10E9218',
                             '0BE75C26-144B-40FD-ABE5-E9728E9DD47E', 'D5FEB122-64E9-4A39-A4CF-BC490455C71E',
                             'C7040EDC-912B-4C7C-B4CC-D1F570BC31FE', '18F0D4F2-CE16-41E8-B6F1-197DE4E13FFD',
                             '3608C974-DA95-4FD4-9BC5-1F705D0A352F'
                           )
               OR
               (
                   @projGUID IN ( '5b6f3e7a-9241-e511-891a-e41f13c5183a', '6698e9d2-4829-e611-80b9-e41f13c51836' )
                   AND @bldguid NOT IN ( '5B9ABEFE-1E3E-41DD-A9D4-FE96EB59C47C',
                                         'A07BE351-EF27-45BA-B5C2-542A20D4026E', '65DD9A61-B190-4ABF-A702-6770BC57C499'
                                       )
               )
            BEGIN
                SET @decDsFee = @mjtmp * 108;
            END;

            IF @projGUID IN ( '5b6f3e7a-9241-e511-891a-e41f13c5183a' )
               AND @bldguid IN ( '5B9ABEFE-1E3E-41DD-A9D4-FE96EB59C47C', 'A07BE351-EF27-45BA-B5C2-542A20D4026E',
                                 '65DD9A61-B190-4ABF-A702-6770BC57C499'
                               )
            BEGIN
                SET @decDsFee = @mjtmp * 162;
            END;
        END;

        RETURN 6;
    END;
    --维修基金计算完毕         


    --维修基金                                                  
    --   计算方式：2016.5.1之前取得预售的，按照总房款的2%缴纳    
    --2016年5月1日后（包含）取得预售许可证配置电梯的,按照162元/平方，不配置电梯按照108元/平方                                               

    IF @chvItemName = '维修基金(电梯)'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                    
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea,
                   @cjtotal = RoomTotal
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @yszdate = YszGetDate
            FROM dbo.p_Building,
                 dbo.p_room
            WHERE dbo.p_Building.BldGUID = dbo.p_room.BldGUID
                  AND p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea,
                   @cjtotal = RoomTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID,
                   @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;




            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @yszdate = YszGetDate
            FROM dbo.p_Building,
                 dbo.p_room
            WHERE dbo.p_Building.BldGUID = dbo.p_room.BldGUID
                  AND p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  

        BEGIN

            IF @yszdate < '2016-05-1 00:00:00.000'
            BEGIN
                SET @decDsFee = ROUND(@cjtotal * 0.02, 2);
            END;

            IF @yszdate >= '2016-05-1 00:00:00.000'
            BEGIN
                SET @decDsFee = @scmj * 162;
            END;
        END;

        RETURN 6;
    END;




    IF @chvItemName = '维修基金(无电梯)'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                    
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea,
                   @cjtotal = RoomTotal
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @yszdate = YszGetDate
            FROM dbo.p_Building,
                 dbo.p_room
            WHERE dbo.p_Building.BldGUID = dbo.p_room.BldGUID
                  AND p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea,
                   @cjtotal = RoomTotal
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID,
                   @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;




            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @yszdate = YszGetDate
            FROM dbo.p_Building,
                 dbo.p_room
            WHERE dbo.p_Building.BldGUID = dbo.p_room.BldGUID
                  AND p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  

        BEGIN

            IF @yszdate < '2016-05-1 00:00:00.000'
            BEGIN
                SET @decDsFee = ROUND(@cjtotal * 0.02, 2);
            END;

            IF @yszdate >= '2016-05-1 00:00:00.000'
            BEGIN
                SET @decDsFee = @scmj * 108;
            END;
        END;

        RETURN 6;
    END;






    --维修基金计算完毕                                    

    --产权登记费                                                  
    --   计算方式：一次性收160，公积金 按揭收240                                            
    IF @chvItemName = '产权登记'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea,
                   @bldguid = BldGUID
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @fkfs = PayformName
            FROM s_Order
            WHERE s_Order.OrderGUID = @chvSaleGUID;
            SELECT @bldname = BldName
            FROM p_Building
            WHERE BldGUID = @bldguid;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea,
                   @bldguid = BldGUID
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @bldname = BldName
            FROM p_Building
            WHERE BldGUID = @bldguid;
            SELECT @fkfs = PayformName
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  


        BEGIN
            IF @fkfs LIKE '%一次性%'
               AND @fkfs <> '一次性-公积金转款'
            BEGIN
                SET @decDsFee = 160;
            END;
            IF @fkfs = '一次性-公积金转款'
            BEGIN
                SET @decDsFee = 160;
            END;
            IF (
                   @fkfs LIKE '%按揭%'
                   OR @fkfs LIKE '%公积金%'
               )
               AND @fkfs <> '一次性-公积金转款'
            BEGIN
                SET @decDsFee = 240;

            END;
            IF @bldname LIKE '%地上%'
               AND @projGUID = 'F70E7F0A-7F46-E711-80BA-E61F13C57837'
            BEGIN
                SET @decDsFee = 80;
            END;
            PRINT '1212312';
            IF @bldname LIKE '%地下%'
            BEGIN
                PRINT '909090';
                PRINT @bldname;
                SET @decDsFee = 550;
                PRINT @decDsFee;
            END;
            IF (
                   @cplx = '住宅'
                   OR @cplx = '高级住宅'
               )
               AND @bldname NOT LIKE '%地下%'
            --      and @projguid in ('28ac3f06-c93b-e711-80ba-e61f13c57837','df2f7dec-cc3b-e711-80ba-e61f13c57837',
            --'5984fe77-da03-e811-80ba-e61f13c57837','ad4e043f-cd3b-e711-80ba-e61f13c57837','4edf2b04-dc03-e811-80ba-e61f13c57837','9bc898d5-cc3b-e711-80ba-e61f13c57837',
            --'39126d3a-783b-e711-80ba-e61f13c57837','ed41ba76-8b3b-e711-80ba-e61f13c57837','767be285-823b-e711-80ba-e61f13c57837')
            BEGIN
                SET @decDsFee = 80;
            END;
            IF (@cplx = '商业' OR @cplx = '地下室/车库')
            --     and @projguid in ('28ac3f06-c93b-e711-80ba-e61f13c57837','df2f7dec-cc3b-e711-80ba-e61f13c57837',
            --'5984fe77-da03-e811-80ba-e61f13c57837','ad4e043f-cd3b-e711-80ba-e61f13c57837','4edf2b04-dc03-e811-80ba-e61f13c57837','9bc898d5-cc3b-e711-80ba-e61f13c57837',
            --'39126d3a-783b-e711-80ba-e61f13c57837','ed41ba76-8b3b-e711-80ba-e61f13c57837','767be285-823b-e711-80ba-e61f13c57837')
            BEGIN
                SET @decDsFee = 550;
            END;

        END;

        RETURN 6;
    END;
--产权登记费计算完毕                                            







END;
---新疆公司代收费用计算结束                                          




--太原公司代收费用开始计算                                                  
IF (@buguid = 'B2770421-F2D0-421C-B210-E6C7EF71B270')
BEGIN


    --契税计算方式：预售建筑面积144平米以上的，按预售总价的3%收取；90-144按预售总计的1.5%收取。90以下1%                          
    ---二套及以上总价款*3% 商业 总价款*3%                                          
    --契税进位精确到元，小数点后数字直接进位  modified by  xiaoyi 2015-11-11                                           




    --维修基金                  
    --   计算方式：按实测建筑面积每平米70元收取                                               
    IF @chvItemName IN ( '维修基金', '（新）维修基金' )
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID,
                   @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                            




        BEGIN
            SET @decDsFee = @scmj * 90;
        END;


        RETURN 6;
    END;
    --维修基金计算完毕                                        

    --产权登记费                                                  
    --   计算方式：住宅=实测*1，,商业=实测*1.5                                            
    IF @chvItemName = '测绘费'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @fkfs = PayformName
            FROM s_Order
            WHERE s_Order.OrderGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            SELECT @fkfs = PayformName
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  


        BEGIN
            IF @cplx LIKE '%住宅%'
            BEGIN
                SET @decDsFee = @scmj * 1;
            END;
            IF @cplx LIKE '%商业%'
            BEGIN
                SET @decDsFee = @scmj * 1.5;

            END;
        END;

        RETURN 6;
    END;
--产权登记费计算完毕                       







END;
---太原公司代收费用计算结束                                          





---------------------                                          






--武汉公司代收费用开始计算                                                  
IF (@buguid = 'B7B03F13-566B-409C-A960-AA2C91A384A4')
BEGIN
    --产权登记                                                  
    --   计算公式：圆梦城 住宅 80.商业550；                                                  
    IF @chvItemName = '产权登记'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                           
        IF (@projGUID = '49a28f94-0628-4947-b6ac-e9830406ef58')
        BEGIN
            IF (@cplx = '住宅' OR @cplx = '高级住宅' OR @cplx = '公寓' OR @cplx = '地下室/车库')
            BEGIN

                SET @decDsFee = 80;

            END;
            IF (@cplx = '商业')
            BEGIN

                SET @decDsFee = 550;

            END;
            RETURN 6;
        END;
    END;
--产权登记 完毕                                              
END;
--武汉公司代收费用计算结束                                    

--成都航逸公司代收费用开始计算                                                  
IF (@buguid = 'BBD25C3A-209D-4F67-8FF2-D7F7BA39D0DB')
BEGIN
    --维修基金                                          
    --   计算方式：有电梯 ：建筑成本价（1100元/㎡）×房屋建筑面积 ×2.5%（保留两位小数）    
    --无电梯 ：建筑成本价（1100元/㎡）×房屋建筑面积 ×2.0%（保留两位小数）                                              
    IF @chvItemName = '专项维修基金有电梯'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  

        BEGIN
            SET @decDsFee = CAST(@mjtmp * 1100 * 0.025 AS DECIMAL(18, 2));
        --set @decDsFee=ceiling (@mjtmp*45 )                                                    
        END;

        RETURN 6;
    END;
    --维修基金计算完毕                   

    IF @chvItemName = '专项维修基金无电梯'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  

        BEGIN
            SET @decDsFee = CAST(@mjtmp * 1100 * 0.02 AS DECIMAL(18, 2));
        --set @decDsFee=ceiling (@mjtmp*45 )                                                    
        END;

        RETURN 6;
    END;
--维修基金计算完毕                    



--计算结束                  

END;

---有线电视费结束                                                     

--成都航逸公司代收费用计算结束     







--里城公司代收费用开始计算                                                  
IF (@buguid = '43F0E86F-7AD8-44BE-8D57-7AB915F93E2D')
BEGIN
    --产权登记费                                          
    --   计算方式：产权登记 80一人，多1人 多10快                                              

    IF @chvItemName = '产权登记费'
    BEGIN
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            PRINT @intCstCount;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

        END;
        PRINT @ge;
        --开始计算                        


        IF @projGUID NOT IN ( '79071e3a-b873-4dde-96bf-d738470de19d', 'c1e6322f-cd0e-eb11-b398-f40270d39969' ) --晋江中航城-天骏                       
        BEGIN

            PRINT @cplx;
            IF @cplx = '商业'
            BEGIN

                SET @decDsFee = 550 + (10 * (@intCstCount - 1));
            END;

            IF @cplx <> '商业'
            BEGIN

                SET @decDsFee = 80 + (10 * (@intCstCount - 1));

            END;
        END;
        IF @projGUID IN ( '79071e3a-b873-4dde-96bf-d738470de19d', 'c1e6322f-cd0e-eb11-b398-f40270d39969' ) --晋江中航城-天骏       
        --c1e6322f-cd0e-eb11-b398-f40270d39969保利上城-一期
        BEGIN

            PRINT @cplx;
            IF @cplx IN ( '商业', '公寓' )
            BEGIN

                SET @decDsFee = 550 + (10 * (@intCstCount - 1));
            END;

            IF @cplx NOT IN ( '商业', '公寓' )
            BEGIN

                SET @decDsFee = 80 + (10 * (@intCstCount - 1));

            END;
        END;



        PRINT @projGUID;
        PRINT @decDsFee;
        RETURN 5;
    END;
    --产权登记费计算完毕 



    --代收电费                                          
    --   计算方式：20190901前收500,20190901(含)收100                                       

    IF @chvItemName = '代收电费'
    BEGIN
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @qsdate = QSDate
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            PRINT @intCstCount;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @qsdate = QSDate
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

        END;
        PRINT @ge;
        --开始计算                        


        IF DATEDIFF(d, @qsdate, '2019-9-1') > 0
        BEGIN
            SET @decDsFee = 500;

        END;

        IF DATEDIFF(d, @qsdate, '2019-9-1') <= 0
        BEGIN
            SET @decDsFee = 100;

        END;

        PRINT @decDsFee;
        RETURN 5;
    END;
    --代收电费计算完毕




    --公维金                                          
    --   计算方式：20190901前收500,20190901(含)收100                                       

    IF @chvItemName = '维修基金'
    BEGIN
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @qsdate = QSDate
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            PRINT @intCstCount;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID,
                   @qsdate = QSDate
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

        END;
        PRINT @ge;
        --开始计算                        
        --保利上城-一期



        IF @cplx = '地下室/车库'
        BEGIN
            SET @decDsFee = @mjtmp * 40;
        --SET @decDsFee = CAST(@mjtmp * 40 AS DECIMAL(18, 2));

        END;

        IF @cplx = '高级住宅'
           AND @projGUID IN ( 'c1e6322f-cd0e-eb11-b398-f40270d39969' )
        BEGIN
            SET @decDsFee = @mjtmp * 100;
        --SET @decDsFee = CAST(@mjtmp * 100 AS DECIMAL(18, 2));
        END;

		--保利檀樾1-2-3-5-6-8-9栋
		IF  @projGUID IN ( '83aa5bb8-0f82-eb11-b398-f40270d39969' )
        BEGIN
            SET @decDsFee = floor(@scmj * 110);

			--SET @decDsFee = @mjtmp * 110;
        --SET @decDsFee = CAST(@mjtmp * 100 AS DECIMAL(18, 2));
        END;

        ELSE IF @cplx NOT IN ( '地下室/车库', '高级住宅' )
        BEGIN
            SET @decDsFee = @mjtmp * 80;
        --SET @decDsFee = CAST(@mjtmp * 80 AS DECIMAL(18, 2));
        END;
        PRINT @mjtmp;

        PRINT @decDsFee;
        RETURN 5;
    END;
    --公维金计算完毕

    --开始计算契税
    IF @chvItemName = '契税'
    BEGIN --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                      
            SELECT @decTmp = ISNULL(RoomTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RoomTotal, 0),
                   @zynum = LEFT(ZyNumber, 1)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

        END;

        --开始计算“契税”                                                  


        IF (@cplx = '住宅')
        BEGIN

            IF (@zynum = 1)
            BEGIN
                IF @mjtmp <= 90
                BEGIN
                    SET @decDsFee = @decTmp * 0.01;
                END;
                IF @mjtmp > 90
                BEGIN
                    SET @decDsFee = @decTmp * 0.015;
                END;
            END;
            ELSE IF (@zynum = 2)
            BEGIN
                IF @mjtmp <= 90
                BEGIN
                    SET @decDsFee = @decTmp * 0.01;
                END;
                IF @mjtmp > 90
                BEGIN
                    SET @decDsFee = @decTmp * 0.02;
                END;
            END;
        END;
        ELSE
            PRINT '3%';
        SET @decDsFee = @decTmp * 0.03;

        PRINT @decTmp;
        PRINT @zynum;
        PRINT @cplx;
        PRINT @mjtmp;
        PRINT @decDsFee;
        RETURN 1;

    END;

    ---契税计算完毕


    --开始计算印花税
    IF @chvItemName = '印花税'
    BEGIN --取价格                                                  
        SET @decTmp = 0;
        --取面积                                                  
        SET @mjtmp = 0;


        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                      
            SELECT @decTmp = ISNULL(RoomTotal, 0),
                   @qsdate = QSDate
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

        END;
        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RoomTotal, 0),
                   @qsdate = QSDate
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

        END;

        --开始计算“印花税”                                                        
        IF @projGUID IN ( '79071e3a-b873-4dde-96bf-d738470de19d' )
           AND @cplx = '商业' --晋江中航城-天骏项目 的商业 需区分日期收费
        BEGIN
            IF YEAR(@qsdate) < 2019
            BEGIN
                SET @decDsFee = @decTmp * 5 / 10000;
            END;
            ELSE
                SET @decDsFee = @decTmp * 2.5 / 10000;
        END;
        ELSE
            PRINT '万分之五';
        SET @decDsFee = @decTmp * 5 / 10000;
        PRINT @qsdate;
        PRINT @decTmp;
        PRINT @cplx;
        PRINT @mjtmp;
        PRINT @decDsFee;
        RETURN 1;

    END;
    ---印花税计算完毕


    ---开始计算维修基金
    IF @chvItemName = '维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  
        IF @projGUID IN ( '65e5cf66-6395-4e29-a323-65da466db135', '79071e3a-b873-4dde-96bf-d738470de19d',
                          'b803bd21-f20f-e911-80bf-e61f13c57837', 'adf3af2d-f20f-e911-80bf-e61f13c57837'
                        )
        BEGIN

            IF @cplx = '住宅'
            BEGIN
                SET @decDsFee = CAST(@mjtmp * 80 AS DECIMAL(18, 2));
            END;

            IF @cplx = '高级住宅'
            BEGIN
                SET @decDsFee = CAST(@mjtmp * 100 AS DECIMAL(18, 2));
            END;

            IF @cplx = '地下室/车库'
            BEGIN
                SET @decDsFee = CAST(@mjtmp * 40 AS DECIMAL(18, 2));
            END;

        END;


        IF @projGUID IN ( 'dd4d7608-a9f7-4cb4-8e26-23ae39ef1611' )
        BEGIN

            IF @cplx = '住宅'
               OR @cplx = '商业'
            BEGIN
                SET @decDsFee = CAST(@mjtmp * 120 AS DECIMAL(18, 2));
            END;



            IF @cplx = '地下室/车库'
            BEGIN
                SET @decDsFee = CAST(@mjtmp * 75 AS DECIMAL(18, 2));
            END;

        END;

    END;

    --  return 6                                 





    ---陈
    IF @chvItemName = '抵押登记费'
    BEGIN
        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                  
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            PRINT @intCstCount;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @ajdke = ISNULL(AjTotal, 0) + ISNULL(GjjTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;






        --                 if @ge<>'公司'                          
        --begin                                                  
        --  select @ge='个人';                                                  
        --end                                                  
        END;
        PRINT @ge;
        --开始计算                        



        BEGIN
            PRINT '111111';
            PRINT @cplx;
            IF @cplx = '商业'
            BEGIN

                SET @decDsFee = 550;
            END;

            IF @cplx <> '商业'
            BEGIN

                PRINT 'lirui';
                SET @decDsFee = 80;

            END;
        END;

        RETURN 5;
    END;
--维修基金计算完毕 
-----chen





--计算结束                  

END;

---有线电视费结束                                                     

--里程公司代收费用计算结束     




--三亚公司代收费用开始计算                                                  
IF (@buguid = 'B0AD0C0D-75A3-4A2D-B597-2C391A136D3A')
BEGIN
    --维修基金                                          
    --   计算方式：按预售建筑面积每平米60元收取                                               
    IF @chvItemName = '维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  

        BEGIN
            SET @decDsFee = CAST(@mjtmp * 60 AS DECIMAL(18, 2));
        --set @decDsFee=ceiling (@mjtmp*45 )                                                    
        END;

        RETURN 6;
    END;
    --维修基金计算完毕                   


    ---有线电视费                  
    IF @chvItemName = '有线电视费'
    BEGIN
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @hx = HuXing
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @hx = HuXing
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;


        --开始计算                  

        IF (@projGUID = 'c749b8bc-e950-e411-9927-e41f13c5183a')
        BEGIN
            IF @hx LIKE '%A%'
            BEGIN
                SET @decDsFee = 300 + 50 * 8;
            END;

            IF @hx LIKE '%B%'
            BEGIN
                SET @decDsFee = 300 + 50 * 8;
            END;

            IF @hx LIKE '%C%'
            BEGIN
                SET @decDsFee = 300 + 50 * 7;
            END;


            IF @hx LIKE '%D%'
            BEGIN
                SET @decDsFee = 300 + 50 * 9;
            END;

        END;


    --计算结束                  

    END;

---有线电视费结束                                                     
END;
--三亚公司代收费用计算结束                              

--大连公司代收费用开始计算                                                  
IF (@buguid = 'CEBF9C18-CF48-49FD-B490-A86E3D9F10D4' or @buguid = '528CA87C-F7AF-4FDD-BD05-79641D9F67FB')
BEGIN
    --维修基金                                          
    --   计算方式：按预售建筑面积每平米60元收取                                               
    IF @chvItemName = '维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算                                                  

        BEGIN

            IF @projGUID NOT IN ( '81416418-6ac3-e711-80ba-e61f13c57837', 'e13fc7a1-2e6b-e911-80b7-0a94ef7517dd' ,'B3BA3317-D28E-EB11-B398-F40270D39969',
			'c288ce2d-518f-47e7-b4de-64b4407619e1','1A845153-7FFB-46B4-99B6-7C8FA08BE295' )
                SET @decDsFee = CAST(@mjtmp * 40 AS DECIMAL(18, 2));
				print @decDsFee

            IF @projGUID IN ( '81416418-6ac3-e711-80ba-e61f13c57837', 'e13fc7a1-2e6b-e911-80b7-0a94ef7517dd',
			'ec5280f2-480a-40e2-9696-20e5ecf69ce0','f1273948-6ac3-e711-80ba-e61f13c57837','fc18203a-3c24-4446-96ea-26cc104a323c','c288ce2d-518f-47e7-b4de-64b4407619e1')
                SET @decDsFee = CAST(@mjtmp * 50 AS DECIMAL(18, 2));
			--拾光年，实测建面*50
			---保利时代D地块
			IF @projGUID IN ( 'B3BA3317-D28E-EB11-B398-F40270D39969' ,'05AB13C7-BE04-4700-9BF5-71A2665238E0','16d8bce6-a9fc-4a7f-8acc-6a0c6095fea9','1A845153-7FFB-46B4-99B6-7C8FA08BE295')
                SET @decDsFee = CAST(@scmj * 50 AS DECIMAL(18, 2));
        --set @decDsFee=ceiling (@mjtmp*45 )   
		     
        END; 

        RETURN 6;
    END;
    --维修基金计算完毕  
	
		--采暖费2                                                   
    --   计算公式：大连市甘井子区旅顺北路由家村项目-保利时代                                                
    --                                        
    --                       
    IF @chvItemName = '采暖费2'
       BEGIN
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @hx = HuXing
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @hx = HuXing
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea,
				   @bldguid = BldGUID
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;

        --开始计算“采暖费2”                                                  
        IF @projGUID IN ( '05AB13C7-BE04-4700-9BF5-71A2665238E0') 
			and @cplx= '商业' --大连市甘井子区旅顺北路由家村项目-保利时代
        BEGIN
            SET @decDsFee = CAST(@scmj * 31 AS DECIMAL(18, 2));;
        END;
		IF @projGUID IN ( '05AB13C7-BE04-4700-9BF5-71A2665238E0','81416418-6ac3-e711-80ba-e61f13c57837','f1273948-6ac3-e711-80ba-e61f13c57837') 
			and @cplx= '住宅' --大连市甘井子区旅顺北路由家村项目-保利时代
        BEGIN
            SET @decDsFee = CAST(@scmj * 26 AS DECIMAL(18, 2));;
        END;

		IF @projGUID IN ( '90b7756f-2d57-e711-80ba-e61f13c57837') 
			--天禧项目-01地块三期
        BEGIN
            SET @decDsFee = CAST(@scmj * 31 AS DECIMAL(18, 2));;
        END;

		IF @projGUID IN ( 'b3ba3317-d28e-eb11-b398-f40270d39969','23f37564-2a57-e711-80ba-e61f13c57837','4d9a336b-70dd-eb11-b398-f40270d39969') 
			--保利拾光年-一期
			---增加保利熙悦
			--增加保利城一期
        BEGIN
            SET @decDsFee = CAST(@scmj * 26 AS DECIMAL(18, 2));;
        END;

		IF @projGUID IN ( '4960f6c2-bdd2-42a3-b153-9c36d7c314e6') 
			--增加保利金地湖光山语B地块
        BEGIN
            SET @decDsFee = CAST(@mjtmp * 26 AS DECIMAL(18, 2));;
        END;

		IF @projGUID IN ( '1A845153-7FFB-46B4-99B6-7C8FA08BE295')  and @bldguid in('943C52D4-FEA0-4A19-B2C7-475DB452149E','C79D97D1-A41F-4C7F-A517-1671423D7255')
			--增加大连市甘井子区旅顺北路由家村项目-A6地块6
        BEGIN
            SET @decDsFee = CAST(@scmj * 26 +150.93 AS DECIMAL(18, 2));;
        END;

		IF @projGUID IN ( '1A845153-7FFB-46B4-99B6-7C8FA08BE295')  and @bldguid in('C1A49196-B7B7-40B0-A406-41E866ECDDF6','678EEE8B-A07A-44DA-A1F1-C1D00857333F','CD37AC0E-DDAD-42FA-926A-A7F4E7391052')
			--增加大连市甘井子区旅顺北路由家村项目-A6地块8+7
        BEGIN
            SET @decDsFee = CAST(@scmj * 26 +123.55 AS DECIMAL(18, 2));;
        END;

		IF @projGUID IN ( '1A845153-7FFB-46B4-99B6-7C8FA08BE295')  and @bldguid in('E843CAD8-2A43-44DC-A9CD-C8D7B806DADA','7E397345-44C8-4FDA-AB9E-513F90DD9A6B','759D9B41-5137-46E3-8699-9387B827A559')
			--增加大连市甘井子区旅顺北路由家村项目-A6地块 ，8，9，12商铺
        BEGIN
            SET @decDsFee = CAST(@scmj * 31 AS DECIMAL(18, 2));;
        END;
		IF @projGUID IN ( '1A845153-7FFB-46B4-99B6-7C8FA08BE295')  and @bldguid in('755A0E53-F313-42C1-85ED-7F3F0255B0B3')
			--增加大连市甘井子区旅顺北路由家村项目-A6地块9号楼
        BEGIN
            SET @decDsFee = CAST(@scmj * 26 +102.258 AS DECIMAL(18, 2));;
        END;

		IF @projGUID IN ( '1A845153-7FFB-46B4-99B6-7C8FA08BE295')  and @bldguid in('0AC4BDEB-A34B-4B06-8B49-4C4DB32C317F','6609E156-32A5-4573-A280-3F90819B603A')
			--增加大连市甘井子区旅顺北路由家村项目-A6地块 ，10，11商铺
        BEGIN
            SET @decDsFee = CAST(@scmj * 40.3 AS DECIMAL(18, 2));;
        END;
		--星光照澜
		IF @projGUID IN ( 'ec5280f2-480a-40e2-9696-20e5ecf69ce0','6a4033bb-c81d-435f-8666-f412a05e2fc3') 
			and @cplx= '住宅' 
        BEGIN
            SET @decDsFee = CAST(@scmj * 26 AS DECIMAL(18, 2));;
        END;


    END;


	--4.2、电费                                                   
    --   计算公式：大连市甘井子区旅顺北路由家村项目-保利时代                                                
    --                                        
    --                       
    IF @chvItemName = '电费'
    BEGIN
        --取价格                                         
        SET @decTmp = 0;

        --取出是个人购买还是公司购买                                                  
        SET @ge = NULL;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @decTmp = ISNULL(RmbCjTotal, 0)
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Order,
                 s_trade2cst
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;


            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Order,
                 s_trade2cst,
                 p_Customer
            WHERE s_Order.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Order.OrderGUID = @chvSaleGUID;
            IF @ge <> '公司'
            BEGIN
                SET @ge = '个人';
            END;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;

        END;

        IF @chvSource = '合同'
        --来源为“合同”通过交易表获取                                                  
        BEGIN
            SELECT @decTmp = ISNULL(RmbHtTotal + SjBcTotal, 0)
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @projGUID = ProjGUID,
                   @chvRoomGUID = RoomGUID
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room
                 LEFT JOIN p_BuildProductType ON p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
            WHERE p_room.RoomGUID = @chvRoomGUID;
            SELECT @intCstCount = COUNT(*)
            FROM s_Contract,
                 s_trade2cst
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            SELECT @ge = RTRIM(p_Customer.CstType)
            FROM s_Contract,
                 s_trade2cst,
                 p_Customer
            WHERE s_Contract.TradeGUID = s_trade2cst.TradeGUID
                  AND p_Customer.CstGUID = s_trade2cst.CstGUID
                  AND s_Contract.ContractGUID = @chvSaleGUID;

            IF @ge <> '公司'
            BEGIN
                SELECT @ge = '个人';
            END;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算“电费”                                                  
        IF @projGUID IN ( '05AB13C7-BE04-4700-9BF5-71A2665238E0') 
			and @cplx= '商业' --大连市甘井子区旅顺北路由家村项目-保利时代
        BEGIN
            SET @decDsFee = 1300;
        END;
		IF @projGUID IN ( '05AB13C7-BE04-4700-9BF5-71A2665238E0') 
			and @cplx= '住宅' --大连市甘井子区旅顺北路由家村项目-保利时代
        BEGIN
            SET @decDsFee = 500;
        END;


    END;

    --业主预存IC卡电费；


    ---采暖费                  
    IF @chvItemName = '采暖费'
    BEGIN
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @hx = HuXing
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @hx = HuXing
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea,
				   @bldguid = BldGUID
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
        END;


        --开始计算                  

        BEGIN
		--金地保利招商星光照澜 - 二期    天禧项目-01地块三期除开15栋
		IF @projGUID IN ( '6a4033bb-c81d-435f-8666-f412a05e2fc3','90b7756f-2d57-e711-80ba-e61f13c57837' )
               and @bldguid not in('1AE6C066-7987-4A06-9395-308F36B94143','BE4FBCEC-11E9-49E8-A5B5-E27F6FF01A0C','7942F1F8-11AE-4E98-B63A-2144C8AC2E73',
'049B20C2-C037-4441-93BD-2B243B364467','EFF6E346-BE27-4BD5-A50E-51DF7F720E5B','95F0D82B-C11E-451A-A1BF-4B6BDF0AFAFF')
                --SET @decDsFee = CAST(@scmj * 31 AS DECIMAL(18, 2));
				SET @decDsFee = CAST(@scmj  * 31/152*93 AS DECIMAL(18, 2));

				IF @projGUID IN ( '1A845153-7FFB-46B4-99B6-7C8FA08BE295')  and @bldguid in('943C52D4-FEA0-4A19-B2C7-475DB452149E','C79D97D1-A41F-4C7F-A517-1671423D7255')
			--增加大连市甘井子区旅顺北路由家村项目-A6地块6
            SET @decDsFee = CAST(@scmj * 26 +150.93 AS DECIMAL(18, 2));;

		IF @projGUID IN ( '1A845153-7FFB-46B4-99B6-7C8FA08BE295')  and @bldguid in('C1A49196-B7B7-40B0-A406-41E866ECDDF6','678EEE8B-A07A-44DA-A1F1-C1D00857333F','CD37AC0E-DDAD-42FA-926A-A7F4E7391052')
			--增加大连市甘井子区旅顺北路由家村项目-A6地块8+7
            SET @decDsFee = CAST(@scmj * 26 +123.55 AS DECIMAL(18, 2));;

					--天禧项目-01地块三期15栋
		IF @projGUID IN ('90b7756f-2d57-e711-80ba-e61f13c57837' )
               and @bldguid  in('1AE6C066-7987-4A06-9395-308F36B94143','BE4FBCEC-11E9-49E8-A5B5-E27F6FF01A0C','7942F1F8-11AE-4E98-B63A-2144C8AC2E73',
'049B20C2-C037-4441-93BD-2B243B364467','EFF6E346-BE27-4BD5-A50E-51DF7F720E5B','95F0D82B-C11E-451A-A1BF-4B6BDF0AFAFF')
				SET @decDsFee = CAST(@scmj  * 31 AS DECIMAL(18, 2));

			--拾光年住宅 9.11.12.13.14.15.16.17的采暖费是：实测建筑面积*26--2-7
			IF @projGUID IN ( 'B3BA3317-D28E-EB11-B398-F40270D39969' )
              and  @bldguid in ('82A1F77E-D525-4E9D-AD1D-1E045A532564','CD09B2C9-66E9-4269-B35C-A81621DF6B09','D0EE8B6D-F2F1-4252-99F0-2C3725405CD7',
			  '54B34C96-CA50-4972-A3BA-26CFA254911F','74BF0446-DF0F-4216-A679-D98530B9EC10','C78AF4F2-2D1C-445E-B184-DB0CB3F9FAE3',
			  'BF79D0EF-D69A-4497-9537-19F4678D8DAE','D4F8DAC2-0BD1-4BE3-B1C6-1FDB740629FD','9DFE3242-99B8-4E15-A8B3-096A8CFD97C5',
			  '42D19E3E-2D33-4FC9-A60E-C34AA4019669','9878070E-EB89-485D-B019-64D35ED8793E','9CB057DA-22FB-456C-8003-DEF20F08A1BD',
			  'B6907466-9696-48F0-AF8E-8BD3D2D8B314','E8BB2AFD-B1D8-4F0F-93B3-766072413528')

                SET @decDsFee = CAST(@scmj * 26 AS DECIMAL(18, 2));

			--大连市甘井子区旅顺北路由家村项目-保利时代D地块D2-1和D2-2这两个楼的公式是：采暖费：建筑面积*31
			IF @projGUID IN ( '16D8BCE6-A9FC-4A7F-8ACC-6A0C6095FEA9' )
              and  @bldguid in ('B371BB16-1547-4811-ABD6-26825B52DB81','0D1AAF24-FA92-4533-9B31-7E0E4A9FF47B')

                SET @decDsFee = CAST(@scmj * 31 AS DECIMAL(18, 2));

			--【大连保利拾光年一期-商铺12 、13、 16、 17 、18、 19 、20】 采暖费是：实测建筑面积*1.2*31
			IF @projGUID IN ( 'B3BA3317-D28E-EB11-B398-F40270D39969' )
              and  @bldguid in ('5AE3A55A-AFE9-4692-B3FE-3BF5FDB5D890','EA42C5DF-20BC-43A4-A607-9956FF8E32D5','D380B6D7-80FC-4388-95B8-7F978A5CC2B1',
			  '7BEDE130-E03A-4950-8E3F-FE8852FC11F0','3799CEA0-04F1-4545-BF66-ACECA1374221','06C008D1-52FE-4798-A1B7-3FD746566423','5B487CF9-7601-4101-BAE3-7EAA965343A5')
			  and @chvRoomGUID not in('233C0EDE-46B9-4457-941C-184F728A519C','A96C5109-133D-4C92-9CD8-C68E7A724B95','D807B4C5-D10B-4DB0-A0F9-1D2690B6D217',
			  '85BF1F96-8F2C-49FC-9E82-7223353AFE52','60E4AD48-1947-42D8-B95A-1151A1CF655C','168F9472-C763-458E-B5FA-31E8E51CA1A2')

                SET @decDsFee = CAST(@scmj * 1.2*31 AS DECIMAL(18, 2));

            IF @projGUID IN ( '42e01936-2d57-e711-80ba-e61f13c57837', '81aca12c-2c3b-e911-80b7-0a94ef7517dd', '81416418-6ac3-e711-80ba-e61f13c57837' )
               AND @chvRoomGUID IN (
                                       SELECT RoomGUID
                                       FROM p_room
                                       WHERE bldguid IN ( '17423CF4-87B6-462C-9DEF-EB95AEC2BC23',
                                                          'AAA47F60-BA3C-467C-A54A-745BE89BD646',
                                                          '4EBB1FA6-1F3C-4CB4-AAA0-3981905DF486',
														  'ab5b578a-716d-4837-b040-3876e131880f'--产品楼栋id，保利和府-一期B2-23栋
                                                        )
                                   )
                SET @decDsFee = CAST(@mjtmp * 31 AS DECIMAL(18, 2));

				--和府二期B1-3、4、5、6、10、11、14、15、18、19、20、8、9、12、13采暖费=面积*26
			IF @projGUID IN ( 'f1273948-6ac3-e711-80ba-e61f13c57837' )
               AND @chvRoomGUID IN (
                                       SELECT RoomGUID
                                       FROM p_room
                                       WHERE bldguid IN ('C176D54A-D45A-49EE-B67C-365466E18334','218D4B7B-222D-496E-8750-3D6374E289C6',
'9F1974C3-12D7-4F89-9FB6-8BBD57649627','4406D0ED-C280-4ACA-8703-B4FAF5EF2342',
'08FA8C2F-0516-4AA3-ABF3-2D5C7487A191','DBB4859B-18A7-4972-8F53-FB628E9A617D',
'9792CF28-164F-4680-884A-306129BD89AE','712F3D8C-A5E4-4CF4-B8FB-4F79D221FAC8',
'20FDCD09-CCDD-491A-82E2-9B1C8A17EBBF','0BDC6E6B-F766-416A-BCDE-E40926EDE59E',
'ACED4D7C-B342-4B4C-8F2C-03037BF3C26D','0026FCB2-82E9-E811-80BF-E61F13C57837',
'2C02AF64-1AC2-4941-8017-A84489BC5F28','D34179CD-030E-42B5-A645-833DB3D78D8C',
'89470B85-71CE-40C2-A6F9-258A35B72D86'
                                                        )
                                   )
                SET @decDsFee = CAST(@scmj * 26 AS DECIMAL(18, 2));
				--和府二期 B1-3、4、5、6、1、2商铺，采暖费=面积*31
				IF @projGUID IN ( 'f1273948-6ac3-e711-80ba-e61f13c57837' )
               AND @chvRoomGUID IN (
                                       SELECT RoomGUID
                                       FROM p_room
                                       WHERE bldguid IN (  'E5FB3A79-72A2-4F41-BD20-7D5CFCC75334','7C844148-93C1-4397-8A2A-A9C46655DCD8',
 'B64AB371-A33C-4E4A-8BEE-C122730B721F','05DECC29-656F-4E59-8A72-CA815B40BE56',
 '9A371BB7-83C2-40B8-933E-27CC73DFC4D5','D90AA68C-E8B3-476D-AF35-416A89F6B988'
									               
                                                        )
                                   )
                SET @decDsFee = CAST(@scmj * 31 AS DECIMAL(18, 2));

            IF @projGUID IN ( '42e01936-2d57-e711-80ba-e61f13c57837' )
               AND @chvRoomGUID IN (
                                       SELECT RoomGUID
                                       FROM p_room
                                       WHERE bldguid IN ( '1214190C-7536-47C8-B7E8-2FA9BFED15A3',
                                                          '93F67091-EAB8-4F7C-9677-9F9268491F86'
                                                        )
                                   )
                SET @decDsFee = CAST(@scmj * 26 AS DECIMAL(18, 2));

            IF @projGUID IN ( '42e01936-2d57-e711-80ba-e61f13c57837', '81aca12c-2c3b-e911-80b7-0a94ef7517dd' )
               AND @chvRoomGUID NOT IN (
                                           SELECT RoomGUID
                                           FROM p_room
                                           WHERE bldguid IN ( '17423CF4-87B6-462C-9DEF-EB95AEC2BC23',
                                                              'AAA47F60-BA3C-467C-A54A-745BE89BD646',
                                                              '4EBB1FA6-1F3C-4CB4-AAA0-3981905DF486',
                                                              '1214190C-7536-47C8-B7E8-2FA9BFED15A3',
                                                              '93F67091-EAB8-4F7C-9677-9F9268491F86',
                                                              '379ECFF1-0AB3-48CB-B851-2869291037D2',
                                                              '6949E9B9-7750-495A-B646-17CB33DAF2D4',
                                                              'F7967377-BB07-41E0-8F62-94991BE48799',
                                                              'B85DFDB6-69E1-464D-B6F6-74F312153FB1'
                                                            )
                                       )
                SET @decDsFee = CAST(@mjtmp * 26 AS DECIMAL(18, 2));


            IF @cplx LIKE '%商%'
               AND @projGUID IN ( '81416418-6ac3-e711-80ba-e61f13c57837' )
               AND @chvRoomGUID NOT IN (
                                           SELECT RoomGUID
                                           FROM p_room
                                           WHERE bldguid in ( 'C4088681-4067-4895-A93B-01D859A43476',
												'56C97865-35EA-4423-B637-CC3FD2559B34',
												'B4DDC7FD-266C-4BC8-B97E-B8EB73AB0B34'
										   )
                                       )
                SET @decDsFee = CAST(@mjtmp * 31 AS DECIMAL(18, 2));

				--和府一期B2-1住宅
			IF @projGUID IN ( '81416418-6ac3-e711-80ba-e61f13c57837' )
               AND @chvRoomGUID  IN (
                                           SELECT RoomGUID
                                           FROM p_room
                                           WHERE bldguid in ( 'B4DDC7FD-266C-4BC8-B97E-B8EB73AB0B34'
										   )
                                       )
                SET @decDsFee = CAST(@scmj * 26/152*81*1 AS DECIMAL(18, 2));

				--和府一期B2-1商铺101/102/103
			IF @projGUID IN ( '81416418-6ac3-e711-80ba-e61f13c57837' )
               AND @chvRoomGUID  IN (
                                           SELECT RoomGUID
                                           FROM p_room
                                           WHERE RoomGUID in('1D3D9426-4D47-4A12-B628-5B753C2D6F8E',
										   '43F95327-D4A5-40CF-8C37-0764ADC49D06',
										   '142F8F89-0326-4F6E-8EC1-4EFEB25FD5B0'
										   )
                                       )
                SET @decDsFee = CAST(@scmj * 31/152*81*1 AS DECIMAL(18, 2));

			--和府一期B2-1商铺104/105
			IF @projGUID IN ( '81416418-6ac3-e711-80ba-e61f13c57837' )
               AND @chvRoomGUID  IN (
                                           SELECT RoomGUID
                                           FROM p_room
                                           WHERE RoomGUID in('C848E2D8-92A9-43DD-8E14-A6A364C481F7',
										   'A226924D-BB1C-4DD6-88B9-BAD08D8251A5'
										   )
                                       )
                SET @decDsFee = CAST(@scmj * 31/152*81*1.2 AS DECIMAL(18, 2));

			--和府一期B2-1商铺106/107/108
			IF @projGUID IN ( '81416418-6ac3-e711-80ba-e61f13c57837' )
               AND @chvRoomGUID  IN (
                                           SELECT RoomGUID
                                           FROM p_room
                                           WHERE RoomGUID in('22C64CE1-1B30-43DB-805C-144D1483F6D9',
										   '80DA604C-5F95-4D3F-BF14-410393AB666D',
										   '2A4982C8-0A66-42D3-B1E2-4387E48AC86F'
										   )
                                       )
                SET @decDsFee = CAST(@scmj * 31/152*81*1.4 AS DECIMAL(18, 2));

            IF @projGUID IN ( '42e01936-2d57-e711-80ba-e61f13c57837' )
               AND @chvRoomGUID IN (
                                       SELECT RoomGUID
                                       FROM p_room
                                       WHERE bldguid = '379ECFF1-0AB3-48CB-B851-2869291037D2'
                                   )
                SET @decDsFee = CAST(@mjtmp * 31 AS DECIMAL(18, 2));
            IF @projGUID IN ( '42e01936-2d57-e711-80ba-e61f13c57837' )
               AND @chvRoomGUID IN (
                                       SELECT RoomGUID
                                       FROM p_room
                                       WHERE bldguid IN ( '6949E9B9-7750-495A-B646-17CB33DAF2D4',
                                                          'F7967377-BB07-41E0-8F62-94991BE48799',
                                                          'B85DFDB6-69E1-464D-B6F6-74F312153FB1'
                                                        )
                                   )
                SET @decDsFee = CAST(@mjtmp * 31 * 1.2 AS DECIMAL(18, 2));
            IF @projGUID IN ( '81416418-6ac3-e711-80ba-e61f13c57837' )
               AND @chvRoomGUID IN (
                                       SELECT RoomGUID
                                       FROM p_room
                                       WHERE bldguid = 'C4088681-4067-4895-A93B-01D859A43476'
                                   )

                SET @decDsFee = CAST(@mjtmp * 37.2 AS DECIMAL(18, 2));

				--和府别墅
				  IF @projGUID IN ( '81416418-6ac3-e711-80ba-e61f13c57837' )
               AND @chvRoomGUID IN (
                                       SELECT RoomGUID
                                       FROM p_room
                                       WHERE bldguid in (select BldGUID from p_Building where ProjGUID='81416418-6AC3-E711-80BA-E61F13C57837' and ProductName ='联排高级住宅')
                                   )

                SET @decDsFee = CAST(@mjtmp * 26*126/151 AS DECIMAL(18, 2));

            IF @cplx NOT LIKE '%商%'
               AND @projGUID NOT IN ( '81416418-6ac3-e711-80ba-e61f13c57837', '42e01936-2d57-e711-80ba-e61f13c57837',
                                      '81aca12c-2c3b-e911-80b7-0a94ef7517dd','4960f6c2-bdd2-42a3-b153-9c36d7c314e6','EC5280F2-480A-40E2-9696-20E5ECF69CE0','16D8BCE6-A9FC-4A7F-8ACC-6A0C6095FEA9'
									  ,'05AB13C7-BE04-4700-9BF5-71A2665238E0','f1273948-6ac3-e711-80ba-e61f13c57837','6a4033bb-c81d-435f-8666-f412a05e2fc3','90b7756f-2d57-e711-80ba-e61f13c57837'
									  ,'c288ce2d-518f-47e7-b4de-64b4407619e1','1A845153-7FFB-46B4-99B6-7C8FA08BE295'
                                    )
                SET @decDsFee = CAST(@mjtmp * 26 AS DECIMAL(18, 2));
            --set @decDsFee=ceiling (@mjtmp*45 )     
            IF @projGUID IN ( 'E13FC7A1-2E6B-E911-80B7-0A94EF7517DD' )
               AND @cplx LIKE '%住宅%'
                SET @decDsFee = CAST(@mjtmp * 26 AS DECIMAL(18, 2));

			IF @projGUID IN ( '4D9A336B-70DD-EB11-B398-F40270D39969','c288ce2d-518f-47e7-b4de-64b4407619e1' )
                SET @decDsFee = @mjtmp * 26 ;

			 IF @projGUID IN ( 'EC5280F2-480A-40E2-9696-20E5ECF69CE0' )
              and  @bldguid in ('C33C739B-7E5C-4CA4-A410-BDC800298BE8','5E31A617-3394-44F2-AB27-0F2803727853')
                SET @decDsFee = CAST(@mjtmp *31/152*95*1.2  AS DECIMAL(18, 2));


			 IF @projGUID IN ( 'EC5280F2-480A-40E2-9696-20E5ECF69CE0' )
              and  @bldguid in ('635192A1-F883-435E-92E2-444B4B211E7A','B855BD91-380E-4594-8FF0-8C62E4BBF78D','85BE5392-1B90-4CCD-AA34-37DD8A73AB64',
'0F9FD695-58A9-4BC0-8A7F-C29EFAE525AD','41001790-3C21-4A44-B46F-0E77873F5FBE','C27988B5-7D28-4885-95F5-F2B033600142',
'A972C021-1D5F-41BD-95C2-8CB9958D83FB','BF5A4445-CA47-4CAD-A736-5842484F9BE2')

                SET @decDsFee = CAST(@mjtmp * 16.25 AS DECIMAL(18, 2));


				--20221225增加大连市甘井子区旅顺北路由家村项目-保利时代
				IF @projGUID IN ( 'EC5280F2-480A-40E2-9696-20E5ECF69CE0' )
              and  @bldguid in ('706A0D37-1490-4D20-B176-660F418DB85D','13D20971-E7F9-4775-9D83-E7A93475E953','49432E7B-5931-448D-AACE-5CE09B7CF99F',
'94200EDA-8102-46DE-987E-AD179763AA82','95C87D10-370B-4BB1-A5E1-A23D523C435E','EA9EC8EA-4387-48CF-866D-159EA6E2CCE8',
'455F6AE2-80B8-4738-AEDA-BA7E39E562E8','7872E79A-A4B4-4A67-B9BB-1DAAA7FEB609','E1AB165F-7DF6-472F-81B6-9DCE8E545A8A')

                SET @decDsFee = CAST(@mjtmp * 26 AS DECIMAL(18, 2));
				--20230323增加金地保利招商星光照澜-一期 采暖费 实测面积*23


			 IF @projGUID IN ( '05AB13C7-BE04-4700-9BF5-71A2665238E0' )
              and  @bldguid in ('21D86FAB-632B-48D6-A1A9-1E2D77044D8B','41F41D1B-FA92-4D54-9FAA-2C25620532C4','010C2A88-F780-4A01-82DE-2F42B2F90E0C',
'2D8E6BA5-530B-4EFC-8347-2FBF7D5222D0','8DF6ABE8-F272-48D7-91DA-34B9EB775F57','48DF024F-BFB0-4B05-8824-4F785A01733E',
'B0076943-5DD8-47D6-B62D-6CF734FB4D1A','59C958AA-0452-4C8E-94E2-7717C7421023','3D4547EB-99D6-46E8-AA7C-8E329F832027',
'46ECAE62-67CE-44EF-B763-C34A3155C8AA','4943E1A8-4EA2-4477-8900-D12591CCB047','3D79EC1E-7225-4978-8818-DA20D456D8A5',
'2ECA0E33-BAE8-4AC2-B9FB-E46305078D0E')
                SET @decDsFee = CAST(@mjtmp*26/152*88*1  AS DECIMAL(18, 2));

				IF @projGUID IN ( '05AB13C7-BE04-4700-9BF5-71A2665238E0' )
              and  @bldguid in ('1187190A-9866-4D43-A627-CF7471640067','77648B37-007C-447A-B011-AE9A9EED9785','89B854CA-8F85-453D-A0BA-CD3EA66F62AA',
			  '269EAFE8-71C7-46F6-99D1-06A1A5613226','F31DF3CB-6FAD-4154-9750-56D3293405FB','78A3B9F2-8954-468D-A8F1-CF7F342182CA','594AE3DA-60A4-46E8-9BAD-8B79AA38263C')
			  SET @decDsFee = CAST(@mjtmp*26  AS DECIMAL(18, 2));

			  IF @projGUID IN ( '05AB13C7-BE04-4700-9BF5-71A2665238E0' )
              and  @bldguid in ('28FB6D5E-5898-4EF1-8A06-B3B38B649E7C','891B39E2-7D46-4F65-9D47-F535C5FB6038','7F8C22BB-6491-48EE-B026-52EAC69814DD',
			  '8A816F59-5B39-4033-A2EA-1D9E9EBB4A23')
			  SET @decDsFee = CAST(@mjtmp*31  AS DECIMAL(18, 2));
			
			 IF @projGUID IN ( '05AB13C7-BE04-4700-9BF5-71A2665238E0' )
              and  @chvRoomGUID in ('43A8C9D4-0369-47D0-9561-09A468F70CCD','878F9B07-4EDD-4CFB-A4A2-2A52E5DD60C4','0ED5BFBD-3AC7-4F3A-9831-4D0FBF43A42A',
'F68A06F3-B742-4DAF-8FBE-5FA8CF54C210','31769F17-92C2-425A-9883-A65DE991B11F','834B3D24-B63A-432A-BFE2-B4568726907C',
'FBF54ABB-63A3-4EA6-844C-C549E2799D58','10D17FC2-D7AA-411E-8872-E2EDDD21DC65','A7A674B5-F624-479E-BF3A-F288827BC7F0')
                SET @decDsFee = CAST(@mjtmp*31/152*88*1.1  AS DECIMAL(18, 2));


				
			 IF @projGUID IN ( '05AB13C7-BE04-4700-9BF5-71A2665238E0' )
              and  @chvRoomGUID in ('1B2DD9FF-C123-4C9A-AF40-0F824A11C82A','9E46121C-985F-40E0-9C0B-1499F97DC021','438D08D3-A248-4065-8782-17B992F2C72A',
'51204AB1-98B3-47A9-85AD-1F2B23F4BA03','6018D566-72CF-4A64-A19C-21BCD6D5E839','89E4FF44-7002-4288-B286-343D769CA301',
'F7C3B3A8-AF9A-4FE3-A92A-43A3A024F20E','463857D0-20E6-4839-A59E-54206C33E57C','7A0AEED9-2C18-4A1A-B44B-6751D9B08D17',
'92E3B187-19AB-4178-9354-77CD1D6AC1E8','D0E5B4B0-4774-4BEA-9572-A4B2776AEDCA','91147786-CE28-4A79-8045-A7B24BC80AE5',
'74D391BA-EA76-4FF2-A530-B13362985B4B','59ECB921-E485-4222-9D4F-B37B164394E0','95B336C6-45EB-4335-8AA3-BB7F17C53852',
'C463A4CD-53BE-4E55-B61D-BBAFF8F5DD06','F699C933-5A22-4BD2-B450-C2E18AF21355','F32FA5C1-A4CF-4313-B060-F389A78D25ED',
'61C38842-0929-4836-92B8-FAAC539FF13A','1A2AA1E9-59CD-4274-9F05-FF030406A2FA')
                SET @decDsFee = CAST(@mjtmp*31/152*88*1  AS DECIMAL(18, 2));

			IF @projGUID IN ( '05AB13C7-BE04-4700-9BF5-71A2665238E0' )
              and  @bldguid in ('EFD7DD0A-2D68-4F0D-B89F-7CC42F2D9F21','A3D88A91-429B-49E8-AB8E-DEE7075D8C04','E50C6ACF-6719-4CDA-AC52-7F7E96F46930',
			  'ADD42131-548B-4F84-8687-4C8C08FDCCB1','863A5F8B-F0AB-4CD4-93FB-FFD635D7600F','95D136A9-692B-40B4-AAB8-A49A79C7EB5C'
			  ,'654B0C90-B5FF-4F4A-B04B-9384617D8ECC','2F5029A5-C354-4E0E-8154-2468D16714A0','0FC2663C-0117-4E93-9EEE-DD47A6ACB69A'
			  ,'FDDB20D7-6D96-401C-9CEB-2CDD0F68BFFB','A36FBFD0-24A5-4140-8FA3-C5821F861B2E','12363781-8E8D-48B1-A8A6-FF778B122C5F'
			  ,'3BBE7FA0-A49F-4BE5-9C61-B4BE5C082CF7','299E3F7B-7893-4A74-9B44-E5B90B6688B3','4250798E-A3C6-45F9-BFAB-8423B550B577',
			  '12F2DC58-180C-415B-9A9B-511102752D93')
                SET @decDsFee = CAST(@scmj*26  AS DECIMAL(18, 2));

			 IF @projGUID IN ( '05AB13C7-BE04-4700-9BF5-71A2665238E0' )
              and  @chvRoomGUID in ('14169086-DA79-425E-B1D8-70A8A7B6638E','7036D42F-63C9-449F-BFEB-81DE198643A3','2BA34CEB-F12B-46FC-A380-CAB8FB81AEB3',
			  '7A4A6DAD-15BE-4F31-BA6E-7BEB868A8835','AD9B6AAA-E537-472D-A7D7-0234D82EB13F','37AD2B65-331B-4872-9B47-504C4C2F2D43',
			  '59F717CC-07F7-40CB-AF15-098F8D28F11C','7484D323-86E1-42B0-AEA4-B0B88113C7D1','43F50837-1685-4CB1-B386-5D722E2BC8E9',
			  '53899F12-1B54-417B-8CC0-11C56F90EBF1'
			  )
                SET @decDsFee = CAST(@scmj*31  AS DECIMAL(18, 2));

			 IF @projGUID IN ( '05AB13C7-BE04-4700-9BF5-71A2665238E0' )
              and  @chvRoomGUID in ('73F1721A-94F2-4D5C-8732-1363DFEE9E1D','AB2FC766-CBD7-4F5B-94BF-08540E974DC7','22F137C2-F1ED-4D5B-A637-0B2DF6DDD628',
			  '4ACA5CF1-2612-46E7-AA0A-685A5B5053DD','C08A8E18-4FD6-EB11-B398-F40270D39969','40824A03-6055-4DFD-B02F-AD5F4BE51DF2',
			  'F2E11E77-7505-4D7A-9310-7CFE965DBCDF','F33A3C4C-5F35-4F06-838D-D2C226EF2BF1','CB073B22-AE29-41DA-B717-BFAAC9C27F6D',
			  'D8BD0FDE-A9FA-440C-B684-4B98AB025900','F8CDDB4A-1B77-47D4-9C22-AECF8D433512','85FADE5E-05EC-440A-81C8-D4CE7E94A626',
			  '846A162F-31D5-493E-9E5A-F58C02E796F4','DF637BF7-4B8E-4D25-AB2C-0351C4E302E7','F284BD82-5D42-4AA5-99E1-240778C6C1D7',
			  'C74F4BE3-9036-41CF-9AD0-845D74ED427C'
			  )
                SET @decDsFee = CAST(@scmj*31*1.1  AS DECIMAL(18, 2));

		


            --20221220增加大连公司保利金地湖光山语B地块，需要设置采暖费的高级扩展，因为是合作项目，交付时间临时定在12.21，所以需要加急处理，算法如下：面积*26*0.6842。
            IF @projGUID IN ( '4960f6c2-bdd2-42a3-b153-9c36d7c314e6' )
			and @bldguid in('3995527E-F958-4F0E-A35A-08A35B445B75','D9A868FB-FC8B-4710-ADD4-E18E80A34965','E5E542EC-2934-4B6C-BA37-4C8FC1186F8F',
			'307084F3-1CB7-41DE-B38B-B7B56B221A16','8F5261DA-37BE-4874-B736-8BF72D27A7C5','2C003DC6-2EF1-4E90-8B49-D21028F8A518',
			'55354693-6996-47CA-A7D5-22B69B0C70E1','F4E42E3F-D82E-4689-9FAA-4A5475F5144F')
               begin
                SET @decDsFee = CAST(@mjtmp * 26 * 0.6842 AS DECIMAL(18, 2));
                print @decDsFee
			   end 

			IF @projGUID IN ( '4960f6c2-bdd2-42a3-b153-9c36d7c314e6'  )
			and @bldguid in('1DD397A2-A303-4A28-9452-449D8D572AE1','EC52BDF7-EA27-4AA6-8060-10C58DC2AE42','F74959C0-4AEC-48C1-AF10-4A29842B1B2D',
			'3D17D6AE-FB11-40B6-AA17-34FDB7211603','C399302F-DEF9-4A6E-8A42-85446870A6D6','64470DFA-A09A-45ED-84AA-AFF7A884FB8B',
			'6961128E-C80E-4C9E-8647-8AF73F427252','F8D2E035-92E5-4EBE-B71E-0A17D2C31C29','4A31BDB6-76CC-4302-83A6-E34AE621FE09',
			'F4A0121B-DCBB-4D51-8847-C8A8DFC2D30B','21C961C5-4FEA-417C-8C4C-16A6ABD8197D'
			)
               begin
                SET @decDsFee = CAST(@mjtmp * 26 AS DECIMAL(18, 2));
                print @decDsFee
			   end 
--由家村D6 住宅
	IF @projGUID IN (  'fc18203a-3c24-4446-96ea-26cc104a323c' )
			and @bldguid in('E9B8328B-6E99-49A7-9073-DEA2564D88A0','7507B53A-3BCE-472B-A686-CB0BDA52980B',
			'5C6756BE-EE52-428C-9D7C-7B25876887E2','2B290AD7-6C06-4B7C-AE53-34CEEF7FE1EB','9C2663A6-5D99-4BA1-ADE0-4454BB5BE065','DFBD74E4-5944-4241-A131-133B2F3185C0','05EB0D7A-3675-40C2-8043-30109EF1EA3A',
			'43FAF7F3-548B-45FE-9C2C-3273A4AE8198','D5AEC868-DBA0-4EA0-9B93-8A2EF6C325AA'
			)
               begin
                SET @decDsFee = CAST(@mjtmp * 26/152*95 AS DECIMAL(18, 2));
                print @decDsFee
			   end 


			   --由家村D6 商铺
	IF @projGUID IN (  'fc18203a-3c24-4446-96ea-26cc104a323c' )
			and @bldguid in('A68B5FE5-8CC4-4EB8-82AD-F058F2CA9C8C','241250BA-C734-4AC3-993B-628C1C4161CE','64D74B8D-8B58-428C-B324-A07AE922068E'
			)
               begin
                SET @decDsFee = CAST(@mjtmp * 31 AS DECIMAL(18, 2));
                print @decDsFee
			   end 


			  --I01二期 13号公寓面积*26元/平；13号底商和loft面积*31元/平
			  IF @projGUID IN ( 'ed60ec5c-2d57-e711-80ba-e61f13c57837' )
			and @bldguid in('32E67649-C18F-4036-AD20-20609DA90E29')
               begin
                SET @decDsFee = CAST(@mjtmp * 26 AS DECIMAL(18, 2));
                print @decDsFee
			   end 

			  IF @projGUID IN ( 'ed60ec5c-2d57-e711-80ba-e61f13c57837' )
			and @bldguid in('BDAEA825-C383-48F8-952D-73CDE6EF839D','08C17DEC-D42C-4893-B29D-5F13420C4504')
               begin
                SET @decDsFee = CAST(@mjtmp * 31 AS DECIMAL(18, 2));
                print @decDsFee
			   end 

			    IF @projGUID IN ( '1A845153-7FFB-46B4-99B6-7C8FA08BE295' )
			and @bldguid in('755A0E53-F313-42C1-85ED-7F3F0255B0B3')
               begin
                SET @decDsFee = CAST(@mjtmp * 26+102.258 AS DECIMAL(18, 2));
                print @decDsFee
			   end 

			   IF @projGUID IN ( '1A845153-7FFB-46B4-99B6-7C8FA08BE295' )
			and @bldguid in('7E397345-44C8-4FDA-AB9E-513F90DD9A6B','E843CAD8-2A43-44DC-A9CD-C8D7B806DADA','759D9B41-5137-46E3-8699-9387B827A559')
               begin
                SET @decDsFee = CAST(@mjtmp *31 AS DECIMAL(18, 2));
                print @decDsFee
			   end 

			    IF @projGUID IN ( '1A845153-7FFB-46B4-99B6-7C8FA08BE295' )
			and @bldguid in('0AC4BDEB-A34B-4B06-8B49-4C4DB32C317F','6609E156-32A5-4573-A280-3F90819B603A')
               begin
                SET @decDsFee = CAST(@mjtmp *40.3 AS DECIMAL(18, 2));
                print @decDsFee
			   end

			   --金地湖光山语B地块
			     IF @projGUID IN ( '4960f6c2-bdd2-42a3-b153-9c36d7c314e6' )
			and @bldguid in ('22E2FBBA-4678-40AD-B87D-7F2C07C16ACA','2DAE704A-B588-4D44-9711-24C164976DC3','FD2C1B68-70A1-4E30-8851-EC2619E89251',
'C01D4640-6336-469E-8BD3-CE4E00966F61','0B7AB6A5-3863-4854-A8E2-77F1D75D2AB8','701D224F-69E1-4DC4-9426-91479BB3EE1F')
               begin
                SET @decDsFee = CAST(@mjtmp * 26*0.90131579 AS DECIMAL(18, 2));
                print @decDsFee
			   end 

------保利时代D地块

			    IF @projGUID IN ( '16d8bce6-a9fc-4a7f-8acc-6a0c6095fea9','F1B10CDA-994C-4214-B183-94CFF8CA800B' )
			 AND @cplx LIKE '%住宅%'
               begin
                SET @decDsFee = CAST(@mjtmp * 26 AS DECIMAL(18, 2));
                print @decDsFee
			   end 

			  IF @projGUID IN ( '16d8bce6-a9fc-4a7f-8acc-6a0c6095fea9','F1B10CDA-994C-4214-B183-94CFF8CA800B' )
			AND @cplx LIKE '%商%'
               begin
                SET @decDsFee = CAST(@mjtmp * 31 AS DECIMAL(18, 2));
                print @decDsFee
			   end 

        END;

        RETURN 6;
    END;

END;


--计算结束                  


---采暖费结束                                                     

--大连公司代收费用计算结束 

--辽宁公司代收费用开始计算                                                  
IF (@buguid = '528CA87C-F7AF-4FDD-BD05-79641D9F67FB')
    ---采暖费                  
    IF @chvItemName = '采暖费'
    BEGIN
        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @hx = HuXing
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
			IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
        END;
        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @hx = HuXing
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;

            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea,
				   @bldguid = BldGUID
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
			IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
        END;


        --开始计算                  

        BEGIN
	--天汇 - 三期16号楼、21号楼 25号楼 23.3*实测建面每平米
	IF @projGUID IN ( 'D7E0EB60-662C-4909-AD52-8B30E28B0C4C')
	and @bldguid IN('AD1EEE70-D20A-4ED7-9980-8C93F82D20B2','3458E50E-890F-4B0B-B7EC-7FA8D27EF3BE','94090659-D2CA-4139-A3EC-E917DB01F157',
	'AD628C5C-1A13-4CE7-AA6E-35AB51C74087','C515D00A-146B-4C38-A1EE-19B1E8AA92EF','B77A45B3-4C93-4E64-BFDF-78E51723F5D7',
	'283EB589-A5B3-49E2-A358-75667D44B2EA','38480009-BA8E-4574-9604-01A9D7E6AF3E','55824421-CA54-4557-9216-826C28DBA780')
                SET @decDsFee = CAST(@scmj * 23.3 AS DECIMAL(18, 2));

	IF @projGUID IN ( 'C81C966F-D70D-4FA0-B569-164CFA873E53','23086544-3BE7-41AD-B66F-B6FDDBE0A471','891994CD-956F-E811-80BF-E61F13C57837','9647bf61-39ad-4e11-82d4-4a6385f83209',
'01F6B7D7-02B9-EB11-B398-F40270D39969'--,'C53CE855-6E56-E711-80BA-E61F13C57837','6DDBF07F-6E56-E711-80BA-E61F13C57837'
,'28A3ECB5-7056-E711-80BA-E61F13C57837','D7E0EB60-662C-4909-AD52-8B30E28B0C4C')
--and @bldguid not in('A7047E05-A877-46C0-82BE-F2D75FF28762','78CFBB6B-9D6C-4FB0-A6FA-8D121DF31D68','9CAEA3CA-8904-4A97-B01A-DFDC1511C145')
                SET @decDsFee = CAST(@scmj * 23.3 AS DECIMAL(18, 2));
	
	--沈阳保利茉莉公馆-四期（原二期部分）
	IF @projGUID IN ('C951BFA3-7056-E711-80BA-E61F13C57837')
	and @cplx='住宅'
				SET @decDsFee = CAST(@scmj * 23.3*2 AS DECIMAL(18, 2));

	--沈阳保利城一期：8# 15# 33#
	--IF @projGUID IN ( '01F6B7D7-02B9-EB11-B398-F40270D39969' )
	--and @bldguid IN('A7047E05-A877-46C0-82BE-F2D75FF28762','78CFBB6B-9D6C-4FB0-A6FA-8D121DF31D68','9CAEA3CA-8904-4A97-B01A-DFDC1511C145')
 --               SET @decDsFee = CAST(@scmj * 23.3*2 AS DECIMAL(18, 2));

	--天汇-四期33# 35# 37# 38#
	IF @projGUID IN ( '84D0EA63-90BE-498B-BB96-118A0583F12A')
	and @bldguid IN('D80998DB-629E-4A08-B8C6-AD88566F8A56','03227C5B-37E0-4A99-83CF-507B7BC41674','8B8EC76D-6047-48C5-B09C-28E67DB63F66','D5C7FC8E-8D6F-46C7-ADD1-234E15E8215A')
                SET @decDsFee = CAST(@scmj * 23.3*2 AS DECIMAL(18, 2));

	IF @projGUID IN ( '8645b78f-dfc7-ea11-80b8-0a94ef7517dd') and @bldguid not in('6AADFAD2-5793-4C1C-B872-B99700EE9090','43A34854-167B-4DFF-B25A-D119C5E81924')
                SET @decDsFee = CAST(@scmj * 23.3 AS DECIMAL(18, 2));


	IF @projGUID IN ( 'D4D57670-C457-E711-80BA-E61F13C57837')
                SET @decDsFee = CAST(@scmj * 28.5 AS DECIMAL(18, 2));

	IF @projGUID IN ('b7d9e816-7156-e711-80ba-e61f13c57837','d993d53a-7156-e711-80ba-e61f13c57837',
'19cfe9d5-4b81-e911-80b7-0a94ef7517dd','36e09687-f384-40f7-93bc-74d14207a494','e960b3e0-ac0b-e811-80ba-e61f13c57837')
	and @cplx='住宅'
				SET @decDsFee = CAST(@scmj * 23.3 AS DECIMAL(18, 2));
	IF @projGUID IN ('b7d9e816-7156-e711-80ba-e61f13c57837','d993d53a-7156-e711-80ba-e61f13c57837',
'19cfe9d5-4b81-e911-80b7-0a94ef7517dd','36e09687-f384-40f7-93bc-74d14207a494','e960b3e0-ac0b-e811-80ba-e61f13c57837')
	and @cplx='商业'
				SET @decDsFee = CAST(@scmj * 32 AS DECIMAL(18, 2));

--20241028住宅46.6*实测面积。商业32*实测面积  沈阳市沈河区高官台东-3地块
	IF @projGUID IN ('615b8aaf-b9b3-eb11-b398-f40270d39969')
	and @cplx='住宅'
				SET @decDsFee = CAST(@scmj * 23.3*2 AS DECIMAL(18, 2));
	IF @projGUID IN ('615b8aaf-b9b3-eb11-b398-f40270d39969')
	and @cplx='商业'
				SET @decDsFee = CAST(@scmj * 32 AS DECIMAL(18, 2));

---加沈阳保利时光印象一期0808,*2  紫云
	IF @projGUID IN ('73686697-b9b3-eb11-b398-f40270d39969','bbbf493e-fc40-eb11-b398-f40270d39969')
				SET @decDsFee = CAST(@scmj * 23.3*2 AS DECIMAL(18, 2));

--丹东香槟国际
IF @projGUID IN ('b650684e-759f-e711-80ba-e61f13c57837','9f69082b-6e9f-e711-80ba-e61f13c57837','7d8a64b5-669f-e711-80ba-e61f13c57837')
	and @cplx='商业'
				SET @decDsFee = CAST(@scmj * 30 AS DECIMAL(18, 2));
				IF @projGUID IN ('b650684e-759f-e711-80ba-e61f13c57837','9f69082b-6e9f-e711-80ba-e61f13c57837','7d8a64b5-669f-e711-80ba-e61f13c57837')
	and @cplx='住宅'
				SET @decDsFee = CAST(@scmj * 26 AS DECIMAL(18, 2));

  IF @projGUID IN ('dba6a4d2-7256-e711-80ba-e61f13c57837','6ddbf07f-6e56-e711-80ba-e61f13c57837','83eb960d-6e56-e711-80ba-e61f13c57837',
	 'c53ce855-6e56-e711-80ba-e61f13c57837','b1889242-7356-e711-80ba-e61f13c57837','837f90e2-4b81-e911-80b7-0a94ef7517dd',
	 '63aace91-7056-e711-80ba-e61f13c57837', '77889f79-7056-e711-80ba-e61f13c57837')
				SET @decDsFee = CAST(@scmj * 23.3 AS DECIMAL(18, 2));
        END;
			
    END;


--计算结束                  


---采暖费结束                                                     

--辽宁公司代收费用计算结束 




--南海（华南）公司代收费用开始计算                                                  
IF (@buguid = '70DD6DF4-47F7-46AF-B470-BC18EE57D8FF')
BEGIN
    --维修基金                                                  
    --   计算方式：茂名博贺湾项目 按预售建筑面积每平米45元收取                                               
    IF @chvItemName = '维修基金'
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @roomtotal = RoomTotal,
                   @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea,
                   @bldguid = BldGUID
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            SELECT @floor = MAX(FloorNo)
            FROM p_FloorPlan
            WHERE BldGUID = @bldguid;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @roomtotal = RoomTotal,
                   @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea,
                   @bldguid = BldGUID
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            SELECT @floor = MAX(FloorNo)
            FROM p_FloorPlan
            WHERE BldGUID = @bldguid;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;
        PRINT '67890 ';
        PRINT @projGUID;
        PRINT @mjtmp;
        --开始计算                                                  
        IF (@projGUID IN ( 'aaa960c8-7dbd-e411-9927-e41f13c5183a', '7fe03e83-eade-e711-80ba-e61f13c57837',
                           '3f3620bc-c933-e711-80ba-e61f13c57837'
                         )
           )
        BEGIN
            IF @cplx = '高级住宅'
                SET @decDsFee = CAST(@mjtmp * 37.5 AS DECIMAL(18, 2));
            --set @decDsFee=ceiling (@mjtmp*45 )            
            ELSE
                SET @decDsFee = CAST(@mjtmp * 45 AS DECIMAL(18, 2));
        END;

        IF (@projGUID IN ( '45b01985-9b67-e711-80ba-e61f13c57837', 'A31403C2-2740-E711-80BA-E61F13C57837' ))
        BEGIN
            PRINT '********';
            SET @decDsFee = CAST(@mjtmp * 45 AS DECIMAL(18, 2));
            PRINT @decDsFee;
        END;

        IF @projGUID IN ( 'dda8c24c-7098-e711-80ba-e61f13c57837', '7ef40dcf-f81f-e611-80b9-e41f13c51836',
                          '79ff9fdb-4131-e711-80ba-e61f13c57837'
                        )
        BEGIN
            SET @decDsFee = CAST(@roomtotal * 0.01 AS DECIMAL(18, 2));
        END;


        --if @projGUID  in (/* 'A31403C2-2740-E711-80BA-E61F13C57837',*/  '45B01985-9B67-E711-80BA-E61F13C57837'  )       

        --begin      
        --if  @floor <=7    

        --begin     
        -- set @decDsFee=cast (@mjtmp*37.5 as decimal(18,2) )             
        --end     
        --  if  @floor >=8  and  @floor<=12    

        --  begin     
        --       set @decDsFee=cast (@mjtmp*42.5 as decimal(18,2) )             

        --  end     
        --  if  @floor>12     
        --   begin     
        --       set @decDsFee=cast (@mjtmp*45  as decimal(18,2) )             

        --  end     
        --end                                              

        RETURN 6;
    END;
    --维修基金计算完毕 
    PRINT @decDsFee;
END;
--南海（华南）公司代收费用计算结束  




--苏州公司代收费用开始计算                                                  
IF (@buguid = 'E9FE544D-9B27-487A-AB66-A957ADEC977E')
BEGIN


    --维修基金                  
    --   计算方式：按实测建筑面积每平米90元收取                                               
    IF @chvItemName IN ( '维修基金', '（新）维修基金' )
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('商铺', @cplx) > 0
            BEGIN
                SET @cplx = '商铺';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID,
                   @cplx = p_BuildProductType.BProductTypeName
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = ScBldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('商铺', @cplx) > 0
            BEGIN
                SET @cplx = '商铺';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算     
		  IF (@projGUID IN ( '54FFA6AE-3A94-EA11-80B8-0A94EF7517DD' ))
        BEGIN

            SET @decDsFee = @scmj * 125;
       
        END;
		--堂悦花园-一期维修基金面积*120
        IF (@projGUID IN ( '48d89321-42b2-e711-80ba-e61f13c57837' ))
        BEGIN

            SET @decDsFee = @scmj * 100;
        --set @decDsFee=ceiling (@mjtmp*45 ) 
        END;
		--堂悦花园-二期维修基金面积*120
		---和光山语雅筑，时光印象雅苑一期添加
		--大都汇添加
        IF (@projGUID IN ( 'F86A5960-63D6-EB11-B398-F40270D39969','75856a13-6c55-eb11-b398-f40270d39969','497e5c8c-9e80-eb11-b398-f40270d39969','28597f8e-a628-ec11-b398-f40270d39969' ))
        BEGIN

            SET @decDsFee = @scmj * 120;
        --set @decDsFee=ceiling (@mjtmp*45 ) 
        END;

		--堂悦花园-二期维修基金面积*125-0621
        IF @projGUID IN ( 'd100586a-fbec-4081-99ec-b743e668c60b' )
        BEGIN

            SET @decDsFee = @scmj * 125;
        --set @decDsFee=ceiling (@mjtmp*45 ) 
        END;

        --常州市钟楼区月季路159亩地块 一期 住宅120，商铺60,车位60

      
		--云影逸品华庭和云影逸品华庭二期都要设置
		 IF @projGUID IN ( '3568689b-2a4a-ea11-80b8-0a94ef7517dd','3568689b-2a4a-ea11-80b8-0a94ef7517dd','16dcb4b7-2e7e-ea11-80b8-0a94ef7517dd',
		 '263e3d8b-58a5-4b75-8150-4acf9f18760b' ,'A1287B85-3AD4-E911-80B7-0A94EF7517DD','0A18AC44-2E1A-44DC-B9B0-036BEA1F6039') 
        BEGIN

            SET @decDsFee = ROUND(@scmj * 120,2);

        END;

        IF (
               @projGUID IN ( '5a517472-4c8f-e911-80b7-0a94ef7517dd' )
               AND @cplx IN ( '商业', '商铺', '地下室/车库' )
           )
        BEGIN

            SET @decDsFee = @scmj * 60;

        END;

        --九里花园二期车库,实测*60

        IF (
               @projGUID IN ( '1403c9a2-195a-e711-80ba-e61f13c57837' )
               AND @cplx IN ( '地下室/车库' )
           )
        BEGIN
            SET @decDsFee = @scmj * 60;
        END;

        --               ELSE 
        --IF ( @projGUID IN ( '5a517472-4c8f-e911-80b7-0a94ef7517dd' )) BEGIN

        --                                                                                      SET @decDsFee = @scmj * 120;

        --                        END;



        ELSE IF (@projGUID NOT IN ( '48d89321-42b2-e711-80ba-e61f13c57837', '5a517472-4c8f-e911-80b7-0a94ef7517dd',
                                    '1403c9a2-195a-e711-80ba-e61f13c57837', '3568689b-2a4a-ea11-80b8-0a94ef7517dd',
									'3568689b-2a4a-ea11-80b8-0a94ef7517dd','16dcb4b7-2e7e-ea11-80b8-0a94ef7517dd',
									'263e3d8b-58a5-4b75-8150-4acf9f18760b','54FFA6AE-3A94-EA11-80B8-0A94EF7517DD','A1287B85-3AD4-E911-80B7-0A94EF7517DD','0A18AC44-2E1A-44DC-B9B0-036BEA1F6039','F86A5960-63D6-EB11-B398-F40270D39969','d100586a-fbec-4081-99ec-b743e668c60b','75856a13-6c55-eb11-b398-f40270d39969','497e5c8c-9e80-eb11-b398-f40270d39969','28597f8e-a628-ec11-b398-f40270d39969'
                                  )
                )
        BEGIN
            SET @decDsFee = @scmj * 90;
        END;


		  IF (@projGUID IN ( '5a517472-4c8f-e911-80b7-0a94ef7517dd' ,'8ff1c7fc-ebde-eb11-b398-f40270d39969','75856a13-6c55-eb11-b398-f40270d39969') AND @cplx = '住宅')
        BEGIN

            SET @decDsFee = @scmj * 120;

        END;
		--天悦华府
			  IF (@projGUID IN ( 'da43aeea-1d5a-e711-80ba-e61f13c57837','2dcadf2c-bb5c-e711-80ba-e61f13c57837','c7e6b13f-1f5a-e711-80ba-e61f13c57837') AND @cplx = '地下室/车库')
        BEGIN

            SET @decDsFee = @scmj * 90;

        END;
		 --常州市天宁区东方西路南侧地块-一期
		---	常州市新北区黄河中路南侧地块-一期				 		 
					 IF ( @projGUID IN ( '9AADB957-2DEA-EB11-B398-F40270D39969','a31c72a0-a628-ec11-b398-f40270d39969' ) and @cplx IN ( '地下室/车库') )
						 BEGIN
                               SET @decDsFee = @scmj * 60;
                        END;

					 IF ( @projGUID IN ( '9AADB957-2DEA-EB11-B398-F40270D39969' ) and @cplx not IN ( '地下室/车库') )
						 BEGIN
                               SET @decDsFee = @scmj * 120;
                        END;


		  IF (@projGUID IN ( '8ff1c7fc-ebde-eb11-b398-f40270d39969') AND @cplx = '地下室/车库')
        BEGIN

            SET @decDsFee = @scmj * 45;

        END;
		---项目：常州市新北区黄河中路南侧地块-一期--范围：1 2 3 4 5 6 7 8 10栋
		 IF (@bldguid IN ( '90B42578-A179-4D52-9156-B46247C89134',
'DEDF3B78-ED30-46FE-8F12-FCEF304D8990',
'CE1D86D2-E011-4248-8546-81761157D425',
'6A362CB2-1C22-4679-91A4-74E181223E2E',
'7CBFBB80-C25E-46D1-8ABA-7C484BEB2029',
'F92379BA-CCC2-44C7-B15F-1323617A12C6',
'B49932D2-9662-4029-9F98-EC9F8B80BEFA',
'C1483CFF-F3B1-4608-AFBB-B81A54FEB9D1',
'4E9CB696-5B45-4851-94F9-BDAA68E5E738') )
        BEGIN

            SET @decDsFee = @scmj * 120;

        END;
		  IF (@projGUID IN ( 'e14eab52-6c40-ed11-b39d-f40270d39969') AND @cplx = '住宅')
        BEGIN

            SET @decDsFee = @scmj * 120;

        END;
		IF (@projGUID IN ( 'e14eab52-6c40-ed11-b39d-f40270d39969') AND @cplx = '地下室/车库')
        BEGIN

            SET @decDsFee = @scmj * 45;

        END;

    END;
--维修基金计算完毕                                        

END;
---江南公司代收费用计算结束                                          


--京津冀公司代收费用开始计算                                                  
IF (@buguid = '289A694A-E5D1-4F02-BFEF-8510E4B6C6A0' or @buguid = 'BC0235CB-1137-4488-8192-E55DC27ACCD7' )
BEGIN
    --公共维修基金                                                               
    IF @chvItemName IN ( '公共维修基金' )
    BEGIN
        SET @scmj = 0;
        SET @mjtmp = 0;
        SET @gd = 0;

        IF @chvSource = '定单'
        BEGIN
            --来源为“定单”通过交易表获取                                                  
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Order
            WHERE OrderGUID = @chvSaleGUID;
            SELECT @cplx = p_BuildProductType.BProductTypeName,
                   @productname = p_room.productname
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = BldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;
            IF CHARINDEX('高层住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高层住宅';
            END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        IF @chvSource = '合同'
        --来源为“合同”通过合同表获取                                                  
        BEGIN
            SELECT @chvRoomGUID = RoomGUID,
                   @mjtmp = BldArea
            FROM s_Contract
            WHERE ContractGUID = @chvSaleGUID;
            SELECT @bldguid = BldGUID,
                   @cplx = p_BuildProductType.BProductTypeName,
                   @productname = p_room.productname
            FROM p_room,
                 p_BuildProductType
            WHERE p_room.BProductTypeCode = p_BuildProductType.BProductTypeCode
                  AND p_room.RoomGUID = @chvRoomGUID;
            SELECT @scmj = BldArea,
                   @mjtmp = YsBldArea
            FROM p_room
            WHERE p_room.RoomGUID = @chvRoomGUID;

            SELECT @floor = MAX(FloorNo)
            FROM p_FloorPlan
            WHERE BldGUID = @bldguid;

            IF CHARINDEX('住宅', @cplx) > 0
            BEGIN
                SET @cplx = '住宅';
            END;

            --IF CHARINDEX('储藏室', @cplx) > 0 BEGIN
            --                                                     SET @cplx  =  '储藏室';
            --                       END;
            IF CHARINDEX('高级住宅', @cplx) > 0
            BEGIN
                SET @cplx = '高级住宅';
            END;
            IF CHARINDEX('商业', @cplx) > 0
            BEGIN
                SET @cplx = '商业';
            END;
            IF CHARINDEX('写字楼', @cplx) > 0
            BEGIN
                SET @cplx = '写字楼';
            END;
            IF CHARINDEX('地下室/车库', @cplx) > 0
            BEGIN
                SET @cplx = '地下室/车库';
            END;
            IF CHARINDEX('公寓', @cplx) > 0
            BEGIN
                SET @cplx = '公寓';
            END;
        END;

        --开始计算    
		--德州市齐河县生态城健康小镇首期用地二期小高层建筑收费标准为62.5元/平方米（按照实测面积）中高层住宅收费标准为80元/平方米（按照实测面积）
		IF @projGUID IN ( '24b59a6e-2331-4544-929d-3933bd2a43b4')
               AND @chvRoomGUID IN (
                                       SELECT RoomGUID
                                       FROM p_room
                                       WHERE bldguid IN ( 'D95B5932-3EB2-4E34-87E6-D5E1AA3FA52A',
                                                          '7CD31410-7988-4CA1-A91C-5A54CD6B5237',
                                                          'F1B023EB-27B2-4A07-8DF2-7B1D9AFF39F9',
														  'E9370DB5-6D8F-4701-974F-803A02EBBD52',
														  'F1B023EB-27B2-4A07-8DF2-7B1D9AFF39F9',
														  'E9370DB5-6D8F-4701-974F-803A02EBBD52',
														  '25F81878-4F12-48EE-AFF8-C85D4CADAB05',
'A300F51F-8CC7-444E-A871-845F4C273B13',
'0B595AB0-9DBB-4A9D-81C5-34A0D6920F56',
'E6376D1D-2D47-46B7-AE92-F1C65088A3AA',
'942809D0-1271-4951-8ADB-FB278041C1FD',
'FA397570-12EA-4B0B-8699-59BED1FAC64D',
'AE880F02-0EB3-423A-899B-A6E182072EC0',
'229B2BA4-48A5-4A58-B68D-0D9460F3047B'
                                                        )
                                   )
                SET @decDsFee = @scmj * 62.5;

				

		IF @projGUID IN ( '24b59a6e-2331-4544-929d-3933bd2a43b4')
               AND @chvRoomGUID IN (
                                       SELECT RoomGUID
                                       FROM p_room
                                       WHERE bldguid IN ( '472B765A-8517-4DBA-8BD4-597ACC66290B',
                                                          'C2278517-98C1-4DED-A275-0BDBFFEBEDC3',
                                                          '964C436A-AE98-4CB6-8A3B-5DE47341594B',
														  '0B9876EC-FAB8-4359-8993-A0E1A49180B9',
														  '4A7CC29F-887A-4AFE-AD03-D07A9953DD88',
														  '8390174E-F546-48D4-807B-30B4FB27B79C',
														  '962023CB-CCB4-4250-A1E5-262615057E5B',
														  'B80E96B4-8676-4736-AAEA-28AD43522502',
														  'ADED1159-774A-4C19-B04D-6D3EE287329D',
														  '8906D9DF-1D72-4F53-8D00-EBAFDE71B67F',
														  'B80E96B4-8676-4736-AAEA-28AD43522502',
														  'ADED1159-774A-4C19-B04D-6D3EE287329D',
														  '8906D9DF-1D72-4F53-8D00-EBAFDE71B67F',
														  '998F6F51-BBD5-44D6-9EC3-EDAC8C046427',
														  '9A2DD2DC-8ACE-4318-8049-1B4C5E5BD016',
'0832C499-AA34-487F-8F4A-2C1F8B2B71F3',
'95C03F87-6C6F-445E-A256-38E6D663BAA3',
'7AD344AB-8F3F-40DA-AD9C-E46E6E8B55A2',
'E986545B-63A7-4738-BC4D-F83892B058DD',
'6F902DA8-62DC-4065-A19C-0619675C98D1',
'A2015A5C-22D0-4F3D-96B8-C91517AB2A47',
'80F77C45-5726-4137-9F0E-BFE8374776C1',
'3B6C37DB-FFF5-46C4-B617-63AFC47F35E9',
'44E9B7DC-7EA6-4A2A-BA91-AAC44BA44621',
'9200CCA0-A8CA-4C47-AAFD-BB0C4738EB4E'
                                                        )
                                   )
                SET @decDsFee = @scmj * 80;

				--齐鲁公司--健康小镇项目首期用地-二期- S1 S2 S3商铺 维修基金公式：实测建筑面积X48㎡/元
		IF @projGUID IN ( '24b59a6e-2331-4544-929d-3933bd2a43b4')
			and @bldguid in('B5543DED-D7D9-449D-9C56-E639BE3974AC','210A87C9-E376-45CF-A9B8-1FD85DD299EB','033BCA06-3EB1-4D7E-9B76-552CD36765C3')
		SET @decDsFee = @scmj * 48;

						--齐鲁公司--健康小镇项目首期用地-一期- 商铺 维修基金公式：实测建筑面积X48㎡/元，非商业80
		IF @projGUID IN ( 'DD19CC3F-5B48-E811-80BA-E61F13C57837')
			and @bldguid in('E73230EF-78BA-E811-80BF-E61F13C57837','D3760F42-FC6D-4095-B39D-7FD11D75FA40','8A3AB03A-5C8A-4AFD-A097-08081D37551A',
			'6503E456-F34B-4331-B445-92AE9475808C','BBDFB573-A8D2-E811-80BF-E61F13C57837')
		SET @decDsFee = @scmj * 48;
		IF @projGUID IN ( 'DD19CC3F-5B48-E811-80BA-E61F13C57837')
			and @bldguid not in('E73230EF-78BA-E811-80BF-E61F13C57837','D3760F42-FC6D-4095-B39D-7FD11D75FA40','8A3AB03A-5C8A-4AFD-A097-08081D37551A',
			'6503E456-F34B-4331-B445-92AE9475808C','BBDFB573-A8D2-E811-80BF-E61F13C57837')
		SET @decDsFee = @scmj * 80;

        --德州市齐河县生态城健康小镇首期用地                                       
        IF (@projGUID IN ( 'F32508C6-A0DF-47F5-806A-4AAF009324E7',
                           'E3399117-34EC-4761-89C6-4F180C51B7D6', '44319AF6-C5EF-48EB-944E-6BB1C4CB77D0',
                           'EB039E25-A964-4CE8-9242-8595BC64FD7E', '0745946E-BD55-4154-A566-BDB2012BA7DE'
                         )
           )
        --   德州市齐河县生态城健康小镇首期用地 计算方式：高层住宅收费标准为80元/平方米，7-12层建筑收费标准为62.5元/平方米(小高层，中高层)，商铺收费标准为48元/平方米（实测面积
        BEGIN
            IF @productname = '高层住宅'
            BEGIN

                SET @decDsFee = @scmj * 80;
            END;
            IF @productname IN ( '小高层住宅', '中高层住宅', '地下储藏室' )
            BEGIN

                SET @decDsFee = @scmj * 62.5;
            END;
            IF @cplx = '地下室/车库'
               AND @productname NOT IN ( '地下储藏室' )
            BEGIN

                SET @decDsFee = @scmj * 80;
            END;
            IF @cplx = '商业'
            BEGIN
                SET @decDsFee = @scmj * 48;
            END;
            IF @floor >= 7
               AND @floor <= 12
            BEGIN
                SET @decDsFee = @scmj * 62.5;
            END;
        END;
        PRINT '楼层';
        PRINT @floor;
        PRINT @productname;
        PRINT @decDsFee;
        PRINT '德州';
        RETURN 6;
    END;
--维修基金计算完毕                                        

END;
---京津冀公司代收费用计算结束







