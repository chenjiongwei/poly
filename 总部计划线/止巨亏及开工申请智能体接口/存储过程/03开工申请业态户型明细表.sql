CREATE OR ALTER PROC [dbo].[usp_s_集团开工申请业态户型明细表智能体数据提取]
AS
BEGIN
   
    
    /***********************************************************************
    步骤2：删除当日已存在的数据，避免重复插入
    说明：
        - 以清洗日期为准，删除当天已存在的数据
    ***********************************************************************/
    DELETE FROM s_集团开工申请楼栋明细表智能体数据提取
    WHERE DATEDIFF(DAY, 清洗日期, GETDATE()) = 0

    INSERT INTO s_集团开工申请业态户型明细表智能体数据提取
    (
        公司名称,
        公司GUID,
        项目名称,
        推广名称,
        项目GUID,
        业态,
        产品类型,
        产品名称,
        户型,
        总可售面积,
        总货值,
        开工套数,
        已售套数,
        已开工未售套数,
        其中已达预售条件未售套数,
        开工面积,
        已售面积,
        已开工未售面积,
        其中已达预售条件未售面积,
        其中已推未售面积,
        近6个月的总签约面积,
        近6月平均流速,
        已售部分含税货值,
        已售部分不含税货值,
        已售部分销售均价,
        已售部分的税后净利润,
        已售部分的销净率,
        已售部分推货去化率,
        户型产销比,
        剩余存销比,
        项目历史供货周期,
        户型是否滞销,
        偏差,
        清洗日期
    )

    
    SELECT
        公司名称,
        公司GUID,
        项目名称,
        推广名称,
        项目GUID,
        业态,
        产品类型,
        产品名称,
        户型,
        总可售面积,
        总货值,
        开工套数,
        已售套数,
        已开工未售套数,
        其中已达预售条件未售套数,
        开工面积,
        已售面积,
        已开工未售面积,
        其中已达预售条件未售面积,
        其中已推未售面积,
        近6个月的总签约面积,
        近6月平均流速,
        已售部分含税货值,
        已售部分不含税货值,
        已售部分销售均价,
        已售部分的税后净利润,
        已售部分的销净率,
        已售部分推货去化率,
        户型产销比,
        剩余存销比,
        项目历史供货周期,
        户型是否滞销,
        偏差,
        GETDATE() AS 清洗日期
    FROM 源数据表 -- 请将“源数据表”替换为实际的数据来源表或视图

    SELECT *
    FROM s_集团开工申请业态户型明细表智能体数据提取  
    -- WHERE DATEDIFF(DAY, 清洗日期, GETDATE()) = 0  -- 如需仅查当天数据可启用
    ORDER BY 项目名称 DESC

END